function t(){}function e(t){return t()}function r(){return Object.create(null)}function n(t){t.forEach(e)}function i(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(e,...r){if(null==e)return t;const n=e.subscribe(...r);return n.unsubscribe?()=>n.unsubscribe():n}function s(t,e,r){t.$$.on_destroy.push(a(e,r))}function u(t,e,r,n){if(t){const i=l(t,e,r,n);return t[0](i)}}function l(t,e,r,n){return t[1]&&n?function(t,e){for(const r in e)t[r]=e[r];return t}(r.ctx.slice(),t[1](n(e))):r.ctx}function c(t,e,r,n,i,o,a){const s=function(t,e,r,n){if(t[2]&&n){const i=t[2](n(r));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],r=Math.max(e.dirty.length,i.length);for(let n=0;n<r;n+=1)t[n]=e.dirty[n]|i[n];return t}return e.dirty|i}return e.dirty}(e,n,i,o);if(s){const i=l(e,r,n,a);t.p(i,s)}}function h(t,e,r=e){return t.set(r),e}function p(t,e){t.appendChild(e)}function d(t,e,r){t.insertBefore(e,r||null)}function f(t){t.parentNode.removeChild(t)}function m(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function g(t){return document.createElement(t)}function v(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function y(t){return document.createTextNode(t)}function x(){return y(" ")}function b(){return y("")}function _(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function w(t,e,r){null==r?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function T(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function E(t,e,r,n){t.style.setProperty(e,r,n?"important":"")}function S(t,e,r){t.classList[r?"add":"remove"](e)}let A;function P(t){A=t}function M(){if(!A)throw new Error("Function called outside component initialization");return A}function I(t){M().$$.on_mount.push(t)}function O(t){return M().$$.context.get(t)}const C=[],R=[],L=[],N=[],F=Promise.resolve();let D=!1;function U(t){L.push(t)}function k(t){N.push(t)}let j=!1;const B=new Set;function z(){if(!j){j=!0;do{for(let t=0;t<C.length;t+=1){const e=C[t];P(e),G(e.$$)}for(P(null),C.length=0;R.length;)R.pop()();for(let t=0;t<L.length;t+=1){const e=L[t];B.has(e)||(B.add(e),e())}L.length=0}while(C.length);for(;N.length;)N.pop()();D=!1,j=!1,B.clear()}}function G(t){if(null!==t.fragment){t.update(),n(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(U)}}const V=new Set;let H;function X(){H={r:0,c:[],p:H}}function W(){H.r||n(H.c),H=H.p}function Y(t,e){t&&t.i&&(V.delete(t),t.i(e))}function q(t,e,r,n){if(t&&t.o){if(V.has(t))return;V.add(t),H.c.push((()=>{V.delete(t),n&&(r&&t.d(1),n())})),t.o(e)}}function $(t,e,r){const n=t.$$.props[e];void 0!==n&&(t.$$.bound[n]=r,r(t.$$.ctx[n]))}function Q(t){t&&t.c()}function Z(t,r,o){const{fragment:a,on_mount:s,on_destroy:u,after_update:l}=t.$$;a&&a.m(r,o),U((()=>{const r=s.map(e).filter(i);u?u.push(...r):n(r),t.$$.on_mount=[]})),l.forEach(U)}function J(t,e){const r=t.$$;null!==r.fragment&&(n(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function K(t,e){-1===t.$$.dirty[0]&&(C.push(t),D||(D=!0,F.then(z)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function tt(e,i,o,a,s,u,l=[-1]){const c=A;P(e);const h=i.props||{},p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:l,skip_bound:!1};let d=!1;if(p.ctx=o?o(e,h,((t,r,...n)=>{const i=n.length?n[0]:r;return p.ctx&&s(p.ctx[t],p.ctx[t]=i)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](i),d&&K(e,t)),r})):[],p.update(),d=!0,n(p.before_update),p.fragment=!!a&&a(p.ctx),i.target){if(i.hydrate){const t=(m=i.target,Array.from(m.childNodes));p.fragment&&p.fragment.l(t),t.forEach(f)}else p.fragment&&p.fragment.c();i.intro&&Y(e.$$.fragment),Z(e,i.target,i.anchor),z()}var m;P(c)}class et{$destroy(){J(this,1),this.$destroy=t}$on(t,e){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const rt=[];function nt(e,r=t){let n;const i=[];function a(t){if(o(e,t)&&(e=t,n)){const t=!rt.length;for(let t=0;t<i.length;t+=1){const r=i[t];r[1](),rt.push(r,e)}if(t){for(let t=0;t<rt.length;t+=2)rt[t][0](rt[t+1]);rt.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(o,s=t){const u=[o,s];return i.push(u),1===i.length&&(n=r(a)||t),o(e),()=>{const t=i.indexOf(u);-1!==t&&i.splice(t,1),0===i.length&&(n(),n=null)}}}}function it(e,r,o){const s=!Array.isArray(e),u=s?[e]:e,l=r.length<2;return{subscribe:nt(o,(e=>{let o=!1;const c=[];let h=0,p=t;const d=()=>{if(h)return;p();const n=r(s?c[0]:c,e);l?e(n):p=i(n)?n:t},f=u.map(((t,e)=>a(t,(t=>{c[e]=t,h&=~(1<<e),o&&d()}),(()=>{h|=1<<e}))));return o=!0,d(),function(){n(f),p()}})).subscribe}}var ot=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===at}(t)}(t)};var at="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function st(t,e){return!1!==e.clone&&e.isMergeableObject(t)?pt((r=t,Array.isArray(r)?[]:{}),t,e):t;var r}function ut(t,e,r){return t.concat(e).map((function(t){return st(t,r)}))}function lt(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function ct(t,e){try{return e in t}catch(t){return!1}}function ht(t,e,r){var n={};return r.isMergeableObject(t)&&lt(t).forEach((function(e){n[e]=st(t[e],r)})),lt(e).forEach((function(i){(function(t,e){return ct(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,i)||(ct(t,i)&&r.isMergeableObject(e[i])?n[i]=function(t,e){if(!e.customMerge)return pt;var r=e.customMerge(t);return"function"==typeof r?r:pt}(i,r)(t[i],e[i],r):n[i]=st(e[i],r))})),n}function pt(t,e,r){(r=r||{}).arrayMerge=r.arrayMerge||ut,r.isMergeableObject=r.isMergeableObject||ot,r.cloneUnlessOtherwiseSpecified=st;var n=Array.isArray(e);return n===Array.isArray(t)?n?r.arrayMerge(t,e,r):ht(t,e,r):st(e,r)}pt.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,r){return pt(t,r,e)}),{})};var dt=pt;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var ft=function(t,e){return(ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function mt(t,e){function r(){this.constructor=t}ft(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var gt,vt,yt,xt,bt=function(){return(bt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function _t(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}function wt(t){return t.type===gt.literal}function Tt(t){return t.type===gt.argument}function Et(t){return t.type===gt.number}function St(t){return t.type===gt.date}function At(t){return t.type===gt.time}function Pt(t){return t.type===gt.select}function Mt(t){return t.type===gt.plural}function It(t){return t.type===gt.pound}function Ot(t){return t.type===gt.tag}function Ct(t){return!(!t||"object"!=typeof t||0!==t.type)}function Rt(t){return!(!t||"object"!=typeof t||1!==t.type)}(vt=gt||(gt={}))[vt.literal=0]="literal",vt[vt.argument=1]="argument",vt[vt.number=2]="number",vt[vt.date=3]="date",vt[vt.time=4]="time",vt[vt.select=5]="select",vt[vt.plural=6]="plural",vt[vt.pound=7]="pound",vt[vt.tag=8]="tag",(xt=yt||(yt={}))[xt.number=0]="number",xt[xt.dateTime=1]="dateTime";var Lt=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;var Nt=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,Ft=/^(@+)?(\+|#+)?$/g;function Dt(t){var e={};return t.replace(Ft,(function(t,r,n){return"string"!=typeof n?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):"+"===n?e.minimumSignificantDigits=r.length:"#"===r[0]?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+("string"==typeof n?n.length:0)),""})),e}function Ut(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":return{currencySign:"accounting"};case"sign-always":return{signDisplay:"always"};case"sign-accounting-always":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":return{signDisplay:"never"}}}function kt(t){var e=Ut(t);return e||{}}function jt(t){for(var e={},r=0,n=t;r<n.length;r++){var i=n[r];switch(i.stem){case"percent":e.style="percent";continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":e.style="unit",e.unit=i.options[0].replace(/^(.*?)-/,"");continue;case"compact-short":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=bt(bt(bt({},e),{notation:"scientific"}),i.options.reduce((function(t,e){return bt(bt({},t),kt(e))}),{}));continue;case"engineering":e=bt(bt(bt({},e),{notation:"engineering"}),i.options.reduce((function(t,e){return bt(bt({},t),kt(e))}),{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue}if(Nt.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(Nt,(function(t,r,n,i,o,a){return"*"===n?e.minimumFractionDigits=r.length:i&&"#"===i[0]?e.maximumFractionDigits=i.length:o&&a?(e.minimumFractionDigits=o.length,e.maximumFractionDigits=o.length+a.length):(e.minimumFractionDigits=r.length,e.maximumFractionDigits=r.length),""})),i.options.length&&(e=bt(bt({},e),Dt(i.options[0])))}else if(Ft.test(i.stem))e=bt(bt({},e),Dt(i.stem));else{var o=Ut(i.stem);o&&(e=bt(bt({},e),o))}}return e}var Bt=function(t){function e(r,n,i,o){var a=t.call(this)||this;return a.message=r,a.expected=n,a.found=i,a.location=o,a.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(a,e),a}return mt(e,t),e.buildMessage=function(t,e){function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function n(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function o(t){switch(t.type){case"literal":return'"'+n(t.text)+'"';case"class":var e=t.parts.map((function(t){return Array.isArray(t)?i(t[0])+"-"+i(t[1]):i(t)}));return"["+(t.inverted?"^":"")+e+"]";case"any":return"any character";case"end":return"end of input";case"other":return t.description}}return"Expected "+function(t){var e,r,n=t.map(o);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+(((a=e)?'"'+n(a)+'"':"end of input")+" found.");var a},e}(Error);var zt=function(t,e){e=void 0!==e?e:{};var r,n={},i={start:Wt},o=Wt,a="<",s=kt("<",!1),u=function(t){return t.join("")},l=kt("#",!1),c=Gt("tagElement"),h=kt("/>",!1),p=kt(">",!1),d=kt("</",!1),f=Gt("argumentElement"),m="{",g=kt("{",!1),v="}",y=kt("}",!1),x=Gt("numberSkeletonId"),b=/^['\/{}]/,_=zt(["'","/","{","}"],!1,!1),w={type:"any"},T=Gt("numberSkeletonTokenOption"),E=kt("/",!1),S=Gt("numberSkeletonToken"),A="::",P=kt("::",!1),M=function(t){return ye.pop(),t.replace(/\s*$/,"")},I=",",O=kt(",",!1),C="number",R=kt("number",!1),L=function(t,e,r){return bt({type:"number"===e?gt.number:"date"===e?gt.date:gt.time,style:r&&r[2],value:t},be())},N="'",F=kt("'",!1),D=/^[^']/,U=zt(["'"],!0,!1),k=/^[^a-zA-Z'{}]/,j=zt([["a","z"],["A","Z"],"'","{","}"],!0,!1),B=/^[a-zA-Z]/,z=zt([["a","z"],["A","Z"]],!1,!1),G="date",V=kt("date",!1),H="time",X=kt("time",!1),W="plural",Y=kt("plural",!1),q="selectordinal",$=kt("selectordinal",!1),Q="offset:",Z=kt("offset:",!1),J="select",K=kt("select",!1),tt=kt("=",!1),et=Gt("whitespace"),rt=/^[\t-\r \x85\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,nt=zt([["\t","\r"]," ",""," "," ",[" "," "],"\u2028","\u2029"," "," ","　"],!1,!1),it=Gt("syntax pattern"),ot=/^[!-\/:-@[-\^`{-~\xA1-\xA7\xA9\xAB\xAC\xAE\xB0\xB1\xB6\xBB\xBF\xD7\xF7\u2010-\u2027\u2030-\u203E\u2041-\u2053\u2055-\u205E\u2190-\u245F\u2500-\u2775\u2794-\u2BFF\u2E00-\u2E7F\u3001-\u3003\u3008-\u3020\u3030\uFD3E\uFD3F\uFE45\uFE46]/,at=zt([["!","/"],[":","@"],["[","^"],"`",["{","~"],["¡","§"],"©","«","¬","®","°","±","¶","»","¿","×","÷",["‐","‧"],["‰","‾"],["⁁","⁓"],["⁕","⁞"],["←","⑟"],["─","❵"],["➔","⯿"],["⸀","⹿"],["、","〃"],["〈","〠"],"〰","﴾","﴿","﹅","﹆"],!1,!1),st=Gt("optional whitespace"),ut=Gt("number"),lt="-",ct=kt("-",!1),ht=Gt("double apostrophes"),pt="''",dt=kt("''",!1),ft=function(t){return!("<"===t||"{"===t||xe()&&"#"===t||ye.length>1&&"}"===t)},mt=kt("\n",!1),vt=Gt("argNameOrNumber"),yt=Gt("validTag"),xt=Gt("argNumber"),_t=kt("0",!1),wt=/^[1-9]/,Tt=zt([["1","9"]],!1,!1),Et=/^[0-9]/,St=zt([["0","9"]],!1,!1),At=Gt("argName"),Pt=Gt("tagName"),Mt=0,It=0,Ot=[{line:1,column:1}],Ct=0,Rt=[],Nt=0;if(void 0!==e.startRule){if(!(e.startRule in i))throw new Error("Can't start parsing from rule \""+e.startRule+'".');o=i[e.startRule]}function Ft(){return t.substring(It,Mt)}function Dt(){return Ht(It,Mt)}function Ut(t,e){throw function(t,e){return new Bt(t,[],"",e)}(t,e=void 0!==e?e:Ht(It,Mt))}function kt(t,e){return{type:"literal",text:t,ignoreCase:e}}function zt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Gt(t){return{type:"other",description:t}}function Vt(e){var r,n=Ot[e];if(n)return n;for(r=e-1;!Ot[r];)r--;for(n={line:(n=Ot[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ot[e]=n,n}function Ht(t,e){var r=Vt(t),n=Vt(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Xt(t){Mt<Ct||(Mt>Ct&&(Ct=Mt,Rt=[]),Rt.push(t))}function Wt(){return Yt()}function Yt(){var t,e;for(t=[],e=qt();e!==n;)t.push(e),e=qt();return t}function qt(){var e,r;return e=Mt,It=Mt,(!Ee?void 0:n)!==n&&(r=function(){var t,e,r,i;Nt++,(t=Zt())===n&&(t=Mt,(e=Jt())!==n&&(r=Yt())!==n&&(i=Kt())!==n?(It=t,a=r,(o=e)!==(s=i)&&Ut('Mismatch tag "'+o+'" !== "'+s+'"',Dt()),t=e=bt({type:gt.tag,value:o,children:a},be())):(Mt=t,t=n));var o,a,s;Nt--,t===n&&(e=n,0===Nt&&Xt(c));return t}())!==n?(It=e,e=r):(Mt=e,e=n),e===n&&(e=function(){var t,e;t=Mt,(e=$t())!==n&&(It=t,r=e,e=bt({type:gt.literal,value:r},be()));var r;return t=e}())===n&&(e=function(){var e,r,i,o;Nt++,e=Mt,123===t.charCodeAt(Mt)?(r=m,Mt++):(r=n,0===Nt&&Xt(g));r!==n&&le()!==n&&(i=fe())!==n&&le()!==n?(125===t.charCodeAt(Mt)?(o=v,Mt++):(o=n,0===Nt&&Xt(y)),o!==n?(It=e,a=i,e=r=bt({type:gt.argument,value:a},be())):(Mt=e,e=n)):(Mt=e,e=n);var a;Nt--,e===n&&(r=n,0===Nt&&Xt(f));return e}())===n&&(e=function(){var e;(e=function(){var e,r,i,o,a,s,u,l,c;e=Mt,123===t.charCodeAt(Mt)?(r=m,Mt++):(r=n,0===Nt&&Xt(g));r!==n&&le()!==n&&(i=fe())!==n&&le()!==n?(44===t.charCodeAt(Mt)?(o=I,Mt++):(o=n,0===Nt&&Xt(O)),o!==n&&le()!==n?(t.substr(Mt,6)===C?(a=C,Mt+=6):(a=n,0===Nt&&Xt(R)),a!==n&&le()!==n?(s=Mt,44===t.charCodeAt(Mt)?(u=I,Mt++):(u=n,0===Nt&&Xt(O)),u!==n&&(l=le())!==n&&(c=function(){var e,r,i;e=Mt,t.substr(Mt,2)===A?(r=A,Mt+=2):(r=n,0===Nt&&Xt(P));r!==n&&(i=function(){var t,e,r;if(t=Mt,e=[],(r=re())!==n)for(;r!==n;)e.push(r),r=re();else e=n;e!==n&&(It=t,e=bt({type:0,tokens:i=e,parsedOptions:Se?jt(i):{}},be()));var i;return t=e}())!==n?(It=e,e=r=i):(Mt=e,e=n);e===n&&(e=Mt,It=Mt,ye.push("numberArgStyle"),(r=(r=!0)?void 0:n)!==n&&(i=$t())!==n?(It=e,e=r=M(i)):(Mt=e,e=n));return e}())!==n?s=u=[u,l,c]:(Mt=s,s=n),s===n&&(s=null),s!==n&&(u=le())!==n?(125===t.charCodeAt(Mt)?(l=v,Mt++):(l=n,0===Nt&&Xt(y)),l!==n?(It=e,e=r=L(i,a,s)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n);return e}())===n&&(e=function(){var e,r,i,o,a,s,u,l,c;e=Mt,123===t.charCodeAt(Mt)?(r=m,Mt++):(r=n,0===Nt&&Xt(g));r!==n&&le()!==n&&(i=fe())!==n&&le()!==n?(44===t.charCodeAt(Mt)?(o=I,Mt++):(o=n,0===Nt&&Xt(O)),o!==n&&le()!==n?(t.substr(Mt,4)===G?(a=G,Mt+=4):(a=n,0===Nt&&Xt(V)),a===n&&(t.substr(Mt,4)===H?(a=H,Mt+=4):(a=n,0===Nt&&Xt(X))),a!==n&&le()!==n?(s=Mt,44===t.charCodeAt(Mt)?(u=I,Mt++):(u=n,0===Nt&&Xt(O)),u!==n&&(l=le())!==n&&(c=function(){var e,r,i;e=Mt,t.substr(Mt,2)===A?(r=A,Mt+=2):(r=n,0===Nt&&Xt(P));r!==n&&(i=function(){var e,r,i,o;e=Mt,r=Mt,i=[],(o=ne())===n&&(o=ie());if(o!==n)for(;o!==n;)i.push(o),(o=ne())===n&&(o=ie());else i=n;r=i!==n?t.substring(r,Mt):i;r!==n&&(It=e,r=bt({type:1,pattern:a=r,parsedOptions:Se?(s=a,u={},s.replace(Lt,(function(t){var e=t.length;switch(t[0]){case"G":u.era=4===e?"long":5===e?"narrow":"short";break;case"y":u.year=2===e?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":u.month=["numeric","2-digit","short","long","narrow"][e-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":u.day=["numeric","2-digit"][e-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":u.weekday=4===e?"short":5===e?"narrow":"short";break;case"e":if(e<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");u.weekday=["short","long","narrow","short"][e-4];break;case"c":if(e<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");u.weekday=["short","long","narrow","short"][e-4];break;case"a":u.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":u.hourCycle="h12",u.hour=["numeric","2-digit"][e-1];break;case"H":u.hourCycle="h23",u.hour=["numeric","2-digit"][e-1];break;case"K":u.hourCycle="h11",u.hour=["numeric","2-digit"][e-1];break;case"k":u.hourCycle="h24",u.hour=["numeric","2-digit"][e-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":u.minute=["numeric","2-digit"][e-1];break;case"s":u.second=["numeric","2-digit"][e-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":u.timeZoneName=e<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""})),u):{}},be()));var a,s,u;return e=r}())!==n?(It=e,e=r=i):(Mt=e,e=n);e===n&&(e=Mt,It=Mt,ye.push("dateOrTimeArgStyle"),(r=(r=!0)?void 0:n)!==n&&(i=$t())!==n?(It=e,e=r=M(i)):(Mt=e,e=n));return e}())!==n?s=u=[u,l,c]:(Mt=s,s=n),s===n&&(s=null),s!==n&&(u=le())!==n?(125===t.charCodeAt(Mt)?(l=v,Mt++):(l=n,0===Nt&&Xt(y)),l!==n?(It=e,e=r=L(i,a,s)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n);return e}());return e}())===n&&(e=function(){var e,r,i,o,a,s,u,l,c,h,p;e=Mt,123===t.charCodeAt(Mt)?(r=m,Mt++):(r=n,0===Nt&&Xt(g));if(r!==n)if(le()!==n)if((i=fe())!==n)if(le()!==n)if(44===t.charCodeAt(Mt)?(o=I,Mt++):(o=n,0===Nt&&Xt(O)),o!==n)if(le()!==n)if(t.substr(Mt,6)===W?(a=W,Mt+=6):(a=n,0===Nt&&Xt(Y)),a===n&&(t.substr(Mt,13)===q?(a=q,Mt+=13):(a=n,0===Nt&&Xt($))),a!==n)if(le()!==n)if(44===t.charCodeAt(Mt)?(s=I,Mt++):(s=n,0===Nt&&Xt(O)),s!==n)if(le()!==n)if(u=Mt,t.substr(Mt,7)===Q?(l=Q,Mt+=7):(l=n,0===Nt&&Xt(Z)),l!==n&&(c=le())!==n&&(h=ce())!==n?u=l=[l,c,h]:(Mt=u,u=n),u===n&&(u=null),u!==n)if((l=le())!==n){if(c=[],(h=ae())!==n)for(;h!==n;)c.push(h),h=ae();else c=n;c!==n&&(h=le())!==n?(125===t.charCodeAt(Mt)?(p=v,Mt++):(p=n,0===Nt&&Xt(y)),p!==n?(It=e,d=i,f=a,x=u,b=c,e=r=bt({type:gt.plural,pluralType:"plural"===f?"cardinal":"ordinal",value:d,offset:x?x[2]:0,options:b.reduce((function(t,e){var r=e.id,n=e.value,i=e.location;return r in t&&Ut('Duplicate option "'+r+'" in plural element: "'+Ft()+'"',Dt()),t[r]={value:n,location:i},t}),{})},be())):(Mt=e,e=n)):(Mt=e,e=n)}else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;var d,f,x,b;return e}())===n&&(e=function(){var e,r,i,o,a,s,u,l,c;e=Mt,123===t.charCodeAt(Mt)?(r=m,Mt++):(r=n,0===Nt&&Xt(g));if(r!==n)if(le()!==n)if((i=fe())!==n)if(le()!==n)if(44===t.charCodeAt(Mt)?(o=I,Mt++):(o=n,0===Nt&&Xt(O)),o!==n)if(le()!==n)if(t.substr(Mt,6)===J?(a=J,Mt+=6):(a=n,0===Nt&&Xt(K)),a!==n)if(le()!==n)if(44===t.charCodeAt(Mt)?(s=I,Mt++):(s=n,0===Nt&&Xt(O)),s!==n)if(le()!==n){if(u=[],(l=oe())!==n)for(;l!==n;)u.push(l),l=oe();else u=n;u!==n&&(l=le())!==n?(125===t.charCodeAt(Mt)?(c=v,Mt++):(c=n,0===Nt&&Xt(y)),c!==n?(It=e,h=i,p=u,e=r=bt({type:gt.select,value:h,options:p.reduce((function(t,e){var r=e.id,n=e.value,i=e.location;return r in t&&Ut('Duplicate option "'+r+'" in select element: "'+Ft()+'"',Dt()),t[r]={value:n,location:i},t}),{})},be())):(Mt=e,e=n)):(Mt=e,e=n)}else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;else Mt=e,e=n;var h,p;return e}())===n&&(e=function(){var e,r;e=Mt,35===t.charCodeAt(Mt)?(r="#",Mt++):(r=n,0===Nt&&Xt(l));r!==n&&(It=e,r=bt({type:gt.pound},be()));return e=r}()),e}function $t(){var e,r,i,o;if(e=Mt,It=Mt,(r=(r=Ee)?void 0:n)!==n){if(i=[],(o=he())===n&&(o=pe())===n&&(o=de())===n&&(60===t.charCodeAt(Mt)?(o=a,Mt++):(o=n,0===Nt&&Xt(s))),o!==n)for(;o!==n;)i.push(o),(o=he())===n&&(o=pe())===n&&(o=de())===n&&(60===t.charCodeAt(Mt)?(o=a,Mt++):(o=n,0===Nt&&Xt(s)));else i=n;i!==n?(It=e,e=r=u(i)):(Mt=e,e=n)}else Mt=e,e=n;if(e===n){if(e=Mt,r=[],(i=he())===n&&(i=pe())===n&&(i=de())===n&&(i=Qt()),i!==n)for(;i!==n;)r.push(i),(i=he())===n&&(i=pe())===n&&(i=de())===n&&(i=Qt());else r=n;r!==n&&(It=e,r=u(r)),e=r}return e}function Qt(){var e,r,i;return e=Mt,r=Mt,Nt++,(i=Jt())===n&&(i=Kt())===n&&(i=Zt()),Nt--,i===n?r=void 0:(Mt=r,r=n),r!==n?(60===t.charCodeAt(Mt)?(i=a,Mt++):(i=n,0===Nt&&Xt(s)),i!==n?(It=e,e=r="<"):(Mt=e,e=n)):(Mt=e,e=n),e}function Zt(){var e,r,i,o,u,l,c;return e=Mt,r=Mt,60===t.charCodeAt(Mt)?(i=a,Mt++):(i=n,0===Nt&&Xt(s)),i!==n&&(o=me())!==n&&(u=le())!==n?("/>"===t.substr(Mt,2)?(l="/>",Mt+=2):(l=n,0===Nt&&Xt(h)),l!==n?r=i=[i,o,u,l]:(Mt=r,r=n)):(Mt=r,r=n),r!==n&&(It=e,c=r,r=bt({type:gt.literal,value:c.join("")},be())),e=r}function Jt(){var e,r,i,o;return e=Mt,60===t.charCodeAt(Mt)?(r=a,Mt++):(r=n,0===Nt&&Xt(s)),r!==n&&(i=me())!==n?(62===t.charCodeAt(Mt)?(o=">",Mt++):(o=n,0===Nt&&Xt(p)),o!==n?(It=e,e=r=i):(Mt=e,e=n)):(Mt=e,e=n),e}function Kt(){var e,r,i,o;return e=Mt,"</"===t.substr(Mt,2)?(r="</",Mt+=2):(r=n,0===Nt&&Xt(d)),r!==n&&(i=me())!==n?(62===t.charCodeAt(Mt)?(o=">",Mt++):(o=n,0===Nt&&Xt(p)),o!==n?(It=e,e=r=i):(Mt=e,e=n)):(Mt=e,e=n),e}function te(){var e,r,i,o,a;if(Nt++,e=Mt,r=[],i=Mt,o=Mt,Nt++,(a=se())===n&&(b.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(_))),Nt--,a===n?o=void 0:(Mt=o,o=n),o!==n?(t.length>Mt?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(w)),a!==n?i=o=[o,a]:(Mt=i,i=n)):(Mt=i,i=n),i!==n)for(;i!==n;)r.push(i),i=Mt,o=Mt,Nt++,(a=se())===n&&(b.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(_))),Nt--,a===n?o=void 0:(Mt=o,o=n),o!==n?(t.length>Mt?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(w)),a!==n?i=o=[o,a]:(Mt=i,i=n)):(Mt=i,i=n);else r=n;return e=r!==n?t.substring(e,Mt):r,Nt--,e===n&&(r=n,0===Nt&&Xt(x)),e}function ee(){var e,r,i;return Nt++,e=Mt,47===t.charCodeAt(Mt)?(r="/",Mt++):(r=n,0===Nt&&Xt(E)),r!==n&&(i=te())!==n?(It=e,e=r=i):(Mt=e,e=n),Nt--,e===n&&(r=n,0===Nt&&Xt(T)),e}function re(){var t,e,r,i;if(Nt++,t=Mt,le()!==n)if((e=te())!==n){for(r=[],i=ee();i!==n;)r.push(i),i=ee();r!==n?(It=t,t={stem:e,options:r}):(Mt=t,t=n)}else Mt=t,t=n;else Mt=t,t=n;return Nt--,t===n&&(n,0===Nt&&Xt(S)),t}function ne(){var e,r,i,o;if(e=Mt,39===t.charCodeAt(Mt)?(r=N,Mt++):(r=n,0===Nt&&Xt(F)),r!==n){if(i=[],(o=he())===n&&(D.test(t.charAt(Mt))?(o=t.charAt(Mt),Mt++):(o=n,0===Nt&&Xt(U))),o!==n)for(;o!==n;)i.push(o),(o=he())===n&&(D.test(t.charAt(Mt))?(o=t.charAt(Mt),Mt++):(o=n,0===Nt&&Xt(U)));else i=n;i!==n?(39===t.charCodeAt(Mt)?(o=N,Mt++):(o=n,0===Nt&&Xt(F)),o!==n?e=r=[r,i,o]:(Mt=e,e=n)):(Mt=e,e=n)}else Mt=e,e=n;if(e===n)if(e=[],(r=he())===n&&(k.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=n,0===Nt&&Xt(j))),r!==n)for(;r!==n;)e.push(r),(r=he())===n&&(k.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=n,0===Nt&&Xt(j)));else e=n;return e}function ie(){var e,r;if(e=[],B.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=n,0===Nt&&Xt(z)),r!==n)for(;r!==n;)e.push(r),B.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=n,0===Nt&&Xt(z));else e=n;return e}function oe(){var e,r,i,o,a,s,u;return e=Mt,le()!==n&&(r=ve())!==n&&le()!==n?(123===t.charCodeAt(Mt)?(i=m,Mt++):(i=n,0===Nt&&Xt(g)),i!==n?(It=Mt,ye.push("select"),(!0?void 0:n)!==n&&(o=Yt())!==n?(125===t.charCodeAt(Mt)?(a=v,Mt++):(a=n,0===Nt&&Xt(y)),a!==n?(It=e,s=r,u=o,ye.pop(),e=bt({id:s,value:u},be())):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e}function ae(){var e,r,i,o,a,s,u;return e=Mt,le()!==n&&(r=function(){var e,r,i,o;return e=Mt,r=Mt,61===t.charCodeAt(Mt)?(i="=",Mt++):(i=n,0===Nt&&Xt(tt)),i!==n&&(o=ce())!==n?r=i=[i,o]:(Mt=r,r=n),(e=r!==n?t.substring(e,Mt):r)===n&&(e=ve()),e}())!==n&&le()!==n?(123===t.charCodeAt(Mt)?(i=m,Mt++):(i=n,0===Nt&&Xt(g)),i!==n?(It=Mt,ye.push("plural"),(!0?void 0:n)!==n&&(o=Yt())!==n?(125===t.charCodeAt(Mt)?(a=v,Mt++):(a=n,0===Nt&&Xt(y)),a!==n?(It=e,s=r,u=o,ye.pop(),e=bt({id:s,value:u},be())):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e}function se(){var e;return Nt++,rt.test(t.charAt(Mt))?(e=t.charAt(Mt),Mt++):(e=n,0===Nt&&Xt(nt)),Nt--,e===n&&0===Nt&&Xt(et),e}function ue(){var e;return Nt++,ot.test(t.charAt(Mt))?(e=t.charAt(Mt),Mt++):(e=n,0===Nt&&Xt(at)),Nt--,e===n&&0===Nt&&Xt(it),e}function le(){var e,r,i;for(Nt++,e=Mt,r=[],i=se();i!==n;)r.push(i),i=se();return e=r!==n?t.substring(e,Mt):r,Nt--,e===n&&(r=n,0===Nt&&Xt(st)),e}function ce(){var e,r,i,o,a;return Nt++,e=Mt,45===t.charCodeAt(Mt)?(r="-",Mt++):(r=n,0===Nt&&Xt(ct)),r===n&&(r=null),r!==n&&(i=ge())!==n?(It=e,o=r,e=r=(a=i)?o?-a:a:0):(Mt=e,e=n),Nt--,e===n&&(r=n,0===Nt&&Xt(ut)),e}function he(){var e,r;return Nt++,e=Mt,t.substr(Mt,2)===pt?(r=pt,Mt+=2):(r=n,0===Nt&&Xt(dt)),r!==n&&(It=e,r="'"),Nt--,(e=r)===n&&(r=n,0===Nt&&Xt(ht)),e}function pe(){var e,r,i,o,a,s;if(e=Mt,39===t.charCodeAt(Mt)?(r=N,Mt++):(r=n,0===Nt&&Xt(F)),r!==n)if((i=function(){var e,r,i,o;e=Mt,r=Mt,t.length>Mt?(i=t.charAt(Mt),Mt++):(i=n,0===Nt&&Xt(w));i!==n?(It=Mt,(o=(o="<"===(a=i)||">"===a||"{"===a||"}"===a||xe()&&"#"===a)?void 0:n)!==n?r=i=[i,o]:(Mt=r,r=n)):(Mt=r,r=n);var a;e=r!==n?t.substring(e,Mt):r;return e}())!==n){for(o=Mt,a=[],t.substr(Mt,2)===pt?(s=pt,Mt+=2):(s=n,0===Nt&&Xt(dt)),s===n&&(D.test(t.charAt(Mt))?(s=t.charAt(Mt),Mt++):(s=n,0===Nt&&Xt(U)));s!==n;)a.push(s),t.substr(Mt,2)===pt?(s=pt,Mt+=2):(s=n,0===Nt&&Xt(dt)),s===n&&(D.test(t.charAt(Mt))?(s=t.charAt(Mt),Mt++):(s=n,0===Nt&&Xt(U)));(o=a!==n?t.substring(o,Mt):a)!==n?(39===t.charCodeAt(Mt)?(a=N,Mt++):(a=n,0===Nt&&Xt(F)),a===n&&(a=null),a!==n?(It=e,e=r=i+o.replace("''","'")):(Mt=e,e=n)):(Mt=e,e=n)}else Mt=e,e=n;else Mt=e,e=n;return e}function de(){var e,r,i,o;return e=Mt,r=Mt,t.length>Mt?(i=t.charAt(Mt),Mt++):(i=n,0===Nt&&Xt(w)),i!==n?(It=Mt,(o=(o=ft(i))?void 0:n)!==n?r=i=[i,o]:(Mt=r,r=n)):(Mt=r,r=n),r===n&&(10===t.charCodeAt(Mt)?(r="\n",Mt++):(r=n,0===Nt&&Xt(mt))),e=r!==n?t.substring(e,Mt):r}function fe(){var e,r;return Nt++,e=Mt,(r=ge())===n&&(r=ve()),e=r!==n?t.substring(e,Mt):r,Nt--,e===n&&(r=n,0===Nt&&Xt(vt)),e}function me(){var e,r;return Nt++,e=Mt,(r=ge())===n&&(r=function(){var e,r,i,o,a;Nt++,e=Mt,r=[],45===t.charCodeAt(Mt)?(i=lt,Mt++):(i=n,0===Nt&&Xt(ct));i===n&&(i=Mt,o=Mt,Nt++,(a=se())===n&&(a=ue()),Nt--,a===n?o=void 0:(Mt=o,o=n),o!==n?(t.length>Mt?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(w)),a!==n?i=o=[o,a]:(Mt=i,i=n)):(Mt=i,i=n));if(i!==n)for(;i!==n;)r.push(i),45===t.charCodeAt(Mt)?(i=lt,Mt++):(i=n,0===Nt&&Xt(ct)),i===n&&(i=Mt,o=Mt,Nt++,(a=se())===n&&(a=ue()),Nt--,a===n?o=void 0:(Mt=o,o=n),o!==n?(t.length>Mt?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(w)),a!==n?i=o=[o,a]:(Mt=i,i=n)):(Mt=i,i=n));else r=n;e=r!==n?t.substring(e,Mt):r;Nt--,e===n&&(r=n,0===Nt&&Xt(Pt));return e}()),e=r!==n?t.substring(e,Mt):r,Nt--,e===n&&(r=n,0===Nt&&Xt(yt)),e}function ge(){var e,r,i,o,a;if(Nt++,e=Mt,48===t.charCodeAt(Mt)?(r="0",Mt++):(r=n,0===Nt&&Xt(_t)),r!==n&&(It=e,r=0),(e=r)===n){if(e=Mt,r=Mt,wt.test(t.charAt(Mt))?(i=t.charAt(Mt),Mt++):(i=n,0===Nt&&Xt(Tt)),i!==n){for(o=[],Et.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(St));a!==n;)o.push(a),Et.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(St));o!==n?r=i=[i,o]:(Mt=r,r=n)}else Mt=r,r=n;r!==n&&(It=e,r=parseInt(r.join(""),10)),e=r}return Nt--,e===n&&(r=n,0===Nt&&Xt(xt)),e}function ve(){var e,r,i,o,a;if(Nt++,e=Mt,r=[],i=Mt,o=Mt,Nt++,(a=se())===n&&(a=ue()),Nt--,a===n?o=void 0:(Mt=o,o=n),o!==n?(t.length>Mt?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(w)),a!==n?i=o=[o,a]:(Mt=i,i=n)):(Mt=i,i=n),i!==n)for(;i!==n;)r.push(i),i=Mt,o=Mt,Nt++,(a=se())===n&&(a=ue()),Nt--,a===n?o=void 0:(Mt=o,o=n),o!==n?(t.length>Mt?(a=t.charAt(Mt),Mt++):(a=n,0===Nt&&Xt(w)),a!==n?i=o=[o,a]:(Mt=i,i=n)):(Mt=i,i=n);else r=n;return e=r!==n?t.substring(e,Mt):r,Nt--,e===n&&(r=n,0===Nt&&Xt(At)),e}var ye=["root"];function xe(){return"plural"===ye[ye.length-1]}function be(){return e&&e.captureLocation?{location:Dt()}:{}}var _e,we,Te,Ee=e&&e.ignoreTag,Se=e&&e.shouldParseSkeleton;if((r=o())!==n&&Mt===t.length)return r;throw r!==n&&Mt<t.length&&Xt({type:"end"}),_e=Rt,we=Ct<t.length?t.charAt(Ct):null,Te=Ct<t.length?Ht(Ct,Ct+1):Ht(Ct,Ct),new Bt(Bt.buildMessage(_e,we),_e,we,Te)},Gt=/(^|[^\\])#/g;function Vt(t){t.forEach((function(t){(Mt(t)||Pt(t))&&Object.keys(t.options).forEach((function(e){for(var r,n=t.options[e],i=-1,o=void 0,a=0;a<n.value.length;a++){var s=n.value[a];if(wt(s)&&Gt.test(s.value)){i=a,o=s;break}}if(o){var u=o.value.replace(Gt,"$1{"+t.value+", number}"),l=zt(u);(r=n.value).splice.apply(r,_t([i,1],l))}Vt(n.value)}))}))}function Ht(t,e){e=bt({normalizeHashtagInPlural:!0,shouldParseSkeleton:!0},e||{});var r=zt(t,e);return e.normalizeHashtagInPlural&&Vt(r),r}function Xt(t,e,r,n){var i,o=null==(i=n)||"number"==typeof i||"boolean"==typeof i?n:r(n),a=e.get(o);return void 0===a&&(a=t.call(this,n),e.set(o,a)),a}function Wt(t,e,r){var n=Array.prototype.slice.call(arguments,3),i=r(n),o=e.get(i);return void 0===o&&(o=t.apply(this,n),e.set(i,o)),o}function Yt(t,e,r,n,i){return r.bind(e,t,n,i)}function qt(t,e){return Yt(t,this,1===t.length?Xt:Wt,e.cache.create(),e.serializer)}function $t(){return JSON.stringify(arguments)}function Qt(){this.cache=Object.create(null)}Qt.prototype.has=function(t){return t in this.cache},Qt.prototype.get=function(t){return this.cache[t]},Qt.prototype.set=function(t,e){this.cache[t]=e};var Zt={create:function(){return new Qt}},Jt=function(t,e){var r=e&&e.cache?e.cache:Zt,n=e&&e.serializer?e.serializer:$t;return(e&&e.strategy?e.strategy:qt)(t,{cache:r,serializer:n})},Kt={variadic:function(t,e){return Yt(t,this,Wt,e.cache.create(),e.serializer)},monadic:function(t,e){return Yt(t,this,Xt,e.cache.create(),e.serializer)}};Jt.strategies=Kt;var te,ee,re=Object.freeze(Object.assign(Object.create(null),Jt,{[Symbol.toStringTag]:"Module",default:Jt,strategies:Kt}));(ee=te||(te={})).MISSING_VALUE="MISSING_VALUE",ee.INVALID_VALUE="INVALID_VALUE",ee.MISSING_INTL_API="MISSING_INTL_API";var ne,ie,oe=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.code=r,i.originalMessage=n,i}return mt(e,t),e.prototype.toString=function(){return"[formatjs Error: "+this.code+"] "+this.message},e}(Error),ae=function(t){function e(e,r,n,i){return t.call(this,'Invalid values for "'+e+'": "'+r+'". Options are "'+Object.keys(n).join('", "')+'"',"INVALID_VALUE",i)||this}return mt(e,t),e}(oe),se=function(t){function e(e,r,n){return t.call(this,'Value for "'+e+'" must be of type '+r,"INVALID_VALUE",n)||this}return mt(e,t),e}(oe),ue=function(t){function e(e,r){return t.call(this,'The intl string context variable "'+e+'" was not provided to the string "'+r+'"',"MISSING_VALUE",r)||this}return mt(e,t),e}(oe);function le(t){return"function"==typeof t}function ce(t,e,r,n,i,o,a){if(1===t.length&&wt(t[0]))return[{type:0,value:t[0].value}];for(var s=[],u=0,l=t;u<l.length;u++){var c=l[u];if(wt(c))s.push({type:0,value:c.value});else if(It(c))"number"==typeof o&&s.push({type:0,value:r.getNumberFormat(e).format(o)});else{var h=c.value;if(!i||!(h in i))throw new ue(h,a);var p=i[h];if(Tt(c))p&&"string"!=typeof p&&"number"!=typeof p||(p="string"==typeof p||"number"==typeof p?String(p):""),s.push({type:"string"==typeof p?0:1,value:p});else if(St(c)){var d="string"==typeof c.style?n.date[c.style]:Rt(c.style)?c.style.parsedOptions:void 0;s.push({type:0,value:r.getDateTimeFormat(e,d).format(p)})}else if(At(c)){d="string"==typeof c.style?n.time[c.style]:Rt(c.style)?c.style.parsedOptions:void 0;s.push({type:0,value:r.getDateTimeFormat(e,d).format(p)})}else if(Et(c)){(d="string"==typeof c.style?n.number[c.style]:Ct(c.style)?c.style.parsedOptions:void 0)&&d.scale&&(p*=d.scale||1),s.push({type:0,value:r.getNumberFormat(e,d).format(p)})}else{if(Ot(c)){var f=c.children,m=c.value,g=i[m];if(!le(g))throw new se(m,"function",a);var v=g(ce(f,e,r,n,i,o).map((function(t){return t.value})));Array.isArray(v)||(v=[v]),s.push.apply(s,v.map((function(t){return{type:"string"==typeof t?0:1,value:t}})))}if(Pt(c)){if(!(y=c.options[p]||c.options.other))throw new ae(c.value,p,Object.keys(c.options),a);s.push.apply(s,ce(y.value,e,r,n,i))}else if(Mt(c)){var y;if(!(y=c.options["="+p])){if(!Intl.PluralRules)throw new oe('Intl.PluralRules is not available in this environment.\nTry polyfilling it using "@formatjs/intl-pluralrules"\n',"MISSING_INTL_API",a);var x=r.getPluralRules(e,{type:c.pluralType}).select(p-(c.offset||0));y=c.options[x]||c.options.other}if(!y)throw new ae(c.value,p,Object.keys(c.options),a);s.push.apply(s,ce(y.value,e,r,n,i,p-(c.offset||0)))}else;}}}return function(t){return t.length<2?t:t.reduce((function(t,e){var r=t[t.length-1];return r&&0===r.type&&0===e.type?r.value+=e.value:t.push(e),t}),[])}(s)}function he(t,e){return e?Object.keys(t).reduce((function(r,n){var i,o;return r[n]=(i=t[n],(o=e[n])?bt(bt(bt({},i||{}),o||{}),Object.keys(i).reduce((function(t,e){return t[e]=bt(bt({},i[e]),o[e]||{}),t}),{})):i),r}),bt({},t)):t}function pe(t){return{create:function(){return{has:function(e){return e in t},get:function(e){return t[e]},set:function(e,r){t[e]=r}}}}}(ie=ne||(ne={}))[ie.literal=0]="literal",ie[ie.object=1]="object";var de=Jt||re;var fe=function(){function t(e,r,n,i){var o,a=this;if(void 0===r&&(r=t.defaultLocale),this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(t){var e=a.formatToParts(t);if(1===e.length)return e[0].value;var r=e.reduce((function(t,e){return t.length&&0===e.type&&"string"==typeof t[t.length-1]?t[t.length-1]+=e.value:t.push(e.value),t}),[]);return r.length<=1?r[0]||"":r},this.formatToParts=function(t){return ce(a.ast,a.locales,a.formatters,a.formats,t,void 0,a.message)},this.resolvedOptions=function(){return{locale:Intl.NumberFormat.supportedLocalesOf(a.locales)[0]}},this.getAst=function(){return a.ast},"string"==typeof e){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");this.ast=t.__parse(e,{normalizeHashtagInPlural:!1,ignoreTag:null==i?void 0:i.ignoreTag})}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=he(t.formats,n),this.locales=r,this.formatters=i&&i.formatters||(void 0===(o=this.formatterCache)&&(o={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:de((function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((t=Intl.NumberFormat).bind.apply(t,_t([void 0],e)))}),{cache:pe(o.number),strategy:de.strategies.variadic}),getDateTimeFormat:de((function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((t=Intl.DateTimeFormat).bind.apply(t,_t([void 0],e)))}),{cache:pe(o.dateTime),strategy:de.strategies.variadic}),getPluralRules:de((function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new((t=Intl.PluralRules).bind.apply(t,_t([void 0],e)))}),{cache:pe(o.pluralRules),strategy:de.strategies.variadic})})}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=(new Intl.NumberFormat).resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.__parse=Ht,t.formats={number:{currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t}();let me;const ge=nt({});function ve(t){return t in me}function ye(t){return null==t||ve(t)?t:ye(Le(t))}function xe(t,...e){ge.update((r=>(r[t]=dt.all([r[t]||{},...e]),r)))}it([ge],(([t])=>Object.keys(t)));ge.subscribe((t=>me=t));const be={};function _e(t){return be[t]}function we(t){return Ne(t).reverse().some((t=>{var e;return null===(e=_e(t))||void 0===e?void 0:e.size}))}const Te={};function Ee(t){if(!we(t))return t in Te?Te[t]:void 0;const e=Ne(t).reverse().map((t=>{const e=_e(t);return[t,e?[...e]:[]]})).filter((([,t])=>t.length>0));return Te[t]=Promise.all(e.map((([t,e])=>function(t,e){return Promise.all(e.map((e=>{return n=e,be[r=t].delete(n),0===be[r].size&&delete be[r],e().then((t=>t.default||t));var r,n}))).then((e=>xe(t,...e)))}(t,e)))).then((()=>{if(we(t))return Ee(t);delete Te[t]})),Te[t]
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */}function Se(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}const Ae={fallbackLocale:null,initialLocale:null,loadingDelay:200,formats:{number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},warnOnMissingMessages:!0};function Pe(){return Ae}const Me=nt(!1);let Ie;const Oe=nt(null);function Ce(t,e){return 0===e.indexOf(t)&&t!==e}function Re(t,e){return t===e||Ce(t,e)||Ce(e,t)}function Le(t){const e=t.lastIndexOf("-");if(e>0)return t.slice(0,e);const{fallbackLocale:r}=Pe();return r&&!Re(t,r)?r:null}function Ne(t){const e=t.split("-").map(((t,e,r)=>r.slice(0,e+1).join("-"))),{fallbackLocale:r}=Pe();return r&&!Re(t,r)?e.concat(Ne(r)):e}function Fe(){return Ie}Oe.subscribe((t=>{Ie=t,"undefined"!=typeof window&&document.documentElement.setAttribute("lang",t)}));const De=Oe.set;Oe.set=t=>{if(ye(t)&&we(t)){const{loadingDelay:e}=Pe();let r;return"undefined"!=typeof window&&null!=Fe()&&e?r=window.setTimeout((()=>Me.set(!0)),e):Me.set(!0),Ee(t).then((()=>{De(t)})).finally((()=>{clearTimeout(r),Me.set(!1)}))}return De(t)},Oe.update=t=>De(t(Ie));const Ue={},ke=(t,e)=>{if(null==e)return;return function(t,e){if(!ve(t))return null;const r=me[t]||null;return e in r?r[e]:function(t,e,r,n,i){for(e=e.split?e.split("."):e,n=0;n<e.length;n++)t=t?t[e[n]]:i;return t===i?r:t}(r,e)}(e,t)||ke(t,Le(e))},je=(t,e)=>{if(e in Ue&&t in Ue[e])return Ue[e][t];const r=ke(t,e);return r?(n=t,i=e,(o=r)?(i in Ue||(Ue[i]={}),n in Ue[i]||(Ue[i][n]=o),o):o):void 0;var n,i,o},Be=t=>{const e=Object.create(null);return r=>{const n=JSON.stringify(r);return n in e?e[n]:e[n]=t(r)}},ze=(t,e)=>{const{formats:r}=Pe();if(t in r&&e in r[t])return r[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},Ge=Be((t=>{var{locale:e,format:r}=t,n=Se(t,["locale","format"]);if(null==e)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(n=ze("number",r)),new Intl.NumberFormat(e,n)})),Ve=Be((t=>{var{locale:e,format:r}=t,n=Se(t,["locale","format"]);if(null==e)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?n=ze("date",r):0===Object.keys(n).length&&(n=ze("date","short")),new Intl.DateTimeFormat(e,n)})),He=Be((t=>{var{locale:e,format:r}=t,n=Se(t,["locale","format"]);if(null==e)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?n=ze("time",r):0===Object.keys(n).length&&(n=ze("time","short")),new Intl.DateTimeFormat(e,n)})),Xe=Be(((t,e=Fe())=>new fe(t,e,Pe().formats))),We=(t,e={})=>{"object"==typeof t&&(t=(e=t).id);const{values:r,locale:n=Fe(),default:i}=e;if(null==n)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let o=je(t,n);if(o){if("string"!=typeof o)return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof o}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),o}else Pe().warnOnMissingMessages&&console.warn(`[svelte-i18n] The message "${t}" was not found in "${Ne(n).join('", "')}".${we(Fe())?"\n\nNote: there are at least one loader still registered to this locale that wasn't executed.":""}`),o=i||t;return r?Xe(o,n).format(r):o},Ye=(t,e)=>((t={})=>{var{locale:e=Fe()}=t,r=Se(t,["locale"]);return He(Object.assign({locale:e},r))})(e).format(t),qe=(t,e)=>((t={})=>{var{locale:e=Fe()}=t,r=Se(t,["locale"]);return Ve(Object.assign({locale:e},r))})(e).format(t),$e=(t,e)=>((t={})=>{var{locale:e=Fe()}=t,r=Se(t,["locale"]);return Ge(Object.assign({locale:e},r))})(e).format(t),Qe=(t,e=Fe())=>je(t,e),Ze=it([Oe,ge],(()=>We));it([Oe],(()=>Ye)),it([Oe],(()=>qe)),it([Oe],(()=>$e)),it([Oe,ge],(()=>Qe));function Je(t){let e,r,i,o,a,s,u,l,c,h,m,v,b,E,S,A,P=t[2]("close")+"";function M(t,e){return"ja"===t[3]?tr:Ke}let I=M(t),O=I(t);function C(t,e){return"ja"===t[3]?rr:er}let R=C(t),L=R(t);function N(t,e){return"ja"===t[3]?ir:nr}let F=N(t),D=F(t);function U(t,e){return"ja"===t[3]?ar:or}let k=U(t),j=k(t);function B(t,e){return"ja"===t[3]?ur:sr}let z=B(t),G=z(t);return{c(){e=g("div"),r=g("div"),i=g("div"),o=g("span"),a=y(P),s=x(),u=g("h1"),u.textContent="mmmapper",l=x(),O.c(),c=x(),L.c(),h=x(),D.c(),m=x(),j.c(),v=x(),G.c(),b=x(),E=g("ul"),E.innerHTML='<li><a target="_blank" class="link" href="https://github.com/nolze/mmmapper">nolze/mmmapper</a></li> \n          <li><a target="_blank" class="link" href="https://magicalmirai.com/2020/procon/">初音ミク「マジカルミライ\n              2020」プログラミング・コンテスト</a></li>',w(o,"class","underline text-sm absolute top-0 right-0 mt-2 mr-2 cursor-pointer"),w(u,"class","text-xl font-bold mb-4"),w(E,"class","list-disc pl-8"),w(i,"class","pt-4 pb-12 px-6"),w(r,"class","relative bg-gray-300 border-4 border-gray-800 rounded flex-grow m-8 md:m-32 overflow-y-auto"),w(e,"class","fixed top-0 bottom-0 left-0 right-0 flex")},m(n,f){d(n,e,f),p(e,r),p(r,i),p(i,o),p(o,a),p(i,s),p(i,u),p(i,l),O.m(i,null),p(i,c),L.m(i,null),p(i,h),D.m(i,null),p(i,m),j.m(i,null),p(i,v),G.m(i,null),p(i,b),p(i,E),S||(A=[_(o,"click",t[4]),_(i,"click",cr),_(e,"click",t[5])],S=!0)},p(t,e){4&e&&P!==(P=t[2]("close")+"")&&T(a,P),I!==(I=M(t))&&(O.d(1),O=I(t),O&&(O.c(),O.m(i,c))),R!==(R=C(t))&&(L.d(1),L=R(t),L&&(L.c(),L.m(i,h))),F!==(F=N(t))&&(D.d(1),D=F(t),D&&(D.c(),D.m(i,m))),k!==(k=U(t))&&(j.d(1),j=k(t),j&&(j.c(),j.m(i,v))),z!==(z=B(t))&&(G.d(1),G=z(t),G&&(G.c(),G.m(i,b)))},d(t){t&&f(e),O.d(),L.d(),D.d(),j.d(),G.d(),S=!1,n(A)}}}function Ke(t){let e,r,n;return{c(){e=g("h2"),e.textContent="About this application",r=x(),n=g("p"),n.textContent='mmmapper is a projection mapping software that works in combination\n            with TextAlive to create expressions based on music information. It\n            is a "virtual-real hybrid" software, which you can enjoy not only in\n            the virtual space, but also in the real space with a projector.',w(e,"class","text-lg mb-2"),w(n,"class","mb-2")},m(t,i){d(t,e,i),d(t,r,i),d(t,n,i)},d(t){t&&f(e),t&&f(r),t&&f(n)}}}function tr(t){let e,r,n;return{c(){e=g("h2"),e.textContent="本アプリケーションについて",r=x(),n=g("p"),n.textContent="mmmapper は TextAlive\n            と連携して音楽情報に基づく表現を行えるプロジェクションマッピングソフトウェアです。\n            「仮想と現実のハイブリッド」がコンセプトで、仮想空間内でだけでなく、プロジェクターを接続すれば実際に投影して楽しむことができます。",w(e,"class","text-lg mb-2"),w(n,"class","mb-2")},m(t,i){d(t,e,i),d(t,r,i),d(t,n,i)},d(t){t&&f(e),t&&f(r),t&&f(n)}}}function er(t){let e,r,n;return{c(){e=g("h2"),e.textContent="Terms",r=x(),n=g("p"),n.innerHTML='This application depends on\n            <a target="_blank" class="link" href="https://developer.textalive.jp/">TextAlive and TextAlive App\n              API</a>. To use the application, you must agree to the terms of\n            use in\n            <a target="_blank" class="link" href="https://github.com/TextAliveJp/textalive-app-api/blob/master/LICENSE.md">TextAlive\n              App API License</a>.',w(e,"class","text-lg mb-2"),w(n,"class","mb-2")},m(t,i){d(t,e,i),d(t,r,i),d(t,n,i)},d(t){t&&f(e),t&&f(r),t&&f(n)}}}function rr(t){let e,r,n;return{c(){e=g("h2"),e.textContent="利用について",r=x(),n=g("p"),n.innerHTML='本アプリケーションは\n            <a target="_blank" class="link" href="https://developer.textalive.jp/">TextAlive および TextAlive\n              App API</a>\n            を利用しています。 利用にあたっては、<a target="_blank" class="link" href="https://github.com/TextAliveJp/textalive-app-api/blob/master/LICENSE.md">TextAlive\n              App API ライセンス</a>に従って利用規約に同意する必要があります。',w(e,"class","text-lg mb-2"),w(n,"class","mb-2")},m(t,i){d(t,e,i),d(t,r,i),d(t,n,i)},d(t){t&&f(e),t&&f(r),t&&f(n)}}}function nr(t){let e,r,n;return{c(){e=g("h2"),e.textContent="Usage",r=x(),n=g("p"),n.innerHTML='<b class="mr-1">Virtual Projector</b>The object framed in yellow.\n            You can move it by dragging its rear part.',w(e,"class","text-lg mb-2")},m(t,i){d(t,e,i),d(t,r,i),d(t,n,i)},d(t){t&&f(e),t&&f(r),t&&f(n)}}}function ir(t){let e,r,n;return{c(){e=g("h2"),e.textContent="操作について",r=x(),n=g("p"),n.innerHTML='<b class="mr-1">仮想プロジェクター</b>黄色の枠で表示されているオブジェクトです。後部をドラッグして移動することができます。',w(e,"class","text-lg mb-2")},m(t,i){d(t,e,i),d(t,r,i),d(t,n,i)},d(t){t&&f(e),t&&f(r),t&&f(n)}}}function or(t){let e,r,n,i,o,a,s;return{c(){e=g("h2"),e.textContent="Menu",r=x(),n=g("p"),n.innerHTML='<b class="mr-1">Edit (Tablet/PC)</b>Edit the screen output from the\n            virtual projector.',i=x(),o=g("p"),o.innerHTML='<b class="mr-1">Projector Mode (PC)</b>Open the view for projection\n            in a new window. (Google Chrome is recommended.) You can edit the\n            view or control the app in the main window during the projection.',a=x(),s=g("p"),s.innerHTML='<b class="mr-1">Resolution</b>Set resolution.',w(e,"class","text-lg mb-2 mt-2")},m(t,u){d(t,e,u),d(t,r,u),d(t,n,u),d(t,i,u),d(t,o,u),d(t,a,u),d(t,s,u)},d(t){t&&f(e),t&&f(r),t&&f(n),t&&f(i),t&&f(o),t&&f(a),t&&f(s)}}}function ar(t){let e,r,n,i,o,a,s;return{c(){e=g("h2"),e.textContent="メニューについて",r=x(),n=g("p"),n.innerHTML='<b class="mr-1">編集 (タブレット/PC)</b>仮想プロジェクターが出力する画面を編集します。',i=x(),o=g("p"),o.innerHTML='<b class="mr-1">プロジェクターモード (PC)</b>プロジェクター投影用の画面を新しいウィンドウで開きます\n            (Google Chrome推奨)\n            。投影しながらの編集や再生はメインウィンドウから可能です。',a=x(),s=g("p"),s.innerHTML='<b class="mr-1">画質</b>画質を変更します。',w(e,"class","text-lg mb-2 mt-2")},m(t,u){d(t,e,u),d(t,r,u),d(t,n,u),d(t,i,u),d(t,o,u),d(t,a,u),d(t,s,u)},d(t){t&&f(e),t&&f(r),t&&f(n),t&&f(i),t&&f(o),t&&f(a),t&&f(s)}}}function sr(t){let e;return{c(){e=g("h2"),e.textContent="Links",w(e,"class","text-lg mb-2 mt-2")},m(t,r){d(t,e,r)},d(t){t&&f(e)}}}function ur(t){let e;return{c(){e=g("h2"),e.textContent="リンク",w(e,"class","text-lg mb-2 mt-2")},m(t,r){d(t,e,r)},d(t){t&&f(e)}}}function lr(e){let r,n=!e[1]&&Je(e);return{c(){n&&n.c(),r=b()},m(t,e){n&&n.m(t,e),d(t,r,e)},p(t,[e]){t[1]?n&&(n.d(1),n=null):n?n.p(t,e):(n=Je(t),n.c(),n.m(r.parentNode,r))},i:t,o:t,d(t){n&&n.d(t),t&&f(r)}}}const cr=t=>{t.stopPropagation()};function hr(t,e,r){let n,i,o;s(t,Me,(t=>r(1,n=t))),s(t,Ze,(t=>r(2,i=t))),s(t,Oe,(t=>r(3,o=t)));let{open:a=!1}=e;return t.$$set=t=>{"open"in t&&r(0,a=t.open)},[a,n,i,o,()=>{r(0,a=!1)},()=>{r(0,a=!1)}]}class pr extends et{constructor(t){super(),tt(this,t,hr,lr,o,{open:0})}}var dr="M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z";function fr(t){let e,r,n,i,o,a=t[1]&&mr(t),s=!t[3]&&gr(t);return{c(){e=g("div"),r=g("div"),a&&a.c(),n=x(),i=g("div"),o=g("div"),s&&s.c(),E(r,"position","absolute"),E(r,"top","0"),E(r,"bottom","0"),E(r,"left","0"),E(r,"right","0"),w(e,"id","projector-window"),E(e,"background","#000"),E(e,"position","fixed"),E(e,"top","0"),E(e,"bottom","0"),E(e,"left","0"),E(e,"right","0"),E(e,"display","flex"),E(i,"position","fixed"),E(i,"left","0px"),E(i,"right","0px"),E(i,"bottom","20px"),E(i,"display","flex"),E(i,"justify-content","center")},m(t,u){d(t,e,u),p(e,r),a&&a.m(r,null),d(t,n,u),d(t,i,u),p(i,o),s&&s.m(o,null)},p(t,e){t[1]?a?a.p(t,e):(a=mr(t),a.c(),a.m(r,null)):a&&(a.d(1),a=null),t[3]?s&&(s.d(1),s=null):s?s.p(t,e):(s=gr(t),s.c(),s.m(o,null))},d(t){t&&f(e),a&&a.d(),t&&f(n),t&&f(i),s&&s.d()}}}function mr(e){let r;return{c(){r=g("canvas"),w(r,"width","600"),w(r,"height","400"),E(r,"width","100%"),E(r,"height","100%"),E(r,"object-fit","contain")},m(t,n){d(t,r,n),e[7](r)},p:t,d(t){t&&f(r),e[7](null)}}}function gr(t){let e,r,i,o,a,s,u,l,c,h,m,b,S,A,P,M,I,O=t[5]("projector_window.maximize")+"",C=t[5]("projector_window.fullscreen")+"";return{c(){e=g("button"),r=g("div"),i=v("svg"),o=v("path"),a=x(),s=g("div"),u=y(O),l=x(),c=g("button"),h=g("div"),m=v("svg"),b=v("path"),S=x(),A=g("div"),P=y(C),w(o,"fill","#ffffff"),w(o,"d",dr),E(i,"width","24px"),E(i,"height","24px"),w(i,"viewBox","0 0 24 24"),w(s,"class","ml-1 text-white"),E(s,"margin-left","0.25rem"),E(s,"color","#fff"),w(r,"class","flex items-center mx-2 my-1"),E(r,"display","flex"),E(r,"align-items","center"),E(r,"margin","0.25rem 0.5rem"),w(e,"class","button"),E(e,"border-width","1px"),E(e,"border-radius","0.25rem"),E(e,"background-color","#4299e1"),E(e,"cursor","pointer"),w(b,"fill","#ffffff"),w(b,"d",dr),E(m,"width","24px"),E(m,"height","24px"),w(m,"viewBox","0 0 24 24"),w(A,"class","ml-1 text-white"),E(A,"margin-left","0.25rem"),E(A,"color","#fff"),w(h,"class","flex items-center mx-2 my-1"),E(h,"display","flex"),E(h,"align-items","center"),E(h,"margin","0.25rem 0.5rem"),w(c,"class","button ml-4"),E(c,"border-width","1px"),E(c,"border-radius","0.25rem"),E(c,"background-color","#4299e1"),E(c,"cursor","pointer")},m(n,f){d(n,e,f),p(e,r),p(r,i),p(i,o),p(r,a),p(r,s),p(s,u),d(n,l,f),d(n,c,f),p(c,h),p(h,m),p(m,b),p(h,S),p(h,A),p(A,P),M||(I=[_(e,"click",t[8]),_(c,"click",t[9])],M=!0)},p(t,e){32&e&&O!==(O=t[5]("projector_window.maximize")+"")&&T(u,O),32&e&&C!==(C=t[5]("projector_window.fullscreen")+"")&&T(P,C)},d(t){t&&f(e),t&&f(l),t&&f(c),M=!1,n(I)}}}function vr(e){let r,n=!e[4]&&fr(e);return{c(){n&&n.c(),r=b()},m(t,e){n&&n.m(t,e),d(t,r,e)},p(t,[e]){t[4]?n&&(n.d(1),n=null):n?n.p(t,e):(n=fr(t),n.c(),n.m(r.parentNode,r))},i:t,o:t,d(t){n&&n.d(t),t&&f(r)}}}function yr(t,e,r){let n,i;s(t,Me,(t=>r(4,n=t))),s(t,Ze,(t=>r(5,i=t)));let o,{self:a}=e,{head:u}=e,{canvas:l}=e;u=u;let c=!1;I((()=>{a.document.addEventListener("fullscreenchange",(()=>{a.document.fullscreenElement||r(3,c=!1)})),r(0,a.document.title="mmmapper",a);const t=o.getContext("2d");requestAnimationFrame((function e(){t.drawImage(l,0,0),requestAnimationFrame(e)}))}));return t.$$set=t=>{"self"in t&&r(0,a=t.self),"head"in t&&r(6,u=t.head),"canvas"in t&&r(1,l=t.canvas)},[a,l,o,c,n,i,u,function(t){R[t?"unshift":"push"]((()=>{o=t,r(2,o)}))},()=>{a.moveTo(25,25),a.resizeTo(a.screen.width-50,a.screen.height-50),r(3,c=!0)},()=>{a.document.documentElement.requestFullscreen(),r(3,c=!0)}]}class xr extends et{constructor(t){super(),tt(this,t,yr,vr,o,{self:0,head:6,canvas:1})}}function br(t){let e;const r=t[6].default,n=u(r,t,t[5],null);return{c(){n&&n.c()},m(t,r){n&&n.m(t,r),e=!0},p(t,e){n&&n.p&&32&e&&c(n,r,t,t[5],e,null,null)},i(t){e||(Y(n,t),e=!0)},o(t){q(n,t),e=!1},d(t){n&&n.d(t)}}}function _r(t){let e,r,n,i,o=t[0]&&br(t);return{c(){e=g("canvas"),r=x(),o&&o.c(),n=b(),w(e,"width",t[1]),w(e,"height",t[2]),w(e,"class",t[4]),w(e,"style",t[3])},m(a,s){d(a,e,s),t[7](e),d(a,r,s),o&&o.m(a,s),d(a,n,s),i=!0},p(t,[r]){(!i||2&r)&&w(e,"width",t[1]),(!i||4&r)&&w(e,"height",t[2]),(!i||16&r)&&w(e,"class",t[4]),(!i||8&r)&&w(e,"style",t[3]),t[0]?o?(o.p(t,r),1&r&&Y(o,1)):(o=br(t),o.c(),Y(o,1),o.m(n.parentNode,n)):o&&(X(),q(o,1,1,(()=>{o=null})),W())},i(t){i||(Y(o),i=!0)},o(t){q(o),i=!1},d(i){i&&f(e),t[7](null),i&&f(r),o&&o.d(i),i&&f(n)}}}function wr(t,e,r){let{$$slots:n={},$$scope:i}=e,{width:o}=e,{height:a}=e,{style:s=""}=e,{class:u=""}=e,{canvas:l=null}=e;return t.$$set=t=>{"width"in t&&r(1,o=t.width),"height"in t&&r(2,a=t.height),"style"in t&&r(3,s=t.style),"class"in t&&r(4,u=t.class),"canvas"in t&&r(0,l=t.canvas),"$$scope"in t&&r(5,i=t.$$scope)},[l,o,a,s,u,i,n,function(t){R[t?"unshift":"push"]((()=>{l=t,r(0,l)}))}]}class Tr extends et{constructor(t){super(),tt(this,t,wr,_r,o,{width:1,height:2,style:3,class:4,canvas:0})}}
/*!
 * pixi.js - v5.3.3
 * Compiled Tue, 04 Aug 2020 16:26:23 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Er=function(t){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t,e){return t(e={exports:{}},e.exports),e.exports}var n=r((function(t,r){!function(t){var e,n=t.Promise,i=n&&"resolve"in n&&"reject"in n&&"all"in n&&"race"in n&&(new n((function(t){e=t})),"function"==typeof e);r?(r.Promise=i?n:E,r.Polyfill=E):i||(t.Promise=E);var o="pending",a="sealed",s="fulfilled",u="rejected",l=function(){};function c(t){return"[object Array]"===Object.prototype.toString.call(t)}var h,p="undefined"!=typeof setImmediate?setImmediate:setTimeout,d=[];function f(){for(var t=0;t<d.length;t++)d[t][0](d[t][1]);d=[],h=!1}function m(t,e){d.push([t,e]),h||(h=!0,p(f,0))}function g(t){var e=t.owner,r=e.state_,n=e.data_,i=t[r],o=t.then;if("function"==typeof i){r=s;try{n=i(n)}catch(t){b(o,t)}}v(o,n)||(r===s&&y(o,n),r===u&&b(o,n))}function v(t,e){var r;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var n=e.then;if("function"==typeof n)return n.call(e,(function(n){r||(r=!0,e!==n?y(t,n):x(t,n))}),(function(e){r||(r=!0,b(t,e))})),!0}}catch(e){return r||b(t,e),!0}return!1}function y(t,e){t!==e&&v(t,e)||x(t,e)}function x(t,e){t.state_===o&&(t.state_=a,t.data_=e,m(w,t))}function b(t,e){t.state_===o&&(t.state_=a,t.data_=e,m(T,t))}function _(t){var e=t.then_;t.then_=void 0;for(var r=0;r<e.length;r++)g(e[r])}function w(t){t.state_=s,_(t)}function T(t){t.state_=u,_(t)}function E(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof E==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function r(t){b(e,t)}try{t((function(t){y(e,t)}),r)}catch(t){r(t)}}(t,this)}E.prototype={constructor:E,state_:o,then_:null,data_:void 0,then:function(t,e){var r={owner:this,then:new this.constructor(l),fulfilled:t,rejected:e};return this.state_===s||this.state_===u?m(g,r):this.then_.push(r),r.then},catch:function(t){return this.then(null,t)}},E.all=function(t){if(!c(t))throw new TypeError("You must pass an array to Promise.all().");return new this((function(e,r){var n=[],i=0;function o(t){return i++,function(r){n[t]=r,--i||e(n)}}for(var a,s=0;s<t.length;s++)(a=t[s])&&"function"==typeof a.then?a.then(o(s),r):n[s]=a;i||e(n)}))},E.race=function(t){if(!c(t))throw new TypeError("You must pass an array to Promise.race().");return new this((function(e,r){for(var n,i=0;i<t.length;i++)(n=t[i])&&"function"==typeof n.then?n.then(e,r):e(n)}))},E.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(e){e(t)}))},E.reject=function(t){return new this((function(e,r){r(t)}))}}("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:e)})),i=(n.Promise,n.Polyfill),o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function u(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var l=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,n,i=arguments,l=u(t),c=1;c<arguments.length;c++){for(var h in r=Object(i[c]))a.call(r,h)&&(l[h]=r[h]);if(o){n=o(r);for(var p=0;p<n.length;p++)s.call(r,n[p])&&(l[n[p]]=r[n[p]])}}return l};
/*!
   * @pixi/polyfill - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/polyfill is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */window.Promise||(window.Promise=i),Object.assign||(Object.assign=l);if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!window.performance||!window.performance.now){var c=Date.now();window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-c}}for(var h=Date.now(),p=["ms","moz","webkit","o"],d=0;d<p.length&&!window.requestAnimationFrame;++d){var f=p[d];window.requestAnimationFrame=window[f+"RequestAnimationFrame"],window.cancelAnimationFrame=window[f+"CancelAnimationFrame"]||window[f+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),r=16+h-e;return r<0&&(r=0),h=e,window.setTimeout((function(){h=Date.now(),t(performance.now())}),r)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var m=/iPhone/i,g=/iPod/i,v=/iPad/i,y=/\biOS-universal(?:.+)Mac\b/i,x=/\bAndroid(?:.+)Mobile\b/i,b=/Android/i,_=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,w=/Silk/i,T=/Windows Phone/i,E=/\bWindows(?:.+)ARM\b/i,S=/BlackBerry/i,A=/BB10/i,P=/Opera Mini/i,M=/\b(CriOS|Chrome)(?:.+)Mobile/i,I=/Mobile(?:.+)Firefox\b/i,O=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};
/*!
   * @pixi/settings - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/settings is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var C=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,n=r.split("[FBAN");void 0!==n[1]&&(r=n[0]),void 0!==(n=r.split("Twitter"))[1]&&(r=n[0]);var i=function(t){return function(e){return e.test(t)}}(r),o={apple:{phone:i(m)&&!i(T),ipod:i(g),tablet:!i(m)&&(i(v)||O(e))&&!i(T),universal:i(y),device:(i(m)||i(g)||i(v)||i(y)||O(e))&&!i(T)},amazon:{phone:i(_),tablet:!i(_)&&i(w),device:i(_)||i(w)},android:{phone:!i(T)&&i(_)||!i(T)&&i(x),tablet:!i(T)&&!i(_)&&!i(x)&&(i(w)||i(b)),device:!i(T)&&(i(_)||i(w)||i(x)||i(b))||i(/\bokhttp\b/i)},windows:{phone:i(T),tablet:i(E),device:i(T)||i(E)},other:{blackberry:i(S),blackberry10:i(A),opera:i(P),firefox:i(I),chrome:i(M),device:i(S)||i(A)||i(P)||i(I)||i(M)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}(window.navigator);var R={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(C.tablet||C.phone){var r;if(C.apple.device)if(r=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(r[1],10)<11&&(e=!1);if(C.android.device)if(r=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(r[1],10)<7&&(e=!1)}return e?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:C.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!C.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},L=r((function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||t,a),u=r?r+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},s.prototype.emit=function(t,e,n,i,o,a){var s=arguments,u=r?r+t:t;if(!this._events[u])return!1;var l,c,h=this._events[u],p=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),p){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,i),!0;case 5:return h.fn.call(h.context,e,n,i,o),!0;case 6:return h.fn.call(h.context,e,n,i,o,a),!0}for(c=1,l=new Array(p-1);c<p;c++)l[c-1]=s[c];h.fn.apply(h.context,l)}else{var d,f=h.length;for(c=0;c<f;c++)switch(h[c].once&&this.removeListener(t,h[c].fn,void 0,!0),p){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,e);break;case 3:h[c].fn.call(h[c].context,e,n);break;case 4:h[c].fn.call(h[c].context,e,n,i);break;default:if(!l)for(d=1,l=new Array(p-1);d<p;d++)l[d-1]=s[d];h[c].fn.apply(h[c].context,l)}}return!0},s.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},s.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},s.prototype.removeListener=function(t,e,n,i){var o=r?r+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==e||i&&!s[u].once||n&&s[u].context!==n)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s})),N=D,F=D;function D(t,e,r){r=r||2;var n,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*r:t.length,p=U(t,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=U(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(q(a));for(s.sort(H),i=0;i<s.length;i++)X(s[i],r),r=k(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)(s=t[f])<n&&(n=s),(u=t[f+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-n,a-i))?1/l:0}return j(p,d,r,n,i,l),d}function U(t,e,r,n,i){var o,a;if(i===st(t,e,r,n)>0)for(o=e;o<r;o+=n)a=it(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=it(o,t[o],t[o+1],a);return a&&J(a,a.next)&&(ot(a),a=a.next),a}function k(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!J(n,n.next)&&0!==Z(n.prev,n,n.next))n=n.next;else{if(ot(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function j(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Y(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?z(t,n,i,o):B(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),ot(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?j(t=G(k(t),e,r),e,r,n,i,o,2):2===a&&V(t,e,r,n,i,o):j(k(t),e,r,n,i,o,1);break}}}function B(t){var e=t.prev,r=t,n=t.next;if(Z(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if($(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Z(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function z(t,e,r,n){var i=t.prev,o=t,a=t.next;if(Z(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Y(s,u,e,r,n),p=Y(l,c,e,r,n),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&$(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Z(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&$(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Z(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&$(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Z(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&$(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Z(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function G(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!J(i,o)&&K(i,n,n.next,o)&&rt(i,o)&&rt(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),ot(n),ot(n.next),n=t=o),n=n.next}while(n!==t);return k(n)}function V(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Q(a,s)){var u=nt(a,s);return a=k(a,a.next),u=k(u,u.next),j(a,e,r,n,i,o),void j(u,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function H(t,e){return t.x-e.x}function X(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var u,l=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&$(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),rt(n,t)&&(u<p||u===p&&(n.x>r.x||n.x===r.x&&W(r,n)))&&(r=n,p=u)),n=n.next}while(n!==l);return r}(t,e)){var r=nt(e,t);k(e,e.next),k(r,r.next)}}function W(t,e){return Z(t.prev,t,e.prev)<0&&Z(e.next,t,t.next)<0}function Y(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function q(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function $(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function Q(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&K(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(rt(t,e)&&rt(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Z(t.prev,t,e.prev)||Z(t,e.prev,e))||J(t,e)&&Z(t.prev,t,t.next)>0&&Z(e.prev,e,e.next)>0)}function Z(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function J(t,e){return t.x===e.x&&t.y===e.y}function K(t,e,r,n){var i=et(Z(t,e,r)),o=et(Z(t,e,n)),a=et(Z(r,n,t)),s=et(Z(r,n,e));return i!==o&&a!==s||(!(0!==i||!tt(t,r,e))||(!(0!==o||!tt(t,n,e))||(!(0!==a||!tt(r,t,n))||!(0!==s||!tt(r,e,n)))))}function tt(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function et(t){return t>0?1:t<0?-1:0}function rt(t,e){return Z(t.prev,t,t.next)<0?Z(t,e,t.next)>=0&&Z(t,t.prev,e)>=0:Z(t,e,t.prev)<0||Z(t,t.next,e)<0}function nt(t,e){var r=new at(t.i,t.x,t.y),n=new at(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function it(t,e,r,n){var i=new at(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function ot(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function at(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function st(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}D.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(st(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*r,c=s<u-1?e[s+1]*r:t.length;a-=Math.abs(st(t,l,c,r))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*r,d=n[s+1]*r,f=n[s+2]*r;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},D.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r},N.default=F;var ut=r((function(t,r){!function(n){var i=r&&!r.nodeType&&r,o=t&&!t.nodeType&&t,a="object"==typeof e&&e;a.global!==a&&a.window!==a&&a.self!==a||(n=a);var s,u,l=2147483647,c=36,h=/^xn--/,p=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,f={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,g=String.fromCharCode;function v(t){throw RangeError(f[t])}function y(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function x(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+y((t=t.replace(d,".")).split("."),e).join(".")}function b(t){for(var e,r,n=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function _(t){return y(t,(function(t){var e="";return t>65535&&(e+=g((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=g(t)})).join("")}function w(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function T(t,e,r){var n=0;for(t=r?m(t/700):t>>1,t+=m(t/e);t>455;n+=c)t=m(t/35);return m(n+36*t/(t+38))}function E(t){var e,r,n,i,o,a,s,u,h,p,d,f=[],g=t.length,y=0,x=128,b=72;for((r=t.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&v("not-basic"),f.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<g;){for(o=y,a=1,s=c;i>=g&&v("invalid-input"),((u=(d=t.charCodeAt(i++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:c)>=c||u>m((l-y)/a))&&v("overflow"),y+=u*a,!(u<(h=s<=b?1:s>=b+26?26:s-b));s+=c)a>m(l/(p=c-h))&&v("overflow"),a*=p;b=T(y-o,e=f.length+1,0==o),m(y/e)>l-x&&v("overflow"),x+=m(y/e),y%=e,f.splice(y++,0,x)}return _(f)}function S(t){var e,r,n,i,o,a,s,u,h,p,d,f,y,x,_,E=[];for(f=(t=b(t)).length,e=128,r=0,o=72,a=0;a<f;++a)(d=t[a])<128&&E.push(g(d));for(n=i=E.length,i&&E.push("-");n<f;){for(s=l,a=0;a<f;++a)(d=t[a])>=e&&d<s&&(s=d);for(s-e>m((l-r)/(y=n+1))&&v("overflow"),r+=(s-e)*y,e=s,a=0;a<f;++a)if((d=t[a])<e&&++r>l&&v("overflow"),d==e){for(u=r,h=c;!(u<(p=h<=o?1:h>=o+26?26:h-o));h+=c)_=u-p,x=c-p,E.push(g(w(p+_%x,0))),u=m(_/x);E.push(g(w(u,0))),o=T(r,y,n==i),r=0,++n}++r,++e}return E.join("")}if(s={version:"1.3.2",ucs2:{decode:b,encode:_},decode:E,encode:S,toASCII:function(t){return x(t,(function(t){return p.test(t)?"xn--"+S(t):t}))},toUnicode:function(t){return x(t,(function(t){return h.test(t)?E(t.slice(4).toLowerCase()):t}))}},i&&o)if(t.exports==i)o.exports=s;else for(u in s)s.hasOwnProperty(u)&&(i[u]=s[u]);else n.punycode=s}(e)})),lt=function(t){return"string"==typeof t},ct=function(t){return"object"==typeof t&&null!==t},ht=function(t){return null===t},pt=function(t){return null==t};function dt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ft=function(t,e,r,n){e=e||"&",r=r||"=";var i={};if("string"!=typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var s=t.length;a>0&&s>a&&(s=a);for(var u=0;u<s;++u){var l,c,h,p,d=t[u].replace(o,"%20"),f=d.indexOf(r);f>=0?(l=d.substr(0,f),c=d.substr(f+1)):(l=d,c=""),h=decodeURIComponent(l),p=decodeURIComponent(c),dt(i,h)?Array.isArray(i[h])?i[h].push(p):i[h]=[i[h],p]:i[h]=p}return i},mt=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},gt=function(t,e,r,n){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(n){var i=encodeURIComponent(mt(n))+r;return Array.isArray(t[n])?t[n].map((function(t){return i+encodeURIComponent(mt(t))})).join(e):i+encodeURIComponent(mt(t[n]))})).join(e):n?encodeURIComponent(mt(n))+r+encodeURIComponent(mt(t)):""},vt=r((function(t,e){e.decode=e.parse=ft,e.encode=e.stringify=gt})),yt=(vt.decode,vt.parse,vt.encode,vt.stringify,Dt),xt=function(t,e){return Dt(t,!1,!0).resolve(e)},bt=function(t,e){if(!t)return e;return Dt(t,!1,!0).resolveObject(e)},_t=function(t){lt(t)&&(t=Dt(t));if(!(t instanceof Tt))return Tt.prototype.format.call(t);return t.format()},wt=Tt;function Tt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Et=/^([a-z0-9.+-]+:)/i,St=/:[0-9]*$/,At=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Pt=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Mt=["'"].concat(Pt),It=["%","/","?",";","#"].concat(Mt),Ot=["/","?","#"],Ct=/^[+a-z0-9A-Z_-]{0,63}$/,Rt=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Lt={javascript:!0,"javascript:":!0},Nt={javascript:!0,"javascript:":!0},Ft={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Dt(t,e,r){if(t&&ct(t)&&t instanceof Tt)return t;var n=new Tt;return n.parse(t,e,r),n}Tt.prototype.parse=function(t,e,r){if(!lt(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),i=-1!==n&&n<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var a=t=o.join(i);if(a=a.trim(),!r&&1===t.split("#").length){var s=At.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=e?vt.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=Et.exec(a);if(u){var l=(u=u[0]).toLowerCase();this.protocol=l,a=a.substr(u.length)}if(r||u||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===a.substr(0,2);!c||u&&Nt[u]||(a=a.substr(2),this.slashes=!0)}if(!Nt[u]&&(c||u&&!Ft[u])){for(var h,p,d=-1,f=0;f<Ot.length;f++){-1!==(m=a.indexOf(Ot[f]))&&(-1===d||m<d)&&(d=m)}-1!==(p=-1===d?a.lastIndexOf("@"):a.lastIndexOf("@",d))&&(h=a.slice(0,p),a=a.slice(p+1),this.auth=decodeURIComponent(h)),d=-1;for(f=0;f<It.length;f++){var m;-1!==(m=a.indexOf(It[f]))&&(-1===d||m<d)&&(d=m)}-1===d&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var v=this.hostname.split(/\./),y=(f=0,v.length);f<y;f++){var x=v[f];if(x&&!x.match(Ct)){for(var b="",_=0,w=x.length;_<w;_++)x.charCodeAt(_)>127?b+="x":b+=x[_];if(!b.match(Ct)){var T=v.slice(0,f),E=v.slice(f+1),S=x.match(Rt);S&&(T.push(S[1]),E.unshift(S[2])),E.length&&(a="/"+E.join(".")+a),this.hostname=T.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=ut.toASCII(this.hostname));var A=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+A,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!Lt[l])for(f=0,y=Mt.length;f<y;f++){var M=Mt[f];if(-1!==a.indexOf(M)){var I=encodeURIComponent(M);I===M&&(I=escape(M)),a=a.split(M).join(I)}}var O=a.indexOf("#");-1!==O&&(this.hash=a.substr(O),a=a.slice(0,O));var C=a.indexOf("?");if(-1!==C?(this.search=a.substr(C),this.query=a.substr(C+1),e&&(this.query=vt.parse(this.query)),a=a.slice(0,C)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Ft[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){A=this.pathname||"";var R=this.search||"";this.path=A+R}return this.href=this.format(),this},Tt.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&ct(this.query)&&Object.keys(this.query).length&&(o=vt.stringify(this.query));var a=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Ft[e])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+i+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(a=a.replace("#","%23"))+n},Tt.prototype.resolve=function(t){return this.resolveObject(Dt(t,!1,!0)).format()},Tt.prototype.resolveObject=function(t){if(lt(t)){var e=new Tt;e.parse(t,!1,!0),t=e}for(var r=new Tt,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),s=0;s<a.length;s++){var u=a[s];"protocol"!==u&&(r[u]=t[u])}return Ft[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!Ft[t.protocol]){for(var l=Object.keys(t),c=0;c<l.length;c++){var h=l[c];r[h]=t[h]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||Nt[t.protocol])r.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var d=r.pathname||"",f=r.search||"";r.path=d+f}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=g||m||r.host&&t.pathname,y=v,x=r.pathname&&r.pathname.split("/")||[],b=(p=t.pathname&&t.pathname.split("/")||[],r.protocol&&!Ft[r.protocol]);if(b&&(r.hostname="",r.port=null,r.host&&(""===x[0]?x[0]=r.host:x.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),v=v&&(""===p[0]||""===x[0])),g)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,x=p;else if(p.length)x||(x=[]),x.pop(),x=x.concat(p),r.search=t.search,r.query=t.query;else if(!pt(t.search)){if(b)r.hostname=r.host=x.shift(),(S=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=S.shift(),r.host=r.hostname=S.shift());return r.search=t.search,r.query=t.query,ht(r.pathname)&&ht(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!x.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var _=x.slice(-1)[0],w=(r.host||t.host||x.length>1)&&("."===_||".."===_)||""===_,T=0,E=x.length;E>=0;E--)"."===(_=x[E])?x.splice(E,1):".."===_?(x.splice(E,1),T++):T&&(x.splice(E,1),T--);if(!v&&!y)for(;T--;T)x.unshift("..");!v||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),w&&"/"!==x.join("/").substr(-1)&&x.push("");var S,A=""===x[0]||x[0]&&"/"===x[0].charAt(0);b&&(r.hostname=r.host=A?"":x.length?x.shift():"",(S=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=S.shift(),r.host=r.hostname=S.shift()));return(v=v||r.host&&x.length)&&!A&&x.unshift(""),x.length?r.pathname=x.join("/"):(r.pathname=null,r.path=null),ht(r.pathname)&&ht(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},Tt.prototype.parseHost=function(){var t=this.host,e=St.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var Ut,kt,jt,Bt,zt,Gt,Vt,Ht,Xt,Wt,Yt,qt,$t,Qt,Zt,Jt,Kt,te={parse:yt,resolve:xt,resolveObject:bt,format:_t,Url:wt};
/*!
   * @pixi/constants - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/constants is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */(Ut=t.ENV||(t.ENV={}))[Ut.WEBGL_LEGACY=0]="WEBGL_LEGACY",Ut[Ut.WEBGL=1]="WEBGL",Ut[Ut.WEBGL2=2]="WEBGL2",(kt=t.RENDERER_TYPE||(t.RENDERER_TYPE={}))[kt.UNKNOWN=0]="UNKNOWN",kt[kt.WEBGL=1]="WEBGL",kt[kt.CANVAS=2]="CANVAS",(jt=t.BUFFER_BITS||(t.BUFFER_BITS={}))[jt.COLOR=16384]="COLOR",jt[jt.DEPTH=256]="DEPTH",jt[jt.STENCIL=1024]="STENCIL",(Bt=t.BLEND_MODES||(t.BLEND_MODES={}))[Bt.NORMAL=0]="NORMAL",Bt[Bt.ADD=1]="ADD",Bt[Bt.MULTIPLY=2]="MULTIPLY",Bt[Bt.SCREEN=3]="SCREEN",Bt[Bt.OVERLAY=4]="OVERLAY",Bt[Bt.DARKEN=5]="DARKEN",Bt[Bt.LIGHTEN=6]="LIGHTEN",Bt[Bt.COLOR_DODGE=7]="COLOR_DODGE",Bt[Bt.COLOR_BURN=8]="COLOR_BURN",Bt[Bt.HARD_LIGHT=9]="HARD_LIGHT",Bt[Bt.SOFT_LIGHT=10]="SOFT_LIGHT",Bt[Bt.DIFFERENCE=11]="DIFFERENCE",Bt[Bt.EXCLUSION=12]="EXCLUSION",Bt[Bt.HUE=13]="HUE",Bt[Bt.SATURATION=14]="SATURATION",Bt[Bt.COLOR=15]="COLOR",Bt[Bt.LUMINOSITY=16]="LUMINOSITY",Bt[Bt.NORMAL_NPM=17]="NORMAL_NPM",Bt[Bt.ADD_NPM=18]="ADD_NPM",Bt[Bt.SCREEN_NPM=19]="SCREEN_NPM",Bt[Bt.NONE=20]="NONE",Bt[Bt.SRC_OVER=0]="SRC_OVER",Bt[Bt.SRC_IN=21]="SRC_IN",Bt[Bt.SRC_OUT=22]="SRC_OUT",Bt[Bt.SRC_ATOP=23]="SRC_ATOP",Bt[Bt.DST_OVER=24]="DST_OVER",Bt[Bt.DST_IN=25]="DST_IN",Bt[Bt.DST_OUT=26]="DST_OUT",Bt[Bt.DST_ATOP=27]="DST_ATOP",Bt[Bt.ERASE=26]="ERASE",Bt[Bt.SUBTRACT=28]="SUBTRACT",Bt[Bt.XOR=29]="XOR",(zt=t.DRAW_MODES||(t.DRAW_MODES={}))[zt.POINTS=0]="POINTS",zt[zt.LINES=1]="LINES",zt[zt.LINE_LOOP=2]="LINE_LOOP",zt[zt.LINE_STRIP=3]="LINE_STRIP",zt[zt.TRIANGLES=4]="TRIANGLES",zt[zt.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",zt[zt.TRIANGLE_FAN=6]="TRIANGLE_FAN",(Gt=t.FORMATS||(t.FORMATS={}))[Gt.RGBA=6408]="RGBA",Gt[Gt.RGB=6407]="RGB",Gt[Gt.ALPHA=6406]="ALPHA",Gt[Gt.LUMINANCE=6409]="LUMINANCE",Gt[Gt.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",Gt[Gt.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",Gt[Gt.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(Vt=t.TARGETS||(t.TARGETS={}))[Vt.TEXTURE_2D=3553]="TEXTURE_2D",Vt[Vt.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",Vt[Vt.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",Vt[Vt.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",Vt[Vt.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",Vt[Vt.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",Vt[Vt.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",Vt[Vt.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",Vt[Vt.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(Ht=t.TYPES||(t.TYPES={}))[Ht.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Ht[Ht.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Ht[Ht.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",Ht[Ht.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",Ht[Ht.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",Ht[Ht.FLOAT=5126]="FLOAT",Ht[Ht.HALF_FLOAT=36193]="HALF_FLOAT",(Xt=t.SCALE_MODES||(t.SCALE_MODES={}))[Xt.NEAREST=0]="NEAREST",Xt[Xt.LINEAR=1]="LINEAR",(Wt=t.WRAP_MODES||(t.WRAP_MODES={}))[Wt.CLAMP=33071]="CLAMP",Wt[Wt.REPEAT=10497]="REPEAT",Wt[Wt.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(Yt=t.MIPMAP_MODES||(t.MIPMAP_MODES={}))[Yt.OFF=0]="OFF",Yt[Yt.POW2=1]="POW2",Yt[Yt.ON=2]="ON",(qt=t.ALPHA_MODES||(t.ALPHA_MODES={}))[qt.NPM=0]="NPM",qt[qt.UNPACK=1]="UNPACK",qt[qt.PMA=2]="PMA",qt[qt.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",qt[qt.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",qt[qt.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",($t=t.CLEAR_MODES||(t.CLEAR_MODES={}))[$t.NO=0]="NO",$t[$t.YES=1]="YES",$t[$t.AUTO=2]="AUTO",$t[$t.BLEND=0]="BLEND",$t[$t.CLEAR=1]="CLEAR",$t[$t.BLIT=2]="BLIT",(Qt=t.GC_MODES||(t.GC_MODES={}))[Qt.AUTO=0]="AUTO",Qt[Qt.MANUAL=1]="MANUAL",(Zt=t.PRECISION||(t.PRECISION={})).LOW="lowp",Zt.MEDIUM="mediump",Zt.HIGH="highp",(Jt=t.MASK_TYPES||(t.MASK_TYPES={}))[Jt.NONE=0]="NONE",Jt[Jt.SCISSOR=1]="SCISSOR",Jt[Jt.STENCIL=2]="STENCIL",Jt[Jt.SPRITE=3]="SPRITE",(Kt=t.MSAA_QUALITY||(t.MSAA_QUALITY={}))[Kt.NONE=0]="NONE",Kt[Kt.LOW=2]="LOW",Kt[Kt.MEDIUM=4]="MEDIUM",Kt[Kt.HIGH=8]="HIGH",
/*!
   * @pixi/utils - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/utils is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
R.RETINA_PREFIX=/@([0-9\.]+)x/,R.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var ee,re=!1;function ne(t){var e;if(!re){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var r=["\n %c %c %c PixiJS 5.3.3 - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=window.console).log.apply(e,r)}else window.console&&window.console.log("PixiJS 5.3.3 - "+t+" - http://www.pixijs.com/");re=!0}}function ie(){return void 0===ee&&(ee=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:R.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!(!r||!r.getContextAttributes().stencil);if(r){var i=r.getExtension("WEBGL_lose_context");i&&i.loseContext()}return r=null,n}catch(t){return!1}}()),ee}function oe(t,e){return void 0===e&&(e=[]),e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function ae(t){var e=t.toString(16);return"#"+(e="000000".substr(0,6-e.length)+e)}function se(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}var ue=function(){for(var e=[],r=[],n=0;n<32;n++)e[n]=n,r[n]=n;e[t.BLEND_MODES.NORMAL_NPM]=t.BLEND_MODES.NORMAL,e[t.BLEND_MODES.ADD_NPM]=t.BLEND_MODES.ADD,e[t.BLEND_MODES.SCREEN_NPM]=t.BLEND_MODES.SCREEN,r[t.BLEND_MODES.NORMAL]=t.BLEND_MODES.NORMAL_NPM,r[t.BLEND_MODES.ADD]=t.BLEND_MODES.ADD_NPM,r[t.BLEND_MODES.SCREEN]=t.BLEND_MODES.SCREEN_NPM;var i=[];return i.push(r),i.push(e),i}();function le(t,e){return ue[e?1:0][t]}function ce(t,e,r,n){return r=r||new Float32Array(4),n||void 0===n?(r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e):(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=e,r}function he(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var r=t>>16&255,n=t>>8&255,i=255&t;return(255*e<<24)+((r=r*e+.5|0)<<16)+((n=n*e+.5|0)<<8)+(i=i*e+.5|0)}function pe(t,e,r,n){return(r=r||new Float32Array(4))[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,(n||void 0===n)&&(r[0]*=e,r[1]*=e,r[2]*=e),r[3]=e,r}function de(t,e){void 0===e&&(e=null);var r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+r);for(var n=0,i=0;n<r;n+=6,i+=4)e[n+0]=i+0,e[n+1]=i+1,e[n+2]=i+2,e[n+3]=i+0,e[n+4]=i+2,e[n+5]=i+3;return e}function fe(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var me={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function ge(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function ve(t){return!(t&t-1||!t)}function ye(t){var e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,e|=r=((t>>>=r)>15?1:0)<<2,(e|=r=((t>>>=r)>3?1:0)<<1)|(t>>>=r)>>1}function xe(t,e,r){var n,i=t.length;if(!(e>=i||0===r)){var o=i-(r=e+r>i?i-e:r);for(n=e;n<o;++n)t[n]=t[n+r];t.length=o}}function be(t){return 0===t?0:t<0?-1:1}var _e=0;function we(){return++_e}var Te={};function Ee(t,e,r){if(void 0===r&&(r=3),!Te[e]){var n=(new Error).stack;void 0===n?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(n=n.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(n))),Te[e]=!0}}var Se={},Ae=Object.create(null),Pe=Object.create(null);var Me=function(){function t(t,e,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||R.RESOLUTION,this.resize(t,e)}return t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},t.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!1,configurable:!0}),t}();function Ie(t){var e,r,n,i=t.width,o=t.height,a=t.getContext("2d"),s=a.getImageData(0,0,i,o).data,u=s.length,l={top:null,left:null,right:null,bottom:null},c=null;for(e=0;e<u;e+=4)0!==s[e+3]&&(r=e/4%i,n=~~(e/4/i),null===l.top&&(l.top=n),(null===l.left||r<l.left)&&(l.left=r),(null===l.right||l.right<r)&&(l.right=r+1),(null===l.bottom||l.bottom<n)&&(l.bottom=n));return null!==l.top&&(i=l.right-l.left,o=l.bottom-l.top+1,c=a.getImageData(l.left,l.top,i,o)),{height:o,width:i,data:c}}var Oe,Ce=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Re(t,e){if(void 0===e&&(e=window.location),0===t.indexOf("data:"))return"";e=e||window.location,Oe||(Oe=document.createElement("a")),Oe.href=t;var r=yt(Oe.href),n=!r.port&&""===e.port||r.port===e.port;return r.hostname===e.hostname&&n&&r.protocol===e.protocol?"":"anonymous"}function Le(t,e){var r=R.RETINA_PREFIX.exec(t);return r?parseFloat(r[1]):void 0!==e?e:1}var Ne,Fe={BaseTextureCache:Pe,CanvasRenderTarget:Me,DATA_URI:Ce,ProgramCache:Se,TextureCache:Ae,clearTextureCache:function(){var t;for(t in Ae)delete Ae[t];for(t in Pe)delete Pe[t]},correctBlendMode:le,createIndicesForQuads:de,decomposeDataUri:function(t){var e=Ce.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:Ee,destroyTextureCache:function(){var t;for(t in Ae)Ae[t].destroy();for(t in Pe)Pe[t].destroy()},determineCrossOrigin:Re,getBufferType:fe,getResolutionOfUrl:Le,hex2rgb:oe,hex2string:ae,interleaveTypedArrays:function(t,e){for(var r=0,n=0,i={},o=0;o<t.length;o++)n+=e[o],r+=t[o].length;var a=new ArrayBuffer(4*r),s=null,u=0;for(o=0;o<t.length;o++){var l=e[o],c=t[o],h=fe(c);i[h]||(i[h]=new me[h](a)),s=i[h];for(var p=0;p<c.length;p++){s[(p/l|0)*n+u+p%l]=c[p]}u+=l}return new Float32Array(a)},isPow2:ve,isWebGLSupported:ie,log2:ye,nextPow2:ge,premultiplyBlendMode:ue,premultiplyRgba:ce,premultiplyTint:he,premultiplyTintToRgba:pe,removeItems:xe,rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)},sayHello:ne,sign:be,skipHello:function(){re=!0},string2hex:se,trimCanvas:Ie,uid:we,isMobile:C,EventEmitter:L,earcut:N,url:te},De=2*Math.PI,Ue=180/Math.PI,ke=Math.PI/180;
/*!
   * @pixi/math - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/math is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */(Ne=t.SHAPES||(t.SHAPES={}))[Ne.POLY=0]="POLY",Ne[Ne.RECT=1]="RECT",Ne[Ne.CIRC=2]="CIRC",Ne[Ne.ELIP=3]="ELIP",Ne[Ne.RREC=4]="RREC";var je=function(){function e(e,r,n,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=Number(e),this.y=Number(r),this.width=Number(n),this.height=Number(i),this.type=t.SHAPES.RECT}return Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EMPTY",{get:function(){return new e(0,0,0,0)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},e.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},e.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},e.prototype.fit=function(t){var e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(i-n,0),this},e.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this},e.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=i-n,this},e}(),Be=function(){function e(e,r,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=e,this.y=r,this.radius=n,this.type=t.SHAPES.CIRC}return e.prototype.clone=function(){return new e(this.x,this.y,this.radius)},e.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-t,i=this.y-e;return(n*=n)+(i*=i)<=r},e.prototype.getBounds=function(){return new je(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},e}(),ze=function(){function e(e,r,n,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=r,this.width=n,this.height=i,this.type=t.SHAPES.ELIP}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,n=(e-this.y)/this.height;return(r*=r)+(n*=n)<=1},e.prototype.getBounds=function(){return new je(this.x-this.width,this.y-this.height,this.width,this.height)},e}(),Ge=function(){function e(){for(var e=arguments,r=[],n=0;n<arguments.length;n++)r[n]=e[n];var i=Array.isArray(r[0])?r[0]:r;if("number"!=typeof i[0]){for(var o=[],a=0,s=i.length;a<s;a++)o.push(i[a].x,i[a].y);i=o}this.points=i,this.type=t.SHAPES.POLY,this.closeStroke=!0}return e.prototype.clone=function(){var t=new e(this.points.slice());return t.closeStroke=this.closeStroke,t},e.prototype.contains=function(t,e){for(var r=!1,n=this.points.length/2,i=0,o=n-1;i<n;o=i++){var a=this.points[2*i],s=this.points[2*i+1],u=this.points[2*o],l=this.points[2*o+1];s>e!=l>e&&t<(e-s)/(l-s)*(u-a)+a&&(r=!r)}return r},e}(),Ve=function(){function e(e,r,n,i,o){void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=20),this.x=e,this.y=r,this.width=n,this.height=i,this.radius=o,this.type=t.SHAPES.RREC}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height,this.radius)},e.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),n=e-(this.y+this.radius),i=this.radius*this.radius;if(r*r+n*n<=i)return!0;if((r=t-(this.x+this.width-this.radius))*r+n*n<=i)return!0;if(r*r+(n=e-(this.y+this.height-this.radius))*n<=i)return!0;if((r=t-(this.x+this.radius))*r+n*n<=i)return!0}return!1},e}(),He=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},t}(),Xe=function(){function t(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._x=r,this._y=n,this.cb=t,this.scope=e}return t.prototype.clone=function(e,r){return void 0===e&&(e=this.cb),void 0===r&&(r=this.scope),new t(e,r,this._x,this._y)},t.prototype.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),t}(),We=function(){function t(t,e,r,n,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,r,n,i,o){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},t.prototype.apply=function(t,e){e=e||new He;var r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new He;var r=1/(this.a*this.d+this.c*-this.b),n=t.x,i=t.y;return e.x=this.d*r*n+-this.c*r*i+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*i+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.a,i=this.c,o=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=i*e-this.d*r,this.d=i*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},t.prototype.append=function(t){var e=this.a,r=this.b,n=this.c,i=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*i,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*i,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,r,n,i,o,a,s,u){return this.a=Math.cos(a+u)*i,this.b=Math.sin(a+u)*i,this.c=-Math.sin(a-s)*o,this.d=Math.cos(a-s)*o,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,r=this.b,n=this.c,i=this.d,o=-Math.atan2(-n,i),a=Math.atan2(r,e),s=Math.abs(o+a);return s<1e-5||Math.abs(De-s)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+i*i),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!1,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!1,configurable:!0}),t}(),Ye=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],qe=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],$e=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Qe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ze=[],Je=[],Ke=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];Ze.push(e);for(var r=0;r<16;r++)for(var n=Ke(Ye[t]*Ye[r]+$e[t]*qe[r]),i=Ke(qe[t]*Ye[r]+Qe[t]*qe[r]),o=Ke(Ye[t]*$e[r]+$e[t]*Qe[r]),a=Ke(qe[t]*$e[r]+Qe[t]*Qe[r]),s=0;s<16;s++)if(Ye[s]===n&&qe[s]===i&&$e[s]===o&&Qe[s]===a){e.push(s);break}}for(t=0;t<16;t++){var u=new We;u.set(Ye[t],qe[t],$e[t],Qe[t],0,0),Je.push(u)}}();var tr={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Ye[t]},uY:function(t){return qe[t]},vX:function(t){return $e[t]},vY:function(t){return Qe[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return Ze[t][e]},sub:function(t,e){return Ze[t][tr.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?tr.S:tr.N:2*Math.abs(e)<=Math.abs(t)?t>0?tr.E:tr.W:e>0?t>0?tr.SE:tr.SW:t>0?tr.NE:tr.NW},matrixAppendRotationInv:function(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=Je[tr.inv(e)];i.tx=r,i.ty=n,t.append(i)}},er=function(){function t(){this.worldTransform=new We,this.localTransform=new We,this.position=new Xe(this.onChange,this,0,0),this.scale=new Xe(this.onChange,this,1,1),this.pivot=new Xe(this.onChange,this,0,0),this.skew=new Xe(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),t.IDENTITY=new t,t}();
/*!
   * @pixi/display - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/display is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
R.SORTABLE_CHILDREN=!1;var rr=function(){function t(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return t.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},t.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},t.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?je.EMPTY:((t=t||new je(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},t.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},t.prototype.addQuad=function(t){var e=this.minX,r=this.minY,n=this.maxX,i=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,i=a>i?a:i,e=(o=t[2])<e?o:e,r=(a=t[3])<r?a:r,n=o>n?o:n,i=a>i?a:i,e=(o=t[4])<e?o:e,r=(a=t[5])<r?a:r,n=o>n?o:n,i=a>i?a:i,e=(o=t[6])<e?o:e,r=(a=t[7])<r?a:r,n=o>n?o:n,i=a>i?a:i,this.minX=e,this.minY=r,this.maxX=n,this.maxY=i},t.prototype.addFrame=function(t,e,r,n,i){this.addFrameMatrix(t.worldTransform,e,r,n,i)},t.prototype.addFrameMatrix=function(t,e,r,n,i){var o=t.a,a=t.b,s=t.c,u=t.d,l=t.tx,c=t.ty,h=this.minX,p=this.minY,d=this.maxX,f=this.maxY,m=o*e+s*r+l,g=a*e+u*r+c;h=m<h?m:h,p=g<p?g:p,d=m>d?m:d,f=g>f?g:f,h=(m=o*n+s*r+l)<h?m:h,p=(g=a*n+u*r+c)<p?g:p,d=m>d?m:d,f=g>f?g:f,h=(m=o*e+s*i+l)<h?m:h,p=(g=a*e+u*i+c)<p?g:p,d=m>d?m:d,f=g>f?g:f,h=(m=o*n+s*i+l)<h?m:h,p=(g=a*n+u*i+c)<p?g:p,d=m>d?m:d,f=g>f?g:f,this.minX=h,this.minY=p,this.maxX=d,this.maxY=f},t.prototype.addVertexData=function(t,e,r){for(var n=this.minX,i=this.minY,o=this.maxX,a=this.maxY,s=e;s<r;s+=2){var u=t[s],l=t[s+1];n=u<n?u:n,i=l<i?l:i,o=u>o?u:o,a=l>a?l:a}this.minX=n,this.minY=i,this.maxX=o,this.maxY=a},t.prototype.addVertices=function(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)},t.prototype.addVerticesMatrix=function(t,e,r,n,i,o){void 0===i&&(i=0),void 0===o&&(o=i);for(var a=t.a,s=t.b,u=t.c,l=t.d,c=t.tx,h=t.ty,p=this.minX,d=this.minY,f=this.maxX,m=this.maxY,g=r;g<n;g+=2){var v=e[g],y=e[g+1],x=a*v+u*y+c,b=l*y+s*v+h;p=Math.min(p,x-i),f=Math.max(f,x+i),d=Math.min(d,b-o),m=Math.max(m,b+o)}this.minX=p,this.minY=d,this.maxX=f,this.maxY=m},t.prototype.addBounds=function(t){var e=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>i?t.maxY:i},t.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=i&&n<=o){var a=this.minX,s=this.minY,u=this.maxX,l=this.maxY;this.minX=r<a?r:a,this.minY=n<s?n:s,this.maxX=i>u?i:u,this.maxY=o>l?o:l}},t.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},t.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=i&&n<=o){var a=this.minX,s=this.minY,u=this.maxX,l=this.maxY;this.minX=r<a?r:a,this.minY=n<s?n:s,this.maxX=i>u?i:u,this.maxY=o>l?o:l}},t.prototype.pad=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},t.prototype.addFramePad=function(t,e,r,n,i,o){t-=i,e-=o,r+=i,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n},t}(),nr=function(t,e){return(nr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */function ir(t,e){function r(){this.constructor=t}nr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var or=function(t){function e(){var e=t.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new er,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new rr,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return ir(e,t),e.mixin=function(t){for(var r=Object.keys(t),n=0;n<r.length;++n){var i=r[n];Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(t,i))}},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new je),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new je),t=this._localBoundsRect),this._localBounds||(this._localBounds=new rr);var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var n=this._bounds,i=this._boundsID;this._bounds=this._localBounds;var o=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-i,o},e.prototype.toGlobal=function(t,e,r){return void 0===r&&(r=!1),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,r,n,i,o,a,s,u){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=i,this.skew.x=o,this.skew.y=a,this.pivot.x=s,this.pivot.y=u,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new ar),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*Ue},set:function(t){this.transform.rotation=t*ke},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){var e;this._mask&&((e=this._mask.maskObject||this._mask).renderable=!0,e.isMask=!1);(this._mask=t,this._mask)&&((e=this._mask.maskObject||this._mask).renderable=!1,e.isMask=!0)},enumerable:!1,configurable:!0}),e}(L),ar=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sortDirty=null,e}return ir(e,t),e}(or);function sr(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}or.prototype.displayObjectUpdateTransform=or.prototype.updateTransform;var ur=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.sortableChildren=R.SORTABLE_CHILDREN,e.sortDirty=!1,e}return ir(e,t),e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];if(e.length>1)for(var n=0;n<e.length;n++)this.addChild(e[n]);else{var i=e[0];i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.push(i),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",i,this,this.children.length-1),i.emit("added",this)}return e[0]},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(t);xe(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];if(e.length>1)for(var n=0;n<e.length;n++)this.removeChild(e[n]);else{var i=e[0],o=this.children.indexOf(i);if(-1===o)return null;i.parent=null,i.transform._parentID=-1,xe(this.children,o,1),this._boundsID++,this.onChildrenChange(o),i.emit("removed",this),this.emit("childRemoved",i,this,o)}return e[0]},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,xe(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var r,n=t,i=e-n;if(i>0&&i<=e){r=this.children.splice(n,i);for(var o=0;o<r.length;++o)r[o].parent=null,r[o].transform&&(r[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(o=0;o<r.length;++o)r[o].emit("removed",this),this.emit("childRemoved",r[o],this,o);return r}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,r=this.children.length;e<r;++e){var n=this.children[e];n._lastSortedIndex=e,t||0===n.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(sr),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var r=this.children[t];r.visible&&r.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var r=e._mask.maskObject||e._mask;r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(e,r){void 0===r&&(r=!1);var n=t.prototype.getLocalBounds.call(this,e);if(!r)for(var i=0,o=this.children.length;i<o;++i){var a=this.children[i];a.visible&&a.updateTransform()}return n},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}r&&t.mask.push(this,this._mask),this._render(t);n=0;for(var i=this.children.length;n<i;n++)this.children[n].render(t);t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var r="boolean"==typeof e?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(r)for(var i=0;i<n.length;++i)n[i].destroy(e)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},enumerable:!1,configurable:!0}),e}(or);ur.prototype.containerUpdateTransform=ur.prototype.updateTransform;
/*!
   * @pixi/accessibility - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/accessibility is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var lr={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};or.mixin(lr);var cr,hr=function(){function t(t){this._hookDiv=null,(C.tablet||C.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._isActive=!1,this._isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),t.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2..toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessability for this content",e.addEventListener("focus",(function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},t.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},t.prototype.activate=function(){this._isActive||(this._isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},t.prototype.deactivate=function(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},t.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}},t.prototype.update=function(){var t=performance.now();if(!(C.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),r=this.renderer.resolution,n=e.width/this.renderer.width*r,i=e.height/this.renderer.height*r,o=this.div;o.style.left=e.left+"px",o.style.top=e.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var a=0;a<this.children.length;a++){var s=this.children[a];if(s.renderId!==this.renderId)s._accessibleActive=!1,xe(this.children,a,1),this.div.removeChild(s._accessibleDiv),this.pool.push(s._accessibleDiv),s._accessibleDiv=null,a--;else{o=s._accessibleDiv;var u=s.hitArea,l=s.worldTransform;s.hitArea?(o.style.left=(l.tx+u.x*l.a)*n+"px",o.style.top=(l.ty+u.y*l.d)*i+"px",o.style.width=u.width*l.a*n+"px",o.style.height=u.height*l.d*i+"px"):(u=s.getBounds(),this.capHitArea(u),o.style.left=u.x*n+"px",o.style.top=u.y*i+"px",o.style.width=u.width*n+"px",o.style.height=u.height*i+"px",o.title!==s.accessibleTitle&&null!==s.accessibleTitle&&(o.title=s.accessibleTitle),o.getAttribute("aria-label")!==s.accessibleHint&&null!==s.accessibleHint&&o.setAttribute("aria-label",s.accessibleHint)),s.accessibleTitle===o.title&&s.tabIndex===o.tabIndex||(o.title=s.accessibleTitle,o.tabIndex=s.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}},t.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},t.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},t.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},t.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},t.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},t.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},t.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},t.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},t.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},t}();
/*!
   * @pixi/ticker - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/ticker is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
R.TARGET_FPMS=.06,(cr=t.UPDATE_PRIORITY||(t.UPDATE_PRIORITY={}))[cr.INTERACTION=50]="INTERACTION",cr[cr.HIGH=25]="HIGH",cr[cr.NORMAL=0]="NORMAL",cr[cr.LOW=-25]="LOW",cr[cr.UTILITY=-50]="UTILITY";var pr=function(){function t(t,e,r,n){void 0===e&&(e=null),void 0===r&&(r=0),void 0===n&&(n=!1),this.fn=t,this.context=e,this.priority=r,this.once=n,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),dr=function(){function e(){var t=this;this._head=new pr(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/R.TARGET_FPMS,this.elapsedMS=1/R.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(e,r,n){return void 0===n&&(n=t.UPDATE_PRIORITY.NORMAL),this._addListener(new pr(e,r,n))},e.prototype.addOnce=function(e,r,n){return void 0===n&&(n=t.UPDATE_PRIORITY.NORMAL),this._addListener(new pr(e,r,n,!0))},e.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this},e.prototype.remove=function(t,e){for(var r=this._head.next;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(e.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},e.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*R.TARGET_FPMS;for(var n=this._head,i=n.next;i;)i=i.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(e.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,R.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shared",{get:function(){if(!e._shared){var t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared},enumerable:!1,configurable:!0}),Object.defineProperty(e,"system",{get:function(){if(!e._system){var t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system},enumerable:!1,configurable:!0}),e}(),fr=function(){function e(){}return e.init=function(e){var r=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,t.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){r._ticker.stop()},this.start=function(){r._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?dr.shared:new dr,e.autoStart&&this.start()},e.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},e}(),mr=function(){function t(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new He,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(t.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),t.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},t.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},t.prototype.reset=function(){this.isPrimary=!1},t}(),gr=function(t,e){return(gr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var vr=function(){function t(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return t.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},t.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},t}(),yr=function(){function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE}return t.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Object.defineProperty(t.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"none",{get:function(){return this._flags===t.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"over",{get:function(){return 0!=(this._flags&t.FLAGS.OVER)},set:function(e){this._doSet(t.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightDown",{get:function(){return 0!=(this._flags&t.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(t.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftDown",{get:function(){return 0!=(this._flags&t.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(t.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),t.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),t}(),xr=function(){function t(){this._tempPoint=new He}return t.prototype.recursiveFindHit=function(t,e,r,n,i){if(!e||!e.visible)return!1;var o=t.data.global,a=!1,s=i=e.interactive||i,u=!0;if(e.hitArea?(n&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(n=!1,u=!1)),s=!1):e._mask&&n&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(n=!1)),u&&e.interactiveChildren&&e.children)for(var l=e.children,c=l.length-1;c>=0;c--){var h=l[c],p=this.recursiveFindHit(t,h,r,n,s);if(p){if(!h.parent)continue;s=!1,p&&(t.target&&(n=!1),a=!0)}}return i&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),r&&r(t,e,!!a))),a},t.prototype.findHit=function(t,e,r,n){this.recursiveFindHit(t,e,r,n,!1)},t}(),br={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};or.mixin(br);var _r={target:null,data:{global:null}},wr=function(e){function r(t,r){var n=e.call(this)||this;return r=r||{},n.renderer=t,n.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,n.interactionFrequency=r.interactionFrequency||10,n.mouse=new mr,n.mouse.identifier=1,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[1]=n.mouse,n.interactionDataPool=[],n.eventData=new vr,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!1,n.supportsTouchEvents="ontouchstart"in window,n.supportsPointerEvents=!!window.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new xr,n._tempDisplayObject=new ar,n._useSystemTicker=void 0===r.useSystemTicker||r.useSystemTicker,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return function(t,e){function r(){this.constructor=t}gr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),Object.defineProperty(r.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),r.prototype.hitTest=function(t,e){return _r.target=null,_r.data.global=t,e||(e=this.lastObjectRendered),this.processInteractive(_r,e,null,!0),_r.target},r.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents(),this.addTickerListener()},r.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(dr.system.add(this.tickerUpdate,this,t.UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},r.prototype.removeTickerListener=function(){this.tickerAdded&&(dr.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},r.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},r.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},r.prototype.tickerUpdate=function(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},r.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var e=this.activeInteractionData[t];if(e.originalEvent&&"touch"!==e.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e);this.processInteractive(r,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},r.prototype.setCursorMode=function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},r.prototype.dispatchEvent=function(t,e,r){r.stopPropagationHint&&t!==r.stopsPropagatingAt||(r.currentTarget=t,r.type=e,t.emit(e,r),t[e]&&t[e](r))},r.prototype.delayDispatchEvent=function(t,e,r){this.delayedEvents.push({displayObject:t,eventString:e,eventData:r})},r.prototype.mapPositionToPoint=function(t,e,r){var n;n=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=1/this.resolution;t.x=(e-n.left)*(this.interactionDOMElement.width/n.width)*i,t.y=(r-n.top)*(this.interactionDOMElement.height/n.height)*i},r.prototype.processInteractive=function(t,e,r,n){var i=this.search.findHit(t,e,r,n),o=this.delayedEvents;if(!o.length)return i;t.stopPropagationHint=!1;var a=o.length;this.delayedEvents=[];for(var s=0;s<a;s++){var u=o[s],l=u.displayObject,c=u.eventString,h=u.eventData;h.stopsPropagatingAt===l&&(h.stopPropagationHint=!0),this.dispatchEvent(l,c,h)}return i},r.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var r=e.length,n=0;n<r;n++){var i=e[n],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);if(a.data.originalEvent=t,this.processInteractive(a,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===i.pointerType)this.emit("touchstart",a);else if("mouse"===i.pointerType||"pen"===i.pointerType){var s=2===i.button;this.emit(s?"rightdown":"mousedown",this.eventData)}}}},r.prototype.processPointerDown=function(t,e,r){var n=t.data,i=t.data.identifier;if(r)if(e.trackedPointers[i]||(e.trackedPointers[i]=new yr(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===n.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===n.pointerType||"pen"===n.pointerType){var o=2===n.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},r.prototype.onPointerComplete=function(t,e,r){for(var n=this.normalizeToPointerData(t),i=n.length,o=t.target!==this.interactionDOMElement?"outside":"",a=0;a<i;a++){var s=n[a],u=this.getInteractionDataForPointerId(s),l=this.configureInteractionEventForDOMEvent(this.eventData,s,u);if(l.data.originalEvent=t,this.processInteractive(l,this.lastObjectRendered,r,e||!o),this.emit(e?"pointercancel":"pointerup"+o,l),"mouse"===s.pointerType||"pen"===s.pointerType){var c=2===s.button;this.emit(c?"rightup"+o:"mouseup"+o,l)}else"touch"===s.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,l),this.releaseInteractionDataForPointerId(s.pointerId))}},r.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},r.prototype.processPointerCancel=function(t,e){var r=t.data,n=t.data.identifier;void 0!==e.trackedPointers[n]&&(delete e.trackedPointers[n],this.dispatchEvent(e,"pointercancel",t),"touch"===r.pointerType&&this.dispatchEvent(e,"touchcancel",t))},r.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},r.prototype.processPointerUp=function(t,e,r){var n=t.data,i=t.data.identifier,o=e.trackedPointers[i],a="touch"===n.pointerType,s="mouse"===n.pointerType||"pen"===n.pointerType,u=!1;if(s){var l=2===n.button,c=yr.FLAGS,h=l?c.RIGHT_DOWN:c.LEFT_DOWN,p=void 0!==o&&o.flags&h;r?(this.dispatchEvent(e,l?"rightup":"mouseup",t),p&&(this.dispatchEvent(e,l?"rightclick":"click",t),u=!0)):p&&this.dispatchEvent(e,l?"rightupoutside":"mouseupoutside",t),o&&(l?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),o&&(s&&!u||this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},r.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this._didMove=!0,this.cursor=null);for(var r=e.length,n=0;n<r;n++){var i=e[n],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",a),"touch"===i.pointerType&&this.emit("touchmove",a),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},r.prototype.processPointerMove=function(t,e,r){var n=t.data,i="touch"===n.pointerType,o="mouse"===n.pointerType||"pen"===n.pointerType;o&&this.processPointerOverOut(t,e,r),this.moveWhenInside&&!r||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},r.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,r);n.data.originalEvent=e,this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(r.identifier)}},r.prototype.processPointerOverOut=function(t,e,r){var n=t.data,i=t.data.identifier,o="mouse"===n.pointerType||"pen"===n.pointerType,a=e.trackedPointers[i];r&&!a&&(a=e.trackedPointers[i]=new yr(i)),void 0!==a&&(r&&this.mouseOverRenderer?(a.over||(a.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[i]))},r.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],r=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,r);n.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",n)},r.prototype.getInteractionDataForPointerId=function(t){var e,r=t.pointerId;return 1===r||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[r]?e=this.activeInteractionData[r]:((e=this.interactionDataPool.pop()||new mr).identifier=r,this.activeInteractionData[r]=e),e.copyEvent(t),e},r.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},r.prototype.configureInteractionEventForDOMEvent=function(t,e,r){return t.data=r,this.mapPositionToPoint(r.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=r.global.x,e.globalY=r.global.y),r.originalEvent=e,t.reset(),t},r.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var r=0,n=t.changedTouches.length;r<n;r++){var i=t.changedTouches[r];void 0===i.button&&(i.button=t.touches.length?1:0),void 0===i.buttons&&(i.buttons=t.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else if(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent)e.push(t);else{var o=t;void 0===o.isPrimary&&(o.isPrimary=!0),void 0===o.width&&(o.width=1),void 0===o.height&&(o.height=1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="mouse"),void 0===o.pointerId&&(o.pointerId=1),void 0===o.pressure&&(o.pressure=.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),o.isNormalized=!0,e.push(o)}return e},r.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},r}(L),Tr=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,r,n,i,o,a,s){if(arguments.length>8)throw new Error("max arguments reached");var u=this,l=u.name,c=u.items;this._aliasCount++;for(var h=0,p=c.length;h<p;h++)c[h][l](t,e,r,n,i,o,a,s);return c===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),t}();Object.defineProperties(Tr.prototype,{dispatch:{value:Tr.prototype.emit},run:{value:Tr.prototype.emit}}),
/*!
   * @pixi/core - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/core is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
R.PREFER_ENV=C.any?t.ENV.WEBGL:t.ENV.WEBGL2,R.STRICT_TEXTURE_CACHE=!1;var Er=[];function Sr(t,e){if(!t)return null;var r="";if("string"==typeof t){var n=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);n&&(r=n[1].toLowerCase())}for(var i=Er.length-1;i>=0;--i){var o=Er[i];if(o.test&&o.test(t,r))return new o(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */var Ar=function(t,e){return(Ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Pr(t,e){function r(){this.constructor=t}Ar(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Mr=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Tr("setRealSize"),this.onUpdate=new Tr("update"),this.onError=new Tr("onError")}return t.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},t.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},t.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(t.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.destroyed||this.onUpdate.emit()},t.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t.prototype.style=function(t,e,r){return!1},t.prototype.dispose=function(){},t.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},t.test=function(t,e){return!1},t}(),Ir=function(e){function r(t,r){var n=this,i=r||{},o=i.width,a=i.height;if(!o||!a)throw new Error("BufferResource width or height invalid");return(n=e.call(this,o,a)||this).data=t,n}return Pr(r,e),r.prototype.upload=function(e,r,n){var i=e.gl;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),n.width===r.width&&n.height===r.height?i.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(n.width=r.width,n.height=r.height,i.texImage2D(r.target,0,n.internalFormat,r.width,r.height,0,r.format,n.type,this.data)),!0},r.prototype.dispose=function(){this.data=null},r.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},r}(Mr),Or={scaleMode:t.SCALE_MODES.NEAREST,format:t.FORMATS.RGBA,alphaMode:t.ALPHA_MODES.NPM},Cr=function(e){function r(r,n){void 0===r&&(r=null),void 0===n&&(n=null);var i=e.call(this)||this,o=(n=n||{}).alphaMode,a=n.mipmap,s=n.anisotropicLevel,u=n.scaleMode,l=n.width,c=n.height,h=n.wrapMode,p=n.format,d=n.type,f=n.target,m=n.resolution,g=n.resourceOptions;return!r||r instanceof Mr||((r=Sr(r,g)).internal=!0),i.width=l||0,i.height=c||0,i.resolution=m||R.RESOLUTION,i.mipmap=void 0!==a?a:R.MIPMAP_TEXTURES,i.anisotropicLevel=void 0!==s?s:R.ANISOTROPIC_LEVEL,i.wrapMode=h||R.WRAP_MODE,i.scaleMode=void 0!==u?u:R.SCALE_MODE,i.format=p||t.FORMATS.RGBA,i.type=d||t.TYPES.UNSIGNED_BYTE,i.target=f||t.TARGETS.TEXTURE_2D,i.alphaMode=void 0!==o?o:t.ALPHA_MODES.UNPACK,void 0!==n.premultiplyAlpha&&(i.premultiplyAlpha=n.premultiplyAlpha),i.uid=we(),i.touched=0,i.isPowerOfTwo=!1,i._refreshPOT(),i._glTextures={},i.dirtyId=0,i.dirtyStyleId=0,i.cacheId=null,i.valid=l>0&&c>0,i.textureCacheIds=[],i.destroyed=!1,i.resource=null,i._batchEnabled=0,i._batchLocation=0,i.parentTextureArray=null,i.setResource(r),i}return Pr(r,e),Object.defineProperty(r.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),r.prototype.setStyle=function(t,e){var r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this},r.prototype.setSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},r.prototype.setRealSize=function(t,e,r){return this.resolution=r||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},r.prototype._refreshPOT=function(){this.isPowerOfTwo=ve(this.realWidth)&&ve(this.realHeight)},r.prototype.setResolution=function(t){var e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT()),this},r.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},r.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},r.prototype.onError=function(t){this.emit("error",this,t)},r.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Pe[this.cacheId],delete Ae[this.cacheId],this.cacheId=null),this.dispose(),r.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},r.prototype.dispose=function(){this.emit("dispose",this)},r.prototype.castToBaseTexture=function(){return this},r.from=function(t,e,n){void 0===n&&(n=R.STRICT_TEXTURE_CACHE);var i="string"==typeof t,o=null;i?o=t:(t._pixiId||(t._pixiId="pixiid_"+we()),o=t._pixiId);var a=Pe[o];if(i&&n&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||((a=new r(t,e)).cacheId=o,r.addToCache(a,o)),a},r.fromBuffer=function(e,n,i,o){e=e||new Float32Array(n*i*4);var a=new Ir(e,{width:n,height:i}),s=e instanceof Float32Array?t.TYPES.FLOAT:t.TYPES.UNSIGNED_BYTE;return new r(a,Object.assign(Or,o||{width:n,height:i,type:s}))},r.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Pe[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Pe[e]=t)},r.removeFromCache=function(t){if("string"==typeof t){var e=Pe[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Pe[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)delete Pe[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},r._globalBatch=0,r}(L),Rr=function(t){function e(e,r){var n=this,i=r||{},o=i.width,a=i.height;(n=t.call(this,o,a)||this).items=[],n.itemDirtyIds=[];for(var s=0;s<e;s++){var u=new Cr;n.items.push(u),n.itemDirtyIds.push(-2)}return n.length=e,n._load=null,n.baseTexture=null,n}return Pr(e,t),e.prototype.initFromArray=function(t,e){for(var r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Mr?this.addResourceAt(t[r],r):this.addResourceAt(Sr(t[r],e),r))},e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");t.prototype.bind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=e,this.items[r].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})).filter((function(t){return t})).map((function(t){return t.load()}));return this._load=Promise.all(e).then((function(){var e=t.items[0],r=e.realWidth,n=e.realHeight;return t.resize(r,n),Promise.resolve(t)})),this._load},e}(Mr),Lr=function(e){function r(t,r){var n,i,o=this,a=r||{},s=a.width,u=a.height;return Array.isArray(t)?(n=t,i=t.length):i=t,o=e.call(this,i,{width:s,height:u})||this,n&&o.initFromArray(n,r),o}return Pr(r,e),r.prototype.addBaseTextureAt=function(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this},r.prototype.bind=function(r){e.prototype.bind.call(this,r),r.target=t.TARGETS.TEXTURE_2D_ARRAY},r.prototype.upload=function(t,e,r){var n=this,i=n.length,o=n.itemDirtyIds,a=n.items,s=t.gl;r.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,i,0,e.format,e.type,null);for(var u=0;u<i;u++){var l=a[u];o[u]<l.dirtyId&&(o[u]=l.dirtyId,l.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,u,l.resource.width,l.resource.height,1,e.format,e.type,l.resource.source))}return!0},r}(Rr),Nr=function(e){function r(t){var r=this,n=t,i=n.naturalWidth||n.videoWidth||n.width,o=n.naturalHeight||n.videoHeight||n.height;return(r=e.call(this,i,o)||this).source=t,r.noSubImage=!1,r}return Pr(r,e),r.crossOrigin=function(t,e,r){void 0===r&&0!==e.indexOf("data:")?t.crossOrigin=Re(e):!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous")},r.prototype.upload=function(e,r,n,i){var o=e.gl,a=r.realWidth,s=r.realHeight;return i=i||this.source,o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),this.noSubImage||r.target!==o.TEXTURE_2D||n.width!==a||n.height!==s?(n.width=a,n.height=s,o.texImage2D(r.target,0,r.format,r.format,r.type,i)):o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,r.type,i),!0},r.prototype.update=function(){if(!this.destroyed){var t=this.source,r=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(r,n),e.prototype.update.call(this)}},r.prototype.dispose=function(){this.source=null},r}(Mr),Fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pr(e,t),e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(Nr),Dr=function(e){function r(n,i){var o=this,a=i||{},s=a.width,u=a.height,l=a.autoLoad,c=a.linkBaseTexture;if(n&&n.length!==r.SIDES)throw new Error("Invalid length. Got "+n.length+", expected 6");o=e.call(this,6,{width:s,height:u})||this;for(var h=0;h<r.SIDES;h++)o.items[h].target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+h;return o.linkBaseTexture=!1!==c,n&&o.initFromArray(n,i),!1!==l&&o.load(),o}return Pr(r,e),r.prototype.bind=function(r){e.prototype.bind.call(this,r),r.target=t.TARGETS.TEXTURE_CUBE_MAP},r.prototype.addBaseTextureAt=function(e,r,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,r)}else e.target=t.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+r,e.parentTextureArray=this.baseTexture,this.items[r]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[r]=e,this},r.prototype.upload=function(t,e,n){for(var i=this.itemDirtyIds,o=0;o<r.SIDES;o++){var a=this.items[o];i[o]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(t,a,n),i[o]=a.dirtyId):i[o]<-1&&(t.gl.texImage2D(a.target,0,n.internalFormat,e.realWidth,e.realHeight,0,e.format,n.type,null),i[o]=-1))}return!0},r.test=function(t){return Array.isArray(t)&&t.length===r.SIDES},r.SIDES=6,r}(Rr),Ur=function(e){function r(t,r){var n=this;if(r=r||{},!(t instanceof HTMLImageElement)){var i=new Image;Nr.crossOrigin(i,t,r.crossorigin),i.src=t,t=i}return n=e.call(this,t)||this,!t.complete&&n._width&&n._height&&(n._width=0,n._height=0),n.url=t.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(void 0!==r.createBitmap?r.createBitmap:R.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,n.alphaMode="number"==typeof r.alphaMode?r.alphaMode:null,void 0!==r.premultiplyAlpha&&(n.premultiplyAlpha=r.premultiplyAlpha),n.bitmap=null,n._load=null,!1!==r.autoLoad&&n.load(),n}return Pr(r,e),r.prototype.load=function(t){var e=this;return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise((function(t,r){var n=e.source;e.url=n.src;var i=function(){e.destroyed||(n.onload=null,n.onerror=null,e.resize(n.width,n.height),e._load=null,e.createBitmap?t(e.process()):t(e))};n.complete&&n.src?i():(n.onload=i,n.onerror=function(t){r(t),e.onError.emit(t)})}))),this._load},r.prototype.process=function(){var e=this,r=this.source;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(r,0,0,r.width,r.height,{premultiplyAlpha:this.alphaMode===t.ALPHA_MODES.UNPACK?"premultiply":"none"}).then((function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))})),this._process):Promise.resolve(this)},r.prototype.upload=function(t,r,n){if("number"==typeof this.alphaMode&&(r.alphaMode=this.alphaMode),!this.createBitmap)return e.prototype.upload.call(this,t,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(e.prototype.upload.call(this,t,r,n,this.bitmap),!this.preserveBitmap){var i=!0,o=r._glTextures;for(var a in o){var s=o[a];if(s!==n&&s.dirtyId!==r.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},r.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,e.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},r.test=function(t){return"string"==typeof t||t instanceof HTMLImageElement},r}(Nr),kr=function(t){function e(e,r){var n=this;return r=r||{},(n=t.call(this,document.createElement("canvas"))||this)._width=0,n._height=0,n.svg=e,n.scale=r.scale||1,n._overrideWidth=r.width,n._overrideHeight=r.height,n._resolve=null,n._crossorigin=r.crossorigin,n._load=null,!1!==r.autoLoad&&n.load(),n}return Pr(e,t),e.prototype.load=function(){var t=this;return this._load||(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},e.prototype._loadSvg=function(){var t=this,e=new Image;Nr.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=function(r){t._resolve&&(e.onerror=null,t.onError.emit(r))},e.onload=function(){if(t._resolve){var r=e.width,n=e.height;if(!r||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=r*t.scale,o=n*t.scale;(t._overrideWidth||t._overrideHeight)&&(i=t._overrideWidth||t._overrideHeight/n*r,o=t._overrideHeight||t._overrideWidth/r*n),i=Math.round(i),o=Math.round(o);var a=t.source;a.width=i,a.height=o,a._pixiId="canvas_"+we(),a.getContext("2d").drawImage(e,0,0,r,n,0,0,i,o),t._resolve(),t._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&0===t.indexOf("data:image/svg+xml;base64")||"string"==typeof t&&0===t.indexOf("<svg")},e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e}(Nr),jr=function(t){function e(r,n){var i=this;if(n=n||{},!(r instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),"string"==typeof r&&(r=[r]);var a=r[0].src||r[0];Nr.crossOrigin(o,a,n.crossorigin);for(var s=0;s<r.length;++s){var u=document.createElement("source"),l=r[s],c=l.src,h=l.mime,p=(c=c||r[s]).split("?").shift().toLowerCase(),d=p.substr(p.lastIndexOf(".")+1);h=h||e.MIME_TYPES[d]||"video/"+d,u.src=c,u.type=h,o.appendChild(u)}r=o}return(i=t.call(this,r)||this).noSubImage=!0,i._autoUpdate=!0,i._isConnectedToTicker=!1,i._updateFPS=n.updateFPS||0,i._msToNextUpdate=0,i.autoPlay=!1!==n.autoPlay,i._load=null,i._resolve=null,i._onCanPlay=i._onCanPlay.bind(i),i._onError=i._onError.bind(i),!1!==n.autoLoad&&i.load(),i}return Pr(e,t),e.prototype.update=function(e){if(!this.destroyed){var r=dr.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(r){t.valid?r(t):(t._resolve=r,e.load())})),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return 3===t.readyState||4===t.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(dr.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&dr.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),t.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(dr.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,r){return t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e}(Nr),Br=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pr(e,t),e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(Nr);Er.push(Ur,Br,Fr,jr,kr,Ir,Dr,Lr);var zr={Resource:Mr,BaseImageResource:Nr,INSTALLED:Er,autoDetectResource:Sr,AbstractMultiResource:Rr,ArrayResource:Lr,BufferResource:Ir,CanvasResource:Fr,CubeResource:Dr,ImageResource:Ur,SVGResource:kr,VideoResource:jr,ImageBitmapResource:Br},Gr=function(){function t(t){this.renderer=t}return t.prototype.destroy=function(){this.renderer=null},t}(),Vr=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return Pr(r,e),r.prototype.upload=function(e,r,n){var i=e.gl;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===t.ALPHA_MODES.UNPACK),n.width===r.width&&n.height===r.height?i.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(n.width=r.width,n.height=r.height,i.texImage2D(r.target,0,1===e.context.webGLVersion?i.DEPTH_COMPONENT:i.DEPTH_COMPONENT16,r.width,r.height,0,r.format,r.type,this.data)),!0},r}(Ir),Hr=function(){function e(e,r){this.width=Math.ceil(e||100),this.height=Math.ceil(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Tr("disposeFramebuffer"),this.multisample=t.MSAA_QUALITY.NONE}return Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),e.prototype.addColorTexture=function(e,r){return void 0===e&&(e=0),this.colorTextures[e]=r||new Cr(null,{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,mipmap:t.MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.addDepthTexture=function(e){return this.depthTexture=e||new Cr(new Vr(null,{width:this.width,height:this.height}),{scaleMode:t.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:t.MIPMAP_MODES.OFF,format:t.FORMATS.DEPTH_COMPONENT,type:t.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},e.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],i=n.resolution;n.setSize(t/i,e/i)}if(this.depthTexture){i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}},e.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},e.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},e}(),Xr=function(t){function e(e){var r=this;if("number"==typeof e){var n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3];e={width:n,height:i,scaleMode:o,resolution:a}}r=t.call(this,null,e)||this;var s=e||{},u=s.width,l=s.height;return r.mipmap=0,r.width=Math.ceil(u)||100,r.height=Math.ceil(l)||100,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new Hr(r.width*r.resolution,r.height*r.resolution).addColorTexture(0,r),r.maskStack=[],r.filterStack=[{}],r}return Pr(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e}(Cr),Wr=function(){function t(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return t.prototype.set=function(t,e,r){var n=e.width,i=e.height;if(r){var o=t.width/2/n,a=t.height/2/i,s=t.x/n+o,u=t.y/i+a;r=tr.add(r,tr.NW),this.x0=s+o*tr.uX(r),this.y0=u+a*tr.uY(r),r=tr.add(r,2),this.x1=s+o*tr.uX(r),this.y1=u+a*tr.uY(r),r=tr.add(r,2),this.x2=s+o*tr.uX(r),this.y2=u+a*tr.uY(r),r=tr.add(r,2),this.x3=s+o*tr.uX(r),this.y3=u+a*tr.uY(r)}else this.x0=t.x/n,this.y0=t.y/i,this.x1=(t.x+t.width)/n,this.y1=t.y/i,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/i,this.x3=t.x/n,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},t}(),Yr=new Wr,qr=function(t){function e(r,n,i,o,a,s){var u=t.call(this)||this;if(u.noFrame=!1,n||(u.noFrame=!0,n=new je(0,0,1,1)),r instanceof e&&(r=r.baseTexture),u.baseTexture=r,u._frame=n,u.trim=o,u.valid=!1,u._uvs=Yr,u.uvMatrix=null,u.orig=i||n,u._rotate=Number(a||0),!0===a)u._rotate=2;else if(u._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return u.defaultAnchor=s?new He(s.x,s.y):new He(0,0),u._updateID=0,u.textureCacheIds=[],r.valid?u.noFrame?r.valid&&u.onBaseTextureUpdated(r):u.frame=n:r.once("loaded",u.onBaseTextureUpdated,u),u.noFrame&&r.on("update",u.onBaseTextureUpdated,u),u}return Pr(e,t),e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture;r&&r.url&&Ae[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===Yr&&(this._uvs=new Wr),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,n){void 0===r&&(r={}),void 0===n&&(n=R.STRICT_TEXTURE_CACHE);var i="string"==typeof t,o=null;i?o=t:(t._pixiId||(t._pixiId="pixiid_"+we()),o=t._pixiId);var a=Ae[o];if(i&&n&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(r.resolution||(r.resolution=Le(t)),(a=new e(new Cr(t,r))).baseTexture.cacheId=o,Cr.addToCache(a.baseTexture,o),e.addToCache(a,o)),a},e.fromURL=function(t,r){var n=Object.assign({autoLoad:!1},null==r?void 0:r.resourceOptions),i=e.from(t,Object.assign({resourceOptions:n},r),!1),o=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):o.load().then((function(){return Promise.resolve(i)}))},e.fromBuffer=function(t,r,n,i){return new e(Cr.fromBuffer(t,r,n,i))},e.fromLoader=function(t,r,n){var i=new Ur(t);i.url=r;var o=new e(new Cr(i,{scaleMode:R.SCALE_MODE,resolution:Le(r)}));return n||(n=r),Cr.addToCache(o.baseTexture,n),e.addToCache(o,n),n!==r&&(Cr.addToCache(o.baseTexture,r),e.addToCache(o,r)),o},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Ae[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),Ae[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Ae[t];if(e){var r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Ae[t],e}}else if(t&&t.textureCacheIds){for(var n=0;n<t.textureCacheIds.length;++n)Ae[t.textureCacheIds[n]]===t&&delete Ae[t.textureCacheIds[n]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var e=t.x,r=t.y,n=t.width,i=t.height,o=e+n>this.baseTexture.width,a=r+i>this.baseTexture.height;if(o||a){var s=o&&a?"and":"or",u="X: "+e+" + "+n+" = "+(e+n)+" > "+this.baseTexture.width,l="Y: "+r+" + "+i+" = "+(r+i)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+u+" "+s+" "+l)}this.valid=n&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e}(L);function $r(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}qr.EMPTY=new qr(new Cr),$r(qr.EMPTY),$r(qr.EMPTY.baseTexture),qr.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new qr(new Cr(new Fr(t)))}(),$r(qr.WHITE),$r(qr.WHITE.baseTexture);var Qr=function(t){function e(e,r){var n=this,i=null;if(!(e instanceof Xr)){var o=arguments[1],a=arguments[2],s=arguments[3],u=arguments[4];console.warn("Please use RenderTexture.create("+o+", "+a+") instead of the ctor directly."),i=arguments[0],r=null,e=new Xr({width:o,height:a,scaleMode:s,resolution:u})}return(n=t.call(this,e,r)||this).legacyRenderer=i,n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Pr(e,t),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,e,r){void 0===r&&(r=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,r&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new Xr(t))},e}(qr),Zr=function(){function t(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return t.prototype.createTexture=function(t,e){var r=new Xr(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Qr(r)},t.prototype.getOptimalTexture=function(e,r,n){void 0===n&&(n=1);var i=t.SCREEN_KEY;e*=n,r*=n,this.enableFullScreen&&e===this._pixelsWidth&&r===this._pixelsHeight||(i=(65535&(e=ge(e)))<<16|65535&(r=ge(r))),this.texturePool[i]||(this.texturePool[i]=[]);var o=this.texturePool[i].pop();return o||(o=this.createTexture(e,r)),o.filterPoolKey=i,o.setResolution(n),o},t.prototype.getFilterTexture=function(t,e){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},t.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},t.prototype.returnFilterTexture=function(t){this.returnTexture(t)},t.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var r=this.texturePool[e];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},t.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var r=t.SCREEN_KEY,n=this.texturePool[r];if(this.enableFullScreen=e.width>0&&e.height>0,n)for(var i=0;i<n.length;i++)n[i].destroy(!0);this.texturePool[r]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},t.SCREEN_KEY="screen",t}(),Jr=function(){function t(t,e,r,n,i,o,a){void 0===e&&(e=0),void 0===r&&(r=!1),void 0===n&&(n=5126),this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=i,this.start=o,this.instance=a}return t.prototype.destroy=function(){this.buffer=null},t.from=function(e,r,n,i,o){return new t(e,r,n,i,o)},t}(),Kr=0,tn=function(){function t(t,e,r){void 0===e&&(e=!0),void 0===r&&(r=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Kr++,this.disposeRunner=new Tr("disposeBuffer")}return t.prototype.update=function(t){this.data=t||this.data,this._updateID++},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.data=null},t.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)},t}();function en(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var rn={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};var nn={5126:4,5123:2,5121:1},on=0,an={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},sn=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=on++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Tr("disposeGeometry"),this.refCount=0}return t.prototype.addAttribute=function(t,e,r,n,i,o,a,s){if(void 0===r&&(r=0),void 0===n&&(n=!1),void 0===s&&(s=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof tn||(e instanceof Array&&(e=new Float32Array(e)),e=new tn(e));var u=t.split("|");if(u.length>1){for(var l=0;l<u.length;l++)this.addAttribute(u[l],e,r,n,i);return this}var c=this.buffers.indexOf(e);return-1===c&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new Jr(c,r,n,i,o,a,s),this.instanced=this.instanced||s,this},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},t.prototype.addIndex=function(t){return t instanceof tn||(t instanceof Array&&(t=new Uint16Array(t)),t=new tn(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},t.prototype.getIndex=function(){return this.indexBuffer},t.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],r=[],n=new tn;for(t in this.attributes){var i=this.attributes[t],o=this.buffers[i.buffer];e.push(o.data),r.push(i.size*nn[i.type]/4),i.buffer=0}for(n.data=function(t,e){for(var r=0,n=0,i={},o=0;o<t.length;o++)n+=e[o],r+=t[o].length;var a=new ArrayBuffer(4*r),s=null,u=0;for(o=0;o<t.length;o++){var l=e[o],c=t[o],h=en(c);i[h]||(i[h]=new rn[h](a)),s=i[h];for(var p=0;p<c.length;p++)s[(p/l|0)*n+u+p%l]=c[p];u+=l}return new Float32Array(a)}(e,r),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},t.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},t.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},t.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},t.prototype.clone=function(){for(var e=new t,r=0;r<this.buffers.length;r++)e.buffers[r]=new tn(this.buffers[r].data.slice(0));for(var r in this.attributes){var n=this.attributes[r];e.attributes[r]=new Jr(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},t.merge=function(e){for(var r,n=new t,i=[],o=[],a=[],s=0;s<e.length;s++){r=e[s];for(var u=0;u<r.buffers.length;u++)o[u]=o[u]||0,o[u]+=r.buffers[u].data.length,a[u]=0}for(s=0;s<r.buffers.length;s++)i[s]=new(an[en(r.buffers[s].data)])(o[s]),n.buffers[s]=new tn(i[s]);for(s=0;s<e.length;s++){r=e[s];for(u=0;u<r.buffers.length;u++)i[u].set(r.buffers[u].data,a[u]),a[u]+=r.buffers[u].data.length}if(n.attributes=r.attributes,r.indexBuffer){n.indexBuffer=n.buffers[r.buffers.indexOf(r.indexBuffer)],n.indexBuffer.index=!0;var l=0,c=0,h=0,p=0;for(s=0;s<r.buffers.length;s++)if(r.buffers[s]!==r.indexBuffer){p=s;break}for(var s in r.attributes){var d=r.attributes[s];(0|d.buffer)===p&&(c+=d.size*nn[d.type]/4)}for(s=0;s<e.length;s++){var f=e[s].indexBuffer.data;for(u=0;u<f.length;u++)n.indexBuffer.data[u+h]+=l;l+=r.buffers[p].data.length/c,h+=f.length}}return n},t}(),un=function(t){function e(){var e=t.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return Pr(e,t),e}(sn),ln=function(t){function e(){var e=t.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new tn(e.vertices),e.uvBuffer=new tn(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return Pr(e,t),e.prototype.map=function(t,e){var r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(sn),cn=0,hn=function(){function t(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=cn++,this.static=!!e}return t.prototype.update=function(){this.dirtyId++},t.prototype.add=function(e,r,n){this.uniforms[e]=new t(r,n)},t.from=function(e,r){return new t(e,r)},t}(),pn=function(){function t(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new je,this.destinationFrame=new je,this.filters=[]}return t.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},t}(),dn=function(e){function r(t){var r=e.call(this,t)||this;return r.defaultFilterStack=[{}],r.texturePool=new Zr,r.texturePool.setScreenSize(t.view),r.statePool=[],r.quad=new un,r.quadUv=new ln,r.tempRect=new je,r.activeState={},r.globalUniforms=new hn({outputFrame:r.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),r.forceClear=!1,r.useMaxPadding=!1,r}return Pr(r,e),r.prototype.push=function(t,e){for(var r=this.renderer,n=this.defaultFilterStack,i=this.statePool.pop()||new pn,o=e[0].resolution,a=e[0].padding,s=e[0].autoFit,u=e[0].legacy,l=1;l<e.length;l++){var c=e[l];o=Math.min(o,c.resolution),a=this.useMaxPadding?Math.max(a,c.padding):a+c.padding,s=s||c.autoFit,u=u||c.legacy}1===n.length&&(this.defaultFilterStack[0].renderTexture=r.renderTexture.current),n.push(i),i.resolution=o,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(a),s&&i.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),i.sourceFrame.ceil(o),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;var h=this.tempRect;h.width=i.sourceFrame.width,h.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,r.renderTexture.bind(i.renderTexture,i.sourceFrame,h),r.renderTexture.clear()},r.prototype.pop=function(){var e=this.defaultFilterStack,r=e.pop(),n=r.filters;this.activeState=r;var i=this.globalUniforms.uniforms;i.outputFrame=r.sourceFrame,i.resolution=r.resolution;var o=i.inputSize,a=i.inputPixel,s=i.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],a[0]=o[0]*r.resolution,a[1]=o[1]*r.resolution,a[2]=1/a[0],a[3]=1/a[1],s[0]=.5*a[2],s[1]=.5*a[3],s[2]=r.sourceFrame.width*o[2]-.5*a[2],s[3]=r.sourceFrame.height*o[3]-.5*a[3],r.legacy){var u=i.filterArea;u[0]=r.destinationFrame.width,u[1]=r.destinationFrame.height,u[2]=r.sourceFrame.x,u[3]=r.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();var l=e[e.length-1];if(r.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,r.renderTexture,l.renderTexture,t.CLEAR_MODES.BLEND,r),this.returnFilterTexture(r.renderTexture);else{var c=r.renderTexture,h=this.getOptimalFilterTexture(c.width,c.height,r.resolution);h.filterFrame=c.filterFrame;var p=0;for(p=0;p<n.length-1;++p){n[p].apply(this,c,h,t.CLEAR_MODES.CLEAR,r);var d=c;c=h,h=d}n[p].apply(this,c,l.renderTexture,t.CLEAR_MODES.BLEND,r),this.returnFilterTexture(c),this.returnFilterTexture(h)}r.clear(),this.statePool.push(r)},r.prototype.bindAndClear=function(e,r){if(void 0===r&&(r=t.CLEAR_MODES.CLEAR),e&&e.filterFrame){var n=this.tempRect;n.width=e.filterFrame.width,n.height=e.filterFrame.height,this.renderer.renderTexture.bind(e,e.filterFrame,n)}else this.renderer.renderTexture.bind(e);"boolean"==typeof r&&(r=r?t.CLEAR_MODES.CLEAR:t.CLEAR_MODES.BLEND,Ee("5.2.1","Use CLEAR_MODES when using clear applyFilter option")),(r===t.CLEAR_MODES.CLEAR||r===t.CLEAR_MODES.BLIT&&this.forceClear)&&this.renderer.renderTexture.clear()},r.prototype.applyFilter=function(e,r,n,i){var o=this.renderer;this.bindAndClear(n,i),e.uniforms.uSampler=r,e.uniforms.filterGlobals=this.globalUniforms,o.state.set(e.state),o.shader.bind(e),e.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(t.DRAW_MODES.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(t.DRAW_MODES.TRIANGLE_STRIP))},r.prototype.calculateSpriteMatrix=function(t,e){var r=this.activeState,n=r.sourceFrame,i=r.destinationFrame,o=e._texture.orig,a=t.set(i.width,0,0,i.height,n.x,n.y),s=e.worldTransform.copyTo(We.TEMP_MATRIX);return s.invert(),a.prepend(s),a.scale(1/o.width,1/o.height),a.translate(e.anchor.x,e.anchor.y),a},r.prototype.destroy=function(){this.texturePool.clear(!1)},r.prototype.getOptimalFilterTexture=function(t,e,r){return void 0===r&&(r=1),this.texturePool.getOptimalTexture(t,e,r)},r.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var r=t;t=e,e=r}t=t||this.activeState.renderTexture;var n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution);return n.filterFrame=t.filterFrame,n},r.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},r.prototype.emptyPool=function(){this.texturePool.clear(!0)},r.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},r}(Gr),fn=function(){function t(t){this.renderer=t}return t.prototype.flush=function(){},t.prototype.destroy=function(){this.renderer=null},t.prototype.start=function(){},t.prototype.stop=function(){this.flush()},t.prototype.render=function(t){},t}(),mn=function(t){function e(e){var r=t.call(this,e)||this;return r.emptyRenderer=new fn(e),r.currentRenderer=r.emptyRenderer,r}return Pr(e,t),e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var r=this.renderer.texture.boundTextures,n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)},e.prototype.boundArray=function(t,e,r,n){for(var i=t.elements,o=t.ids,a=t.count,s=0,u=0;u<a;u++){var l=i[u],c=l._batchLocation;if(c>=0&&c<n&&e[c]===l)o[u]=c;else for(;s<n;){var h=e[s];if(!h||h._batchEnabled!==r||h._batchLocation!==s){o[u]=s,l._batchLocation=s,e[s]=l;break}s++}}},e}(Gr),gn=0,vn=function(e){function r(t){var r=e.call(this,t)||this;return r.webGLVersion=1,r.extensions={},r.supports={uint32Indices:!1},r.handleContextLost=r.handleContextLost.bind(r),r.handleContextRestored=r.handleContextRestored.bind(r),t.view.addEventListener("webglcontextlost",r.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",r.handleContextRestored,!1),r}return Pr(r,e),Object.defineProperty(r.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),r.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=gn++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},r.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=gn++,this.renderer.runners.contextChange.emit(t)},r.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},r.prototype.createContext=function(e,r){var n;if(R.PREFER_ENV>=t.ENV.WEBGL2&&(n=e.getContext("webgl2",r)),n)this.webGLVersion=2;else if(this.webGLVersion=1,!(n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl},r.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},r.prototype.handleContextLost=function(t){t.preventDefault()},r.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},r.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},r.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},r.prototype.validateContext=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var e="WebGL2RenderingContext"in window&&t instanceof window.WebGL2RenderingContext||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=e,e||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},r}(Gr),yn=function(e){this.framebuffer=e,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=t.MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null},xn=new je,bn=function(e){function r(t){var r=e.call(this,t)||this;return r.managedFramebuffers=[],r.unknownFramebuffer=new Hr(10,10),r.msaaSamples=null,r}return Pr(r,e),r.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new je,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var r=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;R.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(r=null,n=null),r?e.drawBuffers=function(t){return r.drawBuffersWEBGL(t)}:(this.hasMRT=!1,e.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},r.prototype.bind=function(t,e){var r=this.gl;if(t){var n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var i=0;i<t.colorTextures.length;i++){var o=t.colorTextures[i];this.renderer.texture.unbind(o.parentTextureArray||o)}t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},r.prototype.setViewport=function(t,e,r,n){var i=this.viewport;i.width===r&&i.height===n&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=r,i.height=n,this.gl.viewport(t,e,r,n))},Object.defineProperty(r.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),r.prototype.clear=function(e,r,n,i,o){void 0===o&&(o=t.BUFFER_BITS.COLOR|t.BUFFER_BITS.DEPTH);var a=this.gl;a.clearColor(e,r,n,i),a.clear(o)},r.prototype.initFramebuffer=function(t){var e=this.gl,r=new yn(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r},r.prototype.resizeFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var n=t.colorTextures,i=0;i<n.length;i++)this.renderer.texture.bind(n[i],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},r.prototype.updateFramebuffer=function(t){var e=this.gl,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures.length;e.drawBuffers||(n=Math.min(n,1)),r.multisample>1&&(r.msaaBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.RGBA8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,r.msaaBuffer));for(var i=[],o=0;o<n;o++)if(!(0===o&&r.multisample>1)){var a=t.colorTextures[o],s=a.parentTextureArray||a;this.renderer.texture.bind(s,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,a.target,s._glTextures[this.CONTEXT_UID].texture,0),i.push(e.COLOR_ATTACHMENT0+o)}if((i.length>1&&e.drawBuffers(i),t.depthTexture)&&this.writeDepthTexture){var u=t.depthTexture;this.renderer.texture.bind(u,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,0)}r.stencil||!t.stencil&&!t.depth||(r.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,r.stencil))},r.prototype.detectSamples=function(e){var r=this.msaaSamples,n=t.MSAA_QUALITY.NONE;if(e<=1||null===r)return n;for(var i=0;i<r.length;i++)if(r[i]<=e){n=r[i];break}return 1===n&&(n=t.MSAA_QUALITY.NONE),n},r.prototype.blit=function(t,e,r){var n=this,i=n.current,o=n.renderer,a=n.gl,s=n.CONTEXT_UID;if(2===o.context.webGLVersion&&i){var u=i.glFramebuffers[s];if(u){if(!t){if(u.multisample<=1)return;u.blitFramebuffer||(u.blitFramebuffer=new Hr(i.width,i.height),u.blitFramebuffer.addColorTexture(0,i.colorTextures[0])),(t=u.blitFramebuffer).width=i.width,t.height=i.height}e||((e=xn).width=i.width,e.height=i.height),r||(r=e);var l=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,u.framebuffer),a.blitFramebuffer(e.x,e.y,e.width,e.height,r.x,r.y,r.width,r.height,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR)}}},r.prototype.disposeFramebuffer=function(t,e){var r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(r){delete t.glFramebuffers[this.CONTEXT_UID];var i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.stencil&&n.deleteRenderbuffer(r.stencil))}},r.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)},r.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var r=t.width,n=t.height,i=this.gl,o=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,r,n),e.stencil=o,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,o)}}},r.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new je},r}(Gr),_n=function(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},wn={5126:4,5123:2,5121:1},Tn=function(e){function r(t){var r=e.call(this,t)||this;return r._activeGeometry=null,r._activeVao=null,r.hasVao=!0,r.hasInstance=!0,r.canUseUInt32ElementIndex=!1,r.managedGeometries={},r.managedBuffers={},r}return Pr(r,e),r.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!e.createVertexArray){var n=this.renderer.context.extensions.vertexArrayObject;R.PREFER_ENV===t.ENV.WEBGL_LEGACY&&(n=null),n?(e.createVertexArray=function(){return n.createVertexArrayOES()},e.bindVertexArray=function(t){return n.bindVertexArrayOES(t)},e.deleteVertexArray=function(t){return n.deleteVertexArrayOES(t)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(!e.vertexAttribDivisor){var i=e.getExtension("ANGLE_instanced_arrays");i?(e.vertexAttribDivisor=function(t,e){return i.vertexAttribDivisorANGLE(t,e)},e.drawElementsInstanced=function(t,e,r,n,o){return i.drawElementsInstancedANGLE(t,e,r,n,o)},e.drawArraysInstanced=function(t,e,r,n){return i.drawArraysInstancedANGLE(t,e,r,n)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===r.webGLVersion||!!r.extensions.uint32ElementIndex},r.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var r=this.gl,n=t.glVertexArrayObjects[this.CONTEXT_UID];n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={});var i=n[e.program.id]||this.initGeometryVao(t,e.program);this._activeGeometry=t,this._activeVao!==i&&(this._activeVao=i,this.hasVao?r.bindVertexArray(i):this.activateVao(t,e.program)),this.updateBuffers()},r.prototype.reset=function(){this.unbind()},r.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,r=0;r<t.buffers.length;r++){var n=t.buffers[r],i=n._glBuffers[this.CONTEXT_UID];if(n._updateID!==i.updateID){i.updateID=n._updateID;var o=n.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(o,i.buffer),this._boundBuffer=i,i.byteLength>=n.data.byteLength)e.bufferSubData(o,0,n.data);else{var a=n.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=n.data.byteLength,e.bufferData(o,n.data,a)}}}},r.prototype.checkCompatibility=function(t,e){var r=t.attributes,n=e.attributeData;for(var i in n)if(!r[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},r.prototype.getSignature=function(t,e){var r=t.attributes,n=e.attributeData,i=["g",t.id];for(var o in r)n[o]&&i.push(o);return i.join("-")},r.prototype.initGeometryVao=function(t,e){this.checkCompatibility(t,e);var r=this.gl,n=this.CONTEXT_UID,i=this.getSignature(t,e),o=t.glVertexArrayObjects[this.CONTEXT_UID],a=o[i];if(a)return o[e.id]=a,a;var s=t.buffers,u=t.attributes,l={},c={};for(var h in s)l[h]=0,c[h]=0;for(var h in u)!u[h].size&&e.attributeData[h]?u[h].size=e.attributeData[h].size:u[h].size||console.warn("PIXI Geometry attribute '"+h+"' size cannot be determined (likely the bound shader does not have the attribute)"),l[u[h].buffer]+=u[h].size*wn[u[h].type];for(var h in u){var p=u[h],d=p.size;void 0===p.stride&&(l[p.buffer]===d*wn[p.type]?p.stride=0:p.stride=l[p.buffer]),void 0===p.start&&(p.start=c[p.buffer],c[p.buffer]+=d*wn[p.type])}a=r.createVertexArray(),r.bindVertexArray(a);for(var f=0;f<s.length;f++){var m=s[f];m._glBuffers[n]||(m._glBuffers[n]=new _n(r.createBuffer()),this.managedBuffers[m.id]=m,m.disposeRunner.add(this)),m._glBuffers[n].refCount++}return this.activateVao(t,e),this._activeVao=a,o[e.id]=a,o[i]=a,a},r.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}},r.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,i=t.buffers;if(t.disposeRunner.remove(this),r){for(var o=0;o<i.length;o++){var a=i[o]._glBuffers[this.CONTEXT_UID];a.refCount--,0!==a.refCount||e||this.disposeBuffer(i[o],e)}if(!e)for(var s in r)if("g"===s[0]){var u=r[s];this._activeVao===u&&this.unbind(),n.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},r.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t);e=Object.keys(this.managedBuffers);for(r=0;r<e.length;r++)this.disposeBuffer(this.managedBuffers[e[r]],t)},r.prototype.activateVao=function(t,e){var r=this.gl,n=this.CONTEXT_UID,i=t.buffers,o=t.attributes;t.indexBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[n].buffer);var a=null;for(var s in o){var u=o[s],l=i[u.buffer]._glBuffers[n];if(e.attributeData[s]){a!==l&&(r.bindBuffer(r.ARRAY_BUFFER,l.buffer),a=l);var c=e.attributeData[s].location;if(r.enableVertexAttribArray(c),r.vertexAttribPointer(c,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(c,1)}}}},r.prototype.draw=function(t,e,r,n){var i=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,s=2===a?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?o.instanced?i.drawElementsInstanced(t,e||o.indexBuffer.data.length,s,(r||0)*a,n||1):i.drawElements(t,e||o.indexBuffer.data.length,s,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?i.drawArraysInstanced(t,r,e||o.getSize(),n||1):i.drawArrays(t,r,e||o.getSize());return this},r.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},r}(Gr),En=function(){function e(e){void 0===e&&(e=null),this.type=t.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return e.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=t.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},e.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},e}();function Sn(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}function An(t,e,r,n){var i=Sn(t,t.VERTEX_SHADER,e),o=Sn(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,i),t.attachShader(a,o),n)for(var s in n)t.bindAttribLocation(a,n[s],s);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||(console.warn(e),console.error(t.getShaderInfoLog(i))),t.getShaderParameter(o,t.COMPILE_STATUS)||(console.warn(r),console.error(t.getShaderInfoLog(o))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(i),t.deleteShader(o),a}function Pn(t){for(var e=new Array(t),r=0;r<e.length;r++)e[r]=!1;return e}function Mn(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return Pn(2*e);case"bvec3":return Pn(3*e);case"bvec4":return Pn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var In,On={},Cn=On;function Rn(){if(Cn===On||Cn&&Cn.isContextLost()){var e=document.createElement("canvas"),r=void 0;R.PREFER_ENV>=t.ENV.WEBGL2&&(r=e.getContext("webgl2",{})),r||((r=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?r.getExtension("WEBGL_draw_buffers"):r=null),Cn=r}return Cn}function Ln(e,r,n){if("precision"!==e.substring(0,9)){var i=r;return r===t.PRECISION.HIGH&&n!==t.PRECISION.HIGH&&(i=t.PRECISION.MEDIUM),"precision "+i+" float;\n"+e}return n!==t.PRECISION.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}var Nn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Fn(t){return Nn[t]}var Dn=null,Un={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function kn(t,e){if(!Dn){var r=Object.keys(Un);Dn={};for(var n=0;n<r.length;++n){var i=r[n];Dn[t[i]]=Un[i]}}return Dn[e]}var jn=[{test:function(t){return"float"===t.type&&1===t.size},code:function(t){return'\n            if(uv["'+t+'"] !== ud["'+t+'"].value)\n            {\n                ud["'+t+'"].value = uv["'+t+'"]\n                gl.uniform1f(ud["'+t+'"].location, uv["'+t+'"])\n            }\n            '}},{test:function(t){return("sampler2D"===t.type||"samplerCube"===t.type||"sampler2DArray"===t.type)&&1===t.size&&!t.isArray},code:function(t){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+t+'"], t);\n\n            if(ud["'+t+'"].value !== t)\n            {\n                ud["'+t+'"].value = t;\n                gl.uniform1i(ud["'+t+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(t,e){return"mat3"===t.type&&1===t.size&&void 0!==e.a},code:function(t){return'\n            gl.uniformMatrix3fv(ud["'+t+'"].location, false, uv["'+t+'"].toArray(true));\n            '}},{test:function(t,e){return"vec2"===t.type&&1===t.size&&void 0!==e.x},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+t+'"].location, v.x, v.y);\n                }'}},{test:function(t){return"vec2"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+t+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(t,e){return"vec4"===t.type&&1===t.size&&void 0!==e.width},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+t+'"].location, v.x, v.y, v.width, v.height)\n                }'}},{test:function(t){return"vec4"===t.type&&1===t.size},code:function(t){return'\n                cv = ud["'+t+'"].value;\n                v = uv["'+t+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+t+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],Bn={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},zn={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var Gn,Vn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Hn(t){for(var e="",r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+="if(test == "+r+".0){}");return e}function Xn(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var r=e.createShader(e.FRAGMENT_SHADER);;){var n=Vn.replace(/%forloop%/gi,Hn(t));if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}var Wn=0,Yn={},qn=function(){function e(r,n,i){void 0===i&&(i="pixi-shader"),this.id=Wn++,this.vertexSrc=r||e.defaultVertexSrc,this.fragmentSrc=n||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),Yn[i]?(Yn[i]++,i+="-"+Yn[i]):Yn[i]=1,this.vertexSrc="#define SHADER_NAME "+i+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+"\n"+this.fragmentSrc,this.vertexSrc=Ln(this.vertexSrc,R.PRECISION_VERTEX,t.PRECISION.HIGH),this.fragmentSrc=Ln(this.fragmentSrc,R.PRECISION_FRAGMENT,function(){if(!In){In=t.PRECISION.MEDIUM;var e=Rn();if(e&&e.getShaderPrecisionFormat){var r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);In=r.precision?t.PRECISION.HIGH:t.PRECISION.MEDIUM}}return In}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return e.prototype.extractData=function(t,e){var r=Rn();if(r){var n=An(r,t,e);this.attributeData=this.getAttributeData(n,r),this.uniformData=this.getUniformData(n,r),r.deleteProgram(n)}else this.uniformData={},this.attributeData={}},e.prototype.getAttributeData=function(t,e){for(var r={},n=[],i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<i;o++){var a=e.getActiveAttrib(t,o),s=kn(e,a.type),u={type:s,name:a.name,size:Fn(s),location:0};r[a.name]=u,n.push(u)}n.sort((function(t,e){return t.name>e.name?1:-1}));for(o=0;o<n.length;o++)n[o].location=o;return r},e.prototype.getUniformData=function(t,e){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<n;i++){var o=e.getActiveUniform(t,i),a=o.name.replace(/\[.*?\]$/,""),s=o.name.match(/\[.*?\]$/),u=kn(e,o.type);r[a]={type:u,size:o.size,isArray:s,value:Mn(u,o.size)}}return r},Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),e.from=function(t,r,n){var i=t+r,o=Se[i];return o||(Se[i]=o=new e(t,r,n)),o},e}(),$n=function(){function t(t,e){for(var r in this.program=t,this.uniformGroup=e?e instanceof hn?e:new hn(e):new hn({}),t.uniformData)this.uniformGroup.uniforms[r]instanceof Array&&(this.uniformGroup.uniforms[r]=new Float32Array(this.uniformGroup.uniforms[r]))}return t.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var r in e.uniforms){var n=e.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},t.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(t.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),t.from=function(e,r,n){return new t(qn.from(e,r),n)},t}(),Qn=function(){function e(){this.data=0,this.blendMode=t.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0}return Object.defineProperty(e.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(t){!!(1&this.data)!==t&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(t){!!(2&this.data)!==t&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(t){!!(4&this.data)!==t&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(t){!!(8&this.data)!==t&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(t){!!(16&this.data)!==t&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==t.BLEND_MODES.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),e.for2d=function(){var t=new e;return t.depthTest=!1,t.blend=!0,t},e}(),Zn=function(t){function e(r,n,i){var o=this,a=qn.from(r||e.defaultVertexSrc,n||e.defaultFragmentSrc);return(o=t.call(this,a,i)||this).padding=0,o.resolution=R.FILTER_RESOLUTION,o.enabled=!0,o.autoFit=!0,o.legacy=!!o.program.attributeData.aTextureCoord,o.state=new Qn,o}return Pr(e,t),e.prototype.apply=function(t,e,r,n,i){t.applyFilter(this,e,r,n)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),e}($n),Jn=new We,Kn=function(){function t(t,e){this._texture=t,this.mapCoord=new We,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),t.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,n=0;n<t.length;n+=2){var i=t[n],o=t[n+1];e[n]=i*r.a+o*r.c+r.tx,e[n+1]=i*r.b+o*r.d+r.ty}return e},t.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=e.orig,i=e.trim;i&&(Jn.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Jn));var o=e.baseTexture,a=this.uClampFrame,s=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(e._frame.x+s+u)/o.width,a[1]=(e._frame.y+s+u)/o.height,a[2]=(e._frame.x+e._frame.width-s+u)/o.width,a[3]=(e._frame.y+e._frame.height-s+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},t}(),ti=function(t){function e(e){var r=this,n=new We;return r=t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this,e.renderable=!1,r.maskSprite=e,r.maskMatrix=n,r}return Pr(e,t),e.prototype.apply=function(t,e,r,n){var i=this.maskSprite,o=i._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new Kn(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))},e}(Zn),ei=function(e){function r(t){var r=e.call(this,t)||this;return r.enableScissor=!1,r.alphaMaskPool=[],r.maskDataPool=[],r.maskStack=[],r.alphaMaskIndex=0,r}return Pr(r,e),r.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},r.prototype.push=function(e,r){var n=r;if(!n.isMaskData){var i=this.maskDataPool.pop()||new En;i.pooled=!0,i.maskObject=r,n=i}switch(n.autoDetect&&this.detect(n),n.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),n._target=e,n.type){case t.MASK_TYPES.SCISSOR:this.maskStack.push(n),this.renderer.scissor.push(n);break;case t.MASK_TYPES.STENCIL:this.maskStack.push(n),this.renderer.stencil.push(n);break;case t.MASK_TYPES.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n),this.maskStack.push(n)}},r.prototype.pop=function(e){var r=this.maskStack.pop();if(r&&r._target===e){switch(r.type){case t.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case t.MASK_TYPES.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case t.MASK_TYPES.SPRITE:this.popSpriteMask()}r.reset(),r.pooled&&this.maskDataPool.push(r)}},r.prototype.detect=function(e){var r=e.maskObject;if(r.isSprite)e.type=t.MASK_TYPES.SPRITE;else if(e.type=t.MASK_TYPES.STENCIL,this.enableScissor&&r.isFastRect&&r.isFastRect()){var n=r.worldTransform,i=Math.atan2(n.b,n.a),o=Math.atan2(n.d,n.c);i=Math.round(i*(180/Math.PI)*100),o=((o=Math.round(o*(180/Math.PI)*100)-i)%18e3+18e3)%18e3,0===(i=(i%9e3+9e3)%9e3)&&9e3===o&&(e.type=t.MASK_TYPES.SCISSOR)}},r.prototype.pushSpriteMask=function(t){var e=t.maskObject,r=t._target,n=this.alphaMaskPool[this.alphaMaskIndex];n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new ti(e)]),n[0].resolution=this.renderer.resolution,n[0].maskSprite=e;var i=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=i,this.alphaMaskIndex++},r.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},r}(Gr),ri=function(t){function e(e){var r=t.call(this,e)||this;return r.maskStack=[],r.glConst=0,r}return Pr(e,t),e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,r=this.getStackLength();this.maskStack=t;var n=this.getStackLength();n!==r&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.maskStack=null},e}(Gr),ni=function(t){function e(e){var r=t.call(this,e)||this;return r.glConst=WebGLRenderingContext.SCISSOR_TEST,r}return Pr(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var r=t._scissorRect,n=e.getBounds(!0),i=this.renderer.gl;e.renderable=!1,r?n.fit(r):i.enable(i.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=n,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,r=this.renderer.projection,n=r.transform,i=r.sourceFrame,o=r.destinationFrame,a=e?e.resolution:this.renderer.resolution,s=(t.x-i.x)*a+o.x,u=(t.y-i.y)*a+o.y,l=t.width*a,c=t.height*a;n&&(s+=n.tx*a,u+=n.ty*a),e||(u=this.renderer.height-c-u),this.renderer.gl.scissor(s,u,l,c)},e}(ri),ii=function(t){function e(e){var r=t.call(this,e)||this;return r.glConst=WebGLRenderingContext.STENCIL_TEST,r}return Pr(e,t),e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,r=this.renderer.gl,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),r.enable(r.STENCIL_TEST)),t._stencilCounter++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n,this._getBitwiseMask()),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(ri),oi=function(t){function e(e){var r=t.call(this,e)||this;return r.destinationFrame=null,r.sourceFrame=null,r.defaultFrame=null,r.projectionMatrix=new We,r.transform=null,r}return Pr(e,t),e.prototype.update=function(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);var i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,r,n){var i=this.projectionMatrix,o=n?-1:1;i.identity(),i.a=1/e.width*2,i.d=o*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-o-e.y*i.d},e.prototype.setTransform=function(t){},e}(Gr),ai=new je,si=new je,ui=new je,li=function(t){function e(e){var r=t.call(this,e)||this;return r.clearColor=e._backgroundColorRgba,r.defaultMaskStack=[],r.current=null,r.sourceFrame=new je,r.destinationFrame=new je,r}return Pr(e,t),e.prototype.bind=function(t,e,r){void 0===t&&(t=null);var n,i,o,a=this.renderer;this.current=t,t?(o=(n=t.baseTexture).resolution,e||(ai.width=t.frame.width,ai.height=t.frame.height,e=ai),r||(si.x=t.frame.x,si.y=t.frame.y,si.width=e.width,si.height=e.height,r=si),i=n.framebuffer):(o=a.resolution,e||(ai.width=a.screen.width,ai.height=a.screen.height,e=ai),r||((r=ai).width=e.width,r.height=e.height)),ui.x=r.x*o,ui.y=r.y*o,ui.width=r.width*o,ui.height=r.height*o,this.renderer.framebuffer.bind(i,ui),this.renderer.projection.update(r,e,o,!i),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)},e.prototype.clear=function(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e)},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(Gr),ci=function(){},hi=function(){function t(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}}return t.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},t}(),pi=0,di={textureCount:0},fi=function(t){function e(e){var r=t.call(this,e)||this;return r.destroyed=!1,r.systemCheck(),r.gl=null,r.shader=null,r.program=null,r.cache={},r.id=pi++,r}return Pr(e,t),e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Gn)return Gn;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Gn=!0===t({a:"b"},"a","b")}catch(t){Gn=!1}return Gn}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(di.textureCount=0,this.syncUniformGroup(t.uniformGroup,di)),n},e.prototype.setUniforms=function(t){var e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,e){var r=this.getglProgram();t.static&&t.dirtyId===r.uniformGroups[t.id]||(r.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))},e.prototype.syncUniforms=function(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var r=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var n in t.uniforms){var i=e[n];if(i){for(var o=t.uniforms[n],a=!1,s=0;s<jn.length;s++)if(jn[s].test(i,o)){r.push(jn[s].code(n,o)),a=!0;break}if(!a){var u=(1===i.size?Bn:zn)[i.type].replace("location",'ud["'+n+'"].location');r.push('\n            cv = ud["'+n+'"].value;\n            v = uv["'+n+'"];\n            '+u+";")}}else t.uniforms[n].group&&r.push('\n                    renderer.shader.syncUniformGroup(uv["'+n+'"], syncData);\n                ')}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var r=t.uniforms,n=[];for(var i in r)n.push(i),e[i]&&n.push(e[i].type);return n.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,r=t.program,n={};for(var i in r.attributeData)n[i]=r.attributeData[i].location;var o=An(e,r.vertexSrc,r.fragmentSrc,n),a={};for(var i in r.uniformData){var s=r.uniformData[i];a[i]={location:e.getUniformLocation(o,i),value:Mn(s.type,s.size)}}var u=new hi(o,a);return r.glPrograms[this.renderer.CONTEXT_UID]=u,u},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(Gr);var mi=function(e){function r(r){var n=e.call(this,r)||this;return n.gl=null,n.stateId=0,n.polygonOffset=0,n.blendMode=t.BLEND_MODES.NONE,n._blendEq=!1,n.map=[],n.map[0]=n.setBlend,n.map[1]=n.setOffset,n.map[2]=n.setCullFace,n.map[3]=n.setDepthTest,n.map[4]=n.setFrontFace,n.checks=[],n.defaultState=new Qn,n.defaultState.blend=!0,n}return Pr(r,e),r.prototype.contextChange=function(e){this.gl=e,this.blendModes=function(e,r){return void 0===r&&(r=[]),r[t.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.ADD]=[e.ONE,e.ONE],r[t.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.NONE]=[0,0],r[t.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],r[t.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],r[t.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],r[t.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],r[t.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],r[t.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],r[t.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],r[t.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],r}(e),this.set(this.defaultState),this.reset()},r.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var e=this.stateId^t.data,r=0;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(r=0;r<this.checks.length;r++)this.checks[r](this,t)},r.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data},r.prototype.setBlend=function(t){this.updateCheck(r.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},r.prototype.setOffset=function(t){this.updateCheck(r.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},r.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},r.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},r.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},r.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},r.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},r.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},r.prototype.updateCheck=function(t,e){var r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):e||-1===r||this.checks.splice(r,1)},r.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},r.checkPolygonOffset=function(t,e){t.setPolygonOffset(1,e.polygonOffset)},r}(Gr),gi=function(e){function r(t){var r=e.call(this,t)||this;return r.count=0,r.checkCount=0,r.maxIdle=R.GC_MAX_IDLE,r.checkCountMax=R.GC_MAX_CHECK_COUNT,r.mode=R.GC_MODE,r}return Pr(r,e),r.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==t.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},r.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,r=!1,n=0;n<e.length;n++){var i=e[n];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[n]=null,r=!0)}if(r){var o=0;for(n=0;n<e.length;n++)null!==e[n]&&(e[o++]=e[n]);e.length=o}},r.prototype.unload=function(t){var e,r=this.renderer.texture;(null===(e=t._texture)||void 0===e?void 0:e.framebuffer)&&r.destroyTexture(t._texture);for(var n=t.children.length-1;n>=0;n--)this.unload(t.children[n])},r}(Gr),vi=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},yi=function(e){function r(t){var r=e.call(this,t)||this;return r.boundTextures=[],r.currentLocation=-1,r.managedTextures=[],r._unknownBoundTextures=!1,r.unknownTexture=new Cr,r}return Pr(r,e),r.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};var n=new vi(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new vi(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(r=0;r<this.boundTextures.length;r++)this.bind(null,r)},r.prototype.bind=function(t,e){void 0===e&&(e=0);var r=this.gl;if(t){if((t=t.castToBaseTexture()).parentTextureArray)return;if(t.valid){t.touched=this.renderer.textureGC.count;var n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null},r.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},r.prototype.unbind=function(t){var e=this.gl,r=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[t.target].texture),r[n]=null)},r.prototype.initTexture=function(t){var e=new vi(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},r.prototype.initTextureType=function(e,r){if(r.internalFormat=e.format,r.type=e.type,2===this.webGLVersion){var n=this.renderer.gl;e.type===n.FLOAT&&e.format===n.RGBA&&(r.internalFormat=n.RGBA32F),e.type===t.TYPES.HALF_FLOAT&&(r.type=n.HALF_FLOAT),r.type===n.HALF_FLOAT&&e.format===n.RGBA&&(r.internalFormat=n.RGBA16F)}},r.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var r=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(r,t,e));else{var n=t.realWidth,i=t.realHeight,o=r.gl;(e.width!==n||e.height!==i||e.dirtyId<0)&&(e.width=n,e.height=i,o.texImage2D(t.target,0,e.internalFormat,n,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},r.prototype.destroyTexture=function(t,e){var r=this.gl;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var n=this.managedTextures.indexOf(t);-1!==n&&xe(this.managedTextures,n,1)}},r.prototype.updateTextureStyle=function(e){var r=e._glTextures[this.CONTEXT_UID];r&&(e.mipmap!==t.MIPMAP_MODES.POW2&&2===this.webGLVersion||e.isPowerOfTwo?r.mipmap=e.mipmap>=1:r.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?r.wrapMode=e.wrapMode:r.wrapMode=t.WRAP_MODES.CLAMP,e.resource&&e.resource.style(this.renderer,e,r)||this.setStyle(e,r),r.dirtyStyleId=e.dirtyStyleId)},r.prototype.setStyle=function(e,r){var n=this.gl;if(r.mipmap&&n.generateMipmap(e.target),n.texParameteri(e.target,n.TEXTURE_WRAP_S,r.wrapMode),n.texParameteri(e.target,n.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var i=this.renderer.context.extensions.anisotropicFiltering;if(i&&e.anisotropicLevel>0&&e.scaleMode===t.SCALE_MODES.LINEAR){var o=Math.min(e.anisotropicLevel,n.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(e.target,n.TEXTURE_MAG_FILTER,e.scaleMode===t.SCALE_MODES.LINEAR?n.LINEAR:n.NEAREST)},r}(Gr),xi={FilterSystem:dn,BatchSystem:mn,ContextSystem:vn,FramebufferSystem:bn,GeometrySystem:Tn,MaskSystem:ei,ScissorSystem:ni,StencilSystem:ii,ProjectionSystem:oi,RenderTextureSystem:li,ShaderSystem:fi,StateSystem:mi,TextureGCSystem:gi,TextureSystem:yi},bi=new We,_i=function(e){function r(r,n){void 0===r&&(r=t.RENDERER_TYPE.UNKNOWN);var i=e.call(this)||this;return(n=Object.assign({},R.RENDER_OPTIONS,n)).roundPixels&&(R.ROUND_PIXELS=n.roundPixels,Ee("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),i.options=n,i.type=r,i.screen=new je(0,0,n.width,n.height),i.view=n.view||document.createElement("canvas"),i.resolution=n.resolution||R.RESOLUTION,i.transparent=n.transparent,i.autoDensity=n.autoDensity||n.autoResize||!1,i.preserveDrawingBuffer=n.preserveDrawingBuffer,i.clearBeforeRender=n.clearBeforeRender,i._backgroundColor=0,i._backgroundColorRgba=[0,0,0,0],i._backgroundColorString="#000000",i.backgroundColor=n.backgroundColor||i._backgroundColor,i._lastObjectRendered=null,i.plugins={},i}return Pr(r,e),r.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},Object.defineProperty(r.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),r.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px"),this.emit("resize",t,e)},r.prototype.generateTexture=function(t,e,r,n){0===(n=n||t.getLocalBounds(null,!0)).width&&(n.width=1),0===n.height&&(n.height=1);var i=Qr.create({width:0|n.width,height:0|n.height,scaleMode:e,resolution:r});return bi.tx=-n.x,bi.ty=-n.y,this.render(t,i,!1,bi,!!t.parent),i},r.prototype.destroy=function(e){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=t.RENDERER_TYPE.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(r.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=ae(t),oe(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),r}(L),wi=function(e){function r(n){var i=e.call(this,t.RENDERER_TYPE.WEBGL,n)||this;return n=i.options,i.gl=null,i.CONTEXT_UID=0,i.runners={destroy:new Tr("destroy"),contextChange:new Tr("contextChange"),reset:new Tr("reset"),update:new Tr("update"),postrender:new Tr("postrender"),prerender:new Tr("prerender"),resize:new Tr("resize")},i.globalUniforms=new hn({projectionMatrix:new We},!0),i.addSystem(ei,"mask").addSystem(vn,"context").addSystem(mi,"state").addSystem(fi,"shader").addSystem(yi,"texture").addSystem(Tn,"geometry").addSystem(bn,"framebuffer").addSystem(ni,"scissor").addSystem(ii,"stencil").addSystem(oi,"projection").addSystem(gi,"textureGC").addSystem(dn,"filter").addSystem(li,"renderTexture").addSystem(mn,"batch"),i.initPlugins(r.__plugins),n.context?i.context.initFromContext(n.context):i.context.initFromOptions({alpha:!!i.transparent,antialias:n.antialias,premultipliedAlpha:i.transparent&&"notMultiplied"!==i.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,powerPreference:i.options.powerPreference}),i.renderingToScreen=!0,ne(2===i.context.webGLVersion?"WebGL 2":"WebGL 1"),i.resize(i.options.width,i.options.height),i}return Pr(r,e),r.create=function(t){if(ie())return new r(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},r.prototype.addSystem=function(t,e){e||(e=t.name);var r=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var n in this[e]=r,this.runners)this.runners[n].add(r);return this},r.prototype.render=function(t,e,r,n,i){if(this.renderingToScreen=!e,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=n,!this.context.isLost){if(e||(this._lastObjectRendered=t),!i){var o=t.enableTempParent();t.updateTransform(),t.disableTempParent(o)}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},r.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this.runners.resize.emit(t,r)},r.prototype.reset=function(){return this.runners.reset.emit(),this},r.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},r.prototype.destroy=function(t){for(var r in this.runners.destroy.emit(),this.runners)this.runners[r].destroy();e.prototype.destroy.call(this,t),this.gl=null},r.registerPlugin=function(t,e){r.__plugins=r.__plugins||{},r.__plugins[t]=e},r}(_i);function Ti(t){return wi.create(t)}var Ei="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Si="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Ai=function(){this.texArray=null,this.blend=0,this.type=t.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},Pi=function(){function t(){this.elements=[],this.ids=[],this.count=0}return t.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},t}(),Mi=function(){function t(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(t.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),t.prototype.view=function(t){return this[t+"View"]},t.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},t.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},t}(),Ii=function(e){function r(t){var r=e.call(this,t)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=Qn.for2d(),r.size=4*R.SPRITE_BATCH_SIZE,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),t.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return Pr(r,e),r.prototype.contextChange=function(){var e=this.renderer.gl;R.PREFER_ENV===t.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),R.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Xn(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},r.prototype.initFlushBuffers=function(){for(var t=r._drawCallPool,e=r._textureArrayPool,n=this.size/4,i=Math.floor(n/this.MAX_TEXTURES)+1;t.length<n;)t.push(new Ai);for(;e.length<i;)e.push(new Pi);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},r.prototype.onPrerender=function(){this._flushId=0},r.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},r.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,e=this.MAX_TEXTURES,n=r._textureArrayPool,i=this.renderer.batch,o=this._tempBoundTextures,a=this.renderer.textureGC.count,s=++Cr._globalBatch,u=0,l=n[0],c=0;i.copyBoundTextures(o,e);for(var h=0;h<this._bufferSize;++h){var p=t[h];t[h]=null,p._batchEnabled!==s&&(l.count>=e&&(i.boundArray(l,o,s,e),this.buildDrawCalls(l,c,h),c=h,l=n[++u],++s),p._batchEnabled=s,p.touched=a,l.elements[l.count++]=p)}l.count>0&&(i.boundArray(l,o,s,e),this.buildDrawCalls(l,c,this._bufferSize),++u,++s);for(h=0;h<o.length;h++)o[h]=null;Cr._globalBatch=s},r.prototype.buildDrawCalls=function(t,e,n){var i=this,o=i._bufferedElements,a=i._attributeBuffer,s=i._indexBuffer,u=i.vertexSize,l=r._drawCallPool,c=this._dcIndex,h=this._aIndex,p=this._iIndex,d=l[c];d.start=this._iIndex,d.texArray=t;for(var f=e;f<n;++f){var m=o[f],g=m._texture.baseTexture,v=ue[g.alphaMode?1:0][m.blendMode];o[f]=null,e<f&&d.blend!==v&&(d.size=p-d.start,e=f,(d=l[++c]).texArray=t,d.start=p),this.packInterleavedGeometry(m,a,s,h,p),h+=m.vertexData.length/2*u,p+=m.indices.length,d.blend=v}e<n&&(d.size=p-d.start,++c),this._dcIndex=c,this._aIndex=h,this._iIndex=p},r.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0},r.prototype.updateGeometry=function(){var t=this,e=t._packedGeometries,r=t._attributeBuffer,n=t._indexBuffer;R.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},r.prototype.drawBatches=function(){for(var t=this._dcIndex,e=this.renderer,n=e.gl,i=e.state,o=r._drawCallPool,a=null,s=0;s<t;s++){var u=o[s],l=u.texArray,c=u.type,h=u.size,p=u.start,d=u.blend;a!==l&&(a=l,this.bindAndClearTexArray(l)),this.state.blendMode=d,i.set(this.state),n.drawElements(c,h,n.UNSIGNED_SHORT,2*p)}},r.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},r.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),R.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},r.prototype.stop=function(){this.flush()},r.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),e.prototype.destroy.call(this)},r.prototype.getAttributeBuffer=function(t){var e=ge(Math.ceil(t/8)),r=ye(e),n=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);var i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new Mi(n*this.vertexSize*4)),i},r.prototype.getIndexBuffer=function(t){var e=ge(Math.ceil(t/12)),r=ye(e),n=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);var i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(n)),i},r.prototype.packInterleavedGeometry=function(t,e,r,n,i){for(var o=e.uint32View,a=e.float32View,s=n/this.vertexSize,u=t.uvs,l=t.indices,c=t.vertexData,h=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),d=p<1&&t._texture.baseTexture.alphaMode?he(t._tintRGB,p):t._tintRGB+(255*p<<24),f=0;f<c.length;f+=2)a[n++]=c[f],a[n++]=c[f+1],a[n++]=u[f],a[n++]=u[f+1],o[n++]=d,a[n++]=h;for(f=0;f<l.length;f++)r[i++]=s+l[f]},r._drawCallPool=[],r._textureArrayPool=[],r}(fn),Oi=function(){function t(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return t.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=hn.from({uSamplers:e},!0);var n=this.fragTemplate;n=(n=n.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new qn(this.vertexSrc,n)}var i={tint:new Float32Array([1,1,1,1]),translationMatrix:new We,default:this.defaultGroupCache[t]};return new $n(this.programCache[t],i)},t.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+="if(vTextureId < "+r+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"},t}(),Ci=function(e){function r(r){void 0===r&&(r=!1);var n=e.call(this)||this;return n._buffer=new tn(null,r,!1),n._indexBuffer=new tn(null,r,!0),n.addAttribute("aVertexPosition",n._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",n._buffer,2,!1,t.TYPES.FLOAT).addAttribute("aColor",n._buffer,4,!0,t.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",n._buffer,1,!0,t.TYPES.FLOAT).addIndex(n._indexBuffer),n}return Pr(r,e),r}(sn),Ri="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Li="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Ni=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:Ri,fragment:Li,geometryClass:Ci,vertexSize:6},t),r=e.vertex,n=e.fragment,i=e.vertexSize,o=e.geometryClass;return function(t){function e(e){var a=t.call(this,e)||this;return a.shaderGenerator=new Oi(r,n),a.geometryClass=o,a.vertexSize=i,a}return Pr(e,t),e}(Ii)},Object.defineProperty(t,"defaultVertexSrc",{get:function(){return Ri},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentTemplate",{get:function(){return Li},enumerable:!1,configurable:!0}),t}(),Fi=Ni.create(),Di=function(){function t(e){var r=this;e=Object.assign({forceCanvas:!1},e),this.renderer=Ti(e),this.stage=new ur,t._plugins.forEach((function(t){t.init.call(r,e)}))}return t.registerPlugin=function(e){t._plugins.push(e)},t.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(t.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),t.prototype.destroy=function(e,r){var n=this,i=t._plugins.slice(0);i.reverse(),i.forEach((function(t){t.destroy.call(n)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null},t}();Di._plugins=[];var Ui=function(){function t(){}return t.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(window.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame((function(){return e.resize()})))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){var t,r;if(e.cancelResize(),e._resizeTo===window)t=window.innerWidth,r=window.innerHeight;else{var n=e._resizeTo;t=n.clientWidth,r=n.clientHeight}e.renderer.resize(t,r)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},t.destroy=function(){this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},t}();Di.registerPlugin(Ui);
/*!
   * @pixi/extract - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/extract is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var ki,ji=new je,Bi=function(){function t(t){this.renderer=t,t.extract=this}return t.prototype.image=function(t,e,r){var n=new Image;return n.src=this.base64(t,e,r),n},t.prototype.base64=function(t,e,r){return this.canvas(t).toDataURL(e,r)},t.prototype.canvas=function(e){var r,n,i,o=this.renderer,a=!1,s=!1;e&&(e instanceof Qr?i=e:(i=this.renderer.generateTexture(e),s=!0)),i?(r=i.baseTexture.resolution,n=i.frame,a=!1,o.renderTexture.bind(i)):(r=this.renderer.resolution,a=!0,(n=ji).width=this.renderer.width,n.height=this.renderer.height,o.renderTexture.bind(null));var u=Math.floor(n.width*r+1e-4),l=Math.floor(n.height*r+1e-4),c=new Me(u,l,1),h=new Uint8Array(4*u*l),p=o.gl;p.readPixels(n.x*r,n.y*r,u,l,p.RGBA,p.UNSIGNED_BYTE,h);var d=c.context.getImageData(0,0,u,l);if(t.arrayPostDivide(h,d.data),c.context.putImageData(d,0,0),a){var f=new Me(c.width,c.height,1);f.context.scale(1,-1),f.context.drawImage(c.canvas,0,-l),c.destroy(),c=f}return s&&i.destroy(!0),c.canvas},t.prototype.pixels=function(e){var r,n,i,o=this.renderer,a=!1;e&&(e instanceof Qr?i=e:(i=this.renderer.generateTexture(e),a=!0)),i?(r=i.baseTexture.resolution,n=i.frame,o.renderTexture.bind(i)):(r=o.resolution,(n=ji).width=o.width,n.height=o.height,o.renderTexture.bind(null));var s=n.width*r,u=n.height*r,l=new Uint8Array(4*s*u),c=o.gl;return c.readPixels(n.x*r,n.y*r,s,u,c.RGBA,c.UNSIGNED_BYTE,l),a&&i.destroy(!0),t.arrayPostDivide(l,l),l},t.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},t.arrayPostDivide=function(t,e){for(var r=0;r<t.length;r+=4){var n=e[r+3]=t[r+3];0!==n?(e[r]=Math.round(Math.min(255*t[r]/n,255)),e[r+1]=Math.round(Math.min(255*t[r+1]/n,255)),e[r+2]=Math.round(Math.min(255*t[r+2]/n,255))):(e[r]=t[r],e[r+1]=t[r+1],e[r+2]=t[r+2])}},t}(),zi=function(t,e){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[e.strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[r.key[o]]=n[o]||"";return i[r.q.name]={},i[r.key[12]].replace(r.q.parser,(function(t,e,n){e&&(i[r.q.name][e]=n)})),i},Gi=r((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(e,r,i){void 0===r&&(r=!1),n(this,t),this._fn=e,this._once=r,this._thisArg=i,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function o(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var a=function(){function t(){n(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var r=[];e;)r.push(e),e=e._next;return r}},{key:"has",value:function(t){if(!(t instanceof i))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=arguments,e=this._head;if(!e)return!1;for(;e;)e._once&&this.detach(e),e._fn.apply(e._thisArg,t),e=e._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return o(this,new i(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return o(this,new i(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof i))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();a.MiniSignalBinding=i,e.default=a,t.exports=e.default})),Vi=(ki=Gi)&&ki.__esModule&&Object.prototype.hasOwnProperty.call(ki,"default")?ki.default:ki;
/*!
   * resource-loader - v3.0.1
   * https://github.com/pixijs/pixi-sound
   * Compiled Tue, 02 Jul 2019 14:06:18 UTC
   *
   * resource-loader is licensed under the MIT license.
   * http://www.opensource.org/licenses/mit-license
   */
function Hi(){}function Xi(t,e,r,n){var i=0,o=t.length;!function a(s){s||i===o?r&&r(s):n?setTimeout((function(){e(t[i++],a)}),1):e(t[i++],a)}()}function Wi(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}var Yi={};function qi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $i(t,e,r){return e&&qi(t.prototype,e),r&&qi(t,r),t}var Qi=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),Zi=null;function Ji(){}var Ki=function(){function t(e,r,n){if("string"!=typeof e||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===n.crossOrigin?"anonymous":n.crossOrigin,this.timeout=n.timeout||0,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Ji,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Vi,this.onProgress=new Vi,this.onComplete=new Vi,this.onAfterMiddleware=new Vi}t.setExtensionLoadType=function(e,r){to(t._loadTypeMap,e,r)},t.setExtensionXhrType=function(e,r){to(t._xhrTypeMap,e,r)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var r=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(r)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:Qi&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(e)?e[r]:e));else{var n=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(n)?n[0]:n))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=t.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},e._createSource=function(t,e,r){r||(r=t+"/"+this._getExtension(e));var n=document.createElement("source");return n.src=e,n.type=r,n},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(eo(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){var t=this.xhr;this.abort(eo(t)+" Request timed out.")},e._xhrOnAbort=function(){var t=this.xhr;this.abort(eo(t)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,r="",n=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(r=e.responseText),0===n&&(r.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?n=200:1223===n&&(n=204),2===(n/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=t.TYPE.JSON}catch(t){return void this.abort("Error trying to parse loaded json: "+t)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=t.TYPE.XML}catch(t){return void this.abort("Error trying to parse loaded xml: "+t)}else this.data=e.response||r;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,Zi||(Zi=document.createElement("a")),Zi.href=t;var r=!(t=zi(Zi.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,n=t.protocol?t.protocol+":":"";return t.host===e.hostname&&r&&n===e.protocol?"":"anonymous"},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var r=t.indexOf("/");e=t.substring(r+1,t.indexOf(";",r))}else{var n=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(n>-1?n:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},$i(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function to(t,e,r){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=r)}function eo(t){return t.toString().replace("object ","")}Ki.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Ki.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Ki.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Ki.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Ki._loadTypeMap={gif:Ki.LOAD_TYPE.IMAGE,png:Ki.LOAD_TYPE.IMAGE,bmp:Ki.LOAD_TYPE.IMAGE,jpg:Ki.LOAD_TYPE.IMAGE,jpeg:Ki.LOAD_TYPE.IMAGE,tif:Ki.LOAD_TYPE.IMAGE,tiff:Ki.LOAD_TYPE.IMAGE,webp:Ki.LOAD_TYPE.IMAGE,tga:Ki.LOAD_TYPE.IMAGE,svg:Ki.LOAD_TYPE.IMAGE,"svg+xml":Ki.LOAD_TYPE.IMAGE,mp3:Ki.LOAD_TYPE.AUDIO,ogg:Ki.LOAD_TYPE.AUDIO,wav:Ki.LOAD_TYPE.AUDIO,mp4:Ki.LOAD_TYPE.VIDEO,webm:Ki.LOAD_TYPE.VIDEO},Ki._xhrTypeMap={xhtml:Ki.XHR_RESPONSE_TYPE.DOCUMENT,html:Ki.XHR_RESPONSE_TYPE.DOCUMENT,htm:Ki.XHR_RESPONSE_TYPE.DOCUMENT,xml:Ki.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Ki.XHR_RESPONSE_TYPE.DOCUMENT,svg:Ki.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Ki.XHR_RESPONSE_TYPE.DOCUMENT,gif:Ki.XHR_RESPONSE_TYPE.BLOB,png:Ki.XHR_RESPONSE_TYPE.BLOB,bmp:Ki.XHR_RESPONSE_TYPE.BLOB,jpg:Ki.XHR_RESPONSE_TYPE.BLOB,jpeg:Ki.XHR_RESPONSE_TYPE.BLOB,tif:Ki.XHR_RESPONSE_TYPE.BLOB,tiff:Ki.XHR_RESPONSE_TYPE.BLOB,webp:Ki.XHR_RESPONSE_TYPE.BLOB,tga:Ki.XHR_RESPONSE_TYPE.BLOB,json:Ki.XHR_RESPONSE_TYPE.JSON,text:Ki.XHR_RESPONSE_TYPE.TEXT,txt:Ki.XHR_RESPONSE_TYPE.TEXT,ttf:Ki.XHR_RESPONSE_TYPE.BUFFER,otf:Ki.XHR_RESPONSE_TYPE.BUFFER},Ki.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var ro=window.URL||window.webkitURL;var no={caching:function(t,e){var r=this;Yi[t.url]?(t.data=Yi[t.url],t.complete()):t.onComplete.once((function(){return Yi[r.url]=r.data})),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===Ki.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var r=ro.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=r,t.type=Ki.TYPE.IMAGE,void(t.data.onload=function(){ro.revokeObjectURL(r),t.data.onload=null,e()})}}else{var n=t.xhr.getResponseHeader("content-type");if(n&&0===n.indexOf("image"))return t.data=new Image,t.data.src="data:"+n+";base64,"+function(t){for(var e="",r=0;r<t.length;){for(var n=[0,0,0],i=[0,0,0,0],o=0;o<n.length;++o)r<t.length?n[o]=255&t.charCodeAt(r++):n[o]=0;switch(i[0]=n[0]>>2,i[1]=(3&n[0])<<4|n[1]>>4,i[2]=(15&n[1])<<2|n[2]>>6,i[3]=63&n[2],r-(t.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(var a=0;a<i.length;++a)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i[a])}return e}(t.xhr.responseText),t.type=Ki.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},io=/(#[\w-]+)?$/,oo=function(){function t(e,r){var n=this;void 0===e&&(e=""),void 0===r&&(r=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return n._loadResource(t,e)},this._queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var r=0,n={_tasks:[],concurrency:e,saturated:Hi,unsaturated:Hi,buffer:e/4,empty:Hi,drain:Hi,error:Hi,started:!1,paused:!1,push:function(t,e){i(t,!1,e)},kill:function(){r=0,n.drain=Hi,n.started=!1,n._tasks=[]},unshift:function(t,e){i(t,!0,e)},process:function(){for(;!n.paused&&r<n.concurrency&&n._tasks.length;){var e=n._tasks.shift();0===n._tasks.length&&n.empty(),(r+=1)===n.concurrency&&n.saturated(),t(e.data,Wi(o(e)))}},length:function(){return n._tasks.length},running:function(){return r},idle:function(){return n._tasks.length+r===0},pause:function(){!0!==n.paused&&(n.paused=!0)},resume:function(){if(!1!==n.paused){n.paused=!1;for(var t=1;t<=n.concurrency;t++)n.process()}}};function i(t,e,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(n.started=!0,null==t&&n.idle())setTimeout((function(){return n.drain()}),1);else{var i={data:t,callback:"function"==typeof r?r:Hi};e?n._tasks.unshift(i):n._tasks.push(i),setTimeout((function(){return n.process()}),1)}}function o(t){return function(){r-=1,t.callback.apply(t,arguments),null!=arguments[0]&&n.error(arguments[0],t.data),r<=n.concurrency-n.buffer&&n.unsaturated(),n.idle()&&n.drain(),n.process()}}return n}(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new Vi,this.onError=new Vi,this.onLoad=new Vi,this.onStart=new Vi,this.onComplete=new Vi;for(var i=0;i<t._defaultBeforeMiddleware.length;++i)this.pre(t._defaultBeforeMiddleware[i]);for(var o=0;o<t._defaultAfterMiddleware.length;++o)this.use(t._defaultAfterMiddleware[o])}var e=t.prototype;return e.add=function(t,e,r,n){if(Array.isArray(t)){for(var i=0;i<t.length;++i)this.add(t[i]);return this}if("object"==typeof t&&(n=e||t.callback||t.onComplete,r=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(n=r,r=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(n=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new Ki(t,e,r),"function"==typeof n&&this.resources[t].onAfterMiddleware.once(n),this.loading){for(var o=r.parentResource,a=[],s=0;s<o.children.length;++s)o.children[s].isComplete||a.push(o.children[s]);var u=o.progressChunk*(a.length+1)/(a.length+2);o.children.push(this.resources[t]),o.progressChunk=u;for(var l=0;l<a.length;++l)a[l].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,r=zi(t,{strictMode:!0});if(e=r.protocol||!r.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var n=io.exec(e)[0];-1!==(e=e.substr(0,e.length-n.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=n}return e},e._loadResource=function(t,e){var r=this;t._dequeue=e,Xi(this._beforeMiddleware,(function(e,n){e.call(r,t,(function(){n(t.isComplete?{}:null)}))}),(function(){t.isComplete?r._onLoad(t):(t._onLoadBinding=t.onComplete.once(r._onLoad,r),t.load())}),!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),Xi(this._afterMiddleware,(function(r,n){r.call(e,t,n)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},$i(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();oo._defaultBeforeMiddleware=[],oo._defaultAfterMiddleware=[],oo.pre=function(t){return oo._defaultBeforeMiddleware.push(t),oo},oo.use=function(t){return oo._defaultAfterMiddleware.push(t),oo};
/*!
   * @pixi/loaders - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/loaders is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
var ao=Ki,so=function(t,e){return(so=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */var uo=function(){function t(){}return t.use=function(t,e){t.data&&t.type===Ki.TYPE.IMAGE&&(t.texture=qr.fromLoader(t.data,t.url,t.name)),e()},t}(),lo=function(t){function e(r,n){for(var i=t.call(this,r,n)||this,o=0;o<e._plugins.length;++o){var a=e._plugins[o],s=a.pre,u=a.use;s&&i.pre(s),u&&i.use(u)}return i._protected=!1,i}return function(t,e){function r(){this.constructor=t}so(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(e,"shared",{get:function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},enumerable:!1,configurable:!0}),e.registerPlugin=function(t){return e._plugins.push(t),t.add&&t.add(),e},e._plugins=[],e}(oo);lo.registerPlugin({use:no.parsing}),lo.registerPlugin(uo);var co=function(){function t(){}return t.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?lo.shared:new lo},t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t}(),ho=function(t,e){return(ho=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};
/*!
   * @pixi/particles - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/particles is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */function po(t,e){function r(){this.constructor=t}ho(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var fo,mo,go=function(e){function r(r,n,i,o){void 0===r&&(r=1500),void 0===i&&(i=16384),void 0===o&&(o=!1);var a=e.call(this)||this;return i>16384&&(i=16384),a._properties=[!1,!0,!1,!1,!1],a._maxSize=r,a._batchSize=i,a._buffers=null,a._bufferUpdateIDs=[],a._updateID=0,a.interactiveChildren=!1,a.blendMode=t.BLEND_MODES.NORMAL,a.autoResize=o,a.roundPixels=!0,a.baseTexture=null,a.setProperties(n),a._tint=0,a.tintRgb=new Float32Array(4),a.tint=16777215,a}return po(r,e),r.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(r.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,oe(t,this.tintRgb)},enumerable:!1,configurable:!0}),r.prototype.render=function(t){var e=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return e.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},r.prototype.onChildrenChange=function(t){for(var e=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID},r.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},r}(ur),vo=function(){function e(e,r,n){this.geometry=new sn,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<e.length;++i){var o=e[i];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||t.TYPES.FLOAT,offset:o.offset},r[i]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return e.prototype.initBuffers=function(){var e=this.geometry,r=0;this.indexBuffer=new tn(de(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var n=0;n<this.dynamicProperties.length;++n){(s=this.dynamicProperties[n]).offset=r,r+=s.size,this.dynamicStride+=s.size}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new tn(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(n=0;n<this.staticProperties.length;++n){(s=this.staticProperties[n]).offset=o,o+=s.size,this.staticStride+=s.size}var a=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(a),this.staticDataUint32=new Uint32Array(a),this.staticBuffer=new tn(this.staticData,!0,!1);for(n=0;n<this.dynamicProperties.length;++n){var s=this.dynamicProperties[n];e.addAttribute(s.attributeName,this.dynamicBuffer,0,s.type===t.TYPES.UNSIGNED_BYTE,s.type,4*this.dynamicStride,4*s.offset)}for(n=0;n<this.staticProperties.length;++n){s=this.staticProperties[n];e.addAttribute(s.attributeName,this.staticBuffer,0,s.type===t.TYPES.UNSIGNED_BYTE,s.type,4*this.staticStride,4*s.offset)}},e.prototype.uploadDynamic=function(e,r,n){for(var i=0;i<this.dynamicProperties.length;i++){var o=this.dynamicProperties[i];o.uploadFunction(e,r,n,o.type===t.TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++},e.prototype.uploadStatic=function(e,r,n){for(var i=0;i<this.staticProperties.length;i++){var o=this.staticProperties[i];o.uploadFunction(e,r,n,o.type===t.TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++},e.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},e}(),yo=function(e){function r(r){var n=e.call(this,r)||this;return n.shader=null,n.properties=null,n.tempMatrix=new We,n.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:n.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:n.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:n.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:n.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:t.TYPES.UNSIGNED_BYTE,uploadFunction:n.uploadTint,offset:0}],n.shader=$n.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),n.state=Qn.for2d(),n}return po(r,e),r.prototype.render=function(t){var e=t.children,r=t._maxSize,n=t._batchSize,i=this.renderer,o=e.length;if(0!==o){o>r&&!t.autoResize&&(o=r);var a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));var s=e[0]._texture.baseTexture;this.state.blendMode=le(t.blendMode,s.alphaMode),i.state.set(this.state);var u=i.gl,l=t.worldTransform.copyTo(this.tempMatrix);l.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=l.toArray(!0),this.shader.uniforms.uColor=ce(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,s.alphaMode),this.shader.uniforms.uSampler=s,this.renderer.shader.bind(this.shader);for(var c=!1,h=0,p=0;h<o;h+=n,p+=1){var d=o-h;d>n&&(d=n),p>=a.length&&a.push(this._generateOneMoreBuffer(t));var f=a[p];f.uploadDynamic(e,h,d);var m=t._bufferUpdateIDs[p]||0;(c=c||f._updateID<m)&&(f._updateID=t._updateID,f.uploadStatic(e,h,d)),i.geometry.bind(f.geometry),u.drawElements(u.TRIANGLES,6*d,u.UNSIGNED_SHORT,0)}}},r.prototype.generateBuffers=function(t){for(var e=[],r=t._maxSize,n=t._batchSize,i=t._properties,o=0;o<r;o+=n)e.push(new vo(this.properties,i,n));return e},r.prototype._generateOneMoreBuffer=function(t){var e=t._batchSize,r=t._properties;return new vo(this.properties,r,e)},r.prototype.uploadVertices=function(t,e,r,n,i,o){for(var a=0,s=0,u=0,l=0,c=0;c<r;++c){var h=t[e+c],p=h._texture,d=h.scale.x,f=h.scale.y,m=p.trim,g=p.orig;m?(a=(s=m.x-h.anchor.x*g.width)+m.width,u=(l=m.y-h.anchor.y*g.height)+m.height):(a=g.width*(1-h.anchor.x),s=g.width*-h.anchor.x,u=g.height*(1-h.anchor.y),l=g.height*-h.anchor.y),n[o]=s*d,n[o+1]=l*f,n[o+i]=a*d,n[o+i+1]=l*f,n[o+2*i]=a*d,n[o+2*i+1]=u*f,n[o+3*i]=s*d,n[o+3*i+1]=u*f,o+=4*i}},r.prototype.uploadPosition=function(t,e,r,n,i,o){for(var a=0;a<r;a++){var s=t[e+a].position;n[o]=s.x,n[o+1]=s.y,n[o+i]=s.x,n[o+i+1]=s.y,n[o+2*i]=s.x,n[o+2*i+1]=s.y,n[o+3*i]=s.x,n[o+3*i+1]=s.y,o+=4*i}},r.prototype.uploadRotation=function(t,e,r,n,i,o){for(var a=0;a<r;a++){var s=t[e+a].rotation;n[o]=s,n[o+i]=s,n[o+2*i]=s,n[o+3*i]=s,o+=4*i}},r.prototype.uploadUvs=function(t,e,r,n,i,o){for(var a=0;a<r;++a){var s=t[e+a]._texture._uvs;s?(n[o]=s.x0,n[o+1]=s.y0,n[o+i]=s.x1,n[o+i+1]=s.y1,n[o+2*i]=s.x2,n[o+2*i+1]=s.y2,n[o+3*i]=s.x3,n[o+3*i+1]=s.y3,o+=4*i):(n[o]=0,n[o+1]=0,n[o+i]=0,n[o+i+1]=0,n[o+2*i]=0,n[o+2*i+1]=0,n[o+3*i]=0,n[o+3*i+1]=0,o+=4*i)}},r.prototype.uploadTint=function(t,e,r,n,i,o){for(var a=0;a<r;++a){var s=t[e+a],u=s._texture.baseTexture.alphaMode>0,l=s.alpha,c=l<1&&u?he(s._tintRGB,l):s._tintRGB+(255*l<<24);n[o]=c,n[o+i]=c,n[o+2*i]=c,n[o+3*i]=c,o+=4*i}},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},r}(fn);(
/*!
   * @pixi/graphics - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/graphics is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
fo=t.LINE_JOIN||(t.LINE_JOIN={})).MITER="miter",fo.BEVEL="bevel",fo.ROUND="round",(mo=t.LINE_CAP||(t.LINE_CAP={})).BUTT="butt",mo.ROUND="round",mo.SQUARE="square";var xo={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive||!t||isNaN(t))return e;var r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},bo=function(){function t(){this.color=16777215,this.alpha=1,this.texture=qr.WHITE,this.matrix=null,this.visible=!1,this.reset()}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},t.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=qr.WHITE,this.matrix=null,this.visible=!1},t.prototype.destroy=function(){this.texture=null,this.matrix=null},t}(),_o=function(t,e){return(_o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function wo(t,e){function r(){this.constructor=t}_o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var To={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var r=t.points,n=t.holes,i=e.points,o=e.indices;if(r.length>=6){for(var a=[],s=0;s<n.length;s++){var u=n[s];a.push(r.length/2),r=r.concat(u.points)}var l=N(r,a,2);if(!l)return;var c=i.length/2;for(s=0;s<l.length;s+=3)o.push(l[s]+c),o.push(l[s+1]+c),o.push(l[s+2]+c);for(s=0;s<r.length;s++)i.push(r[s])}}},Eo={build:function(e){var r,n,i=e.shape,o=e.points,a=i.x,s=i.y;if(o.length=0,e.type===t.SHAPES.CIRC)r=i.radius,n=i.radius;else{var u=e.shape;r=u.width,n=u.height}if(0!==r&&0!==n){var l=Math.floor(30*Math.sqrt(i.radius))||Math.floor(15*Math.sqrt(r+n));l/=2.3;for(var c=2*Math.PI/l,h=0;h<l-.5;h++)o.push(a+Math.sin(-c*h)*r,s+Math.cos(-c*h)*n);o.push(o[0],o[1])}},triangulate:function(t,e){var r=t.points,n=e.points,i=e.indices,o=n.length/2,a=o,s=t.shape,u=t.matrix,l=s.x,c=s.y;n.push(t.matrix?u.a*l+u.c*c+u.tx:l,t.matrix?u.b*l+u.d*c+u.ty:c);for(var h=0;h<r.length;h+=2)n.push(r[h],r[h+1]),i.push(o++,a,o)}},So={build:function(t){var e=t.shape,r=e.x,n=e.y,i=e.width,o=e.height,a=t.points;a.length=0,a.push(r,n,r+i,n,r+i,n+o,r,n+o)},triangulate:function(t,e){var r=t.points,n=e.points,i=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}};function Ao(t,e,r){return t+(e-t)*r}function Po(t,e,r,n,i,o,a){void 0===a&&(a=[]);for(var s=a,u=0,l=0,c=0,h=0,p=0,d=0,f=0,m=0;f<=20;++f)u=Ao(t,r,m=f/20),l=Ao(e,n,m),c=Ao(r,i,m),h=Ao(n,o,m),p=Ao(u,c,m),d=Ao(l,h,m),s.push(p,d);return s}var Mo={build:function(t){var e=t.shape,r=t.points,n=e.x,i=e.y,o=e.width,a=e.height,s=Math.max(0,Math.min(e.radius,Math.min(o,a)/2));r.length=0,s?(Po(n,i+s,n,i,n+s,i,r),Po(n+o-s,i,n+o,i,n+o,i+s,r),Po(n+o,i+a-s,n+o,i+a,n+o-s,i+a,r),Po(n+s,i+a,n,i+a,n,i+a-s,r)):r.push(n,i,n+o,i,n+o,i+a,n,i+a)},triangulate:function(t,e){for(var r=t.points,n=e.points,i=e.indices,o=n.length/2,a=N(r,null,2),s=0,u=a.length;s<u;s+=3)i.push(a[s]+o),i.push(a[s+1]+o),i.push(a[s+2]+o);for(s=0,u=r.length;s<u;s++)n.push(r[s],r[++s])}};function Io(t,e,r,n,i,o,a,s){var u,l;a?(u=n,l=-r):(u=-n,l=r);var c=t-r*i+u,h=e-n*i+l,p=t+r*o+u,d=e+n*o+l;return s.push(c,h),s.push(p,d),2}function Oo(t,e,r,n,i,o,a,s){var u=r-t,l=n-e,c=Math.atan2(u,l),h=Math.atan2(i-t,o-e);s&&c<h?c+=2*Math.PI:!s&&c>h&&(h+=2*Math.PI);var p=c,d=h-c,f=Math.abs(d),m=Math.sqrt(u*u+l*l),g=1+(15*f*Math.sqrt(m)/Math.PI>>0),v=d/g;if(p+=v,s){a.push(t,e),a.push(r,n);for(var y=1,x=p;y<g;y++,x+=v)a.push(t,e),a.push(t+Math.sin(x)*m,e+Math.cos(x)*m);a.push(t,e),a.push(i,o)}else{a.push(r,n),a.push(t,e);for(y=1,x=p;y<g;y++,x+=v)a.push(t+Math.sin(x)*m,e+Math.cos(x)*m),a.push(t,e);a.push(i,o),a.push(t,e)}return 2*g}function Co(e,r){e.lineStyle.native?function(e,r){var n=0,i=e.shape,o=e.points||i.points,a=i.type!==t.SHAPES.POLY||i.closeStroke;if(0!==o.length){var s=r.points,u=r.indices,l=o.length/2,c=s.length/2,h=c;for(s.push(o[0],o[1]),n=1;n<l;n++)s.push(o[2*n],o[2*n+1]),u.push(h,h+1),h++;a&&u.push(h,c)}}(e,r):function(e,r){var n=e.shape,i=e.points||n.points.slice(),o=r.closePointEps;if(0!==i.length){var a=e.lineStyle,s=new He(i[0],i[1]),u=new He(i[i.length-2],i[i.length-1]),l=n.type!==t.SHAPES.POLY||n.closeStroke,c=Math.abs(s.x-u.x)<o&&Math.abs(s.y-u.y)<o;if(l){i=i.slice(),c&&(i.pop(),i.pop(),u.set(i[i.length-2],i[i.length-1]));var h=.5*(s.x+u.x),p=.5*(u.y+s.y);i.unshift(h,p),i.push(h,p)}var d=r.points,f=i.length/2,m=i.length,g=d.length/2,v=a.width/2,y=v*v,x=a.miterLimit*a.miterLimit,b=i[0],_=i[1],w=i[2],T=i[3],E=0,S=0,A=-(_-T),P=b-w,M=0,I=0,O=Math.sqrt(A*A+P*P);A/=O,P/=O,A*=v,P*=v;var C=a.alignment,R=2*(1-C),L=2*C;l||(a.cap===t.LINE_CAP.ROUND?m+=Oo(b-A*(R-L)*.5,_-P*(R-L)*.5,b-A*R,_-P*R,b+A*L,_+P*L,d,!0)+2:a.cap===t.LINE_CAP.SQUARE&&(m+=Io(b,_,A,P,R,L,!0,d))),d.push(b-A*R,_-P*R),d.push(b+A*L,_+P*L);for(var N=1;N<f-1;++N){b=i[2*(N-1)],_=i[2*(N-1)+1],w=i[2*N],T=i[2*N+1],E=i[2*(N+1)],S=i[2*(N+1)+1],A=-(_-T),P=b-w,A/=O=Math.sqrt(A*A+P*P),P/=O,A*=v,P*=v,M=-(T-S),I=w-E,M/=O=Math.sqrt(M*M+I*I),I/=O,M*=v,I*=v;var F=w-b,D=_-T,U=w-E,k=S-T,j=D*U-k*F,B=j<0;if(Math.abs(j)<.1)d.push(w-A*R,T-P*R),d.push(w+A*L,T+P*L);else{var z=(-A+b)*(-P+T)-(-A+w)*(-P+_),G=(-M+E)*(-I+T)-(-M+w)*(-I+S),V=(F*G-U*z)/j,H=(k*z-D*G)/j,X=(V-w)*(V-w)+(H-T)*(H-T),W=w+(V-w)*R,Y=T+(H-T)*R,q=w-(V-w)*L,$=T-(H-T)*L;a.join===t.LINE_JOIN.BEVEL||X/y>x?(B?(d.push(W,Y),d.push(w+A*L,T+P*L),d.push(W,Y),d.push(w+M*L,T+I*L)):(d.push(w-A*R,T-P*R),d.push(q,$),d.push(w-M*R,T-I*R),d.push(q,$)),m+=2):a.join===t.LINE_JOIN.ROUND?B?(d.push(W,Y),d.push(w+A*L,T+P*L),m+=Oo(w,T,w+A*L,T+P*L,w+M*L,T+I*L,d,!0)+4,d.push(W,Y),d.push(w+M*L,T+I*L)):(d.push(w-A*R,T-P*R),d.push(q,$),m+=Oo(w,T,w-A*R,T-P*R,w-M*R,T-I*R,d,!1)+4,d.push(w-M*R,T-I*R),d.push(q,$)):(d.push(W,Y),d.push(q,$))}}b=i[2*(f-2)],_=i[2*(f-2)+1],w=i[2*(f-1)],A=-(_-(T=i[2*(f-1)+1])),P=b-w,A/=O=Math.sqrt(A*A+P*P),P/=O,A*=v,P*=v,d.push(w-A*R,T-P*R),d.push(w+A*L,T+P*L),l||(a.cap===t.LINE_CAP.ROUND?m+=Oo(w-A*(R-L)*.5,T-P*(R-L)*.5,w-A*R,T-P*R,w+A*L,T+P*L,d,!1)+2:a.cap===t.LINE_CAP.SQUARE&&(m+=Io(w,T,A,P,R,L,!1,d)));var Q=r.indices,Z=xo.epsilon*xo.epsilon;for(N=g;N<m+g-2;++N)b=d[2*N],_=d[2*N+1],w=d[2*(N+1)],T=d[2*(N+1)+1],E=d[2*(N+2)],S=d[2*(N+2)+1],Math.abs(b*(T-S)+w*(S-_)+E*(_-T))<Z||Q.push(N,N+1,N+2)}}(e,r)}var Ro,Lo=function(t){function e(e,r,n,i,o,a){void 0===a&&(a=0);o=o||i/2;for(var s=-1*Math.PI/2+a,u=2*n,l=De/u,c=[],h=0;h<u;h++){var p=h%2?o:i,d=h*l+s;c.push(e+p*Math.cos(d),r+p*Math.sin(d))}return t.call(this,c)||this}return wo(e,t),e}(Ge),No=function(){function t(){}return t.curveTo=function(t,e,r,n,i,o){var a=o[o.length-2],s=o[o.length-1]-e,u=a-t,l=n-e,c=r-t,h=Math.abs(s*c-u*l);if(h<1e-8||0===i)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var p=s*s+u*u,d=l*l+c*c,f=s*l+u*c,m=i*Math.sqrt(p)/h,g=i*Math.sqrt(d)/h,v=m*f/p,y=g*f/d,x=m*c+g*u,b=m*l+g*s,_=u*(g+v),w=s*(g+v),T=c*(m+y),E=l*(m+y);return{cx:x+t,cy:b+e,radius:i,startAngle:Math.atan2(w-b,_-x),endAngle:Math.atan2(E-b,T-x),anticlockwise:u*l>c*s}},t.arc=function(t,e,r,n,i,o,a,s,u){for(var l=a-o,c=xo._segmentsCount(Math.abs(l)*i,40*Math.ceil(Math.abs(l)/De)),h=l/(2*c),p=2*h,d=Math.cos(h),f=Math.sin(h),m=c-1,g=m%1/m,v=0;v<=m;++v){var y=h+o+p*(v+g*v),x=Math.cos(y),b=-Math.sin(y);u.push((d*x+f*b)*i+r,(d*-b+f*x)*i+n)}},t}(),Fo=function(){function t(){}return t.curveLength=function(t,e,r,n,i,o,a,s){for(var u=0,l=0,c=0,h=0,p=0,d=0,f=0,m=0,g=0,v=0,y=0,x=t,b=e,_=1;_<=10;++_)v=x-(m=(f=(d=(p=1-(l=_/10))*p)*p)*t+3*d*l*r+3*p*(c=l*l)*i+(h=c*l)*a),y=b-(g=f*e+3*d*l*n+3*p*c*o+h*s),x=m,b=g,u+=Math.sqrt(v*v+y*y);return u},t.curveTo=function(e,r,n,i,o,a,s){var u=s[s.length-2],l=s[s.length-1];s.length-=2;var c=xo._segmentsCount(t.curveLength(u,l,e,r,n,i,o,a)),h=0,p=0,d=0,f=0,m=0;s.push(u,l);for(var g=1,v=0;g<=c;++g)d=(p=(h=1-(v=g/c))*h)*h,m=(f=v*v)*v,s.push(d*u+3*p*v*e+3*h*f*n+m*o,d*l+3*p*v*r+3*h*f*i+m*a)},t}(),Do=function(){function t(){}return t.curveLength=function(t,e,r,n,i,o){var a=t-2*r+i,s=e-2*n+o,u=2*r-2*t,l=2*n-2*e,c=4*(a*a+s*s),h=4*(a*u+s*l),p=u*u+l*l,d=2*Math.sqrt(c+h+p),f=Math.sqrt(c),m=2*c*f,g=2*Math.sqrt(p),v=h/f;return(m*d+f*h*(d-g)+(4*p*c-h*h)*Math.log((2*f+v+d)/(v+g)))/(4*m)},t.curveTo=function(e,r,n,i,o){for(var a=o[o.length-2],s=o[o.length-1],u=xo._segmentsCount(t.curveLength(a,s,e,r,n,i)),l=0,c=0,h=1;h<=u;++h){var p=h/u;l=a+(e-a)*p,c=s+(r-s)*p,o.push(l+(e+(n-e)*p-l)*p,c+(r+(i-r)*p-c)*p)}},t}(),Uo=function(){function t(){this.reset()}return t.prototype.begin=function(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r},t.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},t.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},t}(),ko=((Ro={})[t.SHAPES.POLY]=To,Ro[t.SHAPES.CIRC]=Eo,Ro[t.SHAPES.ELIP]=Eo,Ro[t.SHAPES.RECT]=So,Ro[t.SHAPES.RREC]=Mo,Ro),jo=[],Bo=[],zo={buildPoly:To,buildCircle:Eo,buildRectangle:So,buildRoundedRectangle:Mo,FILL_COMMANDS:ko,BATCH_POOL:jo,DRAW_CALL_POOL:Bo,buildLine:Co,Star:Lo,ArcUtils:No,BezierUtils:Fo,QuadraticUtils:Do,BatchPart:Uo},Go=function(){function t(t,e,r,n){void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=null),this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type,this.points=[],this.holes=[]}return t.prototype.clone=function(){return new t(this.shape,this.fillStyle,this.lineStyle,this.matrix)},t.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},t}(),Vo=new He,Ho=new rr,Xo=function(e){function r(){var t=e.call(this)||this;return t.uvsFloat32=null,t.indicesUint16=null,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.dirty=0,t.batchDirty=-1,t.cacheDirty=-1,t.clearDirty=0,t.drawCalls=[],t.batches=[],t.shapeIndex=0,t._bounds=new rr,t.boundsDirty=-1,t.boundsPadding=0,t.batchable=!1,t.indicesUint16=null,t.uvsFloat32=null,t.closePointEps=1e-4,t}return wo(r,e),Object.defineProperty(r.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),r.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Bo.push(this.drawCalls[t]);this.drawCalls.length=0;for(t=0;t<this.batches.length;t++){var e=this.batches[t];e.reset(),jo.push(e)}this.batches.length=0},r.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},r.prototype.drawShape=function(t,e,r,n){void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=null);var i=new Go(t,e,r,n);return this.graphicsData.push(i),this.dirty++,this},r.prototype.drawHole=function(t,e){if(void 0===e&&(e=null),!this.graphicsData.length)return null;var r=new Go(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},r.prototype.containsPoint=function(t){for(var e=this.graphicsData,r=0;r<e.length;++r){var n=e[r];if(n.fillStyle.visible&&(n.shape&&(n.matrix?n.matrix.applyInverse(t,Vo):Vo.copyFrom(t),n.shape.contains(Vo.x,Vo.y)))){var i=!1;if(n.holes)for(var o=0;o<n.holes.length;o++){if(n.holes[o].shape.contains(Vo.x,Vo.y)){i=!0;break}}if(!i)return!0}}return!1},r.prototype.updateBatches=function(e){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var r=this.uvs,n=this.graphicsData,i=null,o=null;this.batches.length>0&&(o=(i=this.batches[this.batches.length-1]).style);for(var a=this.shapeIndex;a<n.length;a++){this.shapeIndex++;var s=n[a],u=s.fillStyle,l=s.lineStyle;ko[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix);for(var c=0;c<2;c++){var h=0===c?u:l;if(h.visible){var p=h.texture.baseTexture,d=this.indices.length,f=this.points.length/2;p.wrapMode=t.WRAP_MODES.REPEAT,0===c?this.processFill(s):this.processLine(s);var m=this.points.length/2-f;0!==m&&(i&&!this._compareStyles(o,h)&&(i.end(d,f),i=null),i||((i=jo.pop()||new Uo).begin(h,d,f),this.batches.push(i),o=h),this.addUvs(this.points,r,h.texture,f,m,h.matrix))}}}var g=this.indices.length,v=this.points.length/2;if(i&&i.end(g,v),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var y=v>65535&&e;this.indicesUint16=y?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},r.prototype._compareStyles=function(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))},r.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var r=this.graphicsData[t],n=r.fillStyle,i=r.lineStyle;if(n&&!n.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0},r.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,r=t.length;e<r;e++)for(var n=t[e],i=0;i<n.size;i++){var o=n.start+i;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}},r.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var t=this.batches,e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*r.BATCHABLE_SIZE},r.prototype.buildDrawCalls=function(){for(var e=++Cr._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),Bo.push(this.drawCalls[r]);this.drawCalls.length=0;var n=this.colors,i=this.textureIds,o=Bo.pop();o||((o=new Ai).texArray=new Pi),o.texArray.count=0,o.start=0,o.size=0,o.type=t.DRAW_MODES.TRIANGLES;var a=0,s=null,u=0,l=!1,c=t.DRAW_MODES.TRIANGLES,h=0;this.drawCalls.push(o);for(r=0;r<this.batches.length;r++){var p=this.batches[r],d=p.style,f=d.texture.baseTexture;l!==!!d.native&&(c=(l=!!d.native)?t.DRAW_MODES.LINES:t.DRAW_MODES.TRIANGLES,s=null,a=8,e++),s!==f&&(s=f,f._batchEnabled!==e&&(8===a&&(e++,a=0,o.size>0&&((o=Bo.pop())||((o=new Ai).texArray=new Pi),this.drawCalls.push(o)),o.start=h,o.size=0,o.texArray.count=0,o.type=c),f.touched=1,f._batchEnabled=e,f._batchLocation=a,f.wrapMode=10497,o.texArray.elements[o.texArray.count++]=f,a++)),o.size+=p.size,h+=p.size,u=f._batchLocation,this.addColors(n,d.color,d.alpha,p.attribSize),this.addTextureIds(i,u,p.attribSize)}Cr._globalBatch=e,this.packAttributes()},r.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,i=new ArrayBuffer(3*t.length*4),o=new Float32Array(i),a=new Uint32Array(i),s=0,u=0;u<t.length/2;u++)o[s++]=t[2*u],o[s++]=t[2*u+1],o[s++]=e[2*u],o[s++]=e[2*u+1],a[s++]=r[u],o[s++]=n[u];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)},r.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),To.triangulate(t,this)):ko[t.type].triangulate(t,this)},r.prototype.processLine=function(t){Co(t,this);for(var e=0;e<t.holes.length;e++)Co(t.holes[e],this)},r.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var r=t[e];ko[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}},r.prototype.calculateBounds=function(){var e=this._bounds,r=Ho,n=We.IDENTITY;this._bounds.clear(),r.clear();for(var i=0;i<this.graphicsData.length;i++){var o=this.graphicsData[i],a=o.shape,s=o.type,u=o.lineStyle,l=o.matrix||We.IDENTITY,c=0;if(u&&u.visible){var h=u.alignment;c=u.width,s===t.SHAPES.POLY?c*=.5+Math.abs(.5-h):c*=Math.max(0,h)}if(n!==l&&(r.isEmpty()||(e.addBoundsMatrix(r,n),r.clear()),n=l),s===t.SHAPES.RECT||s===t.SHAPES.RREC){var p=a;r.addFramePad(p.x,p.y,p.x+p.width,p.y+p.height,c,c)}else if(s===t.SHAPES.CIRC){var d=a;r.addFramePad(d.x,d.y,d.x,d.y,d.radius+c,d.radius+c)}else if(s===t.SHAPES.ELIP){var f=a;r.addFramePad(f.x,f.y,f.x,f.y,f.width+c,f.height+c)}else{var m=a;e.addVerticesMatrix(n,m.points,0,m.points.length,c,c)}}r.isEmpty()||e.addBoundsMatrix(r,n),e.pad(this.boundsPadding,this.boundsPadding)},r.prototype.transformPoints=function(t,e){for(var r=0;r<t.length/2;r++){var n=t[2*r],i=t[2*r+1];t[2*r]=e.a*n+e.c*i+e.tx,t[2*r+1]=e.b*n+e.d*i+e.ty}},r.prototype.addColors=function(t,e,r,n){for(var i=he((e>>16)+(65280&e)+((255&e)<<16),r);n-- >0;)t.push(i)},r.prototype.addTextureIds=function(t,e,r){for(;r-- >0;)t.push(e)},r.prototype.addUvs=function(t,e,r,n,i,o){void 0===o&&(o=null);for(var a=0,s=e.length,u=r.frame;a<i;){var l=t[2*(n+a)],c=t[2*(n+a)+1];if(o){var h=o.a*l+o.c*c+o.tx;c=o.b*l+o.d*c+o.ty,l=h}a++,e.push(l/u.width,c/u.height)}var p=r.baseTexture;(u.width<p.width||u.height<p.height)&&this.adjustUvs(e,r,s,i)},r.prototype.adjustUvs=function(t,e,r,n){for(var i=e.baseTexture,o=1e-6,a=r+2*n,s=e.frame,u=s.width/i.width,l=s.height/i.height,c=s.x/s.width,h=s.y/s.height,p=Math.floor(t[r]+o),d=Math.floor(t[r+1]+o),f=r+2;f<a;f+=2)p=Math.min(p,Math.floor(t[f]+o)),d=Math.min(d,Math.floor(t[f+1]+o));c-=p,h-=d;for(f=r;f<a;f+=2)t[f]=(t[f]+c)*u,t[f+1]=(t[f+1]+h)*l},r.BATCHABLE_SIZE=100,r}(Ci),Wo=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.width=0,r.alignment=.5,r.native=!1,r.cap=t.LINE_CAP.BUTT,r.join=t.LINE_JOIN.MITER,r.miterLimit=10,r}return wo(r,e),r.prototype.clone=function(){var t=new r;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},r.prototype.reset=function(){e.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},r}(bo),Yo=new Float32Array(3),qo={},$o=function(e){function r(r){void 0===r&&(r=null);var n=e.call(this)||this;return n._geometry=r||new Xo,n._geometry.refCount++,n.shader=null,n.state=Qn.for2d(),n._fillStyle=new bo,n._lineStyle=new Wo,n._matrix=null,n._holeMode=!1,n.currentPath=null,n.batches=[],n.batchTint=-1,n.batchDirty=-1,n.vertexData=null,n.pluginName="batch",n._transformID=-1,n.tint=16777215,n.blendMode=t.BLEND_MODES.NORMAL,n}return wo(r,e),Object.defineProperty(r.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),r.prototype.clone=function(){return this.finishPoly(),new r(this._geometry)},Object.defineProperty(r.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),r.prototype.lineStyle=function(t){if(void 0===t&&(t=null),"number"==typeof t){var e=arguments;t={width:e[0]||0,color:e[1]||0,alpha:void 0!==e[2]?e[2]:1,alignment:void 0!==e[3]?e[3]:.5,native:!!e[4]}}return this.lineTextureStyle(t)},r.prototype.lineTextureStyle=function(e){if("number"==typeof e){Ee("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var r=arguments,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=r[5],l=r[6];e={width:n,texture:i,color:o,alpha:a,matrix:s,alignment:u,native:l},Object.keys(e).forEach((function(t){return void 0===e[t]&&delete e[t]}))}e=Object.assign({width:0,texture:qr.WHITE,color:e&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:t.LINE_CAP.BUTT,join:t.LINE_JOIN.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();var c=e.width>0&&e.alpha>0;return c?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:c},e)):this._lineStyle.reset(),this},r.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ge,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ge,this.currentPath.closeStroke=!1},r.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},r.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},r.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var r=this.currentPath.points,n=r[r.length-2],i=r[r.length-1];return n===t&&i===e||r.push(t,e),this},r.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},r.prototype.quadraticCurveTo=function(t,e,r,n){this._initCurve();var i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),Do.curveTo(t,e,r,n,i),this},r.prototype.bezierCurveTo=function(t,e,r,n,i,o){return this._initCurve(),Fo.curveTo(t,e,r,n,i,o,this.currentPath.points),this},r.prototype.arcTo=function(t,e,r,n,i){this._initCurve(t,e);var o=this.currentPath.points,a=No.curveTo(t,e,r,n,i,o);if(a){var s=a.cx,u=a.cy,l=a.radius,c=a.startAngle,h=a.endAngle,p=a.anticlockwise;this.arc(s,u,l,c,h,p)}return this},r.prototype.arc=function(t,e,r,n,i,o){if(void 0===o&&(o=!1),n===i)return this;if(!o&&i<=n?i+=De:o&&n<=i&&(n+=De),0===i-n)return this;var a=t+Math.cos(n)*r,s=e+Math.sin(n)*r,u=this._geometry.closePointEps,l=this.currentPath?this.currentPath.points:null;if(l){var c=Math.abs(l[l.length-2]-a),h=Math.abs(l[l.length-1]-s);c<u&&h<u||l.push(a,s)}else this.moveTo(a,s),l=this.currentPath.points;return No.arc(a,s,t,e,r,n,i,o,l),this},r.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:qr.WHITE,color:t,alpha:e})},r.prototype.beginTextureFill=function(t){if(t instanceof qr){Ee("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var e=arguments,r=e[0],n=e[1],i=e[2],o=e[3];t={texture:r,color:n,alpha:i,matrix:o},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({texture:qr.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var a=t.alpha>0;return a?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:a},t)):this._fillStyle.reset(),this},r.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},r.prototype.drawRect=function(t,e,r,n){return this.drawShape(new je(t,e,r,n))},r.prototype.drawRoundedRect=function(t,e,r,n,i){return this.drawShape(new Ve(t,e,r,n,i))},r.prototype.drawCircle=function(t,e,r){return this.drawShape(new Be(t,e,r))},r.prototype.drawEllipse=function(t,e,r,n){return this.drawShape(new ze(t,e,r,n))},r.prototype.drawPolygon=function(){for(var t,e=arguments,r=[],n=0;n<arguments.length;n++)r[n]=e[n];var i=!0,o=r[0];o.points?(i=o.closeStroke,t=o.points):t=Array.isArray(r[0])?r[0]:r;var a=new Ge(t);return a.closeStroke=i,this.drawShape(a),this},r.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},r.prototype.drawStar=function(t,e,r,n,i,o){return void 0===o&&(o=0),this.drawPolygon(new Lo(t,e,r,n,i,o))},r.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},r.prototype.isFastRect=function(){var e=this._geometry.graphicsData;return 1===e.length&&e[0].shape.type===t.SHAPES.RECT&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)},r.prototype._render=function(t){this.finishPoly();var e=this._geometry,r=t.context.supports.uint32Indices;e.updateBatches(r),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},r.prototype._populateBatches=function(){var t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(var n=0;n<r;n++){var i=t.batches[n],o=i.style.color,a=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),s=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),u={vertexData:a,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:s,_batchRGB:oe(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=u}},r.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,r=this.batches.length;e<r;e++){var n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}},r.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),r=this._geometry,n=this.tint,i=this.worldAlpha,o=e.uniforms,a=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(n>>16&255)/255*i,o.tint[1]=(n>>8&255)/255*i,o.tint[2]=(255&n)/255*i,o.tint[3]=i,t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(var s=0,u=a.length;s<u;s++)this._renderDrawCallDirect(t,r.drawCalls[s])},r.prototype._renderDrawCallDirect=function(t,e){for(var r=e.texArray,n=e.type,i=e.size,o=e.start,a=r.count,s=0;s<a;s++)t.texture.bind(r.elements[s],s);t.geometry.draw(n,i,o)},r.prototype._resolveDirectShader=function(t){var e=this.shader,r=this.pluginName;if(!e){if(!qo[r]){for(var n=new Int32Array(16),i=0;i<16;i++)n[i]=i;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new We,default:hn.from({uSamplers:n},!0)},a=t.plugins[r]._shader.program;qo[r]=new $n(a,o)}e=qo[r]}return e},r.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var e=t.bounds,r=e.minX,n=e.minY,i=e.maxX,o=e.maxY;this._bounds.addFrame(this.transform,r,n,i,o)}},r.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,r._TEMP_POINT),this._geometry.containsPoint(r._TEMP_POINT)},r.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=oe(this.tint,Yo),e=0;e<this.batches.length;e++){var r=this.batches[e],n=r._batchRGB,i=(t[0]*n[0]*255<<16)+(t[1]*n[1]*255<<8)+(0|t[2]*n[2]*255);r._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}},r.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,o=e.d,a=e.tx,s=e.ty,u=this._geometry.points,l=this.vertexData,c=0,h=0;h<u.length;h+=2){var p=u[h],d=u[h+1];l[c++]=r*p+i*d+a,l[c++]=o*d+n*p+s}}},r.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},r.prototype.setMatrix=function(t){return this._matrix=t,this},r.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},r.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,e.prototype.destroy.call(this,t)},r._TEMP_POINT=new He,r}(ur),Qo=function(t,e){return(Qo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var Zo,Jo=new He,Ko=new Uint16Array([0,1,2,0,2,3]),ta=function(e){function r(r){var n=e.call(this)||this;return n._anchor=new Xe(n._onAnchorUpdate,n,r?r.defaultAnchor.x:0,r?r.defaultAnchor.y:0),n._texture=null,n._width=0,n._height=0,n._tint=null,n._tintRGB=null,n.tint=16777215,n.blendMode=t.BLEND_MODES.NORMAL,n._cachedTint=16777215,n.uvs=null,n.texture=r||qr.EMPTY,n.vertexData=new Float32Array(8),n.vertexTrimmedData=null,n._transformID=-1,n._textureID=-1,n._transformTrimmedID=-1,n._textureTrimmedID=-1,n.indices=Ko,n.pluginName="batch",n.isSprite=!0,n._roundPixels=R.ROUND_PIXELS,n}return function(t,e){function r(){this.constructor=t}Qo(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),r.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=be(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=be(this.scale.y)*this._height/this._texture.orig.height)},r.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},r.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,o=e.d,a=e.tx,s=e.ty,u=this.vertexData,l=t.trim,c=t.orig,h=this._anchor,p=0,d=0,f=0,m=0;if(l?(p=(d=l.x-h._x*c.width)+l.width,f=(m=l.y-h._y*c.height)+l.height):(p=(d=-h._x*c.width)+c.width,f=(m=-h._y*c.height)+c.height),u[0]=r*d+i*m+a,u[1]=o*m+n*d+s,u[2]=r*p+i*m+a,u[3]=o*m+n*p+s,u[4]=r*p+i*f+a,u[5]=o*f+n*p+s,u[6]=r*d+i*f+a,u[7]=o*f+n*d+s,this._roundPixels)for(var g=R.RESOLUTION,v=0;v<u.length;++v)u[v]=Math.round((u[v]*g|0)/g)}},r.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,i=this.transform.worldTransform,o=i.a,a=i.b,s=i.c,u=i.d,l=i.tx,c=i.ty,h=-n._x*r.width,p=h+r.width,d=-n._y*r.height,f=d+r.height;e[0]=o*h+s*d+l,e[1]=u*d+a*h+c,e[2]=o*p+s*d+l,e[3]=u*d+a*p+c,e[4]=o*p+s*f+l,e[5]=u*f+a*p+c,e[6]=o*h+s*f+l,e[7]=u*f+a*h+c},r.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},r.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},r.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new je),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Jo);var e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x,i=0;return Jo.x>=n&&Jo.x<n+e&&(i=-r*this.anchor.y,Jo.y>=i&&Jo.y<i+r)},r.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var r="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!r)}this._texture=null},r.from=function(t,e){return new r(t instanceof qr?t:qr.from(t,e))},Object.defineProperty(r.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=be(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=be(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||qr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),r}(ur),ea=function(t,e){return(ea=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};(Zo=t.TEXT_GRADIENT||(t.TEXT_GRADIENT={}))[Zo.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",Zo[Zo.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL";var ra={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:t.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},na=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ia=function(){function t(t){this.styleID=0,this.reset(),sa(this,t,t)}return t.prototype.clone=function(){var e={};return sa(e,this,ra),new t(e)},t.prototype.reset=function(){sa(this,ra,ra)},Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=aa(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=aa(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=aa(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),t.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&na.indexOf(n)<0&&(n='"'+n+'"'),e[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},t}();function oa(t){return"number"==typeof t?ae(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function aa(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=oa(t[e]);return t}return oa(t)}function sa(t,e,r){for(var n in r)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}var ua=function(){function t(t,e,r,n,i,o,a,s,u){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=i,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=s,this.fontProperties=u}return t.measureText=function(e,r,n,i){void 0===i&&(i=t._canvas),n=null==n?r.wordWrap:n;var o=r.toFontString(),a=t.measureFont(o);0===a.fontSize&&(a.fontSize=r.fontSize,a.ascent=r.fontSize);var s=i.getContext("2d");s.font=o;for(var u=(n?t.wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),l=new Array(u.length),c=0,h=0;h<u.length;h++){var p=s.measureText(u[h]).width+(u[h].length-1)*r.letterSpacing;l[h]=p,c=Math.max(c,p)}var d=c+r.strokeThickness;r.dropShadow&&(d+=r.dropShadowDistance);var f=r.lineHeight||a.fontSize+r.strokeThickness,m=Math.max(f,a.fontSize+r.strokeThickness)+(u.length-1)*(f+r.leading);return r.dropShadow&&(m+=r.dropShadowDistance),new t(e,r,d,m,u,l,f+r.leading,c,a)},t.wordWrap=function(e,r,n){void 0===n&&(n=t._canvas);for(var i=n.getContext("2d"),o=0,a="",s="",u={},l=r.letterSpacing,c=r.whiteSpace,h=t.collapseSpaces(c),p=t.collapseNewlines(c),d=!h,f=r.wordWrapWidth+l,m=t.tokenize(e),g=0;g<m.length;g++){var v=m[g];if(t.isNewline(v)){if(!p){s+=t.addLine(a),d=!h,a="",o=0;continue}v=" "}if(h){var y=t.isBreakingSpace(v),x=t.isBreakingSpace(a[a.length-1]);if(y&&x)continue}var b=t.getFromCache(v,l,u,i);if(b>f)if(""!==a&&(s+=t.addLine(a),a="",o=0),t.canBreakWords(v,r.breakWords))for(var _=t.wordWrapSplit(v),w=0;w<_.length;w++){for(var T=_[w],E=1;_[w+E];){var S=_[w+E],A=T[T.length-1];if(t.canBreakChars(A,S,v,w,r.breakWords))break;T+=S,E++}w+=T.length-1;var P=t.getFromCache(T,l,u,i);P+o>f&&(s+=t.addLine(a),d=!1,a="",o=0),a+=T,o+=P}else{a.length>0&&(s+=t.addLine(a),a="",o=0);var M=g===m.length-1;s+=t.addLine(v,!M),d=!1,a="",o=0}else b+o>f&&(d=!1,s+=t.addLine(a),a="",o=0),(a.length>0||!t.isBreakingSpace(v)||d)&&(a+=v,o+=b)}return s+=t.addLine(a,!1)},t.addLine=function(e,r){return void 0===r&&(r=!0),e=t.trimRight(e),e=r?e+"\n":e},t.getFromCache=function(t,e,r,n){var i=r[t];if(void 0===i){var o=t.length*e;i=n.measureText(t).width+o,r[t]=i}return i},t.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},t.collapseNewlines=function(t){return"normal"===t},t.trimRight=function(e){if("string"!=typeof e)return"";for(var r=e.length-1;r>=0;r--){var n=e[r];if(!t.isBreakingSpace(n))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var r=[],n="";if("string"!=typeof e)return r;for(var i=0;i<e.length;i++){var o=e[i];t.isBreakingSpace(o)||t.isNewline(o)?(""!==n&&(r.push(n),n=""),r.push(o)):n+=o}return""!==n&&r.push(n),r},t.canBreakWords=function(t,e){return e},t.canBreakChars=function(t,e,r,n,i){return!0},t.wordWrapSplit=function(t){return t.split("")},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var r={ascent:0,descent:0,fontSize:0},n=t._canvas,i=t._context;i.font=e;var o=t.METRICS_STRING+t.BASELINE_SYMBOL,a=Math.ceil(i.measureText(o).width),s=Math.ceil(i.measureText(t.BASELINE_SYMBOL).width),u=2*s;s=s*t.BASELINE_MULTIPLIER|0,n.width=a,n.height=u,i.fillStyle="#f00",i.fillRect(0,0,a,u),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(o,0,s);var l=i.getImageData(0,0,a,u).data,c=l.length,h=4*a,p=0,d=0,f=!1;for(p=0;p<s;++p){for(var m=0;m<h;m+=4)if(255!==l[d+m]){f=!0;break}if(f)break;d+=h}for(r.ascent=s-p,d=c-h,f=!1,p=u;p>s;--p){for(m=0;m<h;m+=4)if(255!==l[d+m]){f=!0;break}if(f)break;d-=h}return r.descent=p-s,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r},t.clearMetrics=function(e){void 0===e&&(e=""),e?delete t._fonts[e]:t._fonts={}},t}(),la=function(){try{var t=new OffscreenCanvas(0,0),e=t.getContext("2d");return e&&e.measureText?t:document.createElement("canvas")}catch(t){return document.createElement("canvas")}}();la.width=la.height=10,ua._canvas=la,ua._context=la.getContext("2d"),ua._fonts={},ua.METRICS_STRING="|ÉqÅ",ua.BASELINE_SYMBOL="M",ua.BASELINE_MULTIPLIER=1.4,ua._newlines=[10,13],ua._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var ca={texture:!0,children:!1,baseTexture:!0},ha=function(e){function r(t,r,n){var i=this,o=!1;n||(n=document.createElement("canvas"),o=!0),n.width=3,n.height=3;var a=qr.from(n);return a.orig=new je,a.trim=new je,(i=e.call(this,a)||this)._ownCanvas=o,i.canvas=n,i.context=i.canvas.getContext("2d"),i._resolution=R.RESOLUTION,i._autoResolution=!0,i._text=null,i._style=null,i._styleListener=null,i._font="",i.text=t,i.style=r,i.localStyleID=-1,i}return function(t,e){function r(){this.constructor=t}ea(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),r.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var r,n,i=this.context,o=ua.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=o.width,s=o.height,u=o.lines,l=o.lineHeight,c=o.lineWidths,h=o.maxLineWidth,p=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,a)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,s)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;for(var d=e.dropShadow?2:1,f=0;f<d;++f){var m=e.dropShadow&&0===f,g=m?2*s:0,v=g*this.resolution;if(m){i.fillStyle="black",i.strokeStyle="black";var y=e.dropShadowColor,x=oe("number"==typeof y?y:se(y));i.shadowColor="rgba("+255*x[0]+","+255*x[1]+","+255*x[2]+","+e.dropShadowAlpha+")",i.shadowBlur=e.dropShadowBlur,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+v}else i.fillStyle=this._generateFillStyle(e,u,o),i.strokeStyle=e.stroke,i.shadowColor="0",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;for(var b=0;b<u.length;b++)r=e.strokeThickness/2,n=e.strokeThickness/2+b*l+p.ascent,"right"===e.align?r+=h-c[b]:"center"===e.align&&(r+=(h-c[b])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(u[b],r+e.padding,n+e.padding-g,!0),e.fill&&this.drawLetterSpacing(u[b],r+e.padding,n+e.padding-g)}this.updateTexture()}},r.prototype.drawLetterSpacing=function(t,e,r,n){void 0===n&&(n=!1);var i=this._style.letterSpacing;if(0!==i)for(var o=e,a=Array.from?Array.from(t):t.split(""),s=this.context.measureText(t).width,u=0,l=0;l<a.length;++l){var c=a[l];n?this.context.strokeText(c,o,r):this.context.fillText(c,o,r),o+=s-(u=this.context.measureText(t.substring(l+1)).width)+i,s=u}else n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r)},r.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=Ie(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var r=this._texture,n=this._style,i=n.trim?0:n.padding,o=r.baseTexture;r.trim.width=r._frame.width=Math.ceil(t.width/this._resolution),r.trim.height=r._frame.height=Math.ceil(t.height/this._resolution),r.trim.x=-i,r.trim.y=-i,r.orig.width=r._frame.width-2*i,r.orig.height=r._frame.height-2*i,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},r.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype._render.call(this,t)},r.prototype.getLocalBounds=function(t){return this.updateText(!0),e.prototype.getLocalBounds.call(this,t)},r.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},r.prototype._generateFillStyle=function(e,r,n){var i,o=e.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var a=e.dropShadow?e.dropShadowDistance:0,s=e.padding||0,u=Math.ceil(this.canvas.width/this._resolution)-a-2*s,l=Math.ceil(this.canvas.height/this._resolution)-a-2*s,c=o.slice(),h=e.fillGradientStops.slice();if(!h.length)for(var p=c.length+1,d=1;d<p;++d)h.push(d/p);if(c.unshift(o[0]),h.unshift(0),c.push(o[o.length-1]),h.push(1),e.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){i=this.context.createLinearGradient(u/2,s,u/2,l+s);var f=0,m=(n.fontProperties.fontSize+e.strokeThickness)/l;for(d=0;d<r.length;d++)for(var g=n.lineHeight*d,v=0;v<c.length;v++){var y=g/l+("number"==typeof h[v]?h[v]:v/c.length)*m,x=Math.max(f,y);x=Math.min(x,1),i.addColorStop(x,c[v]),f=x}}else{i=this.context.createLinearGradient(s,l/2,u+s,l/2);var b=c.length+1,_=1;for(d=0;d<c.length;d++){var w=void 0;w="number"==typeof h[d]?h[d]:_/b,i.addColorStop(w,c[d]),_++}}return i},r.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},ca,t),e.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(r.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=be(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=be(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},this._style=t instanceof ia?t:new ia(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),r}(ta);
/*!
   * @pixi/prepare - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/prepare is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
R.UPLOADS_PER_FRAME=4;
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */
var pa=function(t,e){return(pa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var da=function(){function t(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return t.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},t.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},t}();function fa(t,e){var r=!1;if(t&&t._textures&&t._textures.length)for(var n=0;n<t._textures.length;n++)if(t._textures[n]instanceof qr){var i=t._textures[n].baseTexture;-1===e.indexOf(i)&&(e.push(i),r=!0)}return r}function ma(t,e){if(t.baseTexture instanceof Cr){var r=t.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function ga(t,e){if(t._texture&&t._texture instanceof qr){var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function va(t,e){return e instanceof ha&&(e.updateText(!0),!0)}function ya(t,e){if(e instanceof ia){var r=e.toFontString();return ua.measureFont(r),!0}return!1}function xa(t,e){if(t instanceof ha){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var r=t._texture.baseTexture;return-1===e.indexOf(r)&&e.push(r),!0}return!1}function ba(t,e){return t instanceof ia&&(-1===e.indexOf(t)&&e.push(t),!0)}var _a=function(){function e(t){var e=this;this.limiter=new da(R.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(xa),this.registerFindHook(ba),this.registerFindHook(fa),this.registerFindHook(ma),this.registerFindHook(ga),this.registerUploadHook(va),this.registerUploadHook(ya)}return e.prototype.upload=function(e,r){"function"==typeof e&&(r=e,e=null),e&&this.add(e),this.queue.length?(r&&this.completes.push(r),this.ticking||(this.ticking=!0,dr.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY))):r&&r()},e.prototype.tick=function(){setTimeout(this.delayedTick,0)},e.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],r=!1;if(e&&!e._destroyed)for(var n=0,i=this.uploadHooks.length;n<i;n++)if(this.uploadHooks[n](this.uploadHookHelper,e)){this.queue.shift(),r=!0;break}r||this.queue.shift()}if(this.queue.length)dr.system.addOnce(this.tick,this,t.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var o=this.completes.slice(0);this.completes.length=0;for(n=0,i=o.length;n<i;n++)o[n]()}},e.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},e.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},e.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ur)for(e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},e.prototype.destroy=function(){this.ticking&&dr.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},e}();function wa(t,e){return e instanceof Cr&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Ta(t,e){if(!(e instanceof $o))return!1;var r=e.geometry;e.finishPoly(),r.updateBatches();for(var n=r.batches,i=0;i<n.length;i++){var o=n[i].style.texture;o&&wa(t,o.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function Ea(t,e){return t instanceof $o&&(e.push(t),!0)}var Sa=function(t){function e(e){var r=t.call(this,e)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(Ea),r.registerUploadHook(wa),r.registerUploadHook(Ta),r}return function(t,e){function r(){this.constructor=t}pa(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(_a),Aa=function(){function t(t){this.maxMilliseconds=t,this.frameStart=0}return t.prototype.beginFrame=function(){this.frameStart=Date.now()},t.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},t}(),Pa=function(){function t(t,e,r){void 0===r&&(r=null),this._texture=t instanceof qr?t:null,this.baseTexture=t instanceof Cr?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t.prototype._updateResolution=function(t){void 0===t&&(t=null);var e=this.data.meta.scale,r=Le(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&this.baseTexture.setResolution(r),r},t.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},t.prototype._processFrames=function(e){for(var r=e,n=t.BATCH_SIZE;r-e<n&&r<this._frameKeys.length;){var i=this._frameKeys[r],o=this._frames[i],a=o.frame;if(a){var s=null,u=null,l=!1!==o.trimmed&&o.sourceSize?o.sourceSize:o.frame,c=new je(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s=o.rotated?new je(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):new je(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),!1!==o.trimmed&&o.spriteSourceSize&&(u=new je(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new qr(this.baseTexture,s,c,u,o.rotated?2:0,o.anchor),qr.addToCache(this.textures[i],i)}r++}},t.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var r=0;r<t[e].length;r++){var n=t[e][r];this.animations[e].push(this.textures[n])}}},t.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},t.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*t.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},t.prototype.destroy=function(t){var e;for(var r in void 0===t&&(t=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null===(e=this._texture)||void 0===e||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},t.BATCH_SIZE=1e3,t}(),Ma=function(){function t(){}return t.use=function(e,r){var n=this,i=e.name+"_image";if(e.data&&e.type===ao.TYPE.JSON&&e.data.frames&&!n.resources[i]){var o={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},a=t.getResourcePath(e,n.baseUrl);n.add(i,a,o,(function(t){if(t.error)r(t.error);else{var n=new Pa(t.texture,e.data,e.url);n.parse((function(){e.spritesheet=n,e.textures=n.textures,r()}))}}))}else r()},t.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:te.resolve(t.url.replace(e,""),t.data.meta.image)},t}(),Ia=function(t,e){return(Ia=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Oa(t,e){function r(){this.constructor=t}Ia(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Ca=new He,Ra=function(t){function e(e,r,n){void 0===r&&(r=100),void 0===n&&(n=100);var i=t.call(this,e)||this;return i.tileTransform=new er,i._width=r,i._height=n,i.uvMatrix=e.uvMatrix||new Kn(e),i.pluginName="tilingSprite",i.uvRespectAnchor=!1,i}return Oa(e,t),Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,n)},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new je),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Ca);var e=this._width,r=this._height,n=-e*this.anchor._x;if(Ca.x>=n&&Ca.x<n+e){var i=-r*this.anchor._y;if(Ca.y>=i&&Ca.y<i+r)return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r){return"number"==typeof r&&(Ee("5.3.0","TilingSprite.from use options instead of width and height args"),r={width:r,height:arguments[2]}),new e(qr.from(t,r),r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e}(ta),La="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",Na=new We,Fa=function(e){function r(t){var r=e.call(this,t)||this,n={globals:r.renderer.globalUniforms};return r.shader=$n.from(La,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord - floor(vTextureCoord - uClampOffset);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",n),r.simpleShader=$n.from(La,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",n),r.quad=new ln,r.state=Qn.for2d(),r}return Oa(r,e),r.prototype.render=function(e){var r=this.renderer,n=this.quad,i=n.vertices;i[0]=i[6]=e._width*-e.anchor.x,i[1]=i[3]=e._height*-e.anchor.y,i[2]=i[4]=e._width*(1-e.anchor.x),i[5]=i[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&((i=n.uvs)[0]=i[6]=-e.anchor.x,i[1]=i[3]=-e.anchor.y,i[2]=i[4]=1-e.anchor.x,i[5]=i[7]=1-e.anchor.y),n.invalidate();var o=e._texture,a=o.baseTexture,s=e.tileTransform.localTransform,u=e.uvMatrix,l=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;l&&(a._glTextures[r.CONTEXT_UID]?l=a.wrapMode!==t.WRAP_MODES.CLAMP:a.wrapMode===t.WRAP_MODES.CLAMP&&(a.wrapMode=t.WRAP_MODES.REPEAT));var c=l?this.simpleShader:this.shader,h=o.width,p=o.height,d=e._width,f=e._height;Na.set(s.a*h/d,s.b*h/f,s.c*p/d,s.d*p/f,s.tx/d,s.ty/f),Na.invert(),l?Na.prepend(u.mapCoord):(c.uniforms.uMapCoord=u.mapCoord.toArray(!0),c.uniforms.uClampFrame=u.uClampFrame,c.uniforms.uClampOffset=u.uClampOffset),c.uniforms.uTransform=Na.toArray(!0),c.uniforms.uColor=pe(e.tint,e.worldAlpha,c.uniforms.uColor,a.alphaMode),c.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),c.uniforms.uSampler=o,r.shader.bind(c),r.geometry.bind(n),this.state.blendMode=le(e.blendMode,a.alphaMode),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},r}(fn),Da=function(t,e){return(Da=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Ua(t,e){function r(){this.constructor=t}Da(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ka=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),ja=new He,Ba=new Ge,za=function(e){function r(r,n,i,o){void 0===o&&(o=t.DRAW_MODES.TRIANGLES);var a=e.call(this)||this;return a.geometry=r,r.refCount++,a.shader=n,a.state=i||Qn.for2d(),a.drawMode=o,a.start=0,a.size=0,a.uvs=null,a.indices=null,a.vertexData=new Float32Array(1),a.vertexDirty=0,a._transformID=-1,a.tint=16777215,a.blendMode=t.BLEND_MODES.NORMAL,a._roundPixels=R.ROUND_PIXELS,a.batchUvs=null,a}return Ua(r,e),Object.defineProperty(r.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tint",{get:function(){return this.shader.tint},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),r.prototype._render=function(e){var n=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===t.DRAW_MODES.TRIANGLES&&n.length<2*r.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)},r.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},r.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)},r.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var r=this.transform.worldTransform,n=r.a,i=r.b,o=r.c,a=r.d,s=r.tx,u=r.ty,l=this.vertexData,c=0;c<l.length/2;c++){var h=e[2*c],p=e[2*c+1];l[2*c]=n*h+o*p+s,l[2*c+1]=i*h+a*p+u}if(this._roundPixels){var d=R.RESOLUTION;for(c=0;c<l.length;++c)l[c]=Math.round((l[c]*d|0)/d)}this.vertexDirty=t.vertexDirtyId}},r.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ka(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},r.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},r.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ja);for(var e=this.geometry.getBuffer("aVertexPosition").data,r=Ba.points,n=this.geometry.getIndex().data,i=n.length,o=4===this.drawMode?3:1,a=0;a+2<i;a+=o){var s=2*n[a],u=2*n[a+1],l=2*n[a+2];if(r[0]=e[s],r[1]=e[s+1],r[2]=e[u],r[3]=e[u+1],r[4]=e[l],r[5]=e[l+1],Ba.contains(ja.x,ja.y))return!0}return!1},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},r.BATCHABLE_SIZE=100,r}(ur),Ga=function(t){function e(e,r){var n=this,i={uSampler:e,alpha:1,uTextureMatrix:We.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(i,r.uniforms),(n=t.call(this,r.program||qn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i)||this)._colorDirty=!1,n.uvMatrix=new Kn(e),n.batchable=void 0===r.program,n.pluginName=r.pluginName,n.tint=r.tint,n.alpha=r.alpha,n}return Ua(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;pe(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}($n),Va=function(e){function r(r,n,i){var o=e.call(this)||this,a=new tn(r),s=new tn(n,!0),u=new tn(i,!0,!0);return o.addAttribute("aVertexPosition",a,2,!1,t.TYPES.FLOAT).addAttribute("aTextureCoord",s,2,!1,t.TYPES.FLOAT).addIndex(u),o._updateId=-1,o}return Ua(r,e),Object.defineProperty(r.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),r}(sn),Ha=function(t,e){return(Ha=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var Xa=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},Wa=[function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[]};for(var n in e){var i=e[n].match(/^[a-z]+/gm)[0],o=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(var s in o){var u=o[s].split("="),l=u[0],c=u[1].replace(/"/gm,""),h=parseFloat(c),p=isNaN(h)?c:h;a[l]=p}r[i].push(a)}var d=new Xa;return r.info.forEach((function(t){return d.info.push({face:t.face,size:parseInt(t.size,10)})})),r.common.forEach((function(t){return d.common.push({lineHeight:parseInt(t.lineHeight,10)})})),r.page.forEach((function(t){return d.page.push({id:parseInt(t.id,10),file:t.file})})),r.char.forEach((function(t){return d.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})})),r.kerning.forEach((function(t){return d.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})})),d},t}(),function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new Xa,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),s=0;s<r.length;s++)e.info.push({face:r[s].getAttribute("face"),size:parseInt(r[s].getAttribute("size"),10)});for(s=0;s<n.length;s++)e.common.push({lineHeight:parseInt(n[s].getAttribute("lineHeight"),10)});for(s=0;s<i.length;s++)e.page.push({id:parseInt(i[s].getAttribute("id"),10)||0,file:i[s].getAttribute("file")});for(s=0;s<o.length;s++){var u=o[s];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(s=0;s<a.length;s++)e.kerning.push({first:parseInt(a[s].getAttribute("first"),10),second:parseInt(a[s].getAttribute("second"),10),amount:parseInt(a[s].getAttribute("amount"),10)});return e},t}()];function Ya(t){for(var e=0;e<Wa.length;e++)if(Wa[e].test(t))return Wa[e];return null}function qa(e,r,n,i,o,a){var s,u=n.fill;if(!Array.isArray(u))return u;if(1===u.length)return u[0];var l=n.dropShadow?n.dropShadowDistance:0,c=n.padding||0,h=Math.ceil(e.width/i)-l-2*c,p=Math.ceil(e.height/i)-l-2*c,d=u.slice(),f=n.fillGradientStops.slice();if(!f.length)for(var m=d.length+1,g=1;g<m;++g)f.push(g/m);if(d.unshift(u[0]),f.unshift(0),d.push(u[u.length-1]),f.push(1),n.fillGradientType===t.TEXT_GRADIENT.LINEAR_VERTICAL){s=r.createLinearGradient(h/2,c,h/2,p+c);var v=0,y=(a.fontProperties.fontSize+n.strokeThickness)/p;for(g=0;g<o.length;g++)for(var x=a.lineHeight*g,b=0;b<d.length;b++){var _=x/p+("number"==typeof f[b]?f[b]:b/d.length)*y,w=Math.max(v,_);w=Math.min(w,1),s.addColorStop(w,d[b]),v=w}}else{s=r.createLinearGradient(c,p/2,h+c,p/2);var T=d.length+1,E=1;for(g=0;g<d.length;g++){var S=void 0;S="number"==typeof f[g]?f[g]:E/T,s.addColorStop(S,d[g]),E++}}return s}function $a(t,e,r,n,i,o,a){var s=r.text,u=r.fontProperties;e.translate(n,i),e.scale(o,o);var l=a.strokeThickness/2,c=-a.strokeThickness/2;e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=qa(t,e,a,o,[s],r),e.strokeStyle=a.stroke,e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=qa(t,e,a,o,[s],r),e.strokeStyle=a.stroke;var h=a.dropShadowColor,p=oe("number"==typeof h?h:se(h));a.dropShadow?(e.shadowColor="rgba("+255*p[0]+","+255*p[1]+","+255*p[2]+","+a.dropShadowAlpha+")",e.shadowBlur=a.dropShadowBlur,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*a.dropShadowDistance,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*a.dropShadowDistance):(e.shadowColor="0",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),a.stroke&&a.strokeThickness&&e.strokeText(s,l,c+r.lineHeight-u.descent),a.fill&&e.fillText(s,l,c+r.lineHeight-u.descent),e.setTransform(),e.fillStyle="rgba(0, 0, 0, 0)"}var Qa=function(){function t(t,e){var r=t.info[0],n=t.common[0],i=Le(t.page[0].file),o={};this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/i,this.chars={},this.pageTextures=o;for(var a=0;a<t.page.length;a++){var s=t.page[a],u=s.id,l=s.file;o[u]=e instanceof Array?e[a]:e[l]}for(a=0;a<t.char.length;a++){var c=t.char[a],h=(u=c.id,c.page),p=t.char[a],d=p.x,f=p.y,m=p.width,g=p.height,v=p.xoffset,y=p.yoffset,x=p.xadvance;f/=i,m/=i,g/=i,v/=i,y/=i,x/=i;var b=new je((d/=i)+o[h].frame.x/i,f+o[h].frame.y/i,m,g);this.chars[u]={xOffset:v,yOffset:y,xAdvance:x,kerning:{},texture:new qr(o[h].baseTexture,b),page:h}}for(a=0;a<t.kerning.length;a++){var _=t.kerning[a],w=_.first,T=_.second,E=_.amount;w/=i,T/=i,E/=i,this.chars[T]&&(this.chars[T].kerning[w]=E)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,r){var n;if(e instanceof Xa)n=e;else{var i=Ya(e);if(!i)throw new Error("Unrecognized data format for font.");n=i.parse(e)}r instanceof qr&&(r=[r]);var o=new t(n,r);return t.available[o.font]=o,o},t.uninstall=function(e){var r=t.available[e];if(!r)throw new Error("No font found named '"+e+"'");r.destroy(),delete t.available[e]},t.from=function(e,r,n){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var i=Object.assign({},t.defaultOptions,n),o=i.chars,a=i.padding,s=i.resolution,u=i.textureWidth,l=i.textureHeight,c=function(t){"string"==typeof t&&(t=[t]);for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+i.length+".");var o=i[0].charCodeAt(0),a=i[1].charCodeAt(0);if(a<o)throw new Error("[BitmapFont]: Invalid character range.");for(var s=o,u=a;s<=u;s++)e.push(String.fromCharCode(s))}else e.push.apply(e,i.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(o),h=r instanceof ia?r:new ia(r),p=u,d=new Xa;d.info[0]={face:h.fontFamily,size:h.fontSize},d.common[0]={lineHeight:h.fontSize};for(var f,m,g,v=0,y=0,x=0,b=[],_=0;_<c.length;_++){f||((f=document.createElement("canvas")).width=u,f.height=l,m=f.getContext("2d"),g=new Cr(f,{resolution:s}),b.push(new qr(g)),d.page.push({id:b.length-1,file:""}));var w=ua.measureText(c[_],h,!1,f),T=w.width,E=Math.ceil(w.height),S=Math.ceil(("italic"===h.fontStyle?2:1)*T);if(y>=l-E*s){if(0===y)throw new Error("[BitmapFont] textureHeight "+l+"px is too small for "+h.fontSize+"px fonts");--_,f=null,m=null,g=null,y=0,v=0,x=0}else if(x=Math.max(E+w.fontProperties.descent,x),S*s+v>=p)--_,y+=x*s,y=Math.ceil(y),v=0,x=0;else{$a(f,m,w,v,y,s,h);var A=w.text.charCodeAt(0);d.char.push({id:A,page:b.length-1,x:v/s,y:y/s,width:S,height:E,xoffset:0,yoffset:0,xadvance:Math.ceil(T-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0))}),v+=(S+2*a)*s,v=Math.ceil(v)}}var P=new t(d,b);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=P,P},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),Za=[],Ja=[],Ka=function(t){function e(r,n){void 0===n&&(n={});var i=t.call(this)||this;i._tint=16777215,n.font&&(Ee("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),i._upgradeStyle(n));var o=Object.assign({},e.styleDefaults,n),a=o.align,s=o.tint,u=o.maxWidth,l=o.letterSpacing,c=o.fontName,h=o.fontSize;if(!Qa.available[c])throw new Error('Missing BitmapFont "'+c+'"');return i._activePagesMeshData=[],i._textWidth=0,i._textHeight=0,i._align=a,i._tint=s,i._fontName=c,i._fontSize=h||Qa.available[c].size,i._text=r,i._maxWidth=u,i._maxLineHeight=0,i._letterSpacing=l,i._anchor=new Xe((function(){i.dirty=!0}),i,0,0),i.roundPixels=R.ROUND_PIXELS,i.dirty=!0,i}return function(t,e){function r(){this.constructor=t}Ha(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.updateText=function(){for(var t,e=Qa.available[this._fontName],r=this._fontSize/e.size,n=new He,i=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",s=a.length,u=this._maxWidth*e.size/this._fontSize,l=null,c=0,h=0,p=0,d=-1,f=0,m=0,g=0,v=0;v<s;v++){var y=a.charCodeAt(v),x=a.charAt(v);if(/(?:\s)/.test(x)&&(d=v,f=c),"\r"!==x&&"\n"!==x){var b=e.chars[y];if(b){l&&b.kerning[l]&&(n.x+=b.kerning[l]);var _=Ja.pop()||{texture:qr.EMPTY,line:0,charCode:0,position:new He};_.texture=b.texture,_.line=p,_.charCode=y,_.position.x=n.x+b.xOffset+this._letterSpacing/2,_.position.y=n.y+b.yOffset,i.push(_),n.x+=b.xAdvance+this._letterSpacing,c=n.x,g=Math.max(g,b.yOffset+b.texture.height),l=y,-1!==d&&u>0&&n.x>u&&(xe(i,1+d-++m,1+v-d),v=d,d=-1,o.push(f),h=Math.max(h,f),p++,n.x=0,n.y+=e.lineHeight,l=null)}}else o.push(c),h=Math.max(h,c),++p,++m,n.x=0,n.y+=e.lineHeight,l=null}var w=a.charAt(a.length-1);"\r"!==w&&"\n"!==w&&(/(?:\s)/.test(w)&&(c=f),o.push(c),h=Math.max(h,c));var T=[];for(v=0;v<=p;v++){var E=0;"right"===this._align?E=h-o[v]:"center"===this._align&&(E=(h-o[v])/2),T.push(E)}var S=i.length,A={},P=[],M=this._activePagesMeshData;for(v=0;v<M.length;v++)Za.push(M[v]);for(v=0;v<S;v++){var I=(L=i[v].texture).baseTexture.uid;if(!A[I]){if(!(B=Za.pop())){var O=new Va,C=new Ga(qr.EMPTY);B={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new za(O,C),vertices:null,uvs:null,indices:null}}B.index=0,B.indexCount=0,B.vertexCount=0,B.uvsCount=0,B.total=0,B.mesh.texture=new qr(L.baseTexture),B.mesh.tint=this._tint,P.push(B),A[I]=B}A[I].total++}for(v=0;v<M.length;v++)-1===P.indexOf(M[v])&&this.removeChild(M[v].mesh);for(v=0;v<P.length;v++)P[v].mesh.parent!==this&&this.addChild(P[v].mesh);for(var v in this._activePagesMeshData=P,A){var R=(B=A[v]).total;(null===(t=B.indices)||void 0===t?void 0:t.length)>6*R&&!(B.vertices.length<2*za.BATCHABLE_SIZE)||(B.vertices=new Float32Array(8*R),B.uvs=new Float32Array(8*R),B.indices=new Uint16Array(6*R)),B.mesh.size=6*R}for(v=0;v<S;v++){var L,N=((x=i[v]).position.x+T[x.line])*r,F=x.position.y*r,D=A[(L=x.texture).baseTexture.uid],U=L.frame,k=L._uvs,j=D.index++;D.indices[6*j+0]=0+4*j,D.indices[6*j+1]=1+4*j,D.indices[6*j+2]=2+4*j,D.indices[6*j+3]=0+4*j,D.indices[6*j+4]=2+4*j,D.indices[6*j+5]=3+4*j,D.vertices[8*j+0]=N,D.vertices[8*j+1]=F,D.vertices[8*j+2]=N+U.width*r,D.vertices[8*j+3]=F,D.vertices[8*j+4]=N+U.width*r,D.vertices[8*j+5]=F+U.height*r,D.vertices[8*j+6]=N,D.vertices[8*j+7]=F+U.height*r,D.uvs[8*j+0]=k.x0,D.uvs[8*j+1]=k.y0,D.uvs[8*j+2]=k.x1,D.uvs[8*j+3]=k.y1,D.uvs[8*j+4]=k.x2,D.uvs[8*j+5]=k.y2,D.uvs[8*j+6]=k.x3,D.uvs[8*j+7]=k.y3}for(var v in this._textWidth=h*r,this._textHeight=(n.y+e.lineHeight)*r,A){var B=A[v];if(0!==this.anchor.x||0!==this.anchor.y)for(var z=0,G=this._textWidth*this.anchor.x,V=this._textHeight*this.anchor.y,H=0;H<B.total;H++)B.vertices[z++]-=G,B.vertices[z++]-=V,B.vertices[z++]-=G,B.vertices[z++]-=V,B.vertices[z++]-=G,B.vertices[z++]-=V,B.vertices[z++]-=G,B.vertices[z++]-=V;this._maxLineHeight=g*r;var X=B.mesh.geometry.getBuffer("aVertexPosition"),W=B.mesh.geometry.getBuffer("aTextureCoord"),Y=B.mesh.geometry.getIndex();X.data=B.vertices,W.data=B.uvs,Y.data=B.indices,X.update(),W.update(),Y.update()}for(v=0;v<i.length;v++)Ja.push(i[v])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!Qa.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype._upgradeStyle=function(t){if("string"==typeof t.font){var e=t.font.split(" ");t.fontName=1===e.length?e[0]:e.slice(1).join(" "),e.length>=2&&(t.fontSize=parseInt(e[0],10))}else t.fontName=t.font.name,t.fontSize="number"==typeof t.font.size?t.font.size:parseInt(t.font.size,10)},e.registerFont=function(t,e){return Ee("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),Qa.install(t,e)},Object.defineProperty(e,"fonts",{get:function(){return Ee("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),Qa.available},enumerable:!1,configurable:!0}),e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e}(ur),ts=function(){function t(){}return t.add=function(){ao.setExtensionXhrType("fnt",ao.XHR_RESPONSE_TYPE.DOCUMENT)},t.use=function(e,r){var n=Ya(e.data);if(n)for(var i=t.getBaseUrl(this,e),o=n.parse(e.data),a={},s=function(t){a[t.metadata.pageFile]=t.texture,Object.keys(a).length===o.page.length&&(e.bitmapFont=Qa.install(o,a),r())},u=0;u<o.page.length;++u){var l=o.page[u].file,c=i+l,h=!1;for(var p in this.resources){var d=this.resources[p];if(d.url===c){d.metadata.pageFile=l,d.texture?s(d):d.onAfterMiddleware.add(s),h=!0;break}}if(!h){var f={crossOrigin:e.crossOrigin,loadType:ao.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(c,f,s)}}else r()},t.getBaseUrl=function(e,r){var n=r.isDataUrl?"":t.dirname(r.url);return r.isDataUrl&&("."===n&&(n=""),e.baseUrl&&n&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(n+="/")),(n=n.replace(e.baseUrl,""))&&"/"!==n.charAt(n.length-1)&&(n+="/"),n},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}(),es=function(t,e){return(es=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var rs=function(t){function e(e){void 0===e&&(e=1);var r=t.call(this,Ei,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return r.alpha=e,r}return function(t,e){function r(){this.constructor=t}es(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Zn),ns=function(t,e){return(ns=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function is(t,e){function r(){this.constructor=t}ns(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var os,as,ss,us,ls,cs,hs,ps,ds,fs,ms,gs,vs,ys,xs,bs,_s,ws={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Ts=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(os||(os={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(as||(as={})),function(t){t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL"}(ss||(ss={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(us||(us={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ls||(ls={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(cs||(cs={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(hs||(hs={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(ps||(ps={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(ds||(ds={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(fs||(fs={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(ms||(ms={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(gs||(gs={})),function(t){t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT"}(vs||(vs={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(ys||(ys={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(xs||(xs={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(bs||(bs={})),function(t){t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH"}(_s||(_s={}));var Es=function(t){function e(e,r,n,i,o){void 0===r&&(r=8),void 0===n&&(n=4),void 0===i&&(i=R.RESOLUTION),void 0===o&&(o=5);var a=this,s=function(t,e){var r,n=Math.ceil(t/2),i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",o="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var a=0;a<t;a++){var s=r.replace("%index%",a.toString());o+=s=s.replace("%sampleIndex%",a-(n-1)+".0"),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",t.toString())}(o,e),u=function(t){for(var e,r=ws[t],n=r.length,i=Ts,o="",a=0;a<t;a++){var s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",a.toString());e=a,a>=n&&(e=t-a-1),o+=s=s.replace("%value%",r[e].toString()),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",t.toString())}(o);return(a=t.call(this,s,u)||this).horizontal=e,a.resolution=i,a._quality=0,a.quality=n,a.blur=r,a}return is(e,t),e.prototype.apply=function(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{var i=t.getFilterTexture(),o=t.renderer,a=e,s=i;this.state.blend=!1,t.applyFilter(this,a,s,vs.CLEAR);for(var u=1;u<this.passes-1;u++){t.bindAndClear(a,vs.BLIT),this.uniforms.uSampler=s;var l=s;s=a,a=l,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,s,r,n),t.returnFilterTexture(i)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+2*Math.abs(t),this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e}(Zn),Ss=function(t){function e(e,r,n,i){void 0===e&&(e=8),void 0===r&&(r=4),void 0===n&&(n=R.RESOLUTION),void 0===i&&(i=5);var o=t.call(this)||this;return o.blurXFilter=new Es(!0,e,r,n,i),o.blurYFilter=new Es(!1,e,r,n,i),o.resolution=n,o.quality=r,o.blur=e,o.repeatEdgePixels=!1,o}return is(e,t),e.prototype.apply=function(t,e,r,n){var i=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(i&&o){var a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,vs.CLEAR),this.blurYFilter.apply(t,a,r,n),t.returnFilterTexture(a)}else o?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e}(Zn),As=function(t,e){return(As=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var Ps=function(t){function e(){var e=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=t.call(this,Si,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",r)||this).alpha=1,e}return function(t,e){function r(){this.constructor=t}As(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r},e.prototype._multiply=function(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){var r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.greyscale=function(t,e){var r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var r=Math.cos(t),n=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i),a=[r+(1-r)*i,i*(1-r)-o*n,i*(1-r)+o*n,0,0,i*(1-r)+o*n,r+i*(1-r),i*(1-r)-o*n,0,0,i*(1-r)-o*n,i*(1-r)+o*n,r+i*(1-r),0,0,0,0,0,1,0];this._loadMatrix(a,e)},e.prototype.contrast=function(t,e){var r=(t||0)+1,n=-.5*(r-1),i=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var r=2*t/3+1,n=-.5*(r-1),i=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(i,e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,r,n,i){var o=((r=r||16770432)>>16&255)/255,a=(r>>8&255)/255,s=(255&r)/255,u=((n=n||3375104)>>16&255)/255,l=(n>>8&255)/255,c=(255&n)/255,h=[.3,.59,.11,0,0,o,a,s,t=t||.2,0,u,l,c,e=e||.15,0,o-u,a-l,s-c,0,0];this._loadMatrix(h,i)},e.prototype.night=function(t,e){var r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.predator=function(t,e){var r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e}(Zn);Ps.prototype.grayscale=Ps.prototype.greyscale;
/*!
   * @pixi/filter-displacement - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/filter-displacement is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */
var Ms=function(t,e){return(Ms=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var Is=function(t){function e(e,r){var n=this,i=new We;return e.renderable=!1,(n=t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,n.maskMatrix=i,null==r&&(r=20),n.scale=new He(r,r),n}return function(t,e){function r(){this.constructor=t}Ms(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.apply=function(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var i=this.maskSprite.worldTransform,o=Math.sqrt(i.a*i.a+i.b*i.b),a=Math.sqrt(i.c*i.c+i.d*i.d);0!==o&&0!==a&&(this.uniforms.rotation[0]=i.a/o,this.uniforms.rotation[1]=i.b/o,this.uniforms.rotation[2]=i.c/a,this.uniforms.rotation[3]=i.d/a),t.applyFilter(this,e,r,n)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e}(Zn),Os=function(t,e){return(Os=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var Cs=function(t){function e(){return t.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}return function(t,e){function r(){this.constructor=t}Os(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Zn),Rs=function(t,e){return(Rs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var Ls=function(t){function e(e,r){void 0===e&&(e=.5),void 0===r&&(r=Math.random());var n=t.call(this,Si,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return n.noise=e,n.seed=r,n}return function(t,e){function r(){this.constructor=t}Rs(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e}(Zn),Ns=new We;or.prototype._cacheAsBitmap=!1,or.prototype._cacheData=null;var Fs=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(or.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Fs),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),or.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},or.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters){var n=this.filters[0].padding;r.pad(n)}r.ceil(R.RESOLUTION);var i=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),a=t.projection.transform,s=Qr.create({width:r.width,height:r.height}),u="cacheAsBitmap_"+we();this._cacheData.textureCacheId=u,Cr.addToCache(s.baseTexture,u),qr.addToCache(s,u);var l=this.transform.localTransform.copyTo(Ns).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,s,!0,l,!1),t.projection.transform=a,t.renderTexture.bind(i,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var c=new ta(s);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-r.x/r.width,c.anchor.y=-r.y/r.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)}},or.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},or.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var n=t.context,i=t._projTransform;e.ceil(R.RESOLUTION);var o=Qr.create({width:e.width,height:e.height}),a="cacheAsBitmap_"+we();this._cacheData.textureCacheId=a,Cr.addToCache(o.baseTexture,a),qr.addToCache(o,a);var s=Ns;this.transform.localTransform.copyTo(s),s.invert(),s.tx-=e.x,s.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,o,!0,s,!1),t.context=n,t._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var u=new ta(o);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-e.x/e.width,u.anchor.y=-e.y/e.height,u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}},or.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},or.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},or.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Cr.removeFromCache(this._cacheData.textureCacheId),qr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},or.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},
/*!
   * @pixi/mixin-get-child-by-name - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/mixin-get-child-by-name is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
or.prototype.name=null,ur.prototype.getChildByName=function(t,e){for(var r=0,n=this.children.length;r<n;r++)if(this.children[r].name===t)return this.children[r];if(e)for(r=0,n=this.children.length;r<n;r++){if(this.children[r].getChildByName){var i=this.children[r].getChildByName(t,!0);if(i)return i}}return null},
/*!
   * @pixi/mixin-get-global-position - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/mixin-get-global-position is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
or.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new He),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */
var Ds=function(t,e){return(Ds=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Us(t,e){function r(){this.constructor=t}Ds(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ks="5.0.0";
/*!
   * @pixi/mesh-extras - v5.3.3
   * Compiled Tue, 04 Aug 2020 16:26:23 UTC
   *
   * @pixi/mesh-extras is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */
/*! *****************************************************************************
  	Copyright (c) Microsoft Corporation. All rights reserved.
  	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  	this file except in compliance with the License. You may obtain a copy of the
  	License at http://www.apache.org/licenses/LICENSE-2.0
  
  	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  	MERCHANTABLITY OR NON-INFRINGEMENT.
  
  	See the Apache Version 2.0 License for specific language governing permissions
  	and limitations under the License.
  	***************************************************************************** */
var js=function(t,e){return(js=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Bs(t,e){function r(){this.constructor=t}js(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var zs=function(t){function e(e,r,n,i){void 0===e&&(e=100),void 0===r&&(r=100),void 0===n&&(n=10),void 0===i&&(i=10);var o=t.call(this)||this;return o.segWidth=n,o.segHeight=i,o.width=e,o.height=r,o.build(),o}return Bs(e,t),e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,e=[],r=[],n=[],i=this.segWidth-1,o=this.segHeight-1,a=this.width/i,s=this.height/o,u=0;u<t;u++){var l=u%this.segWidth,c=u/this.segWidth|0;e.push(l*a,c*s),r.push(l/i,c/o)}var h=i*o;for(u=0;u<h;u++){var p=u%i,d=u/i|0,f=d*this.segWidth+p,m=d*this.segWidth+p+1,g=(d+1)*this.segWidth+p,v=(d+1)*this.segWidth+p+1;n.push(f,m,g,m,v,g)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e}(Va),Gs=function(t){function e(e,r,n){void 0===e&&(e=200),void 0===n&&(n=0);var i=t.call(this,new Float32Array(4*r.length),new Float32Array(4*r.length),new Uint16Array(6*(r.length-1)))||this;return i.points=r,i._width=e,i.textureScale=n,i.build(),i}return Bs(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),n=this.getIndex();if(!(t.length<1)){e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),n.data=new Uint16Array(6*(t.length-1)));var i=r.data,o=n.data;i[0]=0,i[1]=0,i[2]=0,i[3]=1;for(var a=0,s=t[0],u=this._width*this.textureScale,l=t.length,c=0;c<l;c++){var h=4*c;if(this.textureScale>0){var p=s.x-t[c].x,d=s.y-t[c].y,f=Math.sqrt(p*p+d*d);s=t[c],a+=f/u}else a=c/(l-1);i[h]=a,i[h+1]=0,i[h+2]=a,i[h+3]=1}var m=0;for(c=0;c<l-1;c++){h=2*c;o[m++]=h,o[m++]=h+1,o[m++]=h+2,o[m++]=h+2,o[m++]=h+1,o[m++]=h+3}r.update(),n.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var e,r=t[0],n=0,i=0,o=this.buffers[0].data,a=t.length,s=0;s<a;s++){var u=t[s],l=4*s;i=-((e=s<t.length-1?t[s+1]:u).x-r.x),n=e.y-r.y;var c=Math.sqrt(n*n+i*i),h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;n/=c,i/=c,n*=h,i*=h,o[l]=u.x+n,o[l+1]=u.y+i,o[l+2]=u.x-n,o[l+3]=u.y-i,r=u}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e}(Va),Vs=function(e){function r(r,n,i){void 0===i&&(i=0);var o=this,a=new Gs(r.height,n,i),s=new Ga(r);return i>0&&(r.baseTexture.wrapMode=t.WRAP_MODES.REPEAT),(o=e.call(this,a,s)||this).autoUpdate=!0,o}return Bs(r,e),r.prototype._render=function(t){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),e.prototype._render.call(this,t)},r}(za),Hs=function(t){function e(e,r,n){var i=this,o=new zs(e.width,e.height,r,n),a=new Ga(qr.WHITE);return(i=t.call(this,o,a)||this).texture=e,i}return Bs(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry;t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build()},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,e)},e}(za),Xs=function(t){function e(e,r,n,i,o){void 0===e&&(e=qr.EMPTY);var a=this,s=new Va(r,n,i);s.getBuffer("aVertexPosition").static=!1;var u=new Ga(e);return(a=t.call(this,s,u,null,o)||this).autoUpdate=!0,a}return Bs(e,t),Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},e}(za),Ws=function(t){function e(e,r,n,i,o){void 0===r&&(r=10),void 0===n&&(n=10),void 0===i&&(i=10),void 0===o&&(o=10);var a=t.call(this,qr.WHITE,4,4)||this;return a._origWidth=e.orig.width,a._origHeight=e.orig.height,a._width=a._origWidth,a._height=a._origHeight,a._leftWidth=r,a._rightWidth=i,a._topHeight=n,a._bottomHeight=o,a.texture=e,a}return Bs(e,t),e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,n=this._height>r?1:this._height/r;return Math.min(e,n)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var r=1/this._origWidth,n=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=n*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e}(Hs),Ys=function(t,e){return(Ys=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var qs=function(e){function r(t,r){void 0===r&&(r=!0);var n=e.call(this,t[0]instanceof qr?t[0]:t[0].texture)||this;return n._textures=null,n._durations=null,n._autoUpdate=r,n._isConnectedToTicker=!1,n.animationSpeed=1,n.loop=!0,n.updateAnchor=!1,n.onComplete=null,n.onFrameChange=null,n.onLoop=null,n._currentTime=0,n._playing=!1,n._previousFrame=null,n.textures=t,n}return function(t,e){function r(){this.constructor=t}Ys(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(r,e),r.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1))},r.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(dr.shared.add(this.update,this,t.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},r.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},r.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},r.prototype.update=function(t){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())},r.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},r.fromFrames=function(t){for(var e=[],n=0;n<t.length;++n)e.push(qr.from(t[n]));return new r(e)},r.fromImages=function(t){for(var e=[],n=0;n<t.length;++n)e.push(qr.from(t[n]));return new r(e)},Object.defineProperty(r.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof qr)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(dr.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),r}(ta);wi.registerPlugin("accessibility",hr),wi.registerPlugin("extract",Bi),wi.registerPlugin("interaction",wr),wi.registerPlugin("particle",yo),wi.registerPlugin("prepare",Sa),wi.registerPlugin("batch",Fi),wi.registerPlugin("tilingSprite",Fa),lo.registerPlugin(ts),lo.registerPlugin(Ma),Di.registerPlugin(fr),Di.registerPlugin(co);var $s={AlphaFilter:rs,BlurFilter:Ss,BlurFilterPass:Es,ColorMatrixFilter:Ps,DisplacementFilter:Is,FXAAFilter:Cs,NoiseFilter:Ls};return t.AbstractBatchRenderer=Ii,t.AbstractRenderer=_i,t.AccessibilityManager=hr,t.AnimatedSprite=qs,t.AppLoaderPlugin=co,t.Application=Di,t.Attribute=Jr,t.BasePrepare=_a,t.BaseRenderTexture=Xr,t.BaseTexture=Cr,t.BatchDrawCall=Ai,t.BatchGeometry=Ci,t.BatchPluginFactory=Ni,t.BatchRenderer=Fi,t.BatchShaderGenerator=Oi,t.BatchTextureArray=Pi,t.BitmapFont=Qa,t.BitmapFontData=Xa,t.BitmapFontLoader=ts,t.BitmapText=Ka,t.Bounds=rr,t.Buffer=tn,t.Circle=Be,t.Container=ur,t.CountLimiter=da,t.DEG_TO_RAD=ke,t.DisplayObject=or,t.Ellipse=ze,t.Extract=Bi,t.FillStyle=bo,t.Filter=Zn,t.FilterState=pn,t.Framebuffer=Hr,t.GLFramebuffer=yn,t.GLProgram=hi,t.GLTexture=vi,t.GRAPHICS_CURVES=xo,t.Geometry=sn,t.Graphics=$o,t.GraphicsData=Go,t.GraphicsGeometry=Xo,t.IGLUniformData=ci,t.InteractionData=mr,t.InteractionEvent=vr,t.InteractionManager=wr,t.InteractionTrackingData=yr,t.LineStyle=Wo,t.Loader=lo,t.LoaderResource=ao,t.MaskData=En,t.Matrix=We,t.Mesh=za,t.MeshBatchUvs=ka,t.MeshGeometry=Va,t.MeshMaterial=Ga,t.NineSlicePlane=Ws,t.ObjectRenderer=fn,t.ObservablePoint=Xe,t.PI_2=De,t.ParticleContainer=go,t.ParticleRenderer=yo,t.PlaneGeometry=zs,t.Point=He,t.Polygon=Ge,t.Prepare=Sa,t.Program=qn,t.Quad=un,t.QuadUv=ln,t.RAD_TO_DEG=Ue,t.Rectangle=je,t.RenderTexture=Qr,t.RenderTexturePool=Zr,t.Renderer=wi,t.RopeGeometry=Gs,t.RoundedRectangle=Ve,t.Runner=Tr,t.Shader=$n,t.SimpleMesh=Xs,t.SimplePlane=Hs,t.SimpleRope=Vs,t.Sprite=ta,t.SpriteMaskFilter=ti,t.Spritesheet=Pa,t.SpritesheetLoader=Ma,t.State=Qn,t.System=Gr,t.TemporaryDisplayObject=ar,t.Text=ha,t.TextMetrics=ua,t.TextStyle=ia,t.Texture=qr,t.TextureLoader=uo,t.TextureMatrix=Kn,t.TextureUvs=Wr,t.Ticker=dr,t.TickerPlugin=fr,t.TilingSprite=Ra,t.TilingSpriteRenderer=Fa,t.TimeLimiter=Aa,t.Transform=er,t.UniformGroup=hn,t.VERSION="5.3.3",t.ViewableBuffer=Mi,t.accessibleTarget=lr,t.autoDetectRenderer=Ti,t.checkMaxIfStatementsInShader=Xn,t.defaultFilterVertex=Si,t.defaultVertex=Ei,t.filters=$s,t.graphicsUtils=zo,t.groupD8=tr,t.interactiveTarget=br,t.isMobile=C,t.resources=zr,t.settings=R,t.systems=xi,t.uniformParsers=jn,t.useDeprecated=function(){var t=this;Object.defineProperties(t,{SVG_SIZE:{get:function(){return Ee(ks,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),t.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return Ee(ks,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),t.Transform}},TransformBase:{get:function(){return Ee(ks,"PIXI.TransformBase class has been removed, use PIXI.Transform"),t.Transform}},TRANSFORM_MODE:{get:function(){return Ee(ks,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return Ee(ks,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),t.Renderer}},CanvasRenderTarget:{get:function(){return Ee(ks,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),t.utils.CanvasRenderTarget}},loader:{get:function(){return Ee(ks,"PIXI.loader instance has moved to PIXI.Loader.shared"),t.Loader.shared}},FilterManager:{get:function(){return Ee(ks,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),t.systems.FilterSystem}},CanvasTinter:{get:function(){return Ee("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),t.canvasUtils}},GroupD8:{get:function(){return Ee("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),t.groupD8}}}),t.accessibility={},Object.defineProperties(t.accessibility,{AccessibilityManager:{get:function(){return Ee("5.3.0","PIXI.accessibility.AccessibilityManager moved to PIXI.AccessibilityManager"),t.AccessibilityManager}}}),t.interaction={},Object.defineProperties(t.interaction,{InteractionManager:{get:function(){return Ee("5.3.0","PIXI.interaction.InteractionManager moved to PIXI.InteractionManager"),t.InteractionManager}},InteractionData:{get:function(){return Ee("5.3.0","PIXI.interaction.InteractionData moved to PIXI.InteractionData"),t.InteractionData}},InteractionEvent:{get:function(){return Ee("5.3.0","PIXI.interaction.InteractionEvent moved to PIXI.InteractionEvent"),t.InteractionEvent}}}),t.prepare={},Object.defineProperties(t.prepare,{BasePrepare:{get:function(){return Ee("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),t.BasePrepare}},Prepare:{get:function(){return Ee("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),t.Prepare}},CanvasPrepare:{get:function(){return Ee("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),t.CanvasPrepare}}}),t.extract={},Object.defineProperties(t.extract,{Extract:{get:function(){return Ee("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),t.Extract}},CanvasExtract:{get:function(){return Ee("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),t.CanvasExtract}}}),t.extras={},Object.defineProperties(t.extras,{TilingSprite:{get:function(){return Ee(ks,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),t.TilingSprite}},TilingSpriteRenderer:{get:function(){return Ee(ks,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),t.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return Ee(ks,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),t.AnimatedSprite}},BitmapText:{get:function(){return Ee(ks,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),t.BitmapText}}}),t.TilingSprite.fromFrame=function(e,r,n){return Ee("5.3.0","TilingSprite.fromFrame is deprecated, use TilingSprite.from"),t.TilingSprite.from(e,{width:r,height:n})},t.TilingSprite.fromImage=function(e,r,n,i){return void 0===i&&(i={}),Ee("5.3.0","TilingSprite.fromImage is deprecated, use TilingSprite.from"),i&&"object"!=typeof i&&(i={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),i.width=r,i.height=n,t.TilingSprite.from(e,i)},Object.defineProperties(t.utils,{getSvgSize:{get:function(){return Ee(ks,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),t.resources.SVGResource.getSize}}}),t.mesh={},Object.defineProperties(t.mesh,{Mesh:{get:function(){return Ee(ks,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),t.SimpleMesh}},NineSlicePlane:{get:function(){return Ee(ks,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),t.NineSlicePlane}},Plane:{get:function(){return Ee(ks,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),t.SimplePlane}},Rope:{get:function(){return Ee(ks,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),t.SimpleRope}},RawMesh:{get:function(){return Ee(ks,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),t.Mesh}},CanvasMeshRenderer:{get:function(){return Ee(ks,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),t.CanvasMeshRenderer}},MeshRenderer:{get:function(){return Ee(ks,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),t.MeshRenderer}}}),t.particles={},Object.defineProperties(t.particles,{ParticleContainer:{get:function(){return Ee(ks,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),t.ParticleContainer}},ParticleRenderer:{get:function(){return Ee(ks,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),t.ParticleRenderer}}}),t.ticker={},Object.defineProperties(t.ticker,{Ticker:{get:function(){return Ee(ks,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),t.Ticker}},shared:{get:function(){return Ee(ks,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),t.Ticker.shared}}}),t.loaders={},Object.defineProperties(t.loaders,{Loader:{get:function(){return Ee(ks,"PIXI.loaders.Loader class has moved to PIXI.Loader"),t.Loader}},Resource:{get:function(){return Ee(ks,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),t.LoaderResource}},bitmapFontParser:{get:function(){return Ee(ks,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),t.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){Ee(ks,"PIXI.loaders.parseBitmapFontData function has removed")}},spritesheetParser:{get:function(){return Ee(ks,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),t.SpritesheetLoader.use}},getResourcePath:{get:function(){return Ee(ks,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),t.SpritesheetLoader.getResourcePath}}}),t.Loader.addPixiMiddleware=function(e){return Ee(ks,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),t.loaders.Loader.registerPlugin({use:e()})};var e=function(t){return"on"+t.charAt(0).toUpperCase()+t.slice(1)};Object.assign(t.Loader.prototype,{on:function(t){var r=e(t);Ee(ks,"PIXI.Loader#on is completely deprecated, use PIXI.Loader#"+r+".add")},once:function(t){var r=e(t);Ee(ks,"PIXI.Loader#once is completely deprecated, use PIXI.Loader#"+r+".once")},off:function(t){var r=e(t);Ee(ks,"PIXI.Loader#off is completely deprecated, use PIXI.Loader#"+r+".detach")}}),Object.defineProperty(t.extract,"WebGLExtract",{get:function(){return Ee(ks,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),t.Extract}}),Object.defineProperty(t.prepare,"WebGLPrepare",{get:function(){return Ee(ks,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),t.Prepare}}),t.Container.prototype._renderWebGL=function(t){Ee(ks,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(t)},t.Container.prototype.renderWebGL=function(t){Ee(ks,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(t)},t.DisplayObject.prototype.renderWebGL=function(t){Ee(ks,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(t)},t.Container.prototype.renderAdvancedWebGL=function(t){Ee(ks,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(t)},Object.defineProperties(t.settings,{TRANSFORM_MODE:{get:function(){return Ee(ks,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){Ee(ks,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var r=t.BaseTexture;r.prototype.loadSource=function(e){Ee(ks,"PIXI.BaseTexture.loadSource method has been deprecated");var r=t.resources.autoDetectResource(e);r.internal=!0,this.setResource(r),this.update()};var n=!1;Object.defineProperties(r.prototype,{hasLoaded:{get:function(){return Ee(ks,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){var t;return Ee(ks,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),null===(t=this.resource)||void 0===t?void 0:t.url},set:function(t){Ee(ks,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=t)}},source:{get:function(){return Ee(ks,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource.source},set:function(t){Ee(ks,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=t)}},premultiplyAlpha:{get:function(){return Ee("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){Ee("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}},_id:{get:function(){return n||(Ee("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),n=!0),this._batchLocation},set:function(t){this._batchLocation=t}}}),r.fromImage=function(t,e,n,i){Ee(ks,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var o={scale:i,crossorigin:e};return r.from(t,{scaleMode:n,resourceOptions:o})},r.fromCanvas=function(t,e){return Ee(ks,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),r.from(t,{scaleMode:e})},r.fromSVG=function(t,e,n,i){Ee(ks,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var o={scale:i,crossorigin:e};return r.from(t,{scaleMode:n,resourceOptions:o})},Object.defineProperties(t.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return Ee("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(t){Ee("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}}}),t.Point.prototype.copy=function(t){return Ee(ks,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(t)},t.ObservablePoint.prototype.copy=function(t){return Ee(ks,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(t)},t.Rectangle.prototype.copy=function(t){return Ee(ks,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(t)},t.Matrix.prototype.copy=function(t){return Ee(ks,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(t)},t.systems.StateSystem.prototype.setState=function(t){return Ee("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(t)},Object.assign(t.systems.FilterSystem.prototype,{getRenderTarget:function(t,e){return Ee(ks,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(null,e)},returnRenderTarget:function(t){Ee(ks,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(t)},calculateScreenSpaceMatrix:function(t){Ee(ks,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var e=t.identity(),r=this.activeState,n=r.sourceFrame,i=r.destinationFrame;return e.translate(n.x/i.width,n.y/i.height),e.scale(i.width,i.height),e},calculateNormalizedScreenSpaceMatrix:function(t){Ee(ks,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var e=this.activeState,r=e.sourceFrame,n=e.destinationFrame,i=t.identity();i.translate(r.x/n.width,r.y/n.height);var o=n.width/r.width,a=n.height/r.height;return i.scale(o,a),i}}),Object.defineProperties(t.RenderTexture.prototype,{sourceFrame:{get:function(){return Ee(ks,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return Ee(ks,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var i=function(t){function e(e,r,n,i){return Ee(ks,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!0,e,r,n,i)||this}return Us(e,t),e}(t.filters.BlurFilterPass),o=function(t){function e(e,r,n,i){return Ee(ks,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!1,e,r,n,i)||this}return Us(e,t),e}(t.filters.BlurFilterPass);Object.assign(t.filters,{BlurXFilter:i,BlurYFilter:o});var a=t.Sprite,s=t.Texture,u=t.Graphics;function l(t,e,r,n){return Ee(ks,"PIXI.Sprite."+t+" method is deprecated, use PIXI.Sprite.from"),a.from(e,{resourceOptions:{scale:n,crossorigin:r}})}function c(t,e,r,n){return Ee(ks,"PIXI.Texture."+t+" method is deprecated, use PIXI.Texture.from"),s.from(e,{resourceOptions:{scale:n,crossorigin:r}})}u.prototype.generateCanvasTexture||(u.prototype.generateCanvasTexture=function(){Ee(ks,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(u.prototype,"graphicsData",{get:function(){return Ee(ks,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),a.fromImage=l.bind(null,"fromImage"),a.fromSVG=l.bind(null,"fromSVG"),a.fromCanvas=l.bind(null,"fromCanvas"),a.fromVideo=l.bind(null,"fromVideo"),a.fromFrame=l.bind(null,"fromFrame"),s.fromImage=c.bind(null,"fromImage"),s.fromSVG=c.bind(null,"fromSVG"),s.fromCanvas=c.bind(null,"fromCanvas"),s.fromVideo=c.bind(null,"fromVideo"),s.fromFrame=c.bind(null,"fromFrame"),Object.defineProperty(t.AbstractRenderer.prototype,"autoResize",{get:function(){return Ee(ks,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(t){Ee(ks,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=t}}),Object.defineProperty(t.Renderer.prototype,"textureManager",{get:function(){return Ee(ks,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),t.utils.mixins={mixin:function(){Ee(ks,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){Ee(ks,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){Ee(ks,"PIXI.utils.mixins.performMixins function is no longer available")}},Object.defineProperty(t.BitmapText.prototype,"font",{get:function(){return Ee("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),{name:this._fontName,size:this._fontSize,tint:this._tint,align:this._align}},set:function(e){if(Ee("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),e){var r={font:e};this._upgradeStyle(r),r.fontSize=r.fontSize||t.BitmapFont.available[r.fontName].size,this._fontName=r.fontName,this._fontSize=r.fontSize,this.dirty=!0}}})},t.utils=Fe,t}({});Er.useDeprecated();
/*! (c) Andrea Giammarchi - ISC */
var Sr={};try{Sr.EventTarget=(new EventTarget).constructor}catch(t){!function(t,e){var r=t.create,n=t.defineProperty,i=o.prototype;function o(){e.set(this,r(null))}function a(t,e,r){n(t,e,{configurable:!0,writable:!0,value:r})}function s(t){var e=t.options;e&&e.once&&t.target.removeEventListener(this.type,t.listener),"function"==typeof t.listener?t.listener.call(t.target,this):t.listener.handleEvent(this)}a(i,"addEventListener",(function(t,r,n){for(var i=e.get(this),o=i[t]||(i[t]=[]),a=0,s=o.length;a<s;a++)if(o[a].listener===r)return;o.push({target:this,listener:r,options:n})})),a(i,"dispatchEvent",(function(t){var r=e.get(this)[t.type];return r&&(a(t,"target",this),a(t,"currentTarget",this),r.slice(0).forEach(s,t),delete t.currentTarget,delete t.target),!0})),a(i,"removeEventListener",(function(t,r){for(var n=e.get(this),i=n[t]||(n[t]=[]),o=0,a=i.length;o<a;o++)if(i[o].listener===r)return void i.splice(o,1)})),Sr.EventTarget=o}(Object,new WeakMap)}var Ar=Sr.EventTarget;let Pr=window.PIXI=Object.assign({},Er);const Mr={};class Ir extends Ar{constructor(t){super(),this.screen=t}_onDragStart(t){this.data=t.data,this.dragging=!0,this.dragRelFrom=t.data.getLocalPosition(this.obj)}_onDragEnd(){this.screen&&(this.obj,this.screen.width,this.screen.height),this.dragging=!1,this.data=null}_onDragMove(){if(this.dragging){const t=this.data.getLocalPosition(this.obj.parent);this.obj.position.x=t.x-this.dragRelFrom.x,this.obj.position.y=t.y-this.dragRelFrom.y,this.dispatchEvent(new CustomEvent("dragmove",{x:this.obj.position.x,y:this.obj.position.y}))}}makeDraggable(t,e){this.obj=t,this.handleObj=e||t,this.obj.interactive=!0,this.handleObj.on("pointerdown",this._onDragStart.bind(this)).on("pointerup",this._onDragEnd.bind(this)).on("pointerupoutside",this._onDragEnd.bind(this)).on("pointermove",this._onDragMove.bind(this))}}function Or(t,e,r){r=r||16711680;const n=new Pr.Sprite(Pr.Texture.WHITE);return n.tint=r,n.factor=1,n.anchor.set(.5),n.position.set(t,e),n}class Cr{constructor(t,e,r,n){this.markerColor=16711680,this.graphics=t,this.renderer=e,this.screen=r,"boolean"!=typeof n&&(n=!0),this.width=t.width,this.height=t.height,this.renderTexture=Pr.RenderTexture.create(this.width,this.height),this.render(),this.sprite=new Pr.projection.Sprite2d(this.renderTexture),this.sprite.interactive=!0,this.group=new Pr.Container,this.group.addChild(this.sprite),this.handleMarkers=[Or(0,0,this.markerColor),Or(this.width,0,this.markerColor),Or(this.width,this.height,this.markerColor),Or(0,this.height,this.markerColor)],this.handleMarkers.forEach((t=>{const e=new Ir(this.screen);e.makeDraggable(t),e.addEventListener("dragmove",(()=>{this.drawBorder()})),this.group.addChild(t),t.visible=n})),this.markerPositions=this.handleMarkers.map((t=>t.position)),this.borderMarker=new Pr.Graphics,this.group.addChild(this.borderMarker),n&&this.drawBorder()}get x(){return this.group.x}set x(t){this.group.x=t}get y(){return this.group.y}set y(t){this.group.y=t}setOffset(t,e,r,n){this.handleMarkers[0].x+=!!t&&(t[0]||0),this.handleMarkers[0].y+=!!t&&(t[1]||0),this.handleMarkers[1].x+=!!e&&(e[0]||0),this.handleMarkers[1].y+=!!e&&(e[1]||0),this.handleMarkers[2].x+=!!r&&(r[0]||0),this.handleMarkers[2].y+=!!r&&(r[1]||0),this.handleMarkers[3].x+=!!n&&(n[0]||0),this.handleMarkers[3].y+=!!n&&(n[1]||0),this.update()}render(){this.renderer.render(this.graphics,this.renderTexture)}drawBorder(){this.borderMarker.clear(),this.borderMarker.lineStyle(1,this.markerColor),this.borderMarker.moveTo(this.markerPositions[0].x,this.markerPositions[0].y),this.markerPositions.forEach(((t,e)=>{const r=(e+1)%this.markerPositions.length,{x:n,y:i}=this.markerPositions[r];this.borderMarker.lineTo(n,i),this.borderMarker.moveTo(n,i)}))}update(){this.sprite.proj.mapSprite(this.sprite,this.markerPositions),this.render()}showHelper(t){t?this.drawBorder():this.borderMarker.clear(),this.handleMarkers.forEach((e=>{e.visible=t}))}}var Rr,Lr;Rr=Fr||(Fr={}),(Lr=Rr.utils||(Rr.utils={})).getIntersectionFactor=function(t,e,r,n,i){var o=e.x-t.x,a=r.x-n.x,s=r.x-t.x,u=e.y-t.y,l=r.y-n.y,c=r.y-t.y,h=o*l-u*a;if(Math.abs(h)<1e-7)return i.x=o,i.y=u,0;var p=(s*l-c*a)/h,d=(o*c-u*s)/h;return d<1e-6||d-1>-1e-6?-1:(i.x=t.x+p*(e.x-t.x),i.y=t.y+p*(e.y-t.y),1)},Lr.getPositionFromQuad=function(t,e,r){r=r||new PIXI.Point;var n=1-e.x,i=1-n,o=1-e.y,a=1-o;return r.x=(t[0].x*n+t[1].x*i)*o+(t[3].x*n+t[2].x*i)*a,r.y=(t[0].y*n+t[1].y*i)*o+(t[3].y*n+t[2].y*i)*a,r},PIXI.projection=Fr,function(t){var e,r=function(){function t(t,e){void 0===e&&(e=!0),this._enabled=!1,this.legacy=t,e&&(this.enabled=!0),this.legacy.proj=this}return Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),t.prototype.clear=function(){},t}();t.AbstractProjection=r,(e=t.TRANSFORM_STEP||(t.TRANSFORM_STEP={}))[e.NONE=0]="NONE",e[e.BEFORE_PROJ=4]="BEFORE_PROJ",e[e.PROJ=5]="PROJ",e[e.ALL=9]="ALL"}(Fr||(Fr={}));var Nr,Fr,Dr=(Nr=function(t,e){return(Nr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}Nr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function Ur(t){let e;const r=t[12].default,n=u(r,t,t[11],null);return{c(){n&&n.c()},m(t,r){n&&n.m(t,r),e=!0},p(t,e){n&&n.p&&2048&e&&c(n,r,t,t[11],e,null,null)},i(t){e||(Y(n,t),e=!0)},o(t){q(n,t),e=!1},d(t){n&&n.d(t)}}}function kr(t){let e,r,n=t[0]&&Ur(t);return{c(){n&&n.c(),e=b()},m(t,i){n&&n.m(t,i),d(t,e,i),r=!0},p(t,[r]){t[0]?n?(n.p(t,r),1&r&&Y(n,1)):(n=Ur(t),n.c(),Y(n,1),n.m(e.parentNode,e)):n&&(X(),q(n,1,1,(()=>{n=null})),W())},i(t){r||(Y(n),r=!0)},o(t){q(n),r=!1},d(t){n&&n.d(t),t&&f(e)}}}function jr(t,e,r){let n,i,{$$slots:o={},$$scope:a}=e,{width:u}=e,{height:l}=e,{editMode:c=!1}=e,{canvas:h}=e,{status:p="loaded"}=e;console.log("Screen",{status:p});let d=null,f=!1,m=!1,g=!1;const v=nt((()=>!1)),y=nt([]),x={editMode:nt(!1),sketchWrapperDestructor:v,destructors:y};var b,_;return s(t,y,(t=>r(14,n=t))),s(t,v,(t=>r(15,i=t))),b=Mr,_={getApp:()=>d,pixiStore:x},M().$$.context.set(b,_),I((()=>(r(9,f=!0),()=>{n.forEach((t=>t())),i()&&d.destroy(),r(0,g=!1),r(3,p="destroyed"),console.log("Screen",{status:p})}))),t.$$set=t=>{"width"in t&&r(4,u=t.width),"height"in t&&r(5,l=t.height),"editMode"in t&&r(6,c=t.editMode),"canvas"in t&&r(7,h=t.canvas),"status"in t&&r(3,p=t.status),"$$scope"in t&&r(11,a=t.$$scope)},t.$$.update=()=>{64&t.$$.dirty&&x.editMode.set(c),176&t.$$.dirty&&h&&(d=new Pr.Application({view:h,width:u,height:l,transparent:!0,resolution:window.devicePixelRatio||1}),r(10,m=!0)),1544&t.$$.dirty&&f&&m&&(r(3,p="initialized"),console.log("Screen",{status:p}),r(0,g=!0))},[g,v,y,p,u,l,c,h,function(){return h},f,m,a,o]}!function(t){function e(t){var e=this.proj,r=this,n=t._worldID,i=r.localTransform,o=e.scaleAfterAffine&&e.affine>=2;r._localID!==r._currentLocalID&&(o?(i.a=r._cx,i.b=r._sx,i.c=r._cy,i.d=r._sy,i.tx=r.position._x,i.ty=r.position._y):(i.a=r._cx*r.scale._x,i.b=r._sx*r.scale._x,i.c=r._cy*r.scale._y,i.d=r._sy*r.scale._y,i.tx=r.position._x-(r.pivot._x*i.a+r.pivot._y*i.c),i.ty=r.position._y-(r.pivot._x*i.b+r.pivot._y*i.d)),r._currentLocalID=r._localID,e._currentProjID=-1);var a=e._projID;if(e._currentProjID!==a&&(e._currentProjID=a,e.updateLocalTransform(i),r._parentID=-1),r._parentID!==n){var s=t.proj;s&&!s._affine?e.world.setToMult(s.world,e.local):e.world.setToMultLegacy(t.worldTransform,e.local);var u=r.worldTransform;e.world.copyTo(u,e._affine,e.affinePreserveOrientation),o&&(u.a*=r.scale._x,u.b*=r.scale._x,u.c*=r.scale._y,u.d*=r.scale._y,u.tx-=r.pivot._x*u.a+r.pivot._y*u.c,u.ty-=r.pivot._x*u.b+r.pivot._y*u.d),r._parentID=n,r._worldID++}}var r=function(r){function n(){var e=null!==r&&r.apply(this,arguments)||this;return e._projID=0,e._currentProjID=-1,e._affine=t.AFFINE.NONE,e.affinePreserveOrientation=!1,e.scaleAfterAffine=!0,e}return Dr(n,r),n.prototype.updateLocalTransform=function(t){},Object.defineProperty(n.prototype,"affine",{get:function(){return this._affine},set:function(t){this._affine!=t&&(this._affine=t,this._currentProjID=-1,this.legacy._currentLocalID=-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"enabled",{set:function(t){t!==this._enabled&&(this._enabled=t,t?(this.legacy.updateTransform=e,this.legacy._parentID=-1):(this.legacy.updateTransform=PIXI.Transform.prototype.updateTransform,this.legacy._parentID=-1))},enumerable:!0,configurable:!0}),n.prototype.clear=function(){this._currentProjID=-1,this._projID=0},n}(t.AbstractProjection);t.LinearProjection=r}(Fr||(Fr={})),function(t){var e=PIXI.TYPES,r=PIXI.utils.premultiplyTint,n=function(t){function r(r){void 0===r&&(r=!1);var n=t.call(this)||this;return n._buffer=new PIXI.Buffer(null,r,!1),n._indexBuffer=new PIXI.Buffer(null,r,!0),n.addAttribute("aVertexPosition",n._buffer,3,!1,e.FLOAT).addAttribute("aTextureCoord",n._buffer,2,!1,e.FLOAT).addAttribute("aColor",n._buffer,4,!0,e.UNSIGNED_BYTE).addAttribute("aTextureId",n._buffer,1,!0,e.FLOAT).addIndex(n._indexBuffer),n}return Dr(r,t),r}(PIXI.Geometry);t.Batch3dGeometry=n;var i=function(){function t(){}return t.create=function(t){var e=Object.assign({vertex:"precision highp float;\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n\tgl_Position.xyw = projectionMatrix * aVertexPosition;\n\tgl_Position.z = 0.0;\n\n\tvTextureCoord = aTextureCoord;\n\tvTextureId = aTextureId;\n\tvColor = aColor;\n}\n",fragment:"\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\nvec4 color;\n%forloop%\ngl_FragColor = color * vColor;\n}",geometryClass:n,vertexSize:7},t),i=e.vertex,o=e.fragment,a=e.vertexSize,s=e.geometryClass;return function(t){function e(e){var r=t.call(this,e)||this;return r.shaderGenerator=new PIXI.BatchShaderGenerator(i,o),r.geometryClass=s,r.vertexSize=a,r}return Dr(e,t),e.prototype.packInterleavedGeometry=function(t,e,n,i,o){var a=e.uint32View,s=e.float32View,u=i/this.vertexSize,l=t.uvs,c=t.indices,h=t.vertexData,p=t.vertexData2d,d=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),m=f<1&&t._texture.baseTexture.alphaMode?r(t._tintRGB,f):t._tintRGB+(255*f<<24);if(p)for(var g=0,v=0;v<p.length;v+=3,g+=2)s[i++]=p[v],s[i++]=p[v+1],s[i++]=p[v+2],s[i++]=l[g],s[i++]=l[g+1],a[i++]=m,s[i++]=d;else for(v=0;v<h.length;v+=2)s[i++]=h[v],s[i++]=h[v+1],s[i++]=1,s[i++]=l[v],s[i++]=l[v+1],a[i++]=m,s[i++]=d;for(v=0;v<c.length;v++)n[o++]=u+c[v]},e}(PIXI.AbstractBatchRenderer)},t}();t.Batch2dPluginFactory=i,PIXI.Renderer.registerPlugin("batch2d",i.create({}))}(Fr||(Fr={})),function(t){var e=PIXI.AbstractBatchRenderer,r=PIXI.utils.premultiplyBlendMode,n=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.forceMaxTextures=0,e.defUniforms={},e}return Dr(n,t),n.prototype.getUniforms=function(t){return this.defUniforms},n.prototype.syncUniforms=function(t){if(t){var e=this._shader;for(var r in t)e.uniforms[r]=t[r]}},n.prototype.buildDrawCalls=function(t,n,i){var o=this,a=this,s=a._bufferedElements,u=a._attributeBuffer,l=a._indexBuffer,c=a.vertexSize,h=e._drawCallPool,p=this._dcIndex,d=this._aIndex,f=this._iIndex,m=h[p];m.start=this._iIndex,m.texArray=t;for(var g=n;g<i;++g){var v=s[g],y=v._texture.baseTexture,x=r[y.alphaMode?1:0][v.blendMode],b=this.getUniforms(v);s[g]=null,n<g&&(m.blend!==x||m.uniforms!==b)&&(m.size=f-m.start,n=g,(m=h[++p]).texArray=t,m.start=f),this.packInterleavedGeometry(v,u,l,d,f),d+=v.vertexData.length/2*c,f+=v.indices.length,m.blend=x,m.uniforms=b}n<i&&(m.size=f-m.start,++p),o._dcIndex=p,o._aIndex=d,o._iIndex=f},n.prototype.drawBatches=function(){for(var t=this._dcIndex,r=this.renderer,n=r.gl,i=r.state,o=r.shader,a=e._drawCallPool,s=null,u=null,l=0;l<t;l++){var c=a[l],h=c.texArray,p=c.type,d=c.size,f=c.start,m=c.blend,g=c.uniforms;u!==h&&(u=h,this.bindAndClearTexArray(h)),s!==g&&(s=g,this.syncUniforms(g),o.syncUniformGroup(this._shader.uniformGroup)),this.state.blendMode=m,i.set(this.state),n.drawElements(p,d,n.UNSIGNED_SHORT,2*f)}},n.prototype.contextChange=function(){if(!this.forceMaxTextures)return t.prototype.contextChange.call(this),void this.syncUniforms(this.defUniforms);this.renderer.gl;var e=this;e.MAX_TEXTURES=this.forceMaxTextures,this._shader=e.shaderGenerator.generateShader(this.MAX_TEXTURES),this.syncUniforms(this.defUniforms);for(var r=0;r<e._packedGeometryPoolSize;r++)e._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},n}(e);t.UniformBatchRenderer=n}(Fr||(Fr={})),function(t){var e=[new PIXI.Point,new PIXI.Point,new PIXI.Point,new PIXI.Point],r=[0,0,0,0],n=function(){function t(){this.surfaceID="default",this._updateID=0,this.vertexSrc="",this.fragmentSrc=""}return t.prototype.fillUniforms=function(t){},t.prototype.clear=function(){},t.prototype.boundsQuad=function(t,n,i){for(var o=n[0],a=n[1],s=n[0],u=n[1],l=2;l<8;l+=2)o>n[l]&&(o=n[l]),s<n[l]&&(s=n[l]),a>n[l+1]&&(a=n[l+1]),u<n[l+1]&&(u=n[l+1]);if(e[0].set(o,a),this.apply(e[0],e[0]),e[1].set(s,a),this.apply(e[1],e[1]),e[2].set(s,u),this.apply(e[2],e[2]),e[3].set(o,u),this.apply(e[3],e[3]),i)i.apply(e[0],e[0]),i.apply(e[1],e[1]),i.apply(e[2],e[2]),i.apply(e[3],e[3]),n[0]=e[0].x,n[1]=e[0].y,n[2]=e[1].x,n[3]=e[1].y,n[4]=e[2].x,n[5]=e[2].y,n[6]=e[3].x,n[7]=e[3].y;else{for(l=1;l<=3;l++)if(e[l].y<e[0].y||e[l].y==e[0].y&&e[l].x<e[0].x){var c=e[0];e[0]=e[l],e[l]=c}for(l=1;l<=3;l++)r[l]=Math.atan2(e[l].y-e[0].y,e[l].x-e[0].x);for(l=1;l<=3;l++)for(var h=l+1;h<=3;h++)if(r[l]>r[h]){c=e[l];e[l]=e[h],e[h]=c;var p=r[l];r[l]=r[h],r[h]=p}if(n[0]=e[0].x,n[1]=e[0].y,n[2]=e[1].x,n[3]=e[1].y,n[4]=e[2].x,n[5]=e[2].y,n[6]=e[3].x,n[7]=e[3].y,(e[3].x-e[2].x)*(e[1].y-e[2].y)-(e[1].x-e[2].x)*(e[3].y-e[2].y)<0)return n[4]=e[3].x,void(n[5]=e[3].y)}},t}();t.Surface=n}(Fr||(Fr={})),function(t){var e=new PIXI.Matrix,r=new PIXI.Rectangle,n=new PIXI.Point,i=function(t){function i(){var e=t.call(this)||this;return e.distortion=new PIXI.Point,e}return Dr(i,t),i.prototype.clear=function(){this.distortion.set(0,0)},i.prototype.apply=function(t,e){e=e||new PIXI.Point;var r=this.distortion,n=t.x*t.y;return e.x=t.x+r.x*n,e.y=t.y+r.y*n,e},i.prototype.applyInverse=function(t,e){e=e||new PIXI.Point;var r=t.x,n=t.y,i=this.distortion.x,o=this.distortion.y;if(0==i)e.x=r,e.y=n/(1+o*r);else if(0==o)e.y=n,e.x=r/(1+i*n);else{var a=.5*(n*i-r*o+1)/o,s=a*a+r/o;if(s<=1e-5)return e.set(NaN,NaN),e;e.x=o>0?-a+Math.sqrt(s):-a-Math.sqrt(s),e.y=(r/e.x-1)/i}return e},i.prototype.mapSprite=function(t,e,n){var i=t.texture;return r.x=-t.anchor.x*i.orig.width,r.y=-t.anchor.y*i.orig.height,r.width=i.orig.width,r.height=i.orig.height,this.mapQuad(r,e,n||t.transform)},i.prototype.mapQuad=function(t,r,i){var o=-t.x/t.width,a=-t.y/t.height,s=(1-t.x)/t.width,u=(1-t.y)/t.height,l=r[0].x*(1-o)+r[1].x*o,c=r[0].y*(1-o)+r[1].y*o,h=r[0].x*(1-s)+r[1].x*s,p=r[0].y*(1-s)+r[1].y*s,d=r[3].x*(1-o)+r[2].x*o,f=r[3].y*(1-o)+r[2].y*o,m=r[3].x*(1-s)+r[2].x*s,g=r[3].y*(1-s)+r[2].y*s,v=l*(1-a)+d*a,y=c*(1-a)+f*a,x=h*(1-a)+m*a,b=p*(1-a)+g*a,_=l*(1-u)+d*u,w=c*(1-u)+f*u,T=h*(1-u)+m*u,E=p*(1-u)+g*u,S=e;return S.tx=v,S.ty=y,S.a=x-v,S.b=b-y,S.c=_-v,S.d=w-y,n.set(T,E),S.applyInverse(n,n),this.distortion.set(n.x-1,n.y-1),i.setFromMatrix(S),this},i.prototype.fillUniforms=function(t){t.distortion=t.distortion||new Float32Array([0,0,0,0]);var e=Math.abs(this.distortion.x),r=Math.abs(this.distortion.y);t.distortion[0]=1e4*e<=r?0:this.distortion.x,t.distortion[1]=1e4*r<=e?0:this.distortion.y,t.distortion[2]=1/t.distortion[0],t.distortion[3]=1/t.distortion[1]},i}(t.Surface);t.BilinearSurface=i}(Fr||(Fr={})),function(t){var e=function(e){function r(){var r=e.call(this)||this;return r.proj=new t.ProjectionSurface(r.transform),r}return Dr(r,e),Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj},enumerable:!0,configurable:!0}),r}(PIXI.Container);t.Container2s=e}(Fr||(Fr={})),function(t){var e=PIXI.Transform.prototype.updateTransform;function r(t){var r=this.proj,n=t.proj;return n?n._surface?(r._activeProjection=n,this.updateLocalTransform(),this.localTransform.copyTo(this.worldTransform),void(this._parentID<0&&++this._worldID)):(e.call(this,t),void(r._activeProjection=n._activeProjection)):(e.call(this,t),void(r._activeProjection=null))}var n=function(e){function n(t,r){var n=e.call(this,t,r)||this;return n._surface=null,n._activeProjection=null,n._currentSurfaceID=-1,n._currentLegacyID=-1,n._lastUniforms=null,n}return Dr(n,e),Object.defineProperty(n.prototype,"enabled",{set:function(t){t!==this._enabled&&(this._enabled=t,t?(this.legacy.updateTransform=r,this.legacy._parentID=-1):(this.legacy.updateTransform=PIXI.Transform.prototype.updateTransform,this.legacy._parentID=-1))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"surface",{get:function(){return this._surface},set:function(t){this._surface!=t&&(this._surface=t||null,this.legacy._parentID=-1)},enumerable:!0,configurable:!0}),n.prototype.applyPartial=function(t,e){return null!==this._activeProjection?(e=this.legacy.worldTransform.apply(t,e),this._activeProjection.surface.apply(e,e)):null!==this._surface?this.surface.apply(t,e):this.legacy.worldTransform.apply(t,e)},n.prototype.apply=function(t,e){return null!==this._activeProjection?(e=this.legacy.worldTransform.apply(t,e),this._activeProjection.surface.apply(e,e),this._activeProjection.legacy.worldTransform.apply(e,e)):null!==this._surface?(e=this.surface.apply(t,e),this.legacy.worldTransform.apply(e,e)):this.legacy.worldTransform.apply(t,e)},n.prototype.applyInverse=function(t,e){return null!==this._activeProjection?(e=this._activeProjection.legacy.worldTransform.applyInverse(t,e),this._activeProjection._surface.applyInverse(e,e),this.legacy.worldTransform.applyInverse(e,e)):null!==this._surface?(e=this.legacy.worldTransform.applyInverse(t,e),this._surface.applyInverse(e,e)):this.legacy.worldTransform.applyInverse(t,e)},n.prototype.mapBilinearSprite=function(e,r){this._surface instanceof t.BilinearSurface||(this.surface=new t.BilinearSurface),this.surface.mapSprite(e,r,this.legacy)},n.prototype.clear=function(){this.surface&&this.surface.clear()},Object.defineProperty(n.prototype,"uniforms",{get:function(){return this._currentLegacyID===this.legacy._worldID&&this._currentSurfaceID===this.surface._updateID||(this._lastUniforms=this._lastUniforms||{},this._lastUniforms.translationMatrix=this.legacy.worldTransform,this._surface.fillUniforms(this._lastUniforms)),this._lastUniforms},enumerable:!0,configurable:!0}),n}(t.AbstractProjection);t.ProjectionSurface=n}(Fr||(Fr={})),function(t){var e=PIXI.TYPES,r=PIXI.utils.premultiplyTint,n=function(t){function r(r){void 0===r&&(r=!1);var n=t.call(this)||this;return n._buffer=new PIXI.Buffer(null,r,!1),n._indexBuffer=new PIXI.Buffer(null,r,!0),n.addAttribute("aVertexPosition",n._buffer,2,!1,e.FLOAT).addAttribute("aTrans1",n._buffer,3,!1,e.FLOAT).addAttribute("aTrans2",n._buffer,3,!1,e.FLOAT).addAttribute("aSamplerSize",n._buffer,2,!1,e.FLOAT).addAttribute("aFrame",n._buffer,4,!1,e.FLOAT).addAttribute("aColor",n._buffer,4,!0,e.UNSIGNED_BYTE).addAttribute("aTextureId",n._buffer,1,!0,e.FLOAT).addIndex(n._indexBuffer),n}return Dr(r,t),r}(PIXI.Geometry);t.BatchBilineardGeometry=n;var i=function(){function e(){}return e.create=function(e){var i=Object.assign({vertex:"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec3 aTrans1;\nattribute vec3 aTrans2;\nattribute vec2 aSamplerSize;\nattribute vec4 aFrame;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nvarying vec2 vertexPosition;\nvarying vec3 vTrans1;\nvarying vec3 vTrans2;\nvarying vec2 vSamplerSize;\nvarying vec4 vFrame;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n\tgl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);\n\tgl_Position.z = 0.0;\n\n\tvertexPosition = aVertexPosition;\n\tvTrans1 = aTrans1;\n\tvTrans2 = aTrans2;\n\tvTextureId = aTextureId;\n\tvColor = aColor;\n\tvSamplerSize = aSamplerSize;\n\tvFrame = aFrame;\n}\n",fragment:"precision highp float;\nvarying vec2 vertexPosition;\nvarying vec3 vTrans1;\nvarying vec3 vTrans2;\nvarying vec2 vSamplerSize;\nvarying vec4 vFrame;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nuniform sampler2D uSamplers[%count%];\nuniform vec4 distortion;\n\nvoid main(void){\nvec2 surface;\nvec2 surface2;\n\nfloat vx = vertexPosition.x;\nfloat vy = vertexPosition.y;\nfloat dx = distortion.x;\nfloat dy = distortion.y;\nfloat revx = distortion.z;\nfloat revy = distortion.w;\n\nif (distortion.x == 0.0) {\n\tsurface.x = vx;\n\tsurface.y = vy / (1.0 + dy * vx);\n\tsurface2 = surface;\n} else\nif (distortion.y == 0.0) {\n\tsurface.y = vy;\n\tsurface.x = vx / (1.0 + dx * vy);\n\tsurface2 = surface;\n} else {\n\tfloat c = vy * dx - vx * dy;\n\tfloat b = (c + 1.0) * 0.5;\n\tfloat b2 = (-c + 1.0) * 0.5;\n\tfloat d = b * b + vx * dy;\n\tif (d < -0.00001) {\n\t    discard;\n\t}\n\td = sqrt(max(d, 0.0));\n\tsurface.x = (- b + d) * revy;\n\tsurface2.x = (- b - d) * revy;\n\tsurface.y = (- b2 + d) * revx;\n\tsurface2.y = (- b2 - d) * revx;\n}\n\nvec2 uv;\nuv.x = vTrans1.x * surface.x + vTrans1.y * surface.y + vTrans1.z;\nuv.y = vTrans2.x * surface.x + vTrans2.y * surface.y + vTrans2.z;\n\nvec2 pixels = uv * vSamplerSize;\n\nif (pixels.x < vFrame.x || pixels.x > vFrame.z ||\n\tpixels.y < vFrame.y || pixels.y > vFrame.w) {\n\tuv.x = vTrans1.x * surface2.x + vTrans1.y * surface2.y + vTrans1.z;\n\tuv.y = vTrans2.x * surface2.x + vTrans2.y * surface2.y + vTrans2.z;\n\tpixels = uv * vSamplerSize;\n\n   if (pixels.x < vFrame.x || pixels.x > vFrame.z ||\n       pixels.y < vFrame.y || pixels.y > vFrame.w) {\n       discard;\n   }\n}\n\nvec4 edge;\nedge.xy = clamp(pixels - vFrame.xy + 0.5, vec2(0.0, 0.0), vec2(1.0, 1.0));\nedge.zw = clamp(vFrame.zw - pixels + 0.5, vec2(0.0, 0.0), vec2(1.0, 1.0));\n\nfloat alpha = 1.0; //edge.x * edge.y * edge.z * edge.w;\nvec4 rColor = vColor * alpha;\n\nfloat textureId = floor(vTextureId+0.5);\nvec2 vTextureCoord = uv;\nvec4 color;\n%forloop%\ngl_FragColor = color * rColor;\n}",geometryClass:n,vertexSize:16},e),o=i.vertex,a=i.fragment,s=i.vertexSize,u=i.geometryClass;return function(t){function e(e){var r=t.call(this,e)||this;return r.defUniforms={translationMatrix:new PIXI.Matrix,distortion:new Float32Array([0,0,1/0,1/0])},r.size=1e3,r.forceMaxTextures=1,r.shaderGenerator=new PIXI.BatchShaderGenerator(o,a),r.geometryClass=u,r.vertexSize=s,r}return Dr(e,t),e.prototype.getUniforms=function(t){var e=t.proj;return null!==e.surface?e.uniforms:null!==e._activeProjection?e._activeProjection.uniforms:this.defUniforms},e.prototype.packInterleavedGeometry=function(t,e,n,i,o){for(var a=e.uint32View,s=e.float32View,u=i/this.vertexSize,l=t.indices,c=t.vertexData,h=t._texture._frame,p=t.aTrans,d=t._texture.baseTexture,f=d._batchLocation,m=d.realWidth,g=d.realHeight,v=d.resolution,y=Math.min(t.worldAlpha,1),x=y<1&&t._texture.baseTexture.alphaMode?r(t._tintRGB,y):t._tintRGB+(255*y<<24),b=0;b<c.length;b+=2)s[i]=c[b],s[i+1]=c[b+1],s[i+2]=p.a,s[i+3]=p.c,s[i+4]=p.tx,s[i+5]=p.b,s[i+6]=p.d,s[i+7]=p.ty,s[i+8]=m,s[i+9]=g,s[i+10]=h.x*v,s[i+11]=h.y*v,s[i+12]=(h.x+h.width)*v,s[i+13]=(h.y+h.height)*v,a[i+14]=x,s[i+15]=f,i+=16;for(b=0;b<l.length;b++)n[o++]=u+l[b]},e}(t.UniformBatchRenderer)},e}();t.BatchBilinearPluginFactory=i,PIXI.Renderer.registerPlugin("batch_bilinear",i.create({}))}(Fr||(Fr={})),function(t){var e=function(e){function r(r){var n=e.call(this,r)||this;return n.aTrans=new PIXI.Matrix,n.proj=new t.ProjectionSurface(n.transform),n.pluginName="batch_bilinear",n}return Dr(r,e),r.prototype._calculateBounds=function(){this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)},r.prototype.calculateVertices=function(){var t=this.transform._worldID,e=this._texture._updateID;if(this._transformID!==t||this._textureID!==e){this._transformID=t,this._textureID=e;var r=this._texture,n=this.vertexData,i=r.trim,o=r.orig,a=this._anchor,s=0,u=0,l=0,c=0;if(i?(s=(u=i.x-a._x*o.width)+i.width,l=(c=i.y-a._y*o.height)+i.height):(s=(u=-a._x*o.width)+o.width,l=(c=-a._y*o.height)+o.height),this.proj._surface)n[0]=u,n[1]=c,n[2]=s,n[3]=c,n[4]=s,n[5]=l,n[6]=u,n[7]=l,this.proj._surface.boundsQuad(n,n);else{var h=this.transform.worldTransform,p=h.a,d=h.b,f=h.c,m=h.d,g=h.tx,v=h.ty;n[0]=p*u+f*c+g,n[1]=m*c+d*u+v,n[2]=p*s+f*c+g,n[3]=m*c+d*s+v,n[4]=p*s+f*l+g,n[5]=m*l+d*s+v,n[6]=p*u+f*l+g,n[7]=m*l+d*u+v,this.proj._activeProjection&&this.proj._activeProjection.surface.boundsQuad(n,n)}r.uvMatrix||(r.uvMatrix=new PIXI.TextureMatrix(r)),r.uvMatrix.update();var y=this.aTrans;y.set(o.width,0,0,o.height,u,c),null===this.proj._surface&&y.prepend(this.transform.worldTransform),y.invert(),y.prepend(r.uvMatrix.mapCoord)}},r.prototype.calculateTrimmedVertices=function(){var t=this.transform._worldID,e=this._texture._updateID;if(this.vertexTrimmedData){if(this._transformTrimmedID===t&&this._textureTrimmedID===e)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=t,this._textureTrimmedID=e;var r=this._texture,n=this.vertexTrimmedData,i=r.orig,o=this._anchor,a=-o._x*i.width,s=a+i.width,u=-o._y*i.height,l=u+i.height;if(this.proj._surface)n[0]=a,n[1]=u,n[2]=s,n[3]=u,n[4]=s,n[5]=l,n[6]=a,n[7]=l,this.proj._surface.boundsQuad(n,n,this.transform.worldTransform);else{var c=this.transform.worldTransform,h=c.a,p=c.b,d=c.c,f=c.d,m=c.tx,g=c.ty;n[0]=h*a+d*u+m,n[1]=f*u+p*a+g,n[2]=h*s+d*u+m,n[3]=f*u+p*s+g,n[4]=h*s+d*l+m,n[5]=f*l+p*s+g,n[6]=h*a+d*l+m,n[7]=f*l+p*a+g,this.proj._activeProjection&&this.proj._activeProjection.surface.boundsQuad(n,n,this.proj._activeProjection.legacy.worldTransform)}},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj},enumerable:!0,configurable:!0}),r}(PIXI.Sprite);t.Sprite2s=e}(Fr||(Fr={})),function(t){var e=function(e){function r(r,n,i){var o=e.call(this,r,n,i)||this;return o.aTrans=new PIXI.Matrix,o.proj=new t.ProjectionSurface(o.transform),o.pluginName="batch_bilinear",o}return Dr(r,e),Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj},enumerable:!0,configurable:!0}),r}(PIXI.Text);t.Text2s=e,e.prototype.calculateVertices=t.Sprite2s.prototype.calculateVertices,e.prototype.calculateTrimmedVertices=t.Sprite2s.prototype.calculateTrimmedVertices,e.prototype._calculateBounds=t.Sprite2s.prototype._calculateBounds}(Fr||(Fr={})),function(t){PIXI.Sprite.prototype.convertTo2s=function(){this.proj||(this.pluginName="sprite_bilinear",this.aTrans=new PIXI.Matrix,this.calculateVertices=t.Sprite2s.prototype.calculateVertices,this.calculateTrimmedVertices=t.Sprite2s.prototype.calculateTrimmedVertices,this._calculateBounds=t.Sprite2s.prototype._calculateBounds,PIXI.Container.prototype.convertTo2s.call(this))},PIXI.Container.prototype.convertTo2s=function(){this.proj||(this.proj=new t.Projection2d(this.transform),Object.defineProperty(this,"worldTransform",{get:function(){return this.proj},enumerable:!0,configurable:!0}))},PIXI.Container.prototype.convertSubtreeTo2s=function(){this.convertTo2s();for(var t=0;t<this.children.length;t++)this.children[t].convertSubtreeTo2s()}}(Fr||(Fr={})),function(t){t.container2dWorldTransform=function(){return this.proj.affine?this.transform.worldTransform:this.proj.world};var e=function(e){function r(){var r=e.call(this)||this;return r.proj=new t.Projection2d(r.transform),r}return Dr(r,e),r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),r&&(e=r.toGlobal(e,n,i)),i||this._recursivePostUpdateTransform(),o>=t.TRANSFORM_STEP.PROJ?(i||this.displayObjectUpdateTransform(),this.proj.affine?this.transform.worldTransform.applyInverse(e,n):this.proj.world.applyInverse(e,n)):(this.parent?n=this.parent.worldTransform.applyInverse(e,n):n.copyFrom(e),o===t.TRANSFORM_STEP.NONE?n:this.transform.localTransform.applyInverse(n,n))},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r}(PIXI.Container);t.Container2d=e,t.container2dToLocal=e.prototype.toLocal}(Fr||(Fr={})),function(t){var e,r,n=PIXI.Point,i=[1,0,0,0,1,0,0,0,1];(r=e=t.AFFINE||(t.AFFINE={}))[r.NONE=0]="NONE",r[r.FREE=1]="FREE",r[r.AXIS_X=2]="AXIS_X",r[r.AXIS_Y=3]="AXIS_Y",r[r.POINT=4]="POINT",r[r.AXIS_XR=5]="AXIS_XR";var o=function(){function t(t){this.floatArray=null,this.mat3=new Float64Array(t||i)}return Object.defineProperty(t.prototype,"a",{get:function(){return this.mat3[0]/this.mat3[8]},set:function(t){this.mat3[0]=t*this.mat3[8]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.mat3[1]/this.mat3[8]},set:function(t){this.mat3[1]=t*this.mat3[8]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"c",{get:function(){return this.mat3[3]/this.mat3[8]},set:function(t){this.mat3[3]=t*this.mat3[8]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"d",{get:function(){return this.mat3[4]/this.mat3[8]},set:function(t){this.mat3[4]=t*this.mat3[8]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tx",{get:function(){return this.mat3[6]/this.mat3[8]},set:function(t){this.mat3[6]=t*this.mat3[8]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ty",{get:function(){return this.mat3[7]/this.mat3[8]},set:function(t){this.mat3[7]=t*this.mat3[8]},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e,r,n,i,o){var a=this.mat3;return a[0]=t,a[1]=e,a[2]=0,a[3]=r,a[4]=n,a[5]=0,a[6]=i,a[7]=o,a[8]=1,this},t.prototype.toArray=function(t,e){this.floatArray||(this.floatArray=new Float32Array(9));var r=e||this.floatArray,n=this.mat3;return t?(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8]):(r[0]=n[0],r[1]=n[3],r[2]=n[6],r[3]=n[1],r[4]=n[4],r[5]=n[7],r[6]=n[2],r[7]=n[5],r[8]=n[8]),r},t.prototype.apply=function(t,e){e=e||new PIXI.Point;var r=this.mat3,n=t.x,i=t.y,o=1/(r[2]*n+r[5]*i+r[8]);return e.x=o*(r[0]*n+r[3]*i+r[6]),e.y=o*(r[1]*n+r[4]*i+r[7]),e},t.prototype.translate=function(t,e){var r=this.mat3;return r[0]+=t*r[2],r[1]+=e*r[2],r[3]+=t*r[5],r[4]+=e*r[5],r[6]+=t*r[8],r[7]+=e*r[8],this},t.prototype.scale=function(t,e){var r=this.mat3;return r[0]*=t,r[1]*=e,r[3]*=t,r[4]*=e,r[6]*=t,r[7]*=e,this},t.prototype.scaleAndTranslate=function(t,e,r,n){var i=this.mat3;i[0]=t*i[0]+r*i[2],i[1]=e*i[1]+n*i[2],i[3]=t*i[3]+r*i[5],i[4]=e*i[4]+n*i[5],i[6]=t*i[6]+r*i[8],i[7]=e*i[7]+n*i[8]},t.prototype.applyInverse=function(t,e){e=e||new n;var r=this.mat3,i=t.x,o=t.y,a=r[0],s=r[3],u=r[6],l=r[1],c=r[4],h=r[7],p=r[2],d=r[5],f=r[8],m=(f*c-h*d)*i+(-f*s+u*d)*o+(h*s-u*c),g=(-f*l+h*p)*i+(f*a-u*p)*o+(-h*a+u*l),v=(d*l-c*p)*i+(-d*a+s*p)*o+(c*a-s*l);return e.x=m/v,e.y=g/v,e},t.prototype.invert=function(){var t=this.mat3,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=l*o-a*u,h=-l*i+a*s,p=u*i-o*s,d=e*c+r*h+n*p;return d?(d=1/d,t[0]=c*d,t[1]=(-l*r+n*u)*d,t[2]=(a*r-n*o)*d,t[3]=h*d,t[4]=(l*e-n*s)*d,t[5]=(-a*e+n*i)*d,t[6]=p*d,t[7]=(-u*e+r*s)*d,t[8]=(o*e-r*i)*d,this):this},t.prototype.identity=function(){var t=this.mat3;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this},t.prototype.clone=function(){return new t(this.mat3)},t.prototype.copyTo2dOr3d=function(t){var e=this.mat3,r=t.mat3;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],t},t.prototype.copyTo=function(t,r,n){var i=this.mat3,o=1/i[8],a=i[6]*o,s=i[7]*o;if(t.a=(i[0]-i[2]*a)*o,t.b=(i[1]-i[2]*s)*o,t.c=(i[3]-i[5]*a)*o,t.d=(i[4]-i[5]*s)*o,t.tx=a,t.ty=s,r>=2){var u=t.a*t.d-t.b*t.c;n||(u=Math.abs(u)),r===e.POINT?(u=u>0?1:-1,t.a=u,t.b=0,t.c=0,t.d=u):r===e.AXIS_X?(u/=Math.sqrt(t.b*t.b+t.d*t.d),t.c=0,t.d=u):r===e.AXIS_Y?(u/=Math.sqrt(t.a*t.a+t.c*t.c),t.a=u,t.c=0):r===e.AXIS_XR&&(t.a=t.d*u,t.c=-t.b*u)}return t},t.prototype.copyFrom=function(t){var e=this.mat3;return e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=t.c,e[4]=t.d,e[5]=0,e[6]=t.tx,e[7]=t.ty,e[8]=1,this},t.prototype.setToMultLegacy=function(t,e){var r=this.mat3,n=e.mat3,i=t.a,o=t.b,a=t.c,s=t.d,u=t.tx,l=t.ty,c=n[0],h=n[1],p=n[2],d=n[3],f=n[4],m=n[5],g=n[6],v=n[7],y=n[8];return r[0]=c*i+h*a+p*u,r[1]=c*o+h*s+p*l,r[2]=p,r[3]=d*i+f*a+m*u,r[4]=d*o+f*s+m*l,r[5]=m,r[6]=g*i+v*a+y*u,r[7]=g*o+v*s+y*l,r[8]=y,this},t.prototype.setToMultLegacy2=function(t,e){var r=this.mat3,n=t.mat3,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=e.a,f=e.b,m=e.c,g=e.d,v=e.tx,y=e.ty;return r[0]=d*i+f*s,r[1]=d*o+f*u,r[2]=d*a+f*l,r[3]=m*i+g*s,r[4]=m*o+g*u,r[5]=m*a+g*l,r[6]=v*i+y*s+c,r[7]=v*o+y*u+h,r[8]=v*a+y*l+p,this},t.prototype.setToMult=function(t,e){var r=this.mat3,n=t.mat3,i=e.mat3,o=n[0],a=n[1],s=n[2],u=n[3],l=n[4],c=n[5],h=n[6],p=n[7],d=n[8],f=i[0],m=i[1],g=i[2],v=i[3],y=i[4],x=i[5],b=i[6],_=i[7],w=i[8];return r[0]=f*o+m*u+g*h,r[1]=f*a+m*l+g*p,r[2]=f*s+m*c+g*d,r[3]=v*o+y*u+x*h,r[4]=v*a+y*l+x*p,r[5]=v*s+y*c+x*d,r[6]=b*o+_*u+w*h,r[7]=b*a+_*l+w*p,r[8]=b*s+_*c+w*d,this},t.prototype.prepend=function(t){return t.mat3?this.setToMult(t,this):this.setToMultLegacy(t,this)},t.IDENTITY=new t,t.TEMP_MATRIX=new t,t}();t.Matrix2d=o}(Fr||(Fr={})),function(t){var e=new PIXI.Point,r=[new PIXI.Point,new PIXI.Point,new PIXI.Point,new PIXI.Point],n=new PIXI.Rectangle,i=new t.Matrix2d,o=function(o){function a(e,r){var n=o.call(this,e,r)||this;return n.matrix=new t.Matrix2d,n.pivot=new PIXI.ObservablePoint(n.onChange,n,0,0),n.reverseLocalOrder=!1,n.local=new t.Matrix2d,n.world=new t.Matrix2d,n}return Dr(a,o),a.prototype.onChange=function(){var t=this.pivot,e=this.matrix.mat3;e[6]=-(t._x*e[0]+t._y*e[3]),e[7]=-(t._x*e[1]+t._y*e[4]),this._projID++},a.prototype.setAxisX=function(t,e){void 0===e&&(e=1);var r=t.x,n=t.y,i=Math.sqrt(r*r+n*n),o=this.matrix.mat3;o[0]=r/i,o[1]=n/i,o[2]=e/i,this.onChange()},a.prototype.setAxisY=function(t,e){void 0===e&&(e=1);var r=t.x,n=t.y,i=Math.sqrt(r*r+n*n),o=this.matrix.mat3;o[3]=r/i,o[4]=n/i,o[5]=e/i,this.onChange()},a.prototype.mapSprite=function(t,e){var r=t.texture;return n.x=-t.anchor.x*r.orig.width,n.y=-t.anchor.y*r.orig.height,n.width=r.orig.width,n.height=r.orig.height,this.mapQuad(n,e)},a.prototype.mapQuad=function(n,o){r[0].set(n.x,n.y),r[1].set(n.x+n.width,n.y),r[2].set(n.x+n.width,n.y+n.height),r[3].set(n.x,n.y+n.height);var a=1,s=2,u=3;if(0!==t.utils.getIntersectionFactor(o[0],o[2],o[1],o[3],e)){a=1,s=3,u=2;var l=Math.sqrt((o[0].x-e.x)*(o[0].x-e.x)+(o[0].y-e.y)*(o[0].y-e.y)),c=Math.sqrt((o[a].x-e.x)*(o[a].x-e.x)+(o[a].y-e.y)*(o[a].y-e.y)),h=Math.sqrt((o[s].x-e.x)*(o[s].x-e.x)+(o[s].y-e.y)*(o[s].y-e.y)),p=Math.sqrt((o[u].x-e.x)*(o[u].x-e.x)+(o[u].y-e.y)*(o[u].y-e.y)),d=(l+p)/p,f=(c+h)/h,m=(c+h)/c,g=this.matrix.mat3;g[0]=r[0].x*d,g[1]=r[0].y*d,g[2]=d,g[3]=r[a].x*f,g[4]=r[a].y*f,g[5]=f,g[6]=r[s].x*m,g[7]=r[s].y*m,g[8]=m,this.matrix.invert(),(g=i.mat3)[0]=o[0].x,g[1]=o[0].y,g[2]=1,g[3]=o[a].x,g[4]=o[a].y,g[5]=1,g[6]=o[s].x,g[7]=o[s].y,g[8]=1,this.matrix.setToMult(i,this.matrix),this._projID++}},a.prototype.updateLocalTransform=function(t){0!==this._projID?this.reverseLocalOrder?this.local.setToMultLegacy2(this.matrix,t):this.local.setToMultLegacy(t,this.matrix):this.local.copyFrom(t)},a.prototype.clear=function(){o.prototype.clear.call(this),this.matrix.identity(),this.pivot.set(0,0)},a}(t.LinearProjection);t.Projection2d=o}(Fr||(Fr={})),function(t){var e=function(e){function r(r,n,i,o){var a=e.call(this,r,n,i,o)||this;return a.vertexData2d=null,a.proj=new t.Projection2d(a.transform),a}return Dr(r,e),r.prototype.calculateVertices=function(){if(this.proj._affine)return this.vertexData2d=null,void e.prototype.calculateVertices.call(this);var t=this.geometry,r=t.buffers[0].data,n=this;if(t.vertexDirtyId!==n.vertexDirty||n._transformID!==n.transform._worldID){n._transformID=n.transform._worldID,n.vertexData.length!==r.length&&(n.vertexData=new Float32Array(r.length)),this.vertexData2d&&this.vertexData2d.length===3*r.length/2||(this.vertexData2d=new Float32Array(3*r.length));for(var i=this.proj.world.mat3,o=this.vertexData2d,a=n.vertexData,s=0;s<a.length/2;s++){var u=r[2*s],l=r[2*s+1],c=i[0]*u+i[3]*l+i[6],h=i[1]*u+i[4]*l+i[7],p=i[2]*u+i[5]*l+i[8];o[3*s]=c,o[3*s+1]=h,o[3*s+2]=p,a[2*s]=c/p,a[2*s+1]=h/p}n.vertexDirty=t.vertexDirtyId}},r.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.worldTransform.toArray(!0)),t.shader.bind(e,!1),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),t.container2dToLocal.call(this,e,r,n,i,o)},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r.defaultVertexShader="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tgl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);\n\tgl_Position.z = 0.0;\n\n\tvTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n",r.defaultFragmentShader="\nvarying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n\tgl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}",r}(PIXI.Mesh);t.Mesh2d=e;var r=function(t){function r(r,n,i,o,a){var s=t.call(this,new PIXI.MeshGeometry(n,i,o),new PIXI.MeshMaterial(r,{program:PIXI.Program.from(e.defaultVertexShader,e.defaultFragmentShader),pluginName:"batch2d"}),null,a)||this;return s.autoUpdate=!0,s.geometry.getBuffer("aVertexPosition").static=!1,s}return Dr(r,t),Object.defineProperty(r.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!0,configurable:!0}),r.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,e)},r}(e);t.SimpleMesh2d=r}(Fr||(Fr={})),function(t){var e=function(e){function r(r){var n=e.call(this,r)||this;return n.vertexData2d=null,n.proj=new t.Projection2d(n.transform),n.pluginName="batch2d",n}return Dr(r,e),r.prototype._calculateBounds=function(){this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)},r.prototype.calculateVertices=function(){var t=this._texture;if(this.proj._affine)return this.vertexData2d=null,void e.prototype.calculateVertices.call(this);this.vertexData2d||(this.vertexData2d=new Float32Array(12));var r=this.transform._worldID,n=t._updateID;if(this._transformID!==r||this._textureID!==n){this._textureID!==n&&(this.uvs=t._uvs.uvsFloat32),this._transformID=r,this._textureID=n;var i=this.proj.world.mat3,o=this.vertexData2d,a=this.vertexData,s=t.trim,u=t.orig,l=this._anchor,c=0,h=0,p=0,d=0;s?(c=(h=s.x-l._x*u.width)+s.width,p=(d=s.y-l._y*u.height)+s.height):(c=(h=-l._x*u.width)+u.width,p=(d=-l._y*u.height)+u.height),o[0]=i[0]*h+i[3]*d+i[6],o[1]=i[1]*h+i[4]*d+i[7],o[2]=i[2]*h+i[5]*d+i[8],o[3]=i[0]*c+i[3]*d+i[6],o[4]=i[1]*c+i[4]*d+i[7],o[5]=i[2]*c+i[5]*d+i[8],o[6]=i[0]*c+i[3]*p+i[6],o[7]=i[1]*c+i[4]*p+i[7],o[8]=i[2]*c+i[5]*p+i[8],o[9]=i[0]*h+i[3]*p+i[6],o[10]=i[1]*h+i[4]*p+i[7],o[11]=i[2]*h+i[5]*p+i[8],a[0]=o[0]/o[2],a[1]=o[1]/o[2],a[2]=o[3]/o[5],a[3]=o[4]/o[5],a[4]=o[6]/o[8],a[5]=o[7]/o[8],a[6]=o[9]/o[11],a[7]=o[10]/o[11]}},r.prototype.calculateTrimmedVertices=function(){if(this.proj._affine)e.prototype.calculateTrimmedVertices.call(this);else{var t=this.transform._worldID,r=this._texture._updateID;if(this.vertexTrimmedData){if(this._transformTrimmedID===t&&this._textureTrimmedID===r)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=t,this._textureTrimmedID=r;var n=this._texture,i=this.vertexTrimmedData,o=n.orig,a=this.tileProj?this._width:o.width,s=this.tileProj?this._height:o.height,u=this._anchor,l=this.proj.world.mat3,c=-u._x*a,h=c+a,p=-u._y*s,d=p+s,f=1/(l[2]*c+l[5]*p+l[8]);i[0]=f*(l[0]*c+l[3]*p+l[6]),i[1]=f*(l[1]*c+l[4]*p+l[7]),f=1/(l[2]*h+l[5]*p+l[8]),i[2]=f*(l[0]*h+l[3]*p+l[6]),i[3]=f*(l[1]*h+l[4]*p+l[7]),f=1/(l[2]*h+l[5]*d+l[8]),i[4]=f*(l[0]*h+l[3]*d+l[6]),i[5]=f*(l[1]*h+l[4]*d+l[7]),f=1/(l[2]*c+l[5]*d+l[8]),i[6]=f*(l[0]*c+l[3]*d+l[6]),i[7]=f*(l[1]*c+l[4]*d+l[7])}},r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),t.container2dToLocal.call(this,e,r,n,i,o)},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r}(PIXI.Sprite);t.Sprite2d=e}(Fr||(Fr={})),function(t){var e=function(e){function r(r,n,i){var o=e.call(this,r,n,i)||this;return o.vertexData2d=null,o.proj=new t.Projection2d(o.transform),o.pluginName="batch2d",o}return Dr(r,e),Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r}(PIXI.Text);t.Text2d=e,e.prototype.calculateVertices=t.Sprite2d.prototype.calculateVertices,e.prototype.calculateTrimmedVertices=t.Sprite2d.prototype.calculateTrimmedVertices,e.prototype._calculateBounds=t.Sprite2d.prototype._calculateBounds}(Fr||(Fr={})),function(t){function e(){this.proj||(this.proj=new t.Projection2d(this.transform),this.toLocal=t.Container2d.prototype.toLocal,Object.defineProperty(this,"worldTransform",{get:t.container2dWorldTransform,enumerable:!0,configurable:!0}))}PIXI.Container.prototype.convertTo2d=e,PIXI.Sprite.prototype.convertTo2d=function(){this.proj||(this.calculateVertices=t.Sprite2d.prototype.calculateVertices,this.calculateTrimmedVertices=t.Sprite2d.prototype.calculateTrimmedVertices,this._calculateBounds=t.Sprite2d.prototype._calculateBounds,this.pluginName="batch2d",e.call(this))},PIXI.Container.prototype.convertSubtreeTo2d=function(){this.convertTo2d();for(var t=0;t<this.children.length;t++)this.children[t].convertSubtreeTo2d()},PIXI.SimpleMesh&&(PIXI.SimpleMesh.prototype.convertTo2d=PIXI.SimpleRope.prototype.convertTo2d=function(){this.proj||(this.calculateVertices=t.Mesh2d.prototype.calculateVertices,this._renderDefault=t.Mesh2d.prototype._renderDefault,"batch2d"!==this.material.pluginName&&(this.material=new PIXI.MeshMaterial(this.material.texture,{program:PIXI.Program.from(t.Mesh2d.defaultVertexShader,t.Mesh2d.defaultFragmentShader),pluginName:"batch2d"})),e.call(this))}),PIXI.TilingSprite&&(PIXI.TilingSprite.prototype.convertTo2d=function(){this.proj||(this.tileProj=new t.Projection2d(this.tileTransform),this.tileProj.reverseLocalOrder=!0,this.uvRespectAnchor=!0,this.calculateTrimmedVertices=t.Sprite2d.prototype.calculateTrimmedVertices,this._calculateBounds=t.Sprite2d.prototype._calculateBounds,this._render=t.TilingSprite2d.prototype._render,this.pluginName="tilingSprite2d",e.call(this))})}(Fr||(Fr={})),function(t){var e=new PIXI.Transform,r=function(r){function n(e,n,i){var o=r.call(this,e,n,i)||this;return o.tileProj=new t.Projection2d(o.tileTransform),o.tileProj.reverseLocalOrder=!0,o.proj=new t.Projection2d(o.transform),o.pluginName="tilingSprite2d",o.uvRespectAnchor=!0,o}return Dr(n,r),Object.defineProperty(n.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),n.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),t.container2dToLocal.call(this,e,r,n,i,o)},n.prototype._render=function(t){var r=this._texture;r&&r.valid&&(this.tileTransform.updateTransform(e),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},n}(PIXI.TilingSprite);t.TilingSprite2d=r}(Fr||(Fr={})),function(t){var e="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec3 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position.xyw = projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0);\n\n    vTextureCoord = uTransform * vec3(aTextureCoord, 1.0);\n}\n",r=new t.Matrix2d,n=PIXI.WRAP_MODES,i=PIXI.utils,o=function(t){function o(r){var n=t.call(this,r)||this;n.quad=new PIXI.QuadUv;var i={globals:n.renderer.globalUniforms};return n.shader=PIXI.Shader.from(e,"\nvarying vec3 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord.xy / vTextureCoord.z - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n",i),n.simpleShader=PIXI.Shader.from(e,"\n\tvarying vec3 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord.xy / vTextureCoord.z);\n    gl_FragColor = sample * uColor;\n}\n",i),n}return Dr(o,t),o.prototype.render=function(t){var e=this.renderer,o=this.quad,a=o.vertices;a[0]=a[6]=t._width*-t.anchor.x,a[1]=a[3]=t._height*-t.anchor.y,a[2]=a[4]=t._width*(1-t.anchor.x),a[5]=a[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((a=o.uvs)[0]=a[6]=-t.anchor.x,a[1]=a[3]=-t.anchor.y,a[2]=a[4]=1-t.anchor.x,a[5]=a[7]=1-t.anchor.y),o.invalidate();var s=t._texture,u=s.baseTexture,l=t.tileProj.world,c=t.uvMatrix,h=u.isPowerOfTwo&&s.frame.width===u.width&&s.frame.height===u.height;h&&(u._glTextures[e.CONTEXT_UID]?h=u.wrapMode!==n.CLAMP:u.wrapMode===n.CLAMP&&(u.wrapMode=n.REPEAT));var p=h?this.simpleShader:this.shader;r.identity(),r.scale(s.width,s.height),r.prepend(l),r.scale(1/t._width,1/t._height),r.invert(),h?r.prepend(c.mapCoord):(p.uniforms.uMapCoord=c.mapCoord.toArray(!0),p.uniforms.uClampFrame=c.uClampFrame,p.uniforms.uClampOffset=c.uClampOffset),p.uniforms.uTransform=r.toArray(!0),p.uniforms.uColor=i.premultiplyTintToRgba(t.tint,t.worldAlpha,p.uniforms.uColor,u.premultiplyAlpha),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=s,e.shader.bind(p,!1),e.geometry.bind(o,void 0),e.state.setBlendMode(i.correctBlendMode(t.blendMode,u.premultiplyAlpha)),e.geometry.draw(PIXI.DRAW_MODES.TRIANGLES,6,0)},o}(PIXI.ObjectRenderer);t.TilingSprite2dRenderer=o,PIXI.Renderer.registerPlugin("tilingSprite2d",o)}(Fr||(Fr={})),function(t){PIXI.systems.MaskSystem.prototype.pushSpriteMask=function(e){var r=e.maskObject,n=e._target,i=this.alphaMaskPool[this.alphaMaskIndex];i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new t.SpriteMaskFilter2d(r)]),i[0].resolution=this.renderer.resolution,i[0].maskSprite=r;var o=n.filterArea;n.filterArea=r.getBounds(!0),this.renderer.filter.push(n,i),n.filterArea=o,this.alphaMaskIndex++}}(Fr||(Fr={})),function(t){var e=new t.Matrix2d,r=function(r){function n(e){var n=r.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec3 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n\tgl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n\tvTextureCoord = aTextureCoord;\n\tvMaskCoord = otherMatrix * vec3( aTextureCoord, 1.0);\n}\n","\nvarying vec3 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    vec2 uv = vMaskCoord.xy / vMaskCoord.z;\n\n    float clip = step(3.5,\n        step(maskClamp.x, uv.x) +\n        step(maskClamp.y, uv.y) +\n        step(uv.x, maskClamp.z) +\n        step(uv.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, uv);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this;return n.maskMatrix=new t.Matrix2d,e.renderable=!1,n.maskSprite=e,n}return Dr(n,r),n.prototype.apply=function(t,e,r,i){var o=this.maskSprite,a=this.maskSprite.texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new PIXI.TextureMatrix(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=o.texture,this.uniforms.otherMatrix=n.calculateSpriteMatrix(e,this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,i))},n.calculateSpriteMatrix=function(t,r,n){var i=n.proj,o=t.filterFrame,a=i&&!i._affine?i.world.copyTo2dOr3d(e):e.copyFrom(n.transform.worldTransform),s=n.texture.orig;return r.set(t.width,0,0,t.height,o.x,o.y),a.invert(),r.setToMult(a,r),r.scaleAndTranslate(1/s.width,1/s.height,n.anchor.x,n.anchor.y),r},n}(PIXI.Filter);t.SpriteMaskFilter2d=r}(Fr||(Fr={})),function(t){t.container3dWorldTransform=function(){return this.proj.affine?this.transform.worldTransform:this.proj.world};var e=function(e){function r(){var r=e.call(this)||this;return r.proj=new t.Projection3d(r.transform),r}return Dr(r,e),r.prototype.isFrontFace=function(t){void 0===t&&(t=!1),t&&(this._recursivePostUpdateTransform(),this.displayObjectUpdateTransform());var e=this.proj.world.mat4,r=e[0]*e[15]-e[3]*e[12],n=e[1]*e[15]-e[3]*e[13],i=e[4]*e[15]-e[7]*e[12];return r*(e[5]*e[15]-e[7]*e[13])-i*n>0},r.prototype.getDepth=function(t){void 0===t&&(t=!1),t&&(this._recursivePostUpdateTransform(),this.displayObjectUpdateTransform());var e=this.proj.world.mat4;return e[14]/e[15]},r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),r&&(e=r.toGlobal(e,n,i)),i||this._recursivePostUpdateTransform(),o===t.TRANSFORM_STEP.ALL?(i||this.displayObjectUpdateTransform(),this.proj.affine?this.transform.worldTransform.applyInverse(e,n):this.proj.world.applyInverse(e,n)):(this.parent?n=this.parent.worldTransform.applyInverse(e,n):n.copyFrom(e),o===t.TRANSFORM_STEP.NONE||(n=this.transform.localTransform.applyInverse(n,n),o===t.TRANSFORM_STEP.PROJ&&this.proj.cameraMode&&(n=this.proj.cameraMatrix.applyInverse(n,n))),n)},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position3d",{get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale3d",{get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"euler",{get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pivot3d",{get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)},enumerable:!0,configurable:!0}),r}(PIXI.Container);t.Container3d=e,t.container3dToLocal=e.prototype.toLocal,t.container3dGetDepth=e.prototype.getDepth,t.container3dIsFrontFace=e.prototype.isFrontFace}(Fr||(Fr={})),function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._far=0,e._near=0,e._focus=0,e._orthographic=!1,e.proj.cameraMode=!0,e.setPlanes(400,10,1e4,!1),e}return Dr(e,t),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focus",{get:function(){return this._focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ortographic",{get:function(){return this._orthographic},enumerable:!0,configurable:!0}),e.prototype.setPlanes=function(t,e,r,n){void 0===e&&(e=10),void 0===r&&(r=1e4),void 0===n&&(n=!1),this._focus=t,this._near=e,this._far=r,this._orthographic=n;var i=this.proj,o=i.cameraMatrix.mat4;i._projID++,o[10]=1/(r-e),o[14]=(t-e)/(r-e),this._orthographic?o[11]=0:o[11]=1/t},e}(t.Container3d);t.Camera3d=e}(Fr||(Fr={})),function(t){var e=function(){function t(t,e,r){this._quatUpdateId=-1,this._quatDirtyId=0,this._sign=1,this._x=t||0,this._y=e||0,this._z=r||0,this.quaternion=new Float64Array(4),this.quaternion[3]=1,this.update()}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yaw",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roll",{get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++)},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e,r){var n=t||0,i=e||0,o=r||0;this._x===n&&this._y===i&&this._z===o||(this._x=n,this._y=i,this._z=o,this._quatDirtyId++)},t.prototype.copyFrom=function(t){var e=t.x,r=t.y,n=t.z;this._x===e&&this._y===r&&this._z===n||(this._x=e,this._y=r,this._z=n,this._quatDirtyId++)},t.prototype.copyTo=function(t){return t.set(this._x,this._y,this._z),t},t.prototype.equals=function(t){return this._x===t.x&&this._y===t.y&&this._z===t.z},t.prototype.clone=function(){return new t(this._x,this._y,this._z)},t.prototype.update=function(){if(this._quatUpdateId===this._quatDirtyId)return!1;this._quatUpdateId=this._quatDirtyId;var t=Math.cos(this._x/2),e=Math.cos(this._y/2),r=Math.cos(this._z/2),n=this._sign,i=n*Math.sin(this._x/2),o=n*Math.sin(this._y/2),a=n*Math.sin(this._z/2),s=this.quaternion;return s[0]=i*e*r+t*o*a,s[1]=t*o*r-i*e*a,s[2]=t*e*a+i*o*r,s[3]=t*e*r-i*o*a,!0},t}();t.Euler=e}(Fr||(Fr={})),function(t){var e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=function(){function r(t){this.floatArray=null,this._dirtyId=0,this._updateId=-1,this._mat4inv=null,this.cacheInverse=!1,this.mat4=new Float64Array(t||e)}return Object.defineProperty(r.prototype,"a",{get:function(){return this.mat4[0]/this.mat4[15]},set:function(t){this.mat4[0]=t*this.mat4[15]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"b",{get:function(){return this.mat4[1]/this.mat4[15]},set:function(t){this.mat4[1]=t*this.mat4[15]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"c",{get:function(){return this.mat4[4]/this.mat4[15]},set:function(t){this.mat4[4]=t*this.mat4[15]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"d",{get:function(){return this.mat4[5]/this.mat4[15]},set:function(t){this.mat4[5]=t*this.mat4[15]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tx",{get:function(){return this.mat4[12]/this.mat4[15]},set:function(t){this.mat4[12]=t*this.mat4[15]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ty",{get:function(){return this.mat4[13]/this.mat4[15]},set:function(t){this.mat4[13]=t*this.mat4[15]},enumerable:!0,configurable:!0}),r.prototype.set=function(t,e,r,n,i,o){var a=this.mat4;return a[0]=t,a[1]=e,a[2]=0,a[3]=0,a[4]=r,a[5]=n,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=i,a[13]=o,a[14]=0,a[15]=1,this},r.prototype.toArray=function(t,e){this.floatArray||(this.floatArray=new Float32Array(9));var r=e||this.floatArray,n=this.mat4;return t?(r[0]=n[0],r[1]=n[1],r[2]=n[3],r[3]=n[4],r[4]=n[5],r[5]=n[7],r[6]=n[12],r[7]=n[13],r[8]=n[15]):(r[0]=n[0],r[1]=n[4],r[2]=n[12],r[3]=n[2],r[4]=n[6],r[5]=n[13],r[6]=n[3],r[7]=n[7],r[8]=n[15]),r},r.prototype.setToTranslation=function(t,e,r){var n=this.mat4;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t,n[13]=e,n[14]=r,n[15]=1},r.prototype.setToRotationTranslationScale=function(t,e,r,n,i,o,a){var s=this.mat4,u=t[0],l=t[1],c=t[2],h=t[3],p=u+u,d=l+l,f=c+c,m=u*p,g=u*d,v=u*f,y=l*d,x=l*f,b=c*f,_=h*p,w=h*d,T=h*f;return s[0]=(1-(y+b))*i,s[1]=(g+T)*i,s[2]=(v-w)*i,s[3]=0,s[4]=(g-T)*o,s[5]=(1-(m+b))*o,s[6]=(x+_)*o,s[7]=0,s[8]=(v+w)*a,s[9]=(x-_)*a,s[10]=(1-(m+y))*a,s[11]=0,s[12]=e,s[13]=r,s[14]=n,s[15]=1,s},r.prototype.apply=function(e,r){r=r||new t.Point3d;var n=this.mat4,i=e.x,o=e.y,a=e.z||0,s=1/(n[3]*i+n[7]*o+n[11]*a+n[15]);return r.x=s*(n[0]*i+n[4]*o+n[8]*a+n[12]),r.y=s*(n[1]*i+n[5]*o+n[9]*a+n[13]),r.z=s*(n[2]*i+n[6]*o+n[10]*a+n[14]),r},r.prototype.translate=function(t,e,r){var n=this.mat4;return n[12]=n[0]*t+n[4]*e+n[8]*r+n[12],n[13]=n[1]*t+n[5]*e+n[9]*r+n[13],n[14]=n[2]*t+n[6]*e+n[10]*r+n[14],n[15]=n[3]*t+n[7]*e+n[11]*r+n[15],this},r.prototype.scale=function(t,e,r){var n=this.mat4;return n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t,n[4]*=e,n[5]*=e,n[6]*=e,n[7]*=e,void 0!==r&&(n[8]*=r,n[9]*=r,n[10]*=r,n[11]*=r),this},r.prototype.scaleAndTranslate=function(t,e,r,n,i,o){var a=this.mat4;a[0]=t*a[0]+n*a[3],a[1]=e*a[1]+i*a[3],a[2]=r*a[2]+o*a[3],a[4]=t*a[4]+n*a[7],a[5]=e*a[5]+i*a[7],a[6]=r*a[6]+o*a[7],a[8]=t*a[8]+n*a[11],a[9]=e*a[9]+i*a[11],a[10]=r*a[10]+o*a[11],a[12]=t*a[12]+n*a[15],a[13]=e*a[13]+i*a[15],a[14]=r*a[14]+o*a[15]},r.prototype.applyInverse=function(e,n){n=n||new t.Point3d,this._mat4inv||(this._mat4inv=new Float64Array(16));var i=this._mat4inv,o=this.mat4,a=e.x,s=e.y,u=e.z||0;this.cacheInverse&&this._updateId===this._dirtyId||(this._updateId=this._dirtyId,r.glMatrixMat4Invert(i,o));var l=1/(i[3]*a+i[7]*s+i[11]*u+i[15]),c=l*(i[0]*a+i[4]*s+i[8]*u+i[12]),h=l*(i[1]*a+i[5]*s+i[9]*u+i[13]),p=l*(i[2]*a+i[6]*s+i[10]*u+i[14]);u+=1;var d=1/(i[3]*a+i[7]*s+i[11]*u+i[15]),f=d*(i[0]*a+i[4]*s+i[8]*u+i[12]),m=d*(i[1]*a+i[5]*s+i[9]*u+i[13]),g=d*(i[2]*a+i[6]*s+i[10]*u+i[14]);Math.abs(p-g)<1e-10&&n.set(NaN,NaN,0);var v=(0-p)/(g-p);return n.set((f-c)*v+c,(m-h)*v+h,0),n},r.prototype.invert=function(){return r.glMatrixMat4Invert(this.mat4,this.mat4),this},r.prototype.invertCopyTo=function(t){this._mat4inv||(this._mat4inv=new Float64Array(16));var e=this._mat4inv,n=this.mat4;this.cacheInverse&&this._updateId===this._dirtyId||(this._updateId=this._dirtyId,r.glMatrixMat4Invert(e,n)),t.mat4.set(e)},r.prototype.identity=function(){var t=this.mat4;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},r.prototype.clone=function(){return new r(this.mat4)},r.prototype.copyTo3d=function(t){var e=this.mat4,r=t.mat4;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],t},r.prototype.copyTo2d=function(t){var e=this.mat4,r=t.mat3;return r[0]=e[0],r[1]=e[1],r[2]=e[3],r[3]=e[4],r[4]=e[5],r[5]=e[7],r[6]=e[12],r[7]=e[13],r[8]=e[15],t},r.prototype.copyTo2dOr3d=function(e){return e instanceof t.Matrix2d?this.copyTo2d(e):this.copyTo3d(e)},r.prototype.copyTo=function(e,r,n){var i=this.mat4,o=1/i[15],a=i[12]*o,s=i[13]*o;if(e.a=(i[0]-i[3]*a)*o,e.b=(i[1]-i[3]*s)*o,e.c=(i[4]-i[7]*a)*o,e.d=(i[5]-i[7]*s)*o,e.tx=a,e.ty=s,r>=2){var u=e.a*e.d-e.b*e.c;n||(u=Math.abs(u)),r===t.AFFINE.POINT?(u=u>0?1:-1,e.a=u,e.b=0,e.c=0,e.d=u):r===t.AFFINE.AXIS_X?(u/=Math.sqrt(e.b*e.b+e.d*e.d),e.c=0,e.d=u):r===t.AFFINE.AXIS_Y&&(u/=Math.sqrt(e.a*e.a+e.c*e.c),e.a=u,e.c=0)}return e},r.prototype.copyFrom=function(t){var e=this.mat4;return e[0]=t.a,e[1]=t.b,e[2]=0,e[3]=0,e[4]=t.c,e[5]=t.d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t.tx,e[13]=t.ty,e[14]=0,e[15]=1,this._dirtyId++,this},r.prototype.setToMultLegacy=function(t,e){var r=this.mat4,n=e.mat4,i=t.a,o=t.b,a=t.c,s=t.d,u=t.tx,l=t.ty,c=n[0],h=n[1],p=n[2],d=n[3];return r[0]=c*i+h*a+d*u,r[1]=c*o+h*s+d*l,r[2]=p,r[3]=d,c=n[4],h=n[5],p=n[6],d=n[7],r[4]=c*i+h*a+d*u,r[5]=c*o+h*s+d*l,r[6]=p,r[7]=d,c=n[8],h=n[9],p=n[10],d=n[11],r[8]=c*i+h*a+d*u,r[9]=c*o+h*s+d*l,r[10]=p,r[11]=d,c=n[12],h=n[13],p=n[14],d=n[15],r[12]=c*i+h*a+d*u,r[13]=c*o+h*s+d*l,r[14]=p,r[15]=d,this._dirtyId++,this},r.prototype.setToMultLegacy2=function(t,e){var r=this.mat4,n=t.mat4,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],p=e.a,d=e.b,f=e.c,m=e.d,g=e.tx,v=e.ty;return r[0]=p*i+d*u,r[1]=p*o+d*l,r[2]=p*a+d*c,r[3]=p*s+d*h,r[4]=f*i+m*u,r[5]=f*o+m*l,r[6]=f*a+m*c,r[7]=f*s+m*h,r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=g*i+v*u+n[12],r[13]=g*o+v*l+n[13],r[14]=g*a+v*c+n[14],r[15]=g*s+v*h+n[15],this._dirtyId++,this},r.prototype.setToMult=function(t,e){return r.glMatrixMat4Multiply(this.mat4,t.mat4,e.mat4),this._dirtyId++,this},r.prototype.prepend=function(t){t.mat4?this.setToMult(t,this):this.setToMultLegacy(t,this)},r.glMatrixMat4Invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=r*s-n*a,x=r*u-i*a,b=r*l-o*a,_=n*u-i*s,w=n*l-o*s,T=i*l-o*u,E=c*m-h*f,S=c*g-p*f,A=c*v-d*f,P=h*g-p*m,M=h*v-d*m,I=p*v-d*g,O=y*I-x*M+b*P+_*A-w*S+T*E;return O?(O=1/O,t[0]=(s*I-u*M+l*P)*O,t[1]=(i*M-n*I-o*P)*O,t[2]=(m*T-g*w+v*_)*O,t[3]=(p*w-h*T-d*_)*O,t[4]=(u*A-a*I-l*S)*O,t[5]=(r*I-i*A+o*S)*O,t[6]=(g*b-f*T-v*x)*O,t[7]=(c*T-p*b+d*x)*O,t[8]=(a*M-s*A+l*E)*O,t[9]=(n*A-r*M-o*E)*O,t[10]=(f*w-m*b+v*y)*O,t[11]=(h*b-c*w-d*y)*O,t[12]=(s*S-a*P-u*E)*O,t[13]=(r*P-n*S+i*E)*O,t[14]=(m*x-f*_-g*y)*O,t[15]=(c*_-h*x+p*y)*O,t):null},r.glMatrixMat4Multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],v=e[14],y=e[15],x=r[0],b=r[1],_=r[2],w=r[3];return t[0]=x*n+b*s+_*h+w*m,t[1]=x*i+b*u+_*p+w*g,t[2]=x*o+b*l+_*d+w*v,t[3]=x*a+b*c+_*f+w*y,x=r[4],b=r[5],_=r[6],w=r[7],t[4]=x*n+b*s+_*h+w*m,t[5]=x*i+b*u+_*p+w*g,t[6]=x*o+b*l+_*d+w*v,t[7]=x*a+b*c+_*f+w*y,x=r[8],b=r[9],_=r[10],w=r[11],t[8]=x*n+b*s+_*h+w*m,t[9]=x*i+b*u+_*p+w*g,t[10]=x*o+b*l+_*d+w*v,t[11]=x*a+b*c+_*f+w*y,x=r[12],b=r[13],_=r[14],w=r[15],t[12]=x*n+b*s+_*h+w*m,t[13]=x*i+b*u+_*p+w*g,t[14]=x*o+b*l+_*d+w*v,t[15]=x*a+b*c+_*f+w*y,t},r.IDENTITY=new r,r.TEMP_MATRIX=new r,r}();t.Matrix3d=r}(Fr||(Fr={})),function(t){var e=function(){function e(t,e,r,n,i){this.cb=t,this.scope=e,this._quatUpdateId=-1,this._quatDirtyId=0,this._sign=1,this._x=r||0,this._y=n||0,this._z=i||0,this.quaternion=new Float64Array(4),this.quaternion[3]=1,this.update()}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._quatDirtyId++,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yaw",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._quatDirtyId++,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roll",{get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this._quatDirtyId++,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),e.prototype.set=function(t,e,r){var n=t||0,i=e||0,o=r||0;this._x===n&&this._y===i&&this._z===o||(this._x=n,this._y=i,this._z=o,this._quatDirtyId++,this.cb.call(this.scope))},e.prototype.copyFrom=function(t){var e=t.x,r=t.y,n=t.z;this._x===e&&this._y===r&&this._z===n||(this._x=e,this._y=r,this._z=n,this._quatDirtyId++,this.cb.call(this.scope))},e.prototype.copyTo=function(t){return t.set(this._x,this._y,this._z),t},e.prototype.equals=function(t){return this._x===t.x&&this._y===t.y&&this._z===t.z},e.prototype.clone=function(){return new t.Euler(this._x,this._y,this._z)},e.prototype.update=function(){if(this._quatUpdateId===this._quatDirtyId)return!1;this._quatUpdateId=this._quatDirtyId;var t=Math.cos(this._x/2),e=Math.cos(this._y/2),r=Math.cos(this._z/2),n=this._sign,i=n*Math.sin(this._x/2),o=n*Math.sin(this._y/2),a=n*Math.sin(this._z/2),s=this.quaternion;return s[0]=i*e*r+t*o*a,s[1]=t*o*r-i*e*a,s[2]=t*e*a+i*o*r,s[3]=t*e*r-i*o*a,!0},e}();t.ObservableEuler=e}(Fr||(Fr={})),function(t){var e=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;return i.z=n,i}return Dr(e,t),e.prototype.set=function(t,e,r){return this.x=t||0,this.y=void 0===e?this.x:e||0,this.z=void 0===e?this.x:r||0,this},e.prototype.copyFrom=function(t){return this.set(t.x,t.y,t.z||0),this},e.prototype.copyTo=function(t){return t.set(this.x,this.y,this.z),t},e}(PIXI.Point);t.Point3d=e;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._z=0,e}return Dr(e,t),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z!==t&&(this._z=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),e.prototype.set=function(t,e,r){var n=t||0,i=void 0===e?n:e||0,o=void 0===e?n:r||0;return this._x===n&&this._y===i&&this._z===o||(this._x=n,this._y=i,this._z=o,this.cb.call(this.scope)),this},e.prototype.copyFrom=function(t){return this.set(t.x,t.y,t.z||0),this},e.prototype.copyTo=function(t){return t.set(this._x,this._y,this._z),t},e}(PIXI.ObservablePoint);t.ObservablePoint3d=r}(Fr||(Fr={})),function(t){var e=new t.Matrix3d,r=function(r){function n(e,n){var i=r.call(this,e,n)||this;return i.cameraMatrix=null,i._cameraMode=!1,i.position=new t.ObservablePoint3d(i.onChange,i,0,0),i.scale=new t.ObservablePoint3d(i.onChange,i,1,1),i.euler=new t.ObservableEuler(i.onChange,i,0,0,0),i.pivot=new t.ObservablePoint3d(i.onChange,i,0,0),i.local=new t.Matrix3d,i.world=new t.Matrix3d,i.local.cacheInverse=!0,i.world.cacheInverse=!0,i.position._z=0,i.scale._z=1,i.pivot._z=0,i}return Dr(n,r),Object.defineProperty(n.prototype,"cameraMode",{get:function(){return this._cameraMode},set:function(e){this._cameraMode!==e&&(this._cameraMode=e,this.euler._sign=this._cameraMode?-1:1,this.euler._quatDirtyId++,e&&(this.cameraMatrix=new t.Matrix3d))},enumerable:!0,configurable:!0}),n.prototype.onChange=function(){this._projID++},n.prototype.clear=function(){this.cameraMatrix&&this.cameraMatrix.identity(),this.position.set(0,0,0),this.scale.set(1,1,1),this.euler.set(0,0,0),this.pivot.set(0,0,0),r.prototype.clear.call(this)},n.prototype.updateLocalTransform=function(t){if(0!==this._projID){var r=this.local,n=this.euler,i=this.position,o=this.scale,a=this.pivot;if(n.update(),!this.cameraMode)return r.setToRotationTranslationScale(n.quaternion,i._x,i._y,i._z,o._x,o._y,o._z),r.translate(-a._x,-a._y,-a._z),void r.setToMultLegacy(t,r);r.setToMultLegacy(t,this.cameraMatrix),r.translate(a._x,a._y,a._z),r.scale(1/o._x,1/o._y,1/o._z),e.setToRotationTranslationScale(n.quaternion,0,0,0,1,1,1),r.setToMult(r,e),r.translate(-i._x,-i._y,-i._z),this.local._dirtyId++}else this.local.copyFrom(t)},n}(t.LinearProjection);t.Projection3d=r}(Fr||(Fr={})),function(t){var e=function(e){function r(r,n,i,o){var a=e.call(this,r,n,i,o)||this;return a.vertexData2d=null,a.proj=new t.Projection3d(a.transform),a}return Dr(r,e),r.prototype.calculateVertices=function(){if(this.proj._affine)return this.vertexData2d=null,void e.prototype.calculateVertices.call(this);var t=this.geometry,r=t.buffers[0].data,n=this;if(t.vertexDirtyId!==n.vertexDirty||n._transformID!==n.transform._worldID){n._transformID=n.transform._worldID,n.vertexData.length!==r.length&&(n.vertexData=new Float32Array(r.length)),this.vertexData2d&&this.vertexData2d.length===3*r.length/2||(this.vertexData2d=new Float32Array(3*r.length));for(var i=this.proj.world.mat4,o=this.vertexData2d,a=n.vertexData,s=0;s<a.length/2;s++){var u=r[2*s],l=r[2*s+1],c=i[0]*u+i[4]*l+i[12],h=i[1]*u+i[5]*l+i[13],p=i[3]*u+i[7]*l+i[15];o[3*s]=c,o[3*s+1]=h,o[3*s+2]=p,a[2*s]=c/p,a[2*s+1]=h/p}n.vertexDirty=t.vertexDirtyId}},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),t.container3dToLocal.call(this,e,r,n,i,o)},r.prototype.isFrontFace=function(e){return t.container3dIsFrontFace.call(this,e)},r.prototype.getDepth=function(e){return t.container3dGetDepth.call(this,e)},Object.defineProperty(r.prototype,"position3d",{get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale3d",{get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"euler",{get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pivot3d",{get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)},enumerable:!0,configurable:!0}),r}(PIXI.Mesh);t.Mesh3d2d=e,e.prototype._renderDefault=t.Mesh2d.prototype._renderDefault;var r=function(e){function r(r,n,i,o,a){var s=e.call(this,new PIXI.MeshGeometry(n,i,o),new PIXI.MeshMaterial(r,{program:PIXI.Program.from(t.Mesh2d.defaultVertexShader,t.Mesh2d.defaultFragmentShader),pluginName:"batch2d"}),null,a)||this;return s.autoUpdate=!0,s.geometry.getBuffer("aVertexPosition").static=!1,s}return Dr(r,e),Object.defineProperty(r.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!0,configurable:!0}),r.prototype._render=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),e.prototype._render.call(this,t)},r}(e);t.SimpleMesh3d2d=r}(Fr||(Fr={})),function(t){var e=function(e){function r(r){var n=e.call(this,r)||this;return n.vertexData2d=null,n.culledByFrustrum=!1,n.trimmedCulledByFrustrum=!1,n.proj=new t.Projection3d(n.transform),n.pluginName="batch2d",n}return Dr(r,e),r.prototype.calculateVertices=function(){var t=this._texture;if(this.proj._affine)return this.vertexData2d=null,void e.prototype.calculateVertices.call(this);this.vertexData2d||(this.vertexData2d=new Float32Array(12));var r=this.transform._worldID,n=t._updateID;if(this._transformID!==r||this._textureID!==n){this._textureID!==n&&(this.uvs=t._uvs.uvsFloat32),this._transformID=r,this._textureID=n;var i=this.proj.world.mat4,o=this.vertexData2d,a=this.vertexData,s=t.trim,u=t.orig,l=this._anchor,c=0,h=0,p=0,d=0;s?(c=(h=s.x-l._x*u.width)+s.width,p=(d=s.y-l._y*u.height)+s.height):(c=(h=-l._x*u.width)+u.width,p=(d=-l._y*u.height)+u.height);var f,m=!1;o[0]=i[0]*h+i[4]*d+i[12],o[1]=i[1]*h+i[5]*d+i[13],f=i[2]*h+i[6]*d+i[14],o[2]=i[3]*h+i[7]*d+i[15],m=m||f<0,o[3]=i[0]*c+i[4]*d+i[12],o[4]=i[1]*c+i[5]*d+i[13],f=i[2]*c+i[6]*d+i[14],o[5]=i[3]*c+i[7]*d+i[15],m=m||f<0,o[6]=i[0]*c+i[4]*p+i[12],o[7]=i[1]*c+i[5]*p+i[13],f=i[2]*c+i[6]*p+i[14],o[8]=i[3]*c+i[7]*p+i[15],m=m||f<0,o[9]=i[0]*h+i[4]*p+i[12],o[10]=i[1]*h+i[5]*p+i[13],f=i[2]*h+i[6]*p+i[14],o[11]=i[3]*h+i[7]*p+i[15],m=m||f<0,this.culledByFrustrum=m,a[0]=o[0]/o[2],a[1]=o[1]/o[2],a[2]=o[3]/o[5],a[3]=o[4]/o[5],a[4]=o[6]/o[8],a[5]=o[7]/o[8],a[6]=o[9]/o[11],a[7]=o[10]/o[11]}},r.prototype.calculateTrimmedVertices=function(){if(this.proj._affine)e.prototype.calculateTrimmedVertices.call(this);else{var t=this.transform._worldID,r=this._texture._updateID;if(this.vertexTrimmedData){if(this._transformTrimmedID===t&&this._textureTrimmedID===r)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=t,this._textureTrimmedID=r;var n,i=this._texture,o=this.vertexTrimmedData,a=i.orig,s=this._anchor,u=this.proj.world.mat4,l=-s._x*a.width,c=l+a.width,h=-s._y*a.height,p=h+a.height,d=!1,f=1/(u[3]*l+u[7]*h+u[15]);o[0]=f*(u[0]*l+u[4]*h+u[12]),o[1]=f*(u[1]*l+u[5]*h+u[13]),n=u[2]*l+u[6]*h+u[14],d=d||n<0,f=1/(u[3]*c+u[7]*h+u[15]),o[2]=f*(u[0]*c+u[4]*h+u[12]),o[3]=f*(u[1]*c+u[5]*h+u[13]),n=u[2]*c+u[6]*h+u[14],d=d||n<0,f=1/(u[3]*c+u[7]*p+u[15]),o[4]=f*(u[0]*c+u[4]*p+u[12]),o[5]=f*(u[1]*c+u[5]*p+u[13]),n=u[2]*c+u[6]*p+u[14],d=d||n<0,f=1/(u[3]*l+u[7]*p+u[15]),o[6]=f*(u[0]*l+u[4]*p+u[12]),o[7]=f*(u[1]*l+u[5]*p+u[13]),n=u[2]*l+u[6]*p+u[14],d=d||n<0,this.culledByFrustrum=d}},r.prototype._calculateBounds=function(){if(this.calculateVertices(),!this.culledByFrustrum){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?this._bounds.addQuad(this.vertexData):(this.calculateTrimmedVertices(),this.trimmedCulledByFrustrum||this._bounds.addQuad(this.vertexTrimmedData))}},r.prototype._render=function(t){this.calculateVertices(),this.culledByFrustrum||(t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},r.prototype.containsPoint=function(t){return!this.culledByFrustrum&&e.prototype.containsPoint.call(this,t)},Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),t.container3dToLocal.call(this,e,r,n,i,o)},r.prototype.isFrontFace=function(e){return t.container3dIsFrontFace.call(this,e)},r.prototype.getDepth=function(e){return t.container3dGetDepth.call(this,e)},Object.defineProperty(r.prototype,"position3d",{get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale3d",{get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"euler",{get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pivot3d",{get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)},enumerable:!0,configurable:!0}),r}(PIXI.Sprite);t.Sprite3d=e}(Fr||(Fr={})),function(t){var e=function(e){function r(r,n,i){var o=e.call(this,r,n,i)||this;return o.vertexData2d=null,o.proj=new t.Projection3d(o.transform),o.pluginName="batch2d",o}return Dr(r,e),Object.defineProperty(r.prototype,"worldTransform",{get:function(){return this.proj.affine?this.transform.worldTransform:this.proj.world},enumerable:!0,configurable:!0}),r.prototype.toLocal=function(e,r,n,i,o){return void 0===o&&(o=t.TRANSFORM_STEP.ALL),t.container3dToLocal.call(this,e,r,n,i,o)},r.prototype.isFrontFace=function(e){return t.container3dIsFrontFace.call(this,e)},r.prototype.getDepth=function(e){return t.container3dGetDepth.call(this,e)},Object.defineProperty(r.prototype,"position3d",{get:function(){return this.proj.position},set:function(t){this.proj.position.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scale3d",{get:function(){return this.proj.scale},set:function(t){this.proj.scale.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"euler",{get:function(){return this.proj.euler},set:function(t){this.proj.euler.copyFrom(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pivot3d",{get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copyFrom(t)},enumerable:!0,configurable:!0}),r}(PIXI.Text);t.Text3d=e,e.prototype.calculateVertices=t.Sprite3d.prototype.calculateVertices,e.prototype.calculateTrimmedVertices=t.Sprite3d.prototype.calculateTrimmedVertices,e.prototype._calculateBounds=t.Sprite3d.prototype._calculateBounds,e.prototype.containsPoint=t.Sprite3d.prototype.containsPoint,e.prototype._render=t.Sprite3d.prototype._render}(Fr||(Fr={})),function(t){var e={worldTransform:{get:t.container3dWorldTransform,enumerable:!0,configurable:!0},position3d:{get:function(){return this.proj.position},set:function(t){this.proj.position.copy(t)}},scale3d:{get:function(){return this.proj.scale},set:function(t){this.proj.scale.copy(t)}},pivot3d:{get:function(){return this.proj.pivot},set:function(t){this.proj.pivot.copy(t)}},euler:{get:function(){return this.proj.euler},set:function(t){this.proj.euler.copy(t)}}};function r(){this.proj||(this.proj=new t.Projection3d(this.transform),this.toLocal=t.Container3d.prototype.toLocal,this.isFrontFace=t.Container3d.prototype.isFrontFace,this.getDepth=t.Container3d.prototype.getDepth,Object.defineProperties(this,e))}PIXI.Container.prototype.convertTo3d=r,PIXI.Sprite.prototype.convertTo3d=function(){this.proj||(this.calculateVertices=t.Sprite3d.prototype.calculateVertices,this.calculateTrimmedVertices=t.Sprite3d.prototype.calculateTrimmedVertices,this._calculateBounds=t.Sprite3d.prototype._calculateBounds,this.containsPoint=t.Sprite3d.prototype.containsPoint,this.pluginName="batch2d",r.call(this))},PIXI.Container.prototype.convertSubtreeTo3d=function(){this.convertTo3d();for(var t=0;t<this.children.length;t++)this.children[t].convertSubtreeTo3d()},PIXI.SimpleMesh&&(PIXI.SimpleMesh.prototype.convertTo3d=PIXI.SimpleRope.prototype.convertTo3d=function(){this.proj||(this.calculateVertices=t.Mesh3d2d.prototype.calculateVertices,this._renderDefault=t.Mesh3d2d.prototype._renderDefault,"batch2d"!==this.material.pluginName&&(this.material=new PIXI.MeshMaterial(this.material.texture,{program:PIXI.Program.from(t.Mesh2d.defaultVertexShader,t.Mesh2d.defaultFragmentShader),pluginName:"batch2d"})),r.call(this))})}(Fr||(Fr={}));class Br extends et{constructor(t){super(),tt(this,t,jr,kr,o,{width:4,height:5,editMode:6,canvas:7,status:3,getCanvasRef:8})}get getCanvasRef(){return this.$$.ctx[8]}}function zr(t){let e;const r=t[2].default,n=u(r,t,t[1],null);return{c(){n&&n.c()},m(t,r){n&&n.m(t,r),e=!0},p(t,e){n&&n.p&&2&e&&c(n,r,t,t[1],e,null,null)},i(t){e||(Y(n,t),e=!0)},o(t){q(n,t),e=!1},d(t){n&&n.d(t)}}}function Gr(t){let e,r,n="initialized"===t[0]&&zr(t);return{c(){n&&n.c(),e=b()},m(t,i){n&&n.m(t,i),d(t,e,i),r=!0},p(t,[r]){"initialized"===t[0]?n?(n.p(t,r),1&r&&Y(n,1)):(n=zr(t),n.c(),Y(n,1),n.m(e.parentNode,e)):n&&(X(),q(n,1,1,(()=>{n=null})),W())},i(t){r||(Y(n),r=!0)},o(t){q(n),r=!1},d(t){n&&n.d(t),t&&f(e)}}}function Vr(t,e,r){let{$$slots:n={},$$scope:i}=e;const{getApp:o,pixiStore:a}=O(Mr),s=o();let u="loaded";return console.log("SketchWrapper",{status:u}),s.ticker.start(),I((()=>{r(0,u="mounted"),console.log("SketchWrapper",{status:u}),a.sketchWrapperDestructor.set((()=>(s.ticker.stop(),r(0,u="destroyed"),console.log("SketchWrapper",{status:u}),!0))),r(0,u="initialized"),console.log("SketchWrapper",{status:u})})),t.$$set=t=>{"$$scope"in t&&r(1,i=t.$$scope)},[u,i,n]}class Hr extends et{constructor(t){super(),tt(this,t,Vr,Gr,o,{})}}function Xr(t,e,r){let{x:n=0}=e,{y:i=0}=e,{offset:o=[]}=e,{width:a}=e,{height:s}=e,{fill:u=16777215}=e,{brightness:l=null}=e,{filters:c=[]}=e,{scale:h=1}=e,{position:p="center"}=e,{lineWidth:d=null}=e,{lineColor:f=null}=e;const{getApp:m,pixiStore:g}=O(Mr),v=m(),y=new Ir;let x,b,_=!1;return g.editMode.subscribe((t=>{_=t,x&&x.showHelper(t)})),I((()=>{console.log("RectElement mounted");let t=new Pr.Graphics;d&&(t.lineStyle(d,f),t.drawRect(0,0,a,s)),b=new Pr.Graphics,b.lineStyle(0),b.beginFill(u,1).drawRect(0,0,a,s).endFill(),b.filters=c,t.addChild(b),x=new Cr(t,v.renderer,v.screen,_),x.x=n,x.y=i,x.setOffset(...o),y.makeDraggable(x.group,x.sprite),v.stage.addChild(x.group);const e=function(t,e,r,n,i){let o=()=>{};return"center"===t?o=()=>{r.setTransform((1+n-n*e)/2,(1+i-i*e)/2,e,e)}:"bottom"===t&&(o=()=>{r.setTransform(0,i-i*e,1,e)}),o}(p,h,b,a,s);let r,m,w;const T=function(){x.update(),e(),l&&(r=Math.ceil((u>>16)*l),m=Math.ceil((u>>8&255)*l),w=Math.ceil((255&u)*l),b.tint=(1<<24)+(r<<16)+(m<<8)+w&16777215)};v.ticker.add(T),g.destructors.update((t=>[...t,()=>{v.ticker.remove(T,this),console.log("RectElement destroyed")}]))})),t.$$set=t=>{"x"in t&&r(0,n=t.x),"y"in t&&r(1,i=t.y),"offset"in t&&r(2,o=t.offset),"width"in t&&r(3,a=t.width),"height"in t&&r(4,s=t.height),"fill"in t&&r(5,u=t.fill),"brightness"in t&&r(6,l=t.brightness),"filters"in t&&r(7,c=t.filters),"scale"in t&&r(8,h=t.scale),"position"in t&&r(9,p=t.position),"lineWidth"in t&&r(10,d=t.lineWidth),"lineColor"in t&&r(11,f=t.lineColor)},[n,i,o,a,s,u,l,c,h,p,d,f]}class Wr extends et{constructor(t){super(),tt(this,t,Xr,null,o,{x:0,y:1,offset:2,width:3,height:4,fill:5,brightness:6,filters:7,scale:8,position:9,lineWidth:10,lineColor:11})}}function Yr(t,e,r){let{text:n}=e,{x:i}=e,{y:o}=e,{width:a}=e,{height:s}=e,{style:u={opacity:1,scale:1}}=e,{textStyle:l={}}=e,{fontSize:c=26}=e,{fill:h=0}=e;const{getApp:p,pixiStore:d}=O(Mr),f=p(),m=new Ir,g=new Pr.Text(n,{...l,fontSize:c,fill:h}),v=g;let y,x=!1;return d.editMode.subscribe((t=>{x=t,y&&y.showHelper(t)})),I((()=>{let t=new Pr.Graphics;t.lineStyle(0),t.drawRect(0,0,a,s),t.addChild(g),y=new Cr(t,f.renderer,f.screen,x),y.x=i,y.y=o,m.makeDraggable(y.group,y.sprite),f.stage.addChild(y.group);const e=()=>{g.text=n,g.alpha=u.opacity,g.setTransform(a/2-c*u.scale/2,s/2-c*u.scale/2,u.scale,u.scale),y.update()};f.ticker.add(e),d.destructors.update((t=>[...t,()=>{f.ticker.remove(e,this),console.log("TextElement destroyed")}]))})),t.$$set=t=>{"text"in t&&r(0,n=t.text),"x"in t&&r(1,i=t.x),"y"in t&&r(2,o=t.y),"width"in t&&r(3,a=t.width),"height"in t&&r(4,s=t.height),"style"in t&&r(5,u=t.style),"textStyle"in t&&r(6,l=t.textStyle),"fontSize"in t&&r(7,c=t.fontSize),"fill"in t&&r(8,h=t.fill)},t.$$.update=()=>{256&t.$$.dirty&&(g.tint=h)},[n,i,o,a,s,u,l,c,h,v]}class qr extends et{constructor(t){super(),tt(this,t,Yr,null,o,{text:0,x:1,y:2,width:3,height:4,style:5,textStyle:6,fontSize:7,fill:8,pixiObj:9})}get pixiObj(){return this.$$.ctx[9]}}var $r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Qr(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}function Zr(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})})),e}var Jr=Qr((function(t,e){var r;r=function(){var t=null,e={};m();var r=[],n=function(e){if(void 0!==(e=e||{}).seed&&null!==e.seed&&e.seed===parseInt(e.seed,10))t=e.seed;else if("string"==typeof e.seed)t=x(e.seed);else{if(void 0!==e.seed&&null!==e.seed)throw new TypeError("The seed value must be an integer or string");t=null}var u,l;if(null!==e.count&&void 0!==e.count){for(var c=e.count,h=[],p=0;p<e.count;p++)r.push(!1);for(e.count=null;c>h.length;){var d=n(e);null!==t&&(e.seed=t),h.push(d)}return e.count=c,h}return s([u=i(e),l=o(u,e),a(u,l,e)],e)};function i(t){if(r.length>0){var e=p(o=b(t.hue)),n=(o[1]-o[0])/r.length,i=parseInt((e-o[0])/n);return!0===r[i]?i=(i+2)%r.length:r[i]=!0,(e=p(o=[(o[0]+i*n)%359,(o[0]+(i+1)*n)%359]))<0&&(e=360+e),e}var o;return(e=p(o=l(t.hue)))<0&&(e=360+e),e}function o(t,e){if("monochrome"===e.hue)return 0;if("random"===e.luminosity)return p([0,100]);var r=c(t),n=r[0],i=r[1];switch(e.luminosity){case"bright":n=55;break;case"dark":n=i-10;break;case"light":i=55}return p([n,i])}function a(t,e,r){var n=u(t,e),i=100;switch(r.luminosity){case"dark":i=n+20;break;case"light":n=(i+n)/2;break;case"random":n=0,i=100}return p([n,i])}function s(t,e){switch(e.format){case"hsvArray":return t;case"hslArray":return y(t);case"hsl":var r=y(t);return"hsl("+r[0]+", "+r[1]+"%, "+r[2]+"%)";case"hsla":var n=y(t),i=e.alpha||Math.random();return"hsla("+n[0]+", "+n[1]+"%, "+n[2]+"%, "+i+")";case"rgbArray":return g(t);case"rgb":return"rgb("+g(t).join(", ")+")";case"rgba":var o=g(t);return i=e.alpha||Math.random(),"rgba("+o.join(", ")+", "+i+")";default:return d(t)}}function u(t,e){for(var r=h(t).lowerBounds,n=0;n<r.length-1;n++){var i=r[n][0],o=r[n][1],a=r[n+1][0],s=r[n+1][1];if(e>=i&&e<=a){var u=(s-o)/(a-i);return u*e+(o-u*i)}}return 0}function l(t){if("number"==typeof parseInt(t)){var r=parseInt(t);if(r<360&&r>0)return[r,r]}if("string"==typeof t)if(e[t]){var n=e[t];if(n.hueRange)return n.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var i=v(t)[0];return[i,i]}return[0,360]}function c(t){return h(t).saturationRange}function h(t){for(var r in t>=334&&t<=360&&(t-=360),e){var n=e[r];if(n.hueRange&&t>=n.hueRange[0]&&t<=n.hueRange[1])return e[r]}return"Color not found"}function p(e){if(null===t){var r=.618033988749895,n=Math.random();return n+=r,n%=1,Math.floor(e[0]+n*(e[1]+1-e[0]))}var i=e[1]||1,o=e[0]||0,a=(t=(9301*t+49297)%233280)/233280;return Math.floor(o+a*(i-o))}function d(t){var e=g(t);function r(t){var e=t.toString(16);return 1==e.length?"0"+e:e}return"#"+r(e[0])+r(e[1])+r(e[2])}function f(t,r,n){var i=n[0][0],o=n[n.length-1][0],a=n[n.length-1][1],s=n[0][1];e[t]={hueRange:r,lowerBounds:n,saturationRange:[i,o],brightnessRange:[a,s]}}function m(){f("monochrome",null,[[0,0],[100,0]]),f("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),f("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),f("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),f("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),f("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),f("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),f("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function g(t){var e=t[0];0===e&&(e=1),360===e&&(e=359),e/=360;var r=t[1]/100,n=t[2]/100,i=Math.floor(6*e),o=6*e-i,a=n*(1-r),s=n*(1-o*r),u=n*(1-(1-o)*r),l=256,c=256,h=256;switch(i){case 0:l=n,c=u,h=a;break;case 1:l=s,c=n,h=a;break;case 2:l=a,c=n,h=u;break;case 3:l=a,c=s,h=n;break;case 4:l=u,c=a,h=n;break;case 5:l=n,c=a,h=s}return[Math.floor(255*l),Math.floor(255*c),Math.floor(255*h)]}function v(t){t=3===(t=t.replace(/^#/,"")).length?t.replace(/(.)/g,"$1$1"):t;var e=parseInt(t.substr(0,2),16)/255,r=parseInt(t.substr(2,2),16)/255,n=parseInt(t.substr(4,2),16)/255,i=Math.max(e,r,n),o=i-Math.min(e,r,n),a=i?o/i:0;switch(i){case e:return[(r-n)/o%6*60||0,a,i];case r:return[60*((n-e)/o+2)||0,a,i];case n:return[60*((e-r)/o+4)||0,a,i]}}function y(t){var e=t[0],r=t[1]/100,n=t[2]/100,i=(2-r)*n;return[e,Math.round(r*n/(i<1?i:2-i)*1e4)/100,i/2*100]}function x(t){for(var e=0,r=0;r!==t.length&&!(e>=Number.MAX_SAFE_INTEGER);r++)e+=t.charCodeAt(r);return e}function b(t){if(isNaN(t)){if("string"==typeof t)if(e[t]){var r=e[t];if(r.hueRange)return r.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i))return h(v(t)[0]).hueRange}else{var n=parseInt(t);if(n<360&&n>0)return h(t).hueRange}return[0,360]}return n}(),t&&t.exports&&(e=t.exports=r),e.randomColor=r}));function Kr(t,e,r){let{shape:n="circle"}=e,{x:i=0}=e,{y:o=0}=e,{offset:a=[]}=e,{width:s}=e,{height:u}=e,{n:l=20}=e,{fill:c}=e,{randomFill:h=!1}=e,{hue:p=null}=e,{alpha:d=.5}=e,{delta:f=.2}=e,{direction:m="up"}=e;const g={up:{x:0,y:-1},down:{x:0,y:1},right:{x:1,y:0},left:{x:-1,y:0}},{getApp:v,pixiStore:y}=O(Mr),x=v(),b=new Ir;let _,w=!1;const T=_;y.editMode.subscribe((t=>{w=t,_&&_.showHelper(t)}));let E=[];let S=Jr({count:8,hue:p,alpha:d}).map((t=>parseInt(t.substr(1),16))),A=p;return I((()=>{console.log("FloatElement mounted");let t=new Pr.Graphics;t.lineStyle(0,13421772),t.beginFill(16777215,1e-4).drawRect(0,0,s,u).endFill();for(let e=0;e<l;e++){const e=new Pr.Graphics,r=s*(1-Math.random()),i=u*(1-Math.random());let o=c;!c&&h&&(o=S[Math.floor(S.length*Math.random())]),"line"===n?e.beginFill(o).drawRect(0,0,2,50).endFill():"triangle"===n?e.beginFill(o).moveTo(0,0).lineTo(50,25).lineTo(0,50).lineTo(0,0).endFill():e.beginFill(o).drawCircle(0,0,10).endFill(),e.x=r,e.y=i,e.initialX=r,e.initialY=i,E.push(e),t.addChild(e)}_=new Cr(t,x.renderer,x.screen,w),_.x=i,_.y=o,_.setOffset(...a),b.makeDraggable(_.group,_.sprite),x.stage.addChild(_.group);const e=()=>{_.update(),"up"===m||"down"===m?E.map(((t,e)=>{r(14,E[e].y=(u+(E[e].y+g[m].y*f))%u,E)})):"left"===m||"right"===m?E.map(((t,e)=>{r(14,E[e].x=(s+(E[e].x+g[m].x*f*1.5))%s,E)})):"zoom"===m&&E.map(((t,e)=>{let n=E[e].scale.x-1+.01;(1===E[e].scale.x||n>=1)&&(n=-.5*Math.random());let i=1+n;E[e].setTransform(E[e].initialX+(50-50*i)/2,E[e].initialY+(50-50*i)/2,i,i),r(14,E[e].alpha=2-i,E)}))};x.ticker.add(e),y.destructors.update((t=>[...t,()=>{x.ticker.remove(e,this),console.log("RectElement destroyed")}]))})),t.$$set=t=>{"shape"in t&&r(0,n=t.shape),"x"in t&&r(1,i=t.x),"y"in t&&r(2,o=t.y),"offset"in t&&r(3,a=t.offset),"width"in t&&r(4,s=t.width),"height"in t&&r(5,u=t.height),"n"in t&&r(6,l=t.n),"fill"in t&&r(7,c=t.fill),"randomFill"in t&&r(8,h=t.randomFill),"hue"in t&&r(9,p=t.hue),"alpha"in t&&r(10,d=t.alpha),"delta"in t&&r(11,f=t.delta),"direction"in t&&r(12,m=t.direction)},t.$$.update=()=>{116224&t.$$.dirty&&p!==A&&(r(15,S=Jr({count:8,hue:p,alpha:d}).map((t=>parseInt(t.substr(1),16)))),E.length&&E.map(((t,e)=>{r(14,E[e].tint=S[Math.floor(S.length*Math.random())],E)})),r(16,A=p)),16512&t.$$.dirty&&c&&E.length&&E.map(((t,e)=>{r(14,E[e].tint=c,E)}))},[n,i,o,a,s,u,l,c,h,p,d,f,m,T,E,S,A]}class tn extends et{constructor(t){super(),tt(this,t,Kr,null,o,{shape:0,x:1,y:2,offset:3,width:4,height:5,n:6,fill:7,randomFill:8,hue:9,alpha:10,delta:11,direction:12,pixiObj:13})}get pixiObj(){return this.$$.ctx[13]}}function en(t,e,r){let{x:n=0}=e,{y:i=0}=e,{width:o}=e,{height:a}=e,{offset:s=[]}=e,{stroke:u=16777215}=e,{lineWidth:l=1}=e,{filters:c=[]}=e,{scale:h}=e;const{getApp:p,pixiStore:d}=O(Mr),f=p(),m=new Ir;let g,v=new Pr.Graphics,y=!1;return d.editMode.subscribe((t=>{y=t,g&&g.showHelper(t)})),I((()=>{let t=new Pr.Graphics;t.lineStyle(l,u),t.drawRect(0,0,o,a),v.lineStyle(l,u),v.beginFill(0,0).drawRect(0,0,o,a).endFill(),v.filters=c,t.addChild(v),g=new Cr(t,f.renderer,f.screen,y),g.x=n,g.y=i,g.setOffset(...s),m.makeDraggable(g.group,g.sprite),f.stage.addChild(g.group);const e=()=>{g.update(),v.setTransform((1+o-o*h)/2,(1+a-a*h)/2,h,h)};f.ticker.add(e),d.destructors.update((t=>[...t,()=>{f.ticker.remove(e,this),console.log("RectElement destroyed")}]))})),t.$$set=t=>{"x"in t&&r(0,n=t.x),"y"in t&&r(1,i=t.y),"width"in t&&r(2,o=t.width),"height"in t&&r(3,a=t.height),"offset"in t&&r(4,s=t.offset),"stroke"in t&&r(5,u=t.stroke),"lineWidth"in t&&r(6,l=t.lineWidth),"filters"in t&&r(7,c=t.filters),"scale"in t&&r(8,h=t.scale)},[n,i,o,a,s,u,l,c,h]}class rn extends et{constructor(t){super(),tt(this,t,en,null,o,{x:0,y:1,width:2,height:3,offset:4,stroke:5,lineWidth:6,filters:7,scale:8})}}function nn(t,e,r){let{x:n=0}=e,{y:i=0}=e,{offset:o=[]}=e,{width:a}=e,{height:s}=e,{fills:u=[16777215,16738740]}=e,{fillWidth:l=50}=e,{filters:c=[]}=e,{scale:h=1}=e,{position:p="center"}=e,{lineWidth:d=null}=e,{lineColor:f=null}=e;const{getApp:m,pixiStore:g}=O(Mr),v=m(),y=new Ir;let x,b,_=!1;return g.editMode.subscribe((t=>{_=t,x&&x.showHelper(t)})),I((()=>{let t=new Pr.Graphics;d&&(t.lineStyle(d,f),t.drawRect(0,0,a,s)),b=new Pr.Graphics,b.lineStyle(0);for(let t=0;t<a/l;t++)b.beginFill(u[t%u.length],1).drawRect(l*t,0,l,s).endFill();b.filters=c,t.addChild(b),x=new Cr(t,v.renderer,v.screen,_),x.x=n,x.y=i,x.setOffset(...o),y.makeDraggable(x.group,x.sprite),v.stage.addChild(x.group);const e=function(t,e,r,n,i){let o=()=>{};return"center"===t?o=()=>{r.setTransform((1+n-n*e)/2,(1+i-i*e)/2,e,e)}:"bottom"===t&&(o=()=>{r.setTransform(0,i-i*e,1,e)}),o}(p,h,b,a,s),r=()=>{x.update(),e()};v.ticker.add(r),g.destructors.update((t=>[...t,()=>{v.ticker.remove(r,this),console.log("RectElement destroyed")}]))})),t.$$set=t=>{"x"in t&&r(0,n=t.x),"y"in t&&r(1,i=t.y),"offset"in t&&r(2,o=t.offset),"width"in t&&r(3,a=t.width),"height"in t&&r(4,s=t.height),"fills"in t&&r(5,u=t.fills),"fillWidth"in t&&r(6,l=t.fillWidth),"filters"in t&&r(7,c=t.filters),"scale"in t&&r(8,h=t.scale),"position"in t&&r(9,p=t.position),"lineWidth"in t&&r(10,d=t.lineWidth),"lineColor"in t&&r(11,f=t.lineColor)},[n,i,o,a,s,u,l,c,h,p,d,f]}class on extends et{constructor(t){super(),tt(this,t,nn,null,o,{x:0,y:1,offset:2,width:3,height:4,fills:5,fillWidth:6,filters:7,scale:8,position:9,lineWidth:10,lineColor:11})}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e});var an=0,sn=1,un=2,ln=0,cn=1,hn=2,pn=3;function dn(){}Object.assign(dn.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}});for(var fn=[],mn=0;mn<256;mn++)fn[mn]=(mn<16?"0":"")+mn.toString(16);var gn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(fn[255&t]+fn[t>>8&255]+fn[t>>16&255]+fn[t>>24&255]+"-"+fn[255&e]+fn[e>>8&255]+"-"+fn[e>>16&15|64]+fn[e>>24&255]+"-"+fn[63&r|128]+fn[r>>8&255]+"-"+fn[r>>16&255]+fn[r>>24&255]+fn[255&n]+fn[n>>8&255]+fn[n>>16&255]+fn[n>>24&255]).toUpperCase()},clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*gn.DEG2RAD},radToDeg:function(t){return t*gn.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function vn(t,e){this.x=t||0,this.y=e||0}function yn(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}Object.defineProperties(vn.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(vn.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*r-o*n+t.x,this.y=i*n+o*r+t.y,this}}),Object.assign(yn,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,a){var s=r[n+0],u=r[n+1],l=r[n+2],c=r[n+3],h=i[o+0],p=i[o+1],d=i[o+2],f=i[o+3];if(c!==f||s!==h||u!==p||l!==d){var m=1-a,g=s*h+u*p+l*d+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,g*v);m=Math.sin(m*b)/x,a=Math.sin(a*b)/x}var _=a*v;if(s=s*m+h*_,u=u*m+p*_,l=l*m+d*_,c=c*m+f*_,m===1-a){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}t[e]=s,t[e+1]=u,t[e+2]=l,t[e+3]=c}}),Object.defineProperties(yn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(yn.prototype,{isQuaternion:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,o=t.order,a=Math.cos,s=Math.sin,u=a(r/2),l=a(n/2),c=a(i/2),h=s(r/2),p=s(n/2),d=s(i/2);return"XYZ"===o?(this._x=h*l*c+u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c-h*p*d):"YXZ"===o?(this._x=h*l*c+u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c+h*p*d):"ZXY"===o?(this._x=h*l*c-u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c-h*p*d):"ZYX"===o?(this._x=h*l*c-u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c+h*p*d):"YZX"===o?(this._x=h*l*c+u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c-h*p*d):"XZY"===o&&(this._x=h*l*c-u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c+h*p*d),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],u=r[9],l=r[2],c=r[6],h=r[10],p=n+s+h;return p>0?(e=.5/Math.sqrt(p+1),this._w=.25/e,this._x=(c-u)*e,this._y=(o-l)*e,this._z=(a-i)*e):n>s&&n>h?(e=2*Math.sqrt(1+n-s-h),this._w=(c-u)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+l)/e):s>h?(e=2*Math.sqrt(1+s-n-h),this._w=(o-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(u+c)/e):(e=2*Math.sqrt(1+h-n-s),this._w=(a-i)/e,this._x=(o+l)/e,this._y=(u+c)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(gn.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var n=Math.min(1,e/r);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,a=e._x,s=e._y,u=e._z,l=e._w;return this._x=r*l+o*a+n*u-i*s,this._y=n*l+o*s+i*a-r*u,this._z=i*l+o*u+r*s-n*a,this._w=o*l-r*a-n*s-i*u,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*t._w+r*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var u=1-e;return this._w=u*o+e*this._w,this._x=u*r+e*this._x,this._y=u*n+e*this._y,this._z=u*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,p=Math.sin(e*c)/l;return this._w=o*h+this._w*p,this._x=r*h+this._x*p,this._y=n*h+this._y*p,this._z=i*h+this._z*p,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var xn=new _n,bn=new yn;function _n(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Object.assign(_n.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(bn.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(bn.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=t.w,u=s*e+o*n-a*r,l=s*r+a*e-i*n,c=s*n+i*r-o*e,h=-i*e-o*r-a*n;return this.x=u*s+h*-i+l*-a-c*-o,this.y=l*s+h*-o+c*-i-u*-a,this.z=c*s+h*-a+u*-o-l*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(t){return xn.copy(this).projectOnVector(t),this.sub(xn)},reflect:function(t){return this.sub(xn.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());0===e&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var r=this.dot(t)/e;return Math.acos(gn.clamp(r,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});var wn,Tn=new _n;function En(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(En.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,a,s,u){var l=this.elements;return l[0]=t,l[1]=n,l[2]=a,l[3]=e,l[4]=i,l[5]=s,l[6]=r,l[7]=o,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(t){for(var e=0,r=t.count;e<r;e++)Tn.x=t.getX(e),Tn.y=t.getY(e),Tn.z=t.getZ(e),Tn.applyMatrix3(this),t.setXYZ(e,Tn.x,Tn.y,Tn.z);return t},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[3],s=r[6],u=r[1],l=r[4],c=r[7],h=r[2],p=r[5],d=r[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],x=n[7],b=n[2],_=n[5],w=n[8];return i[0]=o*f+a*v+s*b,i[3]=o*m+a*y+s*_,i[6]=o*g+a*x+s*w,i[1]=u*f+l*v+c*b,i[4]=u*m+l*y+c*_,i[7]=u*g+l*x+c*w,i[2]=h*f+p*v+d*b,i[5]=h*m+p*y+d*_,i[8]=h*g+p*x+d*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*o*l-e*a*u-r*i*l+r*a*s+n*i*u-n*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,n=this.elements,i=r[0],o=r[1],a=r[2],s=r[3],u=r[4],l=r[5],c=r[6],h=r[7],p=r[8],d=p*u-l*h,f=l*c-p*s,m=h*s-u*c,g=i*d+o*f+a*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return n[0]=d*y,n[1]=(a*h-p*o)*y,n[2]=(l*o-a*u)*y,n[3]=f*y,n[4]=(p*i-a*c)*y,n[5]=(a*s-l*i)*y,n[6]=m*y,n[7]=(o*c-h*i)*y,n[8]=(u*i-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,a){var s=Math.cos(i),u=Math.sin(i);this.set(r*s,r*u,-r*(s*o+u*a)+o+t,-n*u,n*s,-n*(-u*o+s*a)+a+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],o=n[3],a=n[6],s=n[1],u=n[4],l=n[7];return n[0]=e*i+r*s,n[3]=e*o+r*u,n[6]=e*a+r*l,n[1]=-r*i+e*s,n[4]=-r*o+e*u,n[7]=-r*a+e*l,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var Sn={getDataURL:function(t){var e;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===wn&&(wn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),wn.width=t.width,wn.height=t.height;var r=wn.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=wn}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},An=0;function Pn(t,e,r,n,i,o,a,s,u,l){Object.defineProperty(this,"id",{value:An++}),this.uuid=gn.generateUUID(),this.name="",this.image=void 0!==t?t:Pn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Pn.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:1001,this.wrapT=void 0!==n?n:1001,this.magFilter=void 0!==i?i:1006,this.minFilter=void 0!==o?o:1008,this.anisotropy=void 0!==u?u:1,this.format=void 0!==a?a:1023,this.type=void 0!==s?s:1009,this.offset=new vn(0,0),this.repeat=new vn(1,1),this.center=new vn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new En,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:3e3,this.version=0,this.onUpdate=null}function Mn(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function In(t,e,r){this.width=t,this.height=e,this.scissor=new Mn(0,0,t,e),this.scissorTest=!1,this.viewport=new Mn(0,0,t,e),r=r||{},this.texture=new Pn(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:1006,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function On(t,e,r){In.call(this,t,e,r),this.samples=4}Pn.DEFAULT_IMAGE=void 0,Pn.DEFAULT_MAPPING=300,Pn.prototype=Object.assign(Object.create(dn.prototype),{constructor:Pn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=gn.generateUUID()),!e&&void 0===t.images[n.uuid]){var i;if(Array.isArray(n)){i=[];for(var o=0,a=n.length;o<a;o++)i.push(Sn.getDataURL(n[o]))}else i=Sn.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Pn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(Mn.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Mn.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=.01,a=.1,s=t.elements,u=s[0],l=s[4],c=s[8],h=s[1],p=s[5],d=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(l-h)<o&&Math.abs(c-f)<o&&Math.abs(d-m)<o){if(Math.abs(l+h)<a&&Math.abs(c+f)<a&&Math.abs(d+m)<a&&Math.abs(u+p+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var v=(u+1)/2,y=(p+1)/2,x=(g+1)/2,b=(l+h)/4,_=(c+f)/4,w=(d+m)/4;return v>y&&v>x?v<o?(r=0,n=.707106781,i=.707106781):(n=b/(r=Math.sqrt(v)),i=_/r):y>x?y<o?(r=.707106781,n=0,i=.707106781):(r=b/(n=Math.sqrt(y)),i=w/n):x<o?(r=.707106781,n=.707106781,i=0):(r=_/(i=Math.sqrt(x)),n=w/i),this.set(r,n,i,e),this}var T=Math.sqrt((m-d)*(m-d)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(T)<.001&&(T=1),this.x=(m-d)/T,this.y=(c-f)/T,this.z=(h-l)/T,this.w=Math.acos((u+p+g-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),In.prototype=Object.assign(Object.create(dn.prototype),{constructor:In,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),On.prototype=Object.assign(Object.create(In.prototype),{constructor:On,isWebGLMultisampleRenderTarget:!0,copy:function(t){return In.prototype.copy.call(this,t),this.samples=t.samples,this}});var Cn=new _n,Rn=new kn,Ln=new _n(0,0,0),Nn=new _n(1,1,1),Fn=new _n,Dn=new _n,Un=new _n;function kn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(kn.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,a,s,u,l,c,h,p,d,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new kn).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,r=t.elements,n=1/Cn.setFromMatrixColumn(t,0).length(),i=1/Cn.setFromMatrixColumn(t,1).length(),o=1/Cn.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),u=Math.sin(n),l=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){var h=o*l,p=o*c,d=a*l,f=a*c;e[0]=s*l,e[4]=-s*c,e[8]=u,e[1]=p+d*u,e[5]=h-f*u,e[9]=-a*s,e[2]=f-h*u,e[6]=d+p*u,e[10]=o*s}else if("YXZ"===t.order){var m=s*l,g=s*c,v=u*l,y=u*c;e[0]=m+y*a,e[4]=v*a-g,e[8]=o*u,e[1]=o*c,e[5]=o*l,e[9]=-a,e[2]=g*a-v,e[6]=y+m*a,e[10]=o*s}else if("ZXY"===t.order){m=s*l,g=s*c,v=u*l,y=u*c;e[0]=m-y*a,e[4]=-o*c,e[8]=v+g*a,e[1]=g+v*a,e[5]=o*l,e[9]=y-m*a,e[2]=-o*u,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){h=o*l,p=o*c,d=a*l,f=a*c;e[0]=s*l,e[4]=d*u-p,e[8]=h*u+f,e[1]=s*c,e[5]=f*u+h,e[9]=p*u-d,e[2]=-u,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var x=o*s,b=o*u,_=a*s,w=a*u;e[0]=s*l,e[4]=w-x*c,e[8]=_*c+b,e[1]=c,e[5]=o*l,e[9]=-a*l,e[2]=-u*l,e[6]=b*c+_,e[10]=x-w*c}else if("XZY"===t.order){x=o*s,b=o*u,_=a*s,w=a*u;e[0]=s*l,e[4]=-c,e[8]=u*l,e[1]=x*c+w,e[5]=o*l,e[9]=b*c-_,e[2]=_*c-b,e[6]=a*l,e[10]=w*c+x}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Ln,t,Nn)},lookAt:function(t,e,r){var n=this.elements;return Un.subVectors(t,e),0===Un.lengthSq()&&(Un.z=1),Un.normalize(),Fn.crossVectors(r,Un),0===Fn.lengthSq()&&(1===Math.abs(r.z)?Un.x+=1e-4:Un.z+=1e-4,Un.normalize(),Fn.crossVectors(r,Un)),Fn.normalize(),Dn.crossVectors(Un,Fn),n[0]=Fn.x,n[4]=Dn.x,n[8]=Un.x,n[1]=Fn.y,n[5]=Dn.y,n[9]=Un.y,n[2]=Fn.z,n[6]=Dn.z,n[10]=Un.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[4],s=r[8],u=r[12],l=r[1],c=r[5],h=r[9],p=r[13],d=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],b=r[15],_=n[0],w=n[4],T=n[8],E=n[12],S=n[1],A=n[5],P=n[9],M=n[13],I=n[2],O=n[6],C=n[10],R=n[14],L=n[3],N=n[7],F=n[11],D=n[15];return i[0]=o*_+a*S+s*I+u*L,i[4]=o*w+a*A+s*O+u*N,i[8]=o*T+a*P+s*C+u*F,i[12]=o*E+a*M+s*R+u*D,i[1]=l*_+c*S+h*I+p*L,i[5]=l*w+c*A+h*O+p*N,i[9]=l*T+c*P+h*C+p*F,i[13]=l*E+c*M+h*R+p*D,i[2]=d*_+f*S+m*I+g*L,i[6]=d*w+f*A+m*O+g*N,i[10]=d*T+f*P+m*C+g*F,i[14]=d*E+f*M+m*R+g*D,i[3]=v*_+y*S+x*I+b*L,i[7]=v*w+y*A+x*O+b*N,i[11]=v*T+y*P+x*C+b*F,i[15]=v*E+y*M+x*R+b*D,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(t){for(var e=0,r=t.count;e<r;e++)Cn.x=t.getX(e),Cn.y=t.getY(e),Cn.z=t.getZ(e),Cn.applyMatrix4(this),t.setXYZ(e,Cn.x,Cn.y,Cn.z);return t},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],u=t[13],l=t[2],c=t[6],h=t[10],p=t[14];return t[3]*(+i*s*c-n*u*c-i*a*h+r*u*h+n*a*p-r*s*p)+t[7]*(+e*s*p-e*u*h+i*o*h-n*o*p+n*u*l-i*s*l)+t[11]*(+e*u*c-e*a*p-i*o*c+r*o*p+i*a*l-r*u*l)+t[15]*(-n*a*l-e*s*c+e*a*h+n*o*c-r*o*h+r*s*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,r){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],p=n[8],d=n[9],f=n[10],m=n[11],g=n[12],v=n[13],y=n[14],x=n[15],b=d*y*h-v*f*h+v*c*m-l*y*m-d*c*x+l*f*x,_=g*f*h-p*y*h-g*c*m+u*y*m+p*c*x-u*f*x,w=p*v*h-g*d*h+g*l*m-u*v*m-p*l*x+u*d*x,T=g*d*c-p*v*c-g*l*f+u*v*f+p*l*y-u*d*y,E=i*b+o*_+a*w+s*T;if(0===E){var S="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(S);return console.warn(S),this.identity()}var A=1/E;return r[0]=b*A,r[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*x-o*f*x)*A,r[2]=(l*y*s-v*c*s+v*a*h-o*y*h-l*a*x+o*c*x)*A,r[3]=(d*c*s-l*f*s-d*a*h+o*f*h+l*a*m-o*c*m)*A,r[4]=_*A,r[5]=(p*y*s-g*f*s+g*a*m-i*y*m-p*a*x+i*f*x)*A,r[6]=(g*c*s-u*y*s-g*a*h+i*y*h+u*a*x-i*c*x)*A,r[7]=(u*f*s-p*c*s+p*a*h-i*f*h-u*a*m+i*c*m)*A,r[8]=w*A,r[9]=(g*d*s-p*v*s-g*o*m+i*v*m+p*o*x-i*d*x)*A,r[10]=(u*v*s-g*l*s+g*o*h-i*v*h-u*o*x+i*l*x)*A,r[11]=(p*l*s-u*d*s-p*o*h+i*d*h+u*o*m-i*l*m)*A,r[12]=T*A,r[13]=(p*v*a-g*d*a+g*o*f-i*v*f-p*o*y+i*d*y)*A,r[14]=(g*l*a-u*v*a-g*o*c+i*v*c+u*o*y-i*l*y)*A,r[15]=(u*d*a-p*l*a+p*o*c-i*d*c-u*o*f+i*l*f)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,a=t.y,s=t.z,u=i*o,l=i*a;return this.set(u*o+r,u*a-n*s,u*s+n*a,0,u*a+n*s,l*a+r,l*s-n*o,0,u*s-n*a,l*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,d=i*c,f=o*l,m=o*c,g=a*c,v=s*u,y=s*l,x=s*c,b=r.x,_=r.y,w=r.z;return n[0]=(1-(f+g))*b,n[1]=(p+x)*b,n[2]=(d-y)*b,n[3]=0,n[4]=(p-x)*_,n[5]=(1-(h+g))*_,n[6]=(m+v)*_,n[7]=0,n[8]=(d+y)*w,n[9]=(m-v)*w,n[10]=(1-(h+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(t,e,r){var n=this.elements,i=Cn.set(n[0],n[1],n[2]).length(),o=Cn.set(n[4],n[5],n[6]).length(),a=Cn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],Rn.copy(this);var s=1/i,u=1/o,l=1/a;return Rn.elements[0]*=s,Rn.elements[1]*=s,Rn.elements[2]*=s,Rn.elements[4]*=u,Rn.elements[5]*=u,Rn.elements[6]*=u,Rn.elements[8]*=l,Rn.elements[9]*=l,Rn.elements[10]*=l,e.setFromRotationMatrix(Rn),r.x=i,r.y=o,r.z=a,this},makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(e-t),u=2*i/(r-n),l=(e+t)/(e-t),c=(r+n)/(r-n),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var a=this.elements,s=1/(e-t),u=1/(r-n),l=1/(o-i),c=(e+t)*s,h=(r+n)*u,p=(o+i)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}});var jn=new kn,Bn=new yn;function zn(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||zn.DefaultOrder}function Gn(){this.mask=1}zn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],zn.DefaultOrder="XYZ",Object.defineProperties(zn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(zn.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=gn.clamp,i=t.elements,o=i[0],a=i[4],s=i[8],u=i[1],l=i[5],c=i[9],h=i[2],p=i[6],d=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,l),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===e?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===e?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,r){return jn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(jn,e,r)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return Bn.setFromEuler(this),this.setFromQuaternion(Bn,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new _n(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(Gn.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});var Vn=0,Hn=new _n,Xn=new yn,Wn=new kn,Yn=new _n,qn=new _n,$n=new _n,Qn=new yn,Zn=new _n(1,0,0),Jn=new _n(0,1,0),Kn=new _n(0,0,1),ti={type:"added"},ei={type:"removed"};function ri(){Object.defineProperty(this,"id",{value:Vn++}),this.uuid=gn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ri.DefaultUp.clone();var t=new _n,e=new zn,r=new yn,n=new _n(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new kn},normalMatrix:{value:new En}}),this.matrix=new kn,this.matrixWorld=new kn,this.matrixAutoUpdate=ri.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Gn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ni(){ri.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ri.DefaultUp=new _n(0,1,0),ri.DefaultMatrixAutoUpdate=!0,ri.prototype=Object.assign(Object.create(dn.prototype),{constructor:ri,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Xn.setFromAxisAngle(t,e),this.quaternion.multiply(Xn),this},rotateOnWorldAxis:function(t,e){return Xn.setFromAxisAngle(t,e),this.quaternion.premultiply(Xn),this},rotateX:function(t){return this.rotateOnAxis(Zn,t)},rotateY:function(t){return this.rotateOnAxis(Jn,t)},rotateZ:function(t){return this.rotateOnAxis(Kn,t)},translateOnAxis:function(t,e){return Hn.copy(t).applyQuaternion(this.quaternion),this.position.add(Hn.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Zn,t)},translateY:function(t){return this.translateOnAxis(Jn,t)},translateZ:function(t){return this.translateOnAxis(Kn,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Wn.getInverse(this.matrixWorld))},lookAt:function(t,e,r){t.isVector3?Yn.copy(t):Yn.set(t,e,r);var n=this.parent;this.updateWorldMatrix(!0,!1),qn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Wn.lookAt(qn,Yn,this.up):Wn.lookAt(Yn,qn,this.up),this.quaternion.setFromRotationMatrix(Wn),n&&(Wn.extractRotation(n.matrixWorld),Xn.setFromRotationMatrix(Wn),this.quaternion.premultiply(Xn.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ti)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(ei)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),Wn.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Wn.multiply(t.parent.matrixWorld)),t.applyMatrix(Wn),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new _n),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new yn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(qn,t,$n),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new _n),this.updateMatrixWorld(!0),this.matrixWorld.decompose(qn,Qn,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new _n),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var n=this.children,i=0,o=n.length;i<o;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isMesh&&0!==this.drawMode&&(n.drawMode=this.drawMode),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,u=a.length;s<u;s++){var l=a[s];i(t.shapes,l)}else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(s=0,u=this.material.length;s<u;s++)c.push(i(t.materials,this.material[s]));n.material=c}else n.material=i(t.materials,this.material);if(this.children.length>0){n.children=[];for(s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object)}if(e){var h=m(t.geometries),p=m(t.materials),d=m(t.textures),f=m(t.images);a=m(t.shapes);h.length>0&&(r.geometries=h),p.length>0&&(r.materials=p),d.length>0&&(r.textures=d),f.length>0&&(r.images=f),a.length>0&&(r.shapes=a)}return r.object=n,r;function m(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}return this}}),ni.prototype=Object.assign(Object.create(ri.prototype),{constructor:ni,isScene:!0,copy:function(t,e){return ri.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=ri.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ii=[new _n,new _n,new _n,new _n,new _n,new _n,new _n,new _n],oi=new _n,ai=new vi,si=new _n,ui=new _n,li=new _n,ci=new _n,hi=new _n,pi=new _n,di=new _n,fi=new _n,mi=new _n,gi=new _n;function vi(t,e){this.min=void 0!==t?t:new _n(1/0,1/0,1/0),this.max=void 0!==e?e:new _n(-1/0,-1/0,-1/0)}function yi(t,e,r,n,i){var o,a;for(o=0,a=t.length-3;o<=a;o+=3){gi.fromArray(t,o);var s=i.x*Math.abs(gi.x)+i.y*Math.abs(gi.y)+i.z*Math.abs(gi.z),u=e.dot(gi),l=r.dot(gi),c=n.dot(gi);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}Object.assign(vi.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=t.length;s<u;s+=3){var l=t[s],c=t[s+1],h=t[s+2];l<e&&(e=l),c<r&&(r=c),h<n&&(n=h),l>i&&(i=l),c>o&&(o=c),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=t.count;s<u;s++){var l=t.getX(s),c=t.getY(s),h=t.getZ(s);l<e&&(e=l),c<r&&(r=c),h<n&&(n=h),l>i&&(i=l),c>o&&(o=c),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=oi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new _n),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new _n),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),ai.copy(e.boundingBox),ai.applyMatrix4(t.matrixWorld),this.expandByPoint(ai.min),this.expandByPoint(ai.max));for(var r=t.children,n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new _n),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,oi),oi.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(di),fi.subVectors(this.max,di),si.subVectors(t.a,di),ui.subVectors(t.b,di),li.subVectors(t.c,di),ci.subVectors(ui,si),hi.subVectors(li,ui),pi.subVectors(si,li);var e=[0,-ci.z,ci.y,0,-hi.z,hi.y,0,-pi.z,pi.y,ci.z,0,-ci.x,hi.z,0,-hi.x,pi.z,0,-pi.x,-ci.y,ci.x,0,-hi.y,hi.x,0,-pi.y,pi.x,0];return!!yi(e,si,ui,li,fi)&&(!!yi(e=[1,0,0,0,1,0,0,0,1],si,ui,li,fi)&&(mi.crossVectors(ci,hi),yi(e=[mi.x,mi.y,mi.z],si,ui,li,fi)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new _n),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return oi.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(oi).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(ii[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ii[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ii[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ii[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ii[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ii[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ii[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ii[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ii)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var xi=new vi;function bi(t,e){this.center=void 0!==t?t:new _n,this.radius=void 0!==e?e:0}Object.assign(bi.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var r=this.center;void 0!==e?r.copy(e):xi.setFromPoints(t).getCenter(r);for(var n=0,i=0,o=t.length;i<o;i++)n=Math.max(n,r.distanceToSquared(t[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new _n),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new vi),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var _i=new _n,wi=new _n,Ti=new _n,Ei=new _n,Si=new _n,Ai=new _n,Pi=new _n;function Mi(t,e){this.origin=void 0!==t?t:new _n,this.direction=void 0!==e?e:new _n(0,0,-1)}Object.assign(Mi.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new _n),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,_i)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new _n),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=_i.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_i.copy(this.direction).multiplyScalar(e).add(this.origin),_i.distanceToSquared(t))},distanceSqToSegment:function(t,e,r,n){wi.copy(t).add(e).multiplyScalar(.5),Ti.copy(e).sub(t).normalize(),Ei.copy(this.origin).sub(wi);var i,o,a,s,u=.5*t.distanceTo(e),l=-this.direction.dot(Ti),c=Ei.dot(this.direction),h=-Ei.dot(Ti),p=Ei.lengthSq(),d=Math.abs(1-l*l);if(d>0)if(o=l*c-h,s=u*d,(i=l*h-c)>=0)if(o>=-s)if(o<=s){var f=1/d;a=(i*=f)*(i+l*(o*=f)+2*c)+o*(l*i+o+2*h)+p}else o=u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*h)+p;else o=-u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*h)+p;else o<=-s?a=-(i=Math.max(0,-(-l*u+c)))*i+(o=i>0?-u:Math.min(Math.max(-u,-h),u))*(o+2*h)+p:o<=s?(i=0,a=(o=Math.min(Math.max(-u,-h),u))*(o+2*h)+p):a=-(i=Math.max(0,-(l*u+c)))*i+(o=i>0?u:Math.min(Math.max(-u,-h),u))*(o+2*h)+p;else o=l>0?-u:u,a=-(i=Math.max(0,-(l*o+c)))*i+o*(o+2*h)+p;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(Ti).multiplyScalar(o).add(wi),a},intersectSphere:function(t,e){_i.subVectors(t.center,this.origin);var r=_i.dot(this.direction),n=_i.dot(_i)-r*r,i=t.radius*t.radius;if(n>i)return null;var o=Math.sqrt(i-n),a=r-o,s=r+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,o,a,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(r=(t.min.x-h.x)*u,n=(t.max.x-h.x)*u):(r=(t.max.x-h.x)*u,n=(t.min.x-h.x)*u),l>=0?(i=(t.min.y-h.y)*l,o=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,o=(t.min.y-h.y)*l),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),c>=0?(a=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(a=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),r>s||a>n?null:((a>r||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,_i)},intersectTriangle:function(t,e,r,n,i){Si.subVectors(e,t),Ai.subVectors(r,t),Pi.crossVectors(Si,Ai);var o,a=this.direction.dot(Pi);if(a>0){if(n)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Ei.subVectors(this.origin,t);var s=o*this.direction.dot(Ai.crossVectors(Ei,Ai));if(s<0)return null;var u=o*this.direction.dot(Si.cross(Ei));if(u<0)return null;if(s+u>a)return null;var l=-o*Ei.dot(Pi);return l<0?null:this.at(l/a,i)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var Ii=new _n,Oi=new _n,Ci=new En;function Ri(t,e){this.normal=void 0!==t?t:new _n(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Ri.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,r){var n=Ii.subVectors(r,e).cross(Oi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new _n),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new _n);var r=t.delta(Ii),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;var i=-(t.start.dot(this.normal)+this.constant)/n;return i<0||i>1?void 0:e.copy(r).multiplyScalar(i).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new _n),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var r=e||Ci.getNormalMatrix(t),n=this.coplanarPoint(Ii).applyMatrix4(t),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Li=new _n,Ni=new _n,Fi=new _n,Di=new _n,Ui=new _n,ki=new _n,ji=new _n,Bi=new _n,zi=new _n,Gi=new _n;function Vi(t,e,r){this.a=void 0!==t?t:new _n,this.b=void 0!==e?e:new _n,this.c=void 0!==r?r:new _n}Object.assign(Vi,{getNormal:function(t,e,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new _n),n.subVectors(r,e),Li.subVectors(t,e),n.cross(Li);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(t,e,r,n,i){Li.subVectors(n,e),Ni.subVectors(r,e),Fi.subVectors(t,e);var o=Li.dot(Li),a=Li.dot(Ni),s=Li.dot(Fi),u=Ni.dot(Ni),l=Ni.dot(Fi),c=o*u-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new _n),0===c)return i.set(-2,-1,-1);var h=1/c,p=(u*s-a*l)*h,d=(o*l-a*s)*h;return i.set(1-p-d,d,p)},containsPoint:function(t,e,r,n){return Vi.getBarycoord(t,e,r,n,Di),Di.x>=0&&Di.y>=0&&Di.x+Di.y<=1},getUV:function(t,e,r,n,i,o,a,s){return this.getBarycoord(t,e,r,n,Di),s.set(0,0),s.addScaledVector(i,Di.x),s.addScaledVector(o,Di.y),s.addScaledVector(a,Di.z),s},isFrontFacing:function(t,e,r,n){return Li.subVectors(r,e),Ni.subVectors(t,e),Li.cross(Ni).dot(n)<0}}),Object.assign(Vi.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Li.subVectors(this.c,this.b),Ni.subVectors(this.a,this.b),.5*Li.cross(Ni).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new _n),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Vi.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Ri),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Vi.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,r,n,i){return Vi.getUV(t,this.a,this.b,this.c,e,r,n,i)},containsPoint:function(t){return Vi.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return Vi.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new _n);var r,n,i=this.a,o=this.b,a=this.c;Ui.subVectors(o,i),ki.subVectors(a,i),Bi.subVectors(t,i);var s=Ui.dot(Bi),u=ki.dot(Bi);if(s<=0&&u<=0)return e.copy(i);zi.subVectors(t,o);var l=Ui.dot(zi),c=ki.dot(zi);if(l>=0&&c<=l)return e.copy(o);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return r=s/(s-l),e.copy(i).addScaledVector(Ui,r);Gi.subVectors(t,a);var p=Ui.dot(Gi),d=ki.dot(Gi);if(d>=0&&p<=d)return e.copy(a);var f=p*u-s*d;if(f<=0&&u>=0&&d<=0)return n=u/(u-d),e.copy(i).addScaledVector(ki,n);var m=l*d-p*c;if(m<=0&&c-l>=0&&p-d>=0)return ji.subVectors(a,o),n=(c-l)/(c-l+(p-d)),e.copy(o).addScaledVector(ji,n);var g=1/(m+f+h);return r=f*g,n=h*g,e.copy(i).addScaledVector(Ui,r).addScaledVector(ki,n)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var Hi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xi={h:0,s:0,l:0},Wi={h:0,s:0,l:0};function Yi(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}function qi(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}function $i(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Qi(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Zi(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new _n,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Yi,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign(Yi.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(t,e,r){if(t=gn.euclideanModulo(t,1),e=gn.clamp(e,0,1),r=gn.clamp(r,0,1),0===e)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=qi(i,n,t+1/3),this.g=qi(i,n,t),this.b=qi(i,n,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,u=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,s,u)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l=r[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=Hi[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=$i(t.r),this.g=$i(t.g),this.b=$i(t.b),this},copyLinearToSRGB:function(t){return this.r=Qi(t.r),this.g=Qi(t.g),this.b=Qi(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o),u=(s+a)/2;if(s===a)e=0,r=0;else{var l=a-s;switch(r=u<=.5?l/(a+s):l/(2-a-s),a){case n:e=(i-o)/l+(i<o?6:0);break;case i:e=(o-n)/l+2;break;case o:e=(n-i)/l+4}e/=6}return t.h=e,t.s=r,t.l=u,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,r){return this.getHSL(Xi),Xi.h+=t,Xi.s+=e,Xi.l+=r,this.setHSL(Xi.h,Xi.s,Xi.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(Xi),t.getHSL(Wi);var r=gn.lerp(Xi.h,Wi.h,e),n=gn.lerp(Xi.s,Wi.s,e),i=gn.lerp(Xi.l,Wi.l,e);return this.setHSL(r,n,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Yi.NAMES=Hi,Object.assign(Zi.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var Ji=0;function Ki(){Object.defineProperty(this,"id",{value:Ji++}),this.uuid=gn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function to(t){Ki.call(this),this.type="MeshBasicMaterial",this.color=new Yi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}function eo(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function ro(t,e,r){eo.call(this,new Int8Array(t),e,r)}function no(t,e,r){eo.call(this,new Uint8Array(t),e,r)}function io(t,e,r){eo.call(this,new Uint8ClampedArray(t),e,r)}function oo(t,e,r){eo.call(this,new Int16Array(t),e,r)}function ao(t,e,r){eo.call(this,new Uint16Array(t),e,r)}function so(t,e,r){eo.call(this,new Int32Array(t),e,r)}function uo(t,e,r){eo.call(this,new Uint32Array(t),e,r)}function lo(t,e,r){eo.call(this,new Float32Array(t),e,r)}function co(t,e,r){eo.call(this,new Float64Array(t),e,r)}function ho(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function po(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}Ki.prototype=Object.assign(Object.create(dn.prototype),{constructor:Ki,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),0!==this.vertexColors&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),o=n(t.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Ki.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),to.prototype=Object.create(Ki.prototype),to.prototype.constructor=to,to.prototype.isMeshBasicMaterial=!0,to.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Object.defineProperty(eo.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(eo.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new Yi),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new vn),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new _n),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Mn),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),ro.prototype=Object.create(eo.prototype),ro.prototype.constructor=ro,no.prototype=Object.create(eo.prototype),no.prototype.constructor=no,io.prototype=Object.create(eo.prototype),io.prototype.constructor=io,oo.prototype=Object.create(eo.prototype),oo.prototype.constructor=oo,ao.prototype=Object.create(eo.prototype),ao.prototype.constructor=ao,so.prototype=Object.create(eo.prototype),so.prototype.constructor=so,uo.prototype=Object.create(eo.prototype),uo.prototype.constructor=uo,lo.prototype=Object.create(eo.prototype),lo.prototype.constructor=lo,co.prototype=Object.create(eo.prototype),co.prototype.constructor=co,Object.assign(ho.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,u=s.length;if(u>0){e=[];for(var l=0;l<u;l++)e[l]={name:s[l].name,data:[]};this.morphTargets.position=e}var c,h=t.morphNormals,p=h.length;if(p>0){c=[];for(l=0;l<p;l++)c[l]={name:h[l].name,data:[]};this.morphTargets.normal=c}var d=t.skinIndices,f=t.skinWeights,m=d.length===n.length,g=f.length===n.length;n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(l=0;l<r.length;l++){var v=r[l];this.vertices.push(n[v.a],n[v.b],n[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=v.normal;this.normals.push(x,x,x)}var b,_=v.vertexColors;if(3===_.length)this.colors.push(_[0],_[1],_[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===o)void 0!==(b=i[0][l])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new vn,new vn,new vn));if(!0===a)void 0!==(b=i[1][l])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new vn,new vn,new vn));for(var T=0;T<u;T++){var E=s[T].vertices;e[T].data.push(E[v.a],E[v.b],E[v.c])}for(T=0;T<p;T++){var S=h[T].vertexNormals[l];c[T].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var fo=1,mo=new kn,go=new ri,vo=new _n,yo=new vi,xo=new vi,bo=new _n;function _o(){Object.defineProperty(this,"id",{value:fo+=2}),this.uuid=gn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}_o.prototype=Object.assign(Object.create(dn.prototype),{constructor:_o,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(po(t)>65535?uo:ao)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new En).getNormalMatrix(t).applyToBufferAttribute(r),r.needsUpdate=!0);var n=this.attributes.tangent;void 0!==n&&((new En).getNormalMatrix(t).applyToBufferAttribute(n),n.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return mo.makeRotationX(t),this.applyMatrix(mo),this},rotateY:function(t){return mo.makeRotationY(t),this.applyMatrix(mo),this},rotateZ:function(t){return mo.makeRotationZ(t),this.applyMatrix(mo),this},translate:function(t,e,r){return mo.makeTranslation(t,e,r),this.applyMatrix(mo),this},scale:function(t,e,r){return mo.makeScale(t,e,r),this.applyMatrix(mo),this},lookAt:function(t){return go.lookAt(t),go.updateMatrix(),this.applyMatrix(go.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(vo).negate(),this.translate(vo.x,vo.y,vo.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new lo(3*e.vertices.length,3),n=new lo(3*e.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new lo(e.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new lo(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new ho).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new eo(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.setAttribute("normal",new eo(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.setAttribute("color",new eo(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new eo(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new eo(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],u=t.morphTargets[a],l=0,c=u.length;l<c;l++){var h=u[l],p=new lo(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var d=new lo(4*t.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new lo(4*t.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new vi);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var r=0,n=e.length;r<n;r++){var i=e[r];yo.setFromBufferAttribute(i),this.morphTargetsRelative?(bo.addVectors(this.boundingBox.min,yo.min),this.boundingBox.expandByPoint(bo),bo.addVectors(this.boundingBox.max,yo.max),this.boundingBox.expandByPoint(bo)):(this.boundingBox.expandByPoint(yo.min),this.boundingBox.expandByPoint(yo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new bi);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var r=this.boundingSphere.center;if(yo.setFromBufferAttribute(t),e)for(var n=0,i=e.length;n<i;n++){var o=e[n];xo.setFromBufferAttribute(o),this.morphTargetsRelative?(bo.addVectors(yo.min,xo.min),yo.expandByPoint(bo),bo.addVectors(yo.max,xo.max),yo.expandByPoint(bo)):(yo.expandByPoint(xo.min),yo.expandByPoint(xo.max))}yo.getCenter(r);var a=0;for(n=0,i=t.count;n<i;n++)bo.fromBufferAttribute(t,n),a=Math.max(a,r.distanceToSquared(bo));if(e)for(n=0,i=e.length;n<i;n++){o=e[n];for(var s=this.morphTargetsRelative,u=0,l=o.count;u<l;u++)bo.fromBufferAttribute(o,u),s&&(vo.fromBufferAttribute(t,u),bo.add(vo)),a=Math.max(a,r.distanceToSquared(bo))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var r=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new eo(new Float32Array(r.length),3));else for(var n=e.normal.array,i=0,o=n.length;i<o;i++)n[i]=0;var a,s,u,l=e.normal.array,c=new _n,h=new _n,p=new _n,d=new _n,f=new _n;if(t){var m=t.array;for(i=0,o=t.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],u=3*m[i+2],c.fromArray(r,a),h.fromArray(r,s),p.fromArray(r,u),d.subVectors(p,h),f.subVectors(c,h),d.cross(f),l[a]+=d.x,l[a+1]+=d.y,l[a+2]+=d.z,l[s]+=d.x,l[s+1]+=d.y,l[s+2]+=d.z,l[u]+=d.x,l[u+1]+=d.y,l[u+2]+=d.z}else for(i=0,o=r.length;i<o;i+=9)c.fromArray(r,i),h.fromArray(r,i+3),p.fromArray(r,i+6),d.subVectors(p,h),f.subVectors(c,h),d.cross(f),l[i]=d.x,l[i+1]=d.y,l[i+2]=d.z,l[i+3]=d.x,l[i+4]=d.y,l[i+5]=d.z,l[i+6]=d.x,l[i+7]=d.y,l[i+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,o=t.attributes[n],a=o.array,s=o.itemSize*e,u=Math.min(a.length,i.length-s),l=0,c=s;l<u;l++,c++)i[c]=a[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,r=t.count;e<r;e++)bo.x=t.getX(e),bo.y=t.getY(e),bo.z=t.getZ(e),bo.normalize(),t.setXYZ(e,bo.x,bo.y,bo.z)},toNonIndexed:function(){function t(t,e){for(var r=t.array,n=t.itemSize,i=new r.constructor(e.length*n),o=0,a=0,s=0,u=e.length;s<u;s++){o=e[s]*n;for(var l=0;l<n;l++)i[a++]=r[o++]}return new eo(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new _o,r=this.index.array,n=this.attributes;for(var i in n){var o=t(n[i],r);e.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],u=a[i],l=0,c=u.length;l<c;l++){o=t(u[l],r);s.push(o)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,p=(l=0,h.length);l<p;l++){var d=h[l];e.addGroup(d.start,d.count,d.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;null!==n&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var o=(p=i[r]).toJSON();""!==p.name&&(o.name=p.name),t.data.attributes[r]=o}var a={},s=!1;for(var r in this.morphAttributes){for(var u=this.morphAttributes[r],l=[],c=0,h=u.length;c<h;c++){var p;o=(p=u[c]).toJSON();""!==p.name&&(o.name=p.name),l.push(o)}l.length>0&&(a[r]=l,s=!0)}s&&(t.data.morphAttributes=a,t.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));var f=this.boundingSphere;return null!==f&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t},clone:function(){return(new _o).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o){var a=o[e];this.setAttribute(e,a.clone())}var s=t.morphAttributes;for(e in s){var u=[],l=s[e];for(r=0,n=l.length;r<n;r++)u.push(l[r].clone());this.morphAttributes[e]=u}this.morphTargetsRelative=t.morphTargetsRelative;var c=t.groups;for(r=0,n=c.length;r<n;r++){var h=c[r];this.addGroup(h.start,h.count,h.materialIndex)}var p=t.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var wo=new kn,To=new Mi,Eo=new bi,So=new _n,Ao=new _n,Po=new _n,Mo=new _n,Io=new _n,Oo=new _n,Co=new _n,Ro=new _n,Lo=new _n,No=new vn,Fo=new vn,Do=new vn,Uo=new _n,ko=new _n;function jo(t,e){ri.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new _o,this.material=void 0!==e?e:new to({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function Bo(t,e,r,n,i,o,a,s){if(null===(1===e.side?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,2!==e.side,s)))return null;ko.copy(s),ko.applyMatrix4(t.matrixWorld);var u=r.ray.origin.distanceTo(ko);return u<r.near||u>r.far?null:{distance:u,point:ko.clone(),object:t}}function zo(t,e,r,n,i,o,a,s,u,l,c,h){So.fromBufferAttribute(i,l),Ao.fromBufferAttribute(i,c),Po.fromBufferAttribute(i,h);var p=t.morphTargetInfluences;if(e.morphTargets&&o&&p){Co.set(0,0,0),Ro.set(0,0,0),Lo.set(0,0,0);for(var d=0,f=o.length;d<f;d++){var m=p[d],g=o[d];0!==m&&(Mo.fromBufferAttribute(g,l),Io.fromBufferAttribute(g,c),Oo.fromBufferAttribute(g,h),a?(Co.addScaledVector(Mo,m),Ro.addScaledVector(Io,m),Lo.addScaledVector(Oo,m)):(Co.addScaledVector(Mo.sub(So),m),Ro.addScaledVector(Io.sub(Ao),m),Lo.addScaledVector(Oo.sub(Po),m)))}So.add(Co),Ao.add(Ro),Po.add(Lo)}var v=Bo(t,e,r,n,So,Ao,Po,Uo);if(v){s&&(No.fromBufferAttribute(s,l),Fo.fromBufferAttribute(s,c),Do.fromBufferAttribute(s,h),v.uv=Vi.getUV(Uo,So,Ao,Po,No,Fo,Do,new vn)),u&&(No.fromBufferAttribute(u,l),Fo.fromBufferAttribute(u,c),Do.fromBufferAttribute(u,h),v.uv2=Vi.getUV(Uo,So,Ao,Po,No,Fo,Do,new vn));var y=new Zi(l,c,h);Vi.getNormal(So,Ao,Po,y.normal),v.face=y}return v}jo.prototype=Object.assign(Object.create(ri.prototype),{constructor:jo,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return ri.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var r,n=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),Eo.copy(n.boundingSphere),Eo.applyMatrix4(o),!1!==t.ray.intersectsSphere(Eo)&&(wo.getInverse(o),To.copy(t.ray).applyMatrix4(wo),null===n.boundingBox||!1!==To.intersectsBox(n.boundingBox))))if(0===this.drawMode){if(n.isBufferGeometry){var a,s,u,l,c,h,p,d,f,m=n.index,g=n.attributes.position,v=n.morphAttributes.position,y=n.morphTargetsRelative,x=n.attributes.uv,b=n.attributes.uv2,_=n.groups,w=n.drawRange;if(null!==m)if(Array.isArray(i))for(l=0,h=_.length;l<h;l++)for(f=i[(d=_[l]).materialIndex],c=Math.max(d.start,w.start),p=Math.min(d.start+d.count,w.start+w.count);c<p;c+=3)a=m.getX(c),s=m.getX(c+1),u=m.getX(c+2),(r=zo(this,f,t,To,g,v,y,x,b,a,s,u))&&(r.faceIndex=Math.floor(c/3),r.face.materialIndex=d.materialIndex,e.push(r));else for(l=Math.max(0,w.start),h=Math.min(m.count,w.start+w.count);l<h;l+=3)a=m.getX(l),s=m.getX(l+1),u=m.getX(l+2),(r=zo(this,i,t,To,g,v,y,x,b,a,s,u))&&(r.faceIndex=Math.floor(l/3),e.push(r));else if(void 0!==g)if(Array.isArray(i))for(l=0,h=_.length;l<h;l++)for(f=i[(d=_[l]).materialIndex],c=Math.max(d.start,w.start),p=Math.min(d.start+d.count,w.start+w.count);c<p;c+=3)(r=zo(this,f,t,To,g,v,y,x,b,a=c,s=c+1,u=c+2))&&(r.faceIndex=Math.floor(c/3),r.face.materialIndex=d.materialIndex,e.push(r));else for(l=Math.max(0,w.start),h=Math.min(g.count,w.start+w.count);l<h;l+=3)(r=zo(this,i,t,To,g,v,y,x,b,a=l,s=l+1,u=l+2))&&(r.faceIndex=Math.floor(l/3),e.push(r))}else if(n.isGeometry){var T,E,S,A,P=Array.isArray(i),M=n.vertices,I=n.faces,O=n.faceVertexUvs[0];O.length>0&&(A=O);for(var C=0,R=I.length;C<R;C++){var L=I[C],N=P?i[L.materialIndex]:i;if(void 0!==N&&(T=M[L.a],E=M[L.b],S=M[L.c],r=Bo(this,N,t,To,T,E,S,Uo))){if(A&&A[C]){var F=A[C];No.copy(F[0]),Fo.copy(F[1]),Do.copy(F[2]),r.uv=Vi.getUV(Uo,T,E,S,No,Fo,Do,new vn)}r.face=L,r.faceIndex=C,e.push(r)}}}}else console.warn("THREE.Mesh: TriangleStripDrawMode and TriangleFanDrawMode are not supported by .raycast().")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Go=0,Vo=new kn,Ho=new ri,Xo=new _n;function Wo(){Object.defineProperty(this,"id",{value:Go+=2}),this.uuid=gn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Wo.prototype=Object.assign(Object.create(dn.prototype),{constructor:Wo,isGeometry:!0,applyMatrix:function(t){for(var e=(new En).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(t)}for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Vo.makeRotationX(t),this.applyMatrix(Vo),this},rotateY:function(t){return Vo.makeRotationY(t),this.applyMatrix(Vo),this},rotateZ:function(t){return Vo.makeRotationZ(t),this.applyMatrix(Vo),this},translate:function(t,e,r){return Vo.makeTranslation(t,e,r),this.applyMatrix(Vo),this},scale:function(t,e,r){return Vo.makeScale(t,e,r),this.applyMatrix(Vo),this},lookAt:function(t){return Ho.lookAt(t),Ho.updateMatrix(),this.applyMatrix(Ho.matrix),this},fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,u=void 0!==n.uv2?n.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var l=0;l<i.length;l+=3)e.vertices.push((new _n).fromArray(i,l)),void 0!==a&&e.colors.push((new Yi).fromArray(a,l));function c(t,r,n,i){var l=void 0===a?[]:[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()],c=new Zi(t,r,n,void 0===o?[]:[(new _n).fromArray(o,3*t),(new _n).fromArray(o,3*r),(new _n).fromArray(o,3*n)],l,i);e.faces.push(c),void 0!==s&&e.faceVertexUvs[0].push([(new vn).fromArray(s,2*t),(new vn).fromArray(s,2*r),(new vn).fromArray(s,2*n)]),void 0!==u&&e.faceVertexUvs[1].push([(new vn).fromArray(u,2*t),(new vn).fromArray(u,2*r),(new vn).fromArray(u,2*n)])}var h=t.groups;if(h.length>0)for(l=0;l<h.length;l++)for(var p=h[l],d=p.start,f=d,m=d+p.count;f<m;f+=3)void 0!==r?c(r[f],r[f+1],r[f+2],p.materialIndex):c(f,f+1,f+2,p.materialIndex);else if(void 0!==r)for(l=0;l<r.length;l+=3)c(r[l],r[l+1],r[l+2]);else for(l=0;l<i.length/3;l+=3)c(l,l+1,l+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xo).negate(),this.translate(Xo.x,Xo.y,Xo.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new kn;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new _n,e=new _n,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)a[e]=new _n;if(t){var s,u,l,c=new _n,h=new _n;for(n=0,i=this.faces.length;n<i;n++)o=this.faces[n],s=this.vertices[o.a],u=this.vertices[o.b],l=this.vertices[o.c],c.subVectors(l,u),h.subVectors(s,u),c.cross(h),a[o.a].add(c),a[o.b].add(c),a[o.c].add(c)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,r=this.vertices.length;e<r;e++)a[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var p=(o=this.faces[n]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new Wo;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)u=new _n,l={a:new _n,b:new _n,c:new _n},a.push(u),s.push(l)}var u,l,c=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],u=c.faceNormals[r],l=c.vertexNormals[r],u.copy(i.normal),l.a.copy(i.vertexNormals[0]),l.b.copy(i.vertexNormals[1]),l.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new vi),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new bi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,u=t.faces,l=this.colors,c=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new En).getNormalMatrix(e));for(var h=0,p=a.length;h<p;h++){var d=a[h].clone();void 0!==e&&d.applyMatrix4(e),o.push(d)}for(h=0,p=c.length;h<p;h++)l.push(c[h].clone());for(h=0,p=u.length;h<p;h++){var f,m,g,v=u[h],y=v.vertexNormals,x=v.vertexColors;(f=new Zi(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==n&&f.normal.applyMatrix3(n).normalize();for(var b=0,_=y.length;b<_;b++)m=y[b].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),f.vertexNormals.push(m);f.color.copy(v.color);for(b=0,_=x.length;b<_;b++)g=x[b],f.vertexColors.push(g.clone());f.materialIndex=v.materialIndex+r,s.push(f)}for(h=0,p=t.faceVertexUvs.length;h<p;h++){var w=t.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(b=0,_=w.length;b<_;b++){for(var T=w[b],E=[],S=0,A=T.length;S<A;S++)E.push(T[S].clone());this.faceVertexUvs[h].push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,o,a,s,u={},l=[],c=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===u[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(u[e]=r,l.push(this.vertices[r]),c[r]=l.length-1):c[r]=c[u[e]];var p=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(r);break}}for(r=p.length-1;r>=0;r--){var f=p[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new _n(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===e&&(n=[]),a&&a.length===e&&(i=[]);for(r=0;r<e;r++){var s=t[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],u={},l=[],c={},h=[],p={};for(i=0;i<this.faces.length;i++){var d=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=d.normal.length()>0,g=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,x=0;if(x=T(x,0,0),x=T(x,1,!0),x=T(x,2,!1),x=T(x,3,f),x=T(x,4,m),x=T(x,5,g),x=T(x,6,v),x=T(x,7,y),a.push(x),a.push(d.a,d.b,d.c),a.push(d.materialIndex),f){var b=this.faceVertexUvs[0][i];a.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&a.push(E(d.normal)),g){var _=d.vertexNormals;a.push(E(_[0]),E(_[1]),E(_[2]))}if(v&&a.push(S(d.color)),y){var w=d.vertexColors;a.push(S(w[0]),S(w[1]),S(w[2]))}}function T(t,e,r){return r?t|1<<e:t&~(1<<e)}function E(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==u[e]||(u[e]=s.length/3,s.push(t.x,t.y,t.z)),u[e]}function S(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]||(c[e]=l.length,l.push(t.getHex())),c[e]}function A(t){var e=t.x.toString()+t.y.toString();return void 0!==p[e]||(p[e]=h.length/2,h.push(t.x,t.y)),p[e]}return t.data={},t.data.vertices=n,t.data.normals=s,l.length>0&&(t.data.colors=l),h.length>0&&(t.data.uvs=[h]),t.data.faces=a,t},clone:function(){return(new Wo).copy(this)},copy:function(t){var e,r,n,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var u=t.colors;for(e=0,r=u.length;e<r;e++)this.colors.push(u[e].clone());var l=t.faces;for(e=0,r=l.length;e<r;e++)this.faces.push(l[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=c.length;n<i;n++){var h=c[n],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[e].push(p)}}var f=t.morphTargets;for(e=0,r=f.length;e<r;e++){var m={};if(m.name=f[e].name,void 0!==f[e].vertices)for(m.vertices=[],n=0,i=f[e].vertices.length;n<i;n++)m.vertices.push(f[e].vertices[n].clone());if(void 0!==f[e].normals)for(m.normals=[],n=0,i=f[e].normals.length;n<i;n++)m.normals.push(f[e].normals[n].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,r=g.length;e<r;e++){var v={};if(void 0!==g[e].vertexNormals)for(v.vertexNormals=[],n=0,i=g[e].vertexNormals.length;n<i;n++){var y=g[e].vertexNormals[n],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),v.vertexNormals.push(x)}if(void 0!==g[e].faceNormals)for(v.faceNormals=[],n=0,i=g[e].faceNormals.length;n<i;n++)v.faceNormals.push(g[e].faceNormals[n].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,r=b.length;e<r;e++)this.skinWeights.push(b[e].clone());var _=t.skinIndices;for(e=0,r=_.length;e<r;e++)this.skinIndices.push(_[e].clone());var w=t.lineDistances;for(e=0,r=w.length;e<r;e++)this.lineDistances.push(w[e]);var T=t.boundingBox;null!==T&&(this.boundingBox=T.clone());var E=t.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Yo extends Wo{constructor(t,e,r,n,i,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new qo(t,e,r,n,i,o)),this.mergeVertices()}}class qo extends _o{constructor(t,e,r,n,i,o){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var a=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;var s=[],u=[],l=[],c=[],h=0,p=0;function d(t,e,r,n,i,o,d,f,m,g,v){var y,x,b=o/m,_=d/g,w=o/2,T=d/2,E=f/2,S=m+1,A=g+1,P=0,M=0,I=new _n;for(x=0;x<A;x++){var O=x*_-T;for(y=0;y<S;y++){var C=y*b-w;I[t]=C*n,I[e]=O*i,I[r]=E,u.push(I.x,I.y,I.z),I[t]=0,I[e]=0,I[r]=f>0?1:-1,l.push(I.x,I.y,I.z),c.push(y/m),c.push(1-x/g),P+=1}}for(x=0;x<g;x++)for(y=0;y<m;y++){var R=h+y+S*x,L=h+y+S*(x+1),N=h+(y+1)+S*(x+1),F=h+(y+1)+S*x;s.push(R,L,F),s.push(L,N,F),M+=6}a.addGroup(p,M,v),p+=M,h+=P}d("z","y","x",-1,-1,r,e,t,o,i,0),d("z","y","x",1,-1,r,e,-t,o,i,1),d("x","z","y",1,1,t,r,e,n,o,2),d("x","z","y",1,-1,t,r,-e,n,o,3),d("x","y","z",1,-1,t,e,r,n,i,4),d("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.setAttribute("position",new lo(u,3)),this.setAttribute("normal",new lo(l,3)),this.setAttribute("uv",new lo(c,2))}}function $o(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[r][n]=i.clone():Array.isArray(i)?e[r][n]=i.slice():e[r][n]=i}return e}function Qo(t){for(var e={},r=0;r<t.length;r++){var n=$o(t[r]);for(var i in n)e[i]=n[i]}return e}var Zo={clone:$o,merge:Qo};function Jo(t){Ki.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Ko(){ri.call(this),this.type="Camera",this.matrixWorldInverse=new kn,this.projectionMatrix=new kn,this.projectionMatrixInverse=new kn}function ta(t,e,r,n){Ko.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Jo.prototype=Object.create(Ki.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isShaderMaterial=!0,Jo.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=$o(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Jo.prototype.toJSON=function(t){var e=Ki.prototype.toJSON.call(this,t);for(var r in e.uniforms={},this.uniforms){var n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(e.extensions=i),e},Ko.prototype=Object.assign(Object.create(ri.prototype),{constructor:Ko,isCamera:!0,copy:function(t,e){return ri.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new _n),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){ri.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ta.prototype=Object.assign(Object.create(Ko.prototype),{constructor:ta,isPerspectiveCamera:!0,copy:function(t,e){return Ko.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*gn.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*gn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*gn.RAD2DEG*Math.atan(Math.tan(.5*gn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*gn.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,e-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}var u=this.filmOffset;0!==u&&(i+=t*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ri.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});function ea(t,e,r,n){ri.call(this),this.type="CubeCamera";var i=new ta(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new _n(1,0,0)),this.add(i);var o=new ta(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new _n(-1,0,0)),this.add(o);var a=new ta(90,1,t,e);a.up.set(0,0,1),a.lookAt(new _n(0,1,0)),this.add(a);var s=new ta(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new _n(0,-1,0)),this.add(s);var u=new ta(90,1,t,e);u.up.set(0,-1,0),u.lookAt(new _n(0,0,1)),this.add(u);var l=new ta(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new _n(0,0,-1)),this.add(l),n=n||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new ra(r,r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=t.getRenderTarget(),n=this.renderTarget,c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,o),t.setRenderTarget(n,2),t.render(e,a),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,u),n.texture.generateMipmaps=c,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(r)},this.clear=function(t,e,r,n){for(var i=t.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)t.setRenderTarget(o,a),t.clear(e,r,n);t.setRenderTarget(i)}}function ra(t,e,r){In.call(this,t,e,r)}function na(t,e,r,n,i,o,a,s,u,l,c,h){Pn.call(this,null,o,a,s,u,l,n,i,c,h),this.image={data:t||null,width:e||1,height:r||1},this.magFilter=void 0!==u?u:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}ea.prototype=Object.create(ri.prototype),ea.prototype.constructor=ea,ra.prototype=Object.create(In.prototype),ra.prototype.constructor=ra,ra.prototype.isWebGLRenderTargetCube=!0,ra.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var r=new ni,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new Jo({type:"CubemapFromEquirect",uniforms:$o(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;var o=new jo(new qo(5,5,5),i);r.add(o);var a=new ea(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(t,r),o.geometry.dispose(),o.material.dispose(),this},na.prototype=Object.create(Pn.prototype),na.prototype.constructor=na,na.prototype.isDataTexture=!0;var ia=new bi,oa=new _n;function aa(t,e,r,n,i,o){this.planes=[void 0!==t?t:new Ri,void 0!==e?e:new Ri,void 0!==r?r:new Ri,void 0!==n?n:new Ri,void 0!==i?i:new Ri,void 0!==o?o:new Ri]}Object.assign(aa.prototype,{set:function(t,e,r,n,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=r[5],l=r[6],c=r[7],h=r[8],p=r[9],d=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return e[0].setComponents(a-n,c-s,f-h,y-m).normalize(),e[1].setComponents(a+n,c+s,f+h,y+m).normalize(),e[2].setComponents(a+i,c+u,f+p,y+g).normalize(),e[3].setComponents(a-i,c-u,f-p,y-g).normalize(),e[4].setComponents(a-o,c-l,f-d,y-v).normalize(),e[5].setComponents(a+o,c+l,f+d,y+v).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),ia.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ia)},intersectsSprite:function(t){return ia.center.set(0,0,0),ia.radius=.7071067811865476,ia.applyMatrix4(t.matrixWorld),this.intersectsSphere(ia)},intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++){if(e[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:function(t){for(var e=this.planes,r=0;r<6;r++){var n=e[r];if(oa.x=n.normal.x>0?t.max.x:t.min.x,oa.y=n.normal.y>0?t.max.y:t.min.y,oa.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(oa)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var sa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpack2HalfToRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpack2HalfToRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ua={common:{diffuse:{value:new Yi(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new En},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new vn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Yi(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new En}},sprite:{diffuse:{value:new Yi(15658734)},opacity:{value:1},center:{value:new vn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new En}}},la={basic:{uniforms:Qo([ua.common,ua.specularmap,ua.envmap,ua.aomap,ua.lightmap,ua.fog]),vertexShader:sa.meshbasic_vert,fragmentShader:sa.meshbasic_frag},lambert:{uniforms:Qo([ua.common,ua.specularmap,ua.envmap,ua.aomap,ua.lightmap,ua.emissivemap,ua.fog,ua.lights,{emissive:{value:new Yi(0)}}]),vertexShader:sa.meshlambert_vert,fragmentShader:sa.meshlambert_frag},phong:{uniforms:Qo([ua.common,ua.specularmap,ua.envmap,ua.aomap,ua.lightmap,ua.emissivemap,ua.bumpmap,ua.normalmap,ua.displacementmap,ua.gradientmap,ua.fog,ua.lights,{emissive:{value:new Yi(0)},specular:{value:new Yi(1118481)},shininess:{value:30}}]),vertexShader:sa.meshphong_vert,fragmentShader:sa.meshphong_frag},standard:{uniforms:Qo([ua.common,ua.envmap,ua.aomap,ua.lightmap,ua.emissivemap,ua.bumpmap,ua.normalmap,ua.displacementmap,ua.roughnessmap,ua.metalnessmap,ua.fog,ua.lights,{emissive:{value:new Yi(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:sa.meshphysical_vert,fragmentShader:sa.meshphysical_frag},matcap:{uniforms:Qo([ua.common,ua.bumpmap,ua.normalmap,ua.displacementmap,ua.fog,{matcap:{value:null}}]),vertexShader:sa.meshmatcap_vert,fragmentShader:sa.meshmatcap_frag},points:{uniforms:Qo([ua.points,ua.fog]),vertexShader:sa.points_vert,fragmentShader:sa.points_frag},dashed:{uniforms:Qo([ua.common,ua.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:sa.linedashed_vert,fragmentShader:sa.linedashed_frag},depth:{uniforms:Qo([ua.common,ua.displacementmap]),vertexShader:sa.depth_vert,fragmentShader:sa.depth_frag},normal:{uniforms:Qo([ua.common,ua.bumpmap,ua.normalmap,ua.displacementmap,{opacity:{value:1}}]),vertexShader:sa.normal_vert,fragmentShader:sa.normal_frag},sprite:{uniforms:Qo([ua.sprite,ua.fog]),vertexShader:sa.sprite_vert,fragmentShader:sa.sprite_frag},background:{uniforms:{uvTransform:{value:new En},t2D:{value:null}},vertexShader:sa.background_vert,fragmentShader:sa.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:sa.cube_vert,fragmentShader:sa.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:sa.equirect_vert,fragmentShader:sa.equirect_frag},distanceRGBA:{uniforms:Qo([ua.common,ua.displacementmap,{referencePosition:{value:new _n},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:sa.distanceRGBA_vert,fragmentShader:sa.distanceRGBA_frag},shadow:{uniforms:Qo([ua.lights,ua.fog,{color:{value:new Yi(0)},opacity:{value:1}}]),vertexShader:sa.shadow_vert,fragmentShader:sa.shadow_frag}};function ca(){var t=null,e=!1,r=null;function n(i,o){!1!==e&&(r(i,o),t.requestAnimationFrame(n))}return{start:function(){!0!==e&&null!==r&&(t.requestAnimationFrame(n),e=!0)},stop:function(){e=!1},setAnimationLoop:function(t){r=t},setContext:function(e){t=e}}}function ha(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=e.get(r);n&&(t.deleteBuffer(n.buffer),e.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=e.get(r);void 0===i?e.set(r,function(e,r){var n=e.array,i=e.usage,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,n,i),e.onUploadCallback();var a=5126;return n instanceof Float32Array?a=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a=5123:n instanceof Int16Array?a=5122:n instanceof Uint32Array?a=5125:n instanceof Int32Array?a=5124:n instanceof Int8Array?a=5120:n instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(r,n)):i.version<r.version&&(!function(e,r,n){var i=r.array,o=r.updateRange;t.bindBuffer(n,e),-1===o.count?t.bufferSubData(n,0,i):(t.bufferSubData(n,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function pa(t,e,r,n){Wo.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new da(t,e,r,n)),this.mergeVertices()}function da(t,e,r,n){_o.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,o,a=(t=t||1)/2,s=(e=e||1)/2,u=Math.floor(r)||1,l=Math.floor(n)||1,c=u+1,h=l+1,p=t/u,d=e/l,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*d-s;for(i=0;i<c;i++){var x=i*p-a;m.push(x,-y,0),g.push(0,0,1),v.push(i/u),v.push(1-o/l)}}for(o=0;o<l;o++)for(i=0;i<u;i++){var b=i+c*o,_=i+c*(o+1),w=i+1+c*(o+1),T=i+1+c*o;f.push(b,_,T),f.push(_,w,T)}this.setIndex(f),this.setAttribute("position",new lo(m,3)),this.setAttribute("normal",new lo(g,3)),this.setAttribute("uv",new lo(v,2))}function fa(t,e,r,n){var i,o,a=new Yi(0),s=0,u=null,l=0;function c(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,n)}return{getClearColor:function(){return a},setClearColor:function(t,e){a.set(t),c(a,s=void 0!==e?e:1)},getClearAlpha:function(){return s},setClearAlpha:function(t){c(a,s=t)},render:function(e,n,h,p){var d=n.background,f=t.vr,m=f.getSession&&f.getSession();if(m&&"additive"===m.environmentBlendMode&&(d=null),null===d?(c(a,s),u=null,l=0):d&&d.isColor&&(c(d,1),p=!0,u=null,l=0),(t.autoClear||p)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLRenderTargetCube)){void 0===o&&((o=new jo(new qo(1,1,1),new Jo({type:"BackgroundCubeMaterial",uniforms:$o(la.cube.uniforms),vertexShader:la.cube.vertexShader,fragmentShader:la.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(o));var g=d.isWebGLRenderTargetCube?d.texture:d;o.material.uniforms.tCube.value=g,o.material.uniforms.tFlip.value=d.isWebGLRenderTargetCube?1:-1,u===d&&l===g.version||(o.material.needsUpdate=!0,u=d,l=g.version),e.unshift(o,o.geometry,o.material,0,0,null)}else d&&d.isTexture&&(void 0===i&&((i=new jo(new da(2,2),new Jo({type:"BackgroundMaterial",uniforms:$o(la.background.uniforms),vertexShader:la.background.vertexShader,fragmentShader:la.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),i.material.uniforms.uvTransform.value.copy(d.matrix),u===d&&l===d.version||(i.material.needsUpdate=!0,u=d,l=d.version),e.unshift(i,i.geometry,i.material,0,0,null))}}}function ma(t,e,r,n){var i,o=n.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,n){t.drawArrays(i,e,n),r.update(n,i)},this.renderInstances=function(n,a,s,u){if(0!==u){var l,c;if(o)l=t,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](i,a,s,u),r.update(s,i,u)}}}function ga(t,e,r){var n;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==r.precision?r.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var u=!0===r.logarithmicDepthBuffer,l=t.getParameter(34930),c=t.getParameter(35660),h=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=c>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=e.get("EXT_texture_filter_anisotropic");return n=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function va(){var t=this,e=null,r=0,n=!1,i=!1,o=new Ri,a=new En,s={value:null,needsUpdate:!1};function u(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,r,n,i){var u=null!==e?e.length:0,l=null;if(0!==u){if(l=s.value,!0!==i||null===l){var c=n+4*u,h=r.matrixWorldInverse;a.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var p=0,d=n;p!==u;++p,d+=4)o.copy(e[p]).applyMatrix4(h,a),o.normal.toArray(l,d),l[d+3]=o.constant}s.value=l,s.needsUpdate=!0}return t.numPlanes=u,l}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,o){var a=0!==t.length||i||0!==r||n;return n=i,e=l(t,o,0),r=t.length,a},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1,u()},this.setState=function(t,o,a,c,h,p){if(!n||null===t||0===t.length||i&&!a)i?l(null):u();else{var d=i?0:r,f=4*d,m=h.clippingState||null;s.value=m,m=l(t,c,f,p);for(var g=0;g!==f;++g)m[g]=e[g];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=d}}}function ya(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}}}function xa(t,e,r){var n=new WeakMap,i=new WeakMap;function o(t){var a=t.target,s=n.get(a);for(var u in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[u]);a.removeEventListener("dispose",o),n.delete(a);var l=i.get(s);l&&(e.remove(l),i.delete(s)),r.memory.geometries--}function a(t){var r=[],n=t.index,o=t.attributes.position,a=0;if(null!==n){var s=n.array;a=n.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],p=s[u+2];r.push(c,h,h,p,p,c)}}else{s=o.array;a=o.version;for(u=0,l=s.length/3-1;u<l;u+=3){c=u+0,h=u+1,p=u+2;r.push(c,h,h,p,p,c)}}var d=new(po(r)>65535?uo:ao)(r,1);d.version=a,e.update(d,34963);var f=i.get(t);f&&e.remove(f),i.set(t,d)}return{get:function(t,e){var i=n.get(e);return i||(e.addEventListener("dispose",o),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new _o).setFromObject(t)),i=e._bufferGeometry),n.set(e,i),r.memory.geometries++,i)},update:function(t){var r=t.index,n=t.attributes;for(var i in null!==r&&e.update(r,34963),n)e.update(n[i],34962);var o=t.morphAttributes;for(var i in o)for(var a=o[i],s=0,u=a.length;s<u;s++)e.update(a[s],34962)},getWireframeAttribute:function(t){var e=i.get(t);if(e){var r=t.index;null!==r&&e.version<r.version&&a(t)}else a(t);return i.get(t)}}}function ba(t,e,r,n){var i,o,a,s=n.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(i,n,o,e*a),r.update(n,i)},this.renderInstances=function(n,u,l,c){if(0!==c){var h,p;if(s)h=t,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(h=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[p](i,l,o,u*a,c),r.update(l,i,c)}}}function _a(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,n){switch(n=n||1,e.calls++,r){case 4:e.triangles+=n*(t/3);break;case 5:case 6:e.triangles+=n*(t-2);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function wa(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ta(t){var e={},r=new Float32Array(8);return{update:function(n,i,o,a){var s=n.morphTargetInfluences,u=s.length,l=e[i.id];if(void 0===l){l=[];for(var c=0;c<u;c++)l[c]=[c,0];e[i.id]=l}var h=o.morphTargets&&i.morphAttributes.position,p=o.morphNormals&&i.morphAttributes.normal;for(c=0;c<u;c++){0!==(f=l[c])[1]&&(h&&i.deleteAttribute("morphTarget"+c),p&&i.deleteAttribute("morphNormal"+c))}for(c=0;c<u;c++){(f=l[c])[0]=c,f[1]=s[c]}l.sort(wa);var d=0;for(c=0;c<8;c++){var f;if(f=l[c]){var m=f[0],g=f[1];if(g){h&&i.setAttribute("morphTarget"+c,h[m]),p&&i.setAttribute("morphNormal"+c,p[m]),r[c]=g,d+=g;continue}}r[c]=0}var v=i.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",v),a.getUniforms().setValue(t,"morphTargetInfluences",r)}}}function Ea(t,e,r,n){var i={};return{update:function(t){var o=n.render.frame,a=t.geometry,s=e.get(t,a);return i[s.id]!==o&&(a.isGeometry&&s.updateFromObject(t),e.update(s),i[s.id]=o),t.isInstancedMesh&&r.update(t.instanceMatrix,34962),s},dispose:function(){i={}}}}function Sa(t,e,r,n,i,o,a,s,u,l){t=void 0!==t?t:[],e=void 0!==e?e:301,a=void 0!==a?a:1022,Pn.call(this,t,e,r,n,i,o,a,s,u,l),this.flipY=!1}function Aa(t,e,r,n){Pn.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Pa(t,e,r,n){Pn.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}la.physical={uniforms:Qo([la.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Yi(0)},clearcoatNormalScale:{value:new vn(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:sa.meshphysical_vert,fragmentShader:sa.meshphysical_frag},pa.prototype=Object.create(Wo.prototype),pa.prototype.constructor=pa,da.prototype=Object.create(_o.prototype),da.prototype.constructor=da,Sa.prototype=Object.create(Pn.prototype),Sa.prototype.constructor=Sa,Sa.prototype.isCubeTexture=!0,Object.defineProperty(Sa.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Aa.prototype=Object.create(Pn.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isDataTexture2DArray=!0,Pa.prototype=Object.create(Pn.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isDataTexture3D=!0;var Ma=new Pn,Ia=new Aa,Oa=new Pa,Ca=new Sa,Ra=[],La=[],Na=new Float32Array(16),Fa=new Float32Array(9),Da=new Float32Array(4);function Ua(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,o=Ra[i];if(void 0===o&&(o=new Float32Array(i),Ra[i]=o),0!==e){n.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=r,t[a].toArray(o,s)}return o}function ka(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function ja(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function Ba(t,e){var r=La[e];void 0===r&&(r=new Int32Array(e),La[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocateTextureUnit();return r}function za(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function Ga(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(ka(r,e))return;t.uniform2fv(this.addr,e),ja(r,e)}}function Va(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(ka(r,e))return;t.uniform3fv(this.addr,e),ja(r,e)}}function Ha(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(ka(r,e))return;t.uniform4fv(this.addr,e),ja(r,e)}}function Xa(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(ka(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),ja(r,e)}else{if(ka(r,n))return;Da.set(n),t.uniformMatrix2fv(this.addr,!1,Da),ja(r,n)}}function Wa(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(ka(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),ja(r,e)}else{if(ka(r,n))return;Fa.set(n),t.uniformMatrix3fv(this.addr,!1,Fa),ja(r,n)}}function Ya(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(ka(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),ja(r,e)}else{if(ka(r,n))return;Na.set(n),t.uniformMatrix4fv(this.addr,!1,Na),ja(r,n)}}function qa(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(e||Ma,i)}function $a(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(e||Ia,i)}function Qa(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(e||Oa,i)}function Za(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(e||Ca,i)}function Ja(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function Ka(t,e){var r=this.cache;ka(r,e)||(t.uniform2iv(this.addr,e),ja(r,e))}function ts(t,e){var r=this.cache;ka(r,e)||(t.uniform3iv(this.addr,e),ja(r,e))}function es(t,e){var r=this.cache;ka(r,e)||(t.uniform4iv(this.addr,e),ja(r,e))}function rs(t,e){t.uniform1fv(this.addr,e)}function ns(t,e){t.uniform1iv(this.addr,e)}function is(t,e){t.uniform2iv(this.addr,e)}function os(t,e){t.uniform3iv(this.addr,e)}function as(t,e){t.uniform4iv(this.addr,e)}function ss(t,e){var r=Ua(e,this.size,2);t.uniform2fv(this.addr,r)}function us(t,e){var r=Ua(e,this.size,3);t.uniform3fv(this.addr,r)}function ls(t,e){var r=Ua(e,this.size,4);t.uniform4fv(this.addr,r)}function cs(t,e){var r=Ua(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,r)}function hs(t,e){var r=Ua(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,r)}function ps(t,e){var r=Ua(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,r)}function ds(t,e,r){var n=e.length,i=Ba(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.safeSetTexture2D(e[o]||Ma,i[o])}function fs(t,e,r){var n=e.length,i=Ba(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.safeSetTextureCube(e[o]||Ca,i[o])}function ms(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return za;case 35664:return Ga;case 35665:return Va;case 35666:return Ha;case 35674:return Xa;case 35675:return Wa;case 35676:return Ya;case 35678:case 36198:return qa;case 35679:return Qa;case 35680:return Za;case 36289:return $a;case 5124:case 35670:return Ja;case 35667:case 35671:return Ka;case 35668:case 35672:return ts;case 35669:case 35673:return es}}(e.type)}function gs(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return rs;case 35664:return ss;case 35665:return us;case 35666:return ls;case 35674:return cs;case 35675:return hs;case 35676:return ps;case 35678:return ds;case 35680:return fs;case 5124:case 35670:return ns;case 35667:case 35671:return is;case 35668:case 35672:return os;case 35669:case 35673:return as}}(e.type)}function vs(t){this.id=t,this.seq=[],this.map={}}gs.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ja(e,t)},vs.prototype.setValue=function(t,e,r){for(var n=this.seq,i=0,o=n.length;i!==o;++i){var a=n[i];a.setValue(t,e[a.id],r)}};var ys=/([\w\d_]+)(\])?(\[|\.)?/g;function xs(t,e){t.seq.push(e),t.map[e.id]=e}function bs(t,e,r){var n=t.name,i=n.length;for(ys.lastIndex=0;;){var o=ys.exec(n),a=ys.lastIndex,s=o[1],u="]"===o[2],l=o[3];if(u&&(s|=0),void 0===l||"["===l&&a+2===i){xs(r,void 0===l?new ms(s,t,e):new gs(s,t,e));break}var c=r.map[s];void 0===c&&xs(r,c=new vs(s)),r=c}}function _s(t,e){this.seq=[],this.map={};for(var r=t.getProgramParameter(e,35718),n=0;n<r;++n){var i=t.getActiveUniform(e,n);bs(i,t.getUniformLocation(e,i.name),this)}}function ws(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}_s.prototype.setValue=function(t,e,r,n){var i=this.map[e];void 0!==i&&i.setValue(t,r,n)},_s.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},_s.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},_s.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r};var Ts=0;function Es(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function Ss(t,e,r){var n=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return n&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(t.getShaderSource(e))}function As(t,e){var r=Es(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Ps(t,e){var r;switch(e){case 1:r="Linear";break;case 2:r="Reinhard";break;case 3:r="Uncharted2";break;case 4:r="OptimizedCineon";break;case 5:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Ms(t){return""!==t}function Is(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Os(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Cs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Rs(t){return t.replace(Cs,Ls)}function Ls(t,e){var r=sa[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return Rs(r)}var Ns=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Fs(t){return t.replace(Ns,Ds)}function Ds(t,e,r,n){for(var i="",o=parseInt(e);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Us(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ks(t,e,r,n,i,o){var a,s,u,l,c,h=t.getContext(),p=n.defines,d=i.vertexShader,f=i.fragmentShader,m=function(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(o),g=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:e="ENVMAP_TYPE_EQUIREC";break;case 305:e="ENVMAP_TYPE_SPHERE"}return e}(o),v=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:e="ENVMAP_MODE_REFRACTION"}return e}(o),y=function(t){var e="ENVMAP_BLENDING_MULTIPLY";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(o),x=t.gammaFactor>0?t.gammaFactor:1,b=o.isWebGL2?"":function(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ms).join("\n")}(n.extensions,o,e),_=function(t){var e=[];for(var r in t){var n=t[r];!1!==n&&e.push("#define "+r+" "+n)}return e.join("\n")}(p),w=h.createProgram(),T=o.numMultiviewViews;if(n.isRawShaderMaterial?((a=[_].filter(Ms).join("\n")).length>0&&(a+="\n"),(s=[b,_].filter(Ms).join("\n")).length>0&&(s+="\n")):(a=[Us(o),"#define SHADER_NAME "+i.name,_,o.instancing?"#define USE_INSTANCING":"",o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+v:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+m:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(o.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ms).join("\n"),s=[b,Us(o),"#define SHADER_NAME "+i.name,_,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+x,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp2?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+g:"",o.envMap?"#define "+v:"",o.envMap?"#define "+y:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.normalMap&&o.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",o.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.sheen?"#define USE_SHEEN":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.vertexUvs?"#define USE_UV":"",o.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+m:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(o.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensions&&n.extensions.shaderTextureLOD||o.envMap)&&(o.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?sa.tonemapping_pars_fragment:"",0!==o.toneMapping?Ps("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?sa.encodings_pars_fragment:"",o.mapEncoding?As("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?As("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?As("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?As("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?(u="linearToOutputTexel",l=o.outputEncoding,c=Es(l),"vec4 "+u+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ms).join("\n")),d=Os(d=Is(d=Rs(d),o),o),f=Os(f=Is(f=Rs(f),o),o),d=Fs(d),f=Fs(f),o.isWebGL2&&!n.isRawShaderMaterial){var E=!1,S=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==d.match(S)&&null!==f.match(S)&&(E=!0,d=d.replace(S,""),f=f.replace(S,"")),a=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,s=["#version 300 es\n","#define varying in",E?"":"out highp vec4 pc_fragColor;",E?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s,T>0&&(a=(a=a.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+T+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+T+"];","uniform mat4 projectionMatrices["+T+"];","uniform mat4 viewMatrices["+T+"];","uniform mat3 normalMatrices["+T+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),s=(s=s.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+T+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var A,P,M=s+f,I=ws(h,35633,a+d),O=ws(h,35632,M);if(h.attachShader(w,I),h.attachShader(w,O),void 0!==n.index0AttributeName?h.bindAttribLocation(w,0,n.index0AttributeName):!0===o.morphTargets&&h.bindAttribLocation(w,0,"position"),h.linkProgram(w),t.debug.checkShaderErrors){var C=h.getProgramInfoLog(w).trim(),R=h.getShaderInfoLog(I).trim(),L=h.getShaderInfoLog(O).trim(),N=!0,F=!0;if(!1===h.getProgramParameter(w,35714)){N=!1;var D=Ss(h,I,"vertex"),U=Ss(h,O,"fragment");console.error("THREE.WebGLProgram: shader error: ",h.getError(),"35715",h.getProgramParameter(w,35715),"gl.getProgramInfoLog",C,D,U)}else""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==R&&""!==L||(F=!1);F&&(this.diagnostics={runnable:N,material:n,programLog:C,vertexShader:{log:R,prefix:a},fragmentShader:{log:L,prefix:s}})}return h.deleteShader(I),h.deleteShader(O),this.getUniforms=function(){return void 0===A&&(A=new _s(h,w)),A},this.getAttributes=function(){return void 0===P&&(P=function(t,e){for(var r={},n=t.getProgramParameter(e,35721),i=0;i<n;i++){var o=t.getActiveAttrib(e,i).name;r[o]=t.getAttribLocation(e,o)}return r}(h,w)),P},this.destroy=function(){h.deleteProgram(w),this.program=void 0},this.name=i.name,this.id=Ts++,this.cacheKey=r,this.usedTimes=1,this.program=w,this.vertexShader=I,this.fragmentShader=O,this.numMultiviewViews=T,this}function js(t,e,r){var n=[],i=r.isWebGL2,o=r.logarithmicDepthBuffer,a=r.floatVertexTextures,s=r.precision,u=r.maxVertexUniforms,l=r.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(t,e){var r;return t?t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding):r=3e3,3e3===r&&e&&(r=3007),r}this.getParameters=function(e,n,h,d,f,m,g){var v=c[e.type],y=g.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(a)return 1024;var r=u,n=Math.floor((r-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}(g):0;null!==e.precision&&(s=r.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",s,"instead.");var x=t.getRenderTarget(),b=x&&x.isWebGLMultiviewRenderTarget?x.numViews:0;return{isWebGL2:i,shaderID:v,precision:s,instancing:!0===g.isInstancedMesh,supportsVertexTextures:l,numMultiviewViews:b,outputEncoding:p(x?x.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:p(e.map,t.gammaInput),matcap:!!e.matcap,matcapEncoding:p(e.matcap,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:p(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(306===e.envMap.mapping||307===e.envMap.mapping),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:p(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:1===e.normalMapType,tangentSpaceNormalMap:0===e.normalMapType,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||e.displacementMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||!e.displacementMap),fog:!!d,useFog:e.fog,fogExp2:d&&d.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:o,skinning:e.skinning&&y>0,maxBones:y,useVertexTexture:a,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numDirLightShadows:n.directionalShadowMap.length,numPointLightShadows:n.pointShadowMap.length,numSpotLightShadows:n.spotShadowMap.length,numClippingPlanes:f,numClipIntersection:m,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:e.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:2===e.side,flipSided:1===e.side,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCacheKey=function(e,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);for(var o=0;o<h.length;o++)n.push(r[h[o]]);return n.push(e.onBeforeCompile.toString()),n.push(t.gammaOutput),n.push(t.gammaFactor),n.join()},this.acquireProgram=function(r,i,o,a){for(var s,u=0,l=n.length;u<l;u++){var c=n[u];if(c.cacheKey===a){++(s=c).usedTimes;break}}return void 0===s&&(s=new ks(t,e,a,r,i,o),n.push(s)),s},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function Bs(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&(r={},t.set(e,r)),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}}function zs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Gs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Vs(){var t=[],e=0,r=[],n=[],i={id:-1};function o(r,n,o,a,s,u){var l=t[e];return void 0===l?(l={id:r.id,object:r,geometry:n,material:o,program:o.program||i,groupOrder:a,renderOrder:r.renderOrder,z:s,group:u},t[e]=l):(l.id=r.id,l.object=r,l.geometry=n,l.material=o,l.program=o.program||i,l.groupOrder=a,l.renderOrder=r.renderOrder,l.z=s,l.group=u),e++,l}return{opaque:r,transparent:n,init:function(){e=0,r.length=0,n.length=0},push:function(t,e,i,a,s,u){var l=o(t,e,i,a,s,u);(!0===i.transparent?n:r).push(l)},unshift:function(t,e,i,a,s,u){var l=o(t,e,i,a,s,u);(!0===i.transparent?n:r).unshift(l)},sort:function(){r.length>1&&r.sort(zs),n.length>1&&n.sort(Gs)}}}function Hs(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i,o=t.get(r);return void 0===o?(i=new Vs,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):void 0===(i=o.get(n))&&(i=new Vs,o.set(n,i)),i},dispose:function(){t=new WeakMap}}}function Xs(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new _n,color:new Yi,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new vn};break;case"SpotLight":r={position:new _n,direction:new _n,color:new Yi,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new vn};break;case"PointLight":r={position:new _n,color:new Yi,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new vn,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new _n,skyColor:new Yi,groundColor:new Yi};break;case"RectAreaLight":r={color:new Yi,position:new _n,halfWidth:new _n,halfHeight:new _n}}return t[e.id]=r,r}}}var Ws=0;function Ys(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function qs(){for(var t=new Xs,e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},r=0;r<9;r++)e.probe.push(new _n);var n=new _n,i=new kn,o=new kn;return{setup:function(r,a,s){for(var u=0,l=0,c=0,h=0;h<9;h++)e.probe[h].set(0,0,0);var p=0,d=0,f=0,m=0,g=0,v=0,y=0,x=0,b=s.matrixWorldInverse;r.sort(Ys),h=0;for(var _=r.length;h<_;h++){var w=r[h],T=w.color,E=w.intensity,S=w.distance,A=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)u+=T.r*E,l+=T.g*E,c+=T.b*E;else if(w.isLightProbe)for(var P=0;P<9;P++)e.probe[P].addScaledVector(w.sh.coefficients[P],E);else if(w.isDirectionalLight){if((I=t.get(w)).color.copy(w.color).multiplyScalar(w.intensity),I.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),I.direction.sub(n),I.direction.transformDirection(b),I.shadow=w.castShadow,w.castShadow){var M=w.shadow;I.shadowBias=M.bias,I.shadowRadius=M.radius,I.shadowMapSize=M.mapSize,e.directionalShadowMap[p]=A,e.directionalShadowMatrix[p]=w.shadow.matrix,v++}e.directional[p]=I,p++}else if(w.isSpotLight){if((I=t.get(w)).position.setFromMatrixPosition(w.matrixWorld),I.position.applyMatrix4(b),I.color.copy(T).multiplyScalar(E),I.distance=S,I.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),I.direction.sub(n),I.direction.transformDirection(b),I.coneCos=Math.cos(w.angle),I.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),I.decay=w.decay,I.shadow=w.castShadow,w.castShadow){M=w.shadow;I.shadowBias=M.bias,I.shadowRadius=M.radius,I.shadowMapSize=M.mapSize,e.spotShadowMap[f]=A,e.spotShadowMatrix[f]=w.shadow.matrix,x++}e.spot[f]=I,f++}else if(w.isRectAreaLight){(I=t.get(w)).color.copy(T).multiplyScalar(E),I.position.setFromMatrixPosition(w.matrixWorld),I.position.applyMatrix4(b),o.identity(),i.copy(w.matrixWorld),i.premultiply(b),o.extractRotation(i),I.halfWidth.set(.5*w.width,0,0),I.halfHeight.set(0,.5*w.height,0),I.halfWidth.applyMatrix4(o),I.halfHeight.applyMatrix4(o),e.rectArea[m]=I,m++}else if(w.isPointLight){if((I=t.get(w)).position.setFromMatrixPosition(w.matrixWorld),I.position.applyMatrix4(b),I.color.copy(w.color).multiplyScalar(w.intensity),I.distance=w.distance,I.decay=w.decay,I.shadow=w.castShadow,w.castShadow){M=w.shadow;I.shadowBias=M.bias,I.shadowRadius=M.radius,I.shadowMapSize=M.mapSize,I.shadowCameraNear=M.camera.near,I.shadowCameraFar=M.camera.far,e.pointShadowMap[d]=A,e.pointShadowMatrix[d]=w.shadow.matrix,y++}e.point[d]=I,d++}else if(w.isHemisphereLight){var I;(I=t.get(w)).direction.setFromMatrixPosition(w.matrixWorld),I.direction.transformDirection(b),I.direction.normalize(),I.skyColor.copy(w.color).multiplyScalar(E),I.groundColor.copy(w.groundColor).multiplyScalar(E),e.hemi[g]=I,g++}}e.ambient[0]=u,e.ambient[1]=l,e.ambient[2]=c;var O=e.hash;O.directionalLength===p&&O.pointLength===d&&O.spotLength===f&&O.rectAreaLength===m&&O.hemiLength===g&&O.numDirectionalShadows===v&&O.numPointShadows===y&&O.numSpotShadows===x||(e.directional.length=p,e.spot.length=f,e.rectArea.length=m,e.point.length=d,e.hemi.length=g,e.directionalShadowMap.length=v,e.pointShadowMap.length=y,e.spotShadowMap.length=x,e.directionalShadowMatrix.length=v,e.pointShadowMatrix.length=y,e.spotShadowMatrix.length=x,O.directionalLength=p,O.pointLength=d,O.spotLength=f,O.rectAreaLength=m,O.hemiLength=g,O.numDirectionalShadows=v,O.numPointShadows=y,O.numSpotShadows=x,e.version=Ws++)},state:e}}function $s(){var t=new qs,e=[],r=[];return{init:function(){e.length=0,r.length=0},state:{lightsArray:e,shadowsArray:r,lights:t},setupLights:function(n){t.setup(e,r,n)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)}}}function Qs(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i;return!1===t.has(r)?(i=new $s,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):!1===t.get(r).has(n)?(i=new $s,t.get(r).set(n,i)):i=t.get(r).get(n),i},dispose:function(){t=new WeakMap}}}function Zs(t){Ki.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Js(t){Ki.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new _n,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Zs.prototype=Object.create(Ki.prototype),Zs.prototype.constructor=Zs,Zs.prototype.isMeshDepthMaterial=!0,Zs.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Js.prototype=Object.create(Ki.prototype),Js.prototype.constructor=Js,Js.prototype.isMeshDistanceMaterial=!0,Js.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function Ks(t,e,r){var n=new aa,i=new vn,o=new vn,a=new Mn,s=[],u=[],l={},c={0:1,1:0,2:2},h=new Jo({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new vn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpack2HalfToRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONAL_PASS=1;var d=new _o;d.setAttribute("position",new eo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var f=new jo(d,h),m=this;function g(r,n){var i=e.update(f);h.uniforms.shadow_pass.value=r.map.texture,h.uniforms.resolution.value=r.mapSize,h.uniforms.radius.value=r.radius,t.setRenderTarget(r.mapPass),t.clear(),t.renderBufferDirect(n,null,i,h,f,null),p.uniforms.shadow_pass.value=r.mapPass.texture,p.uniforms.resolution.value=r.mapSize,p.uniforms.radius.value=r.radius,t.setRenderTarget(r.map),t.clear(),t.renderBufferDirect(n,null,i,p,f,null)}function v(t,e,r){var n=t<<0|e<<1|r<<2,i=s[n];return void 0===i&&(i=new Zs({depthPacking:3201,morphTargets:t,skinning:e}),s[n]=i),i}function y(t,e,r){var n=t<<0|e<<1|r<<2,i=u[n];return void 0===i&&(i=new Js({morphTargets:t,skinning:e}),u[n]=i),i}function x(e,r,n,i,o,a){var s=e.geometry,u=null,h=v,p=e.customDepthMaterial;if(!0===n.isPointLight&&(h=y,p=e.customDistanceMaterial),void 0===p){var d=!1;!0===r.morphTargets&&(!0===s.isBufferGeometry?d=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(d=s.morphTargets&&s.morphTargets.length>0));var f=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?f=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),u=h(d,f,!0===e.isInstancedMesh)}else u=p;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=u.uuid,g=r.uuid,x=l[m];void 0===x&&(x={},l[m]=x);var b=x[g];void 0===b&&(b=u.clone(),x[g]=b),u=b}return u.visible=r.visible,u.wireframe=r.wireframe,u.side=3===a?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:c[r.side],u.clipShadows=r.clipShadows,u.clippingPlanes=r.clippingPlanes,u.clipIntersection=r.clipIntersection,u.wireframeLinewidth=r.wireframeLinewidth,u.linewidth=r.linewidth,!0===n.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(n.matrixWorld),u.nearDistance=i,u.farDistance=o),u}function b(r,i,o,a,s){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&3===s)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var u=e.update(r),l=r.material;if(Array.isArray(l))for(var c=u.groups,h=0,p=c.length;h<p;h++){var d=c[h],f=l[d.materialIndex];if(f&&f.visible){var m=x(r,f,a,o.near,o.far,s);t.renderBufferDirect(o,null,u,m,r,d)}}else if(l.visible){m=x(r,l,a,o.near,o.far,s);t.renderBufferDirect(o,null,u,m,r,null)}}for(var g=r.children,v=0,y=g.length;v<y;v++)b(g[v],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,s,u){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==e.length){var l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=e.length;d<f;d++){var v=e[d],y=v.shadow;if(void 0!==y){i.copy(y.mapSize);var x=y.getFrameExtents();if(i.multiply(x),o.copy(y.mapSize),(i.x>r||i.y>r)&&(console.warn("THREE.WebGLShadowMap:",v,"has shadow exceeding max texture size, reducing"),i.x>r&&(o.x=Math.floor(r/x.x),i.x=o.x*x.x,y.mapSize.x=o.x),i.y>r&&(o.y=Math.floor(r/x.y),i.y=o.y*x.y,y.mapSize.y=o.y)),null===y.map&&!y.isPointLightShadow&&3===this.type){var _={minFilter:1006,magFilter:1006,format:1023};y.map=new In(i.x,i.y,_),y.map.texture.name=v.name+".shadowMap",y.mapPass=new In(i.x,i.y,_),y.camera.updateProjectionMatrix()}if(null===y.map){_={minFilter:1003,magFilter:1003,format:1023};y.map=new In(i.x,i.y,_),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()}t.setRenderTarget(y.map),t.clear();for(var w=y.getViewportCount(),T=0;T<w;T++){var E=y.getViewport(T);a.set(o.x*E.x,o.y*E.y,o.x*E.z,o.y*E.w),p.viewport(a),y.updateMatrices(v,T),n=y.getFrustum(),b(s,u,y.camera,v,this.type)}y.isPointLightShadow||3!==this.type||g(y,u)}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,t.setRenderTarget(l,c,h)}}}function tu(t,e,r){var n=r.isWebGL2;var i=new function(){var e=!1,r=new Mn,n=null,i=new Mn(0,0,0,0);return{setMask:function(r){n===r||e||(t.colorMask(r,r,r,r),n=r)},setLocked:function(t){e=t},setClear:function(e,n,o,a,s){!0===s&&(e*=a,n*=a,o*=a),r.set(e,n,o,a),!1===i.equals(r)&&(t.clearColor(e,n,o,a),i.copy(r))},reset:function(){e=!1,n=null,i.set(-1,0,0,0)}}},o=new function(){var e=!1,r=null,n=null,i=null;return{setTest:function(t){t?k(2929):j(2929)},setMask:function(n){r===n||e||(t.depthMask(n),r=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,r=null,n=null,i=null}}},a=new function(){var e=!1,r=null,n=null,i=null,o=null,a=null,s=null,u=null,l=null;return{setTest:function(t){e||(t?k(2960):j(2960))},setMask:function(n){r===n||e||(t.stencilMask(n),r=n)},setFunc:function(e,r,a){n===e&&i===r&&o===a||(t.stencilFunc(e,r,a),n=e,i=r,o=a)},setOp:function(e,r,n){a===e&&s===r&&u===n||(t.stencilOp(e,r,n),a=e,s=r,u=n)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,r=null,n=null,i=null,o=null,a=null,s=null,u=null,l=null}}},s=t.getParameter(34921),u=new Uint8Array(s),l=new Uint8Array(s),c=new Uint8Array(s),h={},p=null,d=null,f=null,m=null,g=null,v=null,y=null,x=null,b=null,_=!1,w=null,T=null,E=null,S=null,A=null,P=t.getParameter(35661),M=!1,I=0,O=t.getParameter(7938);-1!==O.indexOf("WebGL")?(I=parseFloat(/^WebGL\ ([0-9])/.exec(O)[1]),M=I>=1):-1!==O.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(O)[1]),M=I>=2);var C=null,R={},L=new Mn,N=new Mn;function F(e,r,n){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var a=0;a<n;a++)t.texImage2D(r+a,0,6408,1,1,0,6408,5121,i);return o}var D={};function U(r,i){(u[r]=1,0===l[r]&&(t.enableVertexAttribArray(r),l[r]=1),c[r]!==i)&&((n?t:e.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),c[r]=i)}function k(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function j(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}D[3553]=F(3553,3553,1),D[34067]=F(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),a.setClear(0),k(2929),o.setFunc(3),H(!1),X(1),k(2884),V(0);var B={100:32774,101:32778,102:32779};if(n)B[103]=32775,B[104]=32776;else{var z=e.get("EXT_blend_minmax");null!==z&&(B[103]=z.MIN_EXT,B[104]=z.MAX_EXT)}var G={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function V(e,r,n,i,o,a,s,u){if(0!==e){if(d||(k(3042),d=!0),5===e)o=o||r,a=a||n,s=s||i,r===m&&o===y||(t.blendEquationSeparate(B[r],B[o]),m=r,y=o),n===g&&i===v&&a===x&&s===b||(t.blendFuncSeparate(G[n],G[i],G[a],G[s]),g=n,v=i,x=a,b=s),f=e,_=null;else if(e!==f||u!==_){if(100===m&&100===y||(t.blendEquation(32774),m=100,y=100),u)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,v=null,x=null,b=null,f=e,_=u}}else d&&(j(3042),d=!1)}function H(e){w!==e&&(e?t.frontFace(2304):t.frontFace(2305),w=e)}function X(e){0!==e?(k(2884),e!==T&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):j(2884),T=e}function W(e,r,n){e?(k(32823),S===r&&A===n||(t.polygonOffset(r,n),S=r,A=n)):j(32823)}function Y(e){void 0===e&&(e=33984+P-1),C!==e&&(t.activeTexture(e),C=e)}return{buffers:{color:i,depth:o,stencil:a},initAttributes:function(){for(var t=0,e=u.length;t<e;t++)u[t]=0},enableAttribute:function(t){U(t,0)},enableAttributeAndDivisor:U,disableUnusedAttributes:function(){for(var e=0,r=l.length;e!==r;++e)l[e]!==u[e]&&(t.disableVertexAttribArray(e),l[e]=0)},enable:k,disable:j,useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:V,setMaterial:function(t,e){2===t.side?j(2884):k(2884);var r=1===t.side;e&&(r=!r),H(r),1===t.blending&&!1===t.transparent?V(0):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),i.setMask(t.colorWrite);var n=t.stencilWrite;a.setTest(n),n&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),W(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:H,setCullFace:X,setLineWidth:function(e){e!==E&&(M&&t.lineWidth(e),E=e)},setPolygonOffset:W,setScissorTest:function(t){t?k(3089):j(3089)},activeTexture:Y,bindTexture:function(e,r){null===C&&Y();var n=R[C];void 0===n&&(n={type:void 0,texture:void 0},R[C]=n),n.type===e&&n.texture===r||(t.bindTexture(e,r||D[e]),n.type=e,n.texture=r)},unbindTexture:function(){var e=R[C];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===L.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){for(var e=0;e<l.length;e++)1===l[e]&&(t.disableVertexAttribArray(e),l[e]=0);h={},C=null,R={},p=null,f=null,w=null,T=null,i.reset(),o.reset(),a.reset()}}}function eu(t,e,r,n,i,o,a){var s,u=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,h=i.maxTextureSize,p=i.maxSamples,d=new WeakMap,f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d");function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,r,n){var i=1;if((t.width>n||t.height>n)&&(i=n/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var o=e?gn.floorPowerOfTwo:Math.floor,a=o(i*t.width),u=o(i*t.height);void 0===s&&(s=m(a,u));var l=r?m(a,u):s;return l.width=a,l.height=u,l.getContext("2d").drawImage(t,0,0,a,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+u+")."),l}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return gn.isPowerOfTwo(t.width)&&gn.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function x(e,r,i,o){t.generateMipmap(e),n.get(r).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function b(t,r){if(!1===u)return t;var n=t;return 6403===t&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===t&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===t&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=32856)),33325===n||33326===n||34842===n||34836===n?e.get("EXT_color_buffer_float"):34843!==n&&34837!==n||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),n}function _(t){return 1003===t||1004===t||1005===t?9728:9729}function w(e){var r=e.target;r.removeEventListener("dispose",w),function(e){var r=n.get(e);if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture),n.remove(e)}(r),r.isVideoTexture&&d.delete(r),a.memory.textures--}function T(e){var r=e.target;r.removeEventListener("dispose",T),function(e){var r=n.get(e),i=n.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[o]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer);if(e.isWebGLMultiviewRenderTarget){t.deleteTexture(r.__webglColorTexture),t.deleteTexture(r.__webglDepthStencilTexture),a.memory.textures-=2;o=0;for(var s=r.__webglViewFramebuffers.length;o<s;o++)t.deleteFramebuffer(r.__webglViewFramebuffers[o])}n.remove(e.texture),n.remove(e)}(r),a.memory.textures--}var E=0;function S(t,e){var i=n.get(t);if(t.isVideoTexture&&function(t){var e=a.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void R(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+e),r.bindTexture(3553,i.__webglTexture)}function A(e,i){if(6===e.image.length){var a=n.get(e);if(e.version>0&&a.__version!==e.version){C(a,e),r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture),t.pixelStorei(37440,e.flipY);for(var s=e&&e.isCompressedTexture,l=e.image[0]&&e.image[0].isDataTexture,h=[],p=0;p<6;p++)h[p]=s||l?l?e.image[p].image:e.image[p]:g(e.image[p],!1,!0,c);var d,f=h[0],m=v(f)||u,_=o.convert(e.format),w=o.convert(e.type),T=b(_,w);if(O(34067,e,m),s){for(p=0;p<6;p++){d=h[p].mipmaps;for(var E=0;E<d.length;E++){var S=d[E];1023!==e.format&&1022!==e.format?null!==_?r.compressedTexImage2D(34069+p,E,T,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+p,E,T,S.width,S.height,0,_,w,S.data)}}a.__maxMipLevel=d.length-1}else{d=e.mipmaps;for(p=0;p<6;p++)if(l){r.texImage2D(34069+p,0,T,h[p].width,h[p].height,0,_,w,h[p].data);for(E=0;E<d.length;E++){var A=(S=d[E]).image[p].image;r.texImage2D(34069+p,E+1,T,A.width,A.height,0,_,w,A.data)}}else{r.texImage2D(34069+p,0,T,_,w,h[p]);for(E=0;E<d.length;E++){S=d[E];r.texImage2D(34069+p,E+1,T,_,w,S.image[p])}}a.__maxMipLevel=d.length}y(e,m)&&x(34067,e,f.width,f.height),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture)}}function P(t,e){r.activeTexture(33984+e),r.bindTexture(34067,n.get(t).__webglTexture)}var M={1e3:10497,1001:33071,1002:33648},I={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function O(r,o,a){a?(t.texParameteri(r,10242,M[o.wrapS]),t.texParameteri(r,10243,M[o.wrapT]),32879!==r&&35866!==r||t.texParameteri(r,32882,M[o.wrapR]),t.texParameteri(r,10240,I[o.magFilter]),t.texParameteri(r,10241,I[o.minFilter])):(t.texParameteri(r,10242,33071),t.texParameteri(r,10243,33071),32879!==r&&35866!==r||t.texParameteri(r,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(r,10240,_(o.magFilter)),t.texParameteri(r,10241,_(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=e.get("EXT_texture_filter_anisotropic");if(s){if(1015===o.type&&null===e.get("OES_texture_float_linear"))return;if(1016===o.type&&null===(u||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(t.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function C(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),a.memory.textures++)}function R(e,n,i){var a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),C(e,n),r.activeTexture(33984+i),r.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment);var s=function(t){return!u&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)}(n)&&!1===v(n.image),l=g(n.image,s,!1,h),c=v(l)||u,p=o.convert(n.format),d=o.convert(n.type),f=b(p,d);O(a,n,c);var m,_=n.mipmaps;if(n.isDepthTexture){if(f=6402,1015===n.type){if(!1===u)throw new Error("Float Depth Texture only supported in WebGL2.0");f=36012}else u&&(f=33189);1026===n.format&&6402===f&&1012!==n.type&&1014!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=1012,d=o.convert(n.type)),1027===n.format&&(f=34041,1020!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=1020,d=o.convert(n.type))),r.texImage2D(3553,0,f,l.width,l.height,0,p,d,null)}else if(n.isDataTexture)if(_.length>0&&c){for(var w=0,T=_.length;w<T;w++)m=_[w],r.texImage2D(3553,w,f,m.width,m.height,0,p,d,m.data);n.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else r.texImage2D(3553,0,f,l.width,l.height,0,p,d,l.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(w=0,T=_.length;w<T;w++)m=_[w],1023!==n.format&&1022!==n.format?null!==p?r.compressedTexImage2D(3553,w,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,w,f,m.width,m.height,0,p,d,m.data);e.__maxMipLevel=_.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,f,l.width,l.height,l.depth,0,p,d,l.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,f,l.width,l.height,l.depth,0,p,d,l.data),e.__maxMipLevel=0;else if(_.length>0&&c){for(w=0,T=_.length;w<T;w++)m=_[w],r.texImage2D(3553,w,f,p,d,m);n.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else r.texImage2D(3553,0,f,p,d,l),e.__maxMipLevel=0;y(n,c)&&x(3553,n,l.width,l.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function L(e,i,a,s){var u=o.convert(i.texture.format),l=o.convert(i.texture.type),c=b(u,l);r.texImage2D(s,0,c,i.width,i.height,0,u,l,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,n.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function N(e,r,n){if(t.bindRenderbuffer(36161,e),r.depthBuffer&&!r.stencilBuffer){if(n){var i=D(r);t.renderbufferStorageMultisample(36161,i,33189,r.width,r.height)}else t.renderbufferStorage(36161,33189,r.width,r.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(r.depthBuffer&&r.stencilBuffer){if(n){i=D(r);t.renderbufferStorageMultisample(36161,i,35056,r.width,r.height)}else t.renderbufferStorage(36161,34041,r.width,r.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var a=b(o.convert(r.texture.format),o.convert(r.texture.type));if(n){i=D(r);t.renderbufferStorageMultisample(36161,i,a,r.width,r.height)}else t.renderbufferStorage(36161,a,r.width,r.height)}t.bindRenderbuffer(36161,null)}function F(e){var r=n.get(e),i=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),S(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(1026===r.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==r.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,e)}else if(i){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=t.createRenderbuffer(),N(r.__webglDepthbuffer[o],e)}else t.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),N(r.__webglDepthbuffer,e);t.bindFramebuffer(36160,null)}function D(t){return u&&t.isWebGLMultisampleRenderTarget?Math.min(p,t.samples):0}var U=!1,k=!1;this.allocateTextureUnit=function(){var t=E;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),E+=1,t},this.resetTextureUnits=function(){E=0},this.setTexture2D=S,this.setTexture2DArray=function(t,e){var i=n.get(t);t.version>0&&i.__version!==t.version?R(i,t,e):(r.activeTexture(33984+e),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){var i=n.get(t);t.version>0&&i.__version!==t.version?R(i,t,e):(r.activeTexture(33984+e),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=A,this.setTextureCubeDynamic=P,this.setupRenderTarget=function(i){var s=n.get(i),l=n.get(i.texture);i.addEventListener("dispose",T),l.__webglTexture=t.createTexture(),a.memory.textures++;var c=!0===i.isWebGLRenderTargetCube,h=!0===i.isWebGLMultisampleRenderTarget,p=!0===i.isWebGLMultiviewRenderTarget,d=v(i)||u;if(c){s.__webglFramebuffer=[];for(var f=0;f<6;f++)s.__webglFramebuffer[f]=t.createFramebuffer()}else if(s.__webglFramebuffer=t.createFramebuffer(),h)if(u){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=b(o.convert(i.texture.format),o.convert(i.texture.type)),g=D(i);t.renderbufferStorageMultisample(36161,g,m,i.width,i.height),t.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),i.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),N(s.__webglDepthRenderbuffer,i,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(p){var _=i.width,w=i.height,E=i.numViews;t.bindFramebuffer(36160,s.__webglFramebuffer);var S=e.get("OVR_multiview2");a.memory.textures+=2;var A=t.createTexture();t.bindTexture(35866,A),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,32856,_,w,E,0,6408,5121,null),S.framebufferTextureMultiviewOVR(36160,36064,A,0,0,E);var P=t.createTexture();t.bindTexture(35866,P),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,35056,_,w,E,0,34041,34042,null),S.framebufferTextureMultiviewOVR(36160,33306,P,0,0,E);var M=new Array(E);for(f=0;f<E;++f)M[f]=t.createFramebuffer(),t.bindFramebuffer(36160,M[f]),t.framebufferTextureLayer(36160,36064,A,0,f);s.__webglColorTexture=A,s.__webglDepthStencilTexture=P,s.__webglViewFramebuffers=M,t.bindFramebuffer(36160,null),t.bindTexture(35866,null)}if(c){r.bindTexture(34067,l.__webglTexture),O(34067,i.texture,d);for(f=0;f<6;f++)L(s.__webglFramebuffer[f],i,36064,34069+f);y(i.texture,d)&&x(34067,i.texture,i.width,i.height),r.bindTexture(34067,null)}else p||(r.bindTexture(3553,l.__webglTexture),O(3553,i.texture,d),L(s.__webglFramebuffer,i,36064,3553),y(i.texture,d)&&x(3553,i.texture,i.width,i.height),r.bindTexture(3553,null));i.depthBuffer&&F(i)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(y(e,v(t)||u)){var i=t.isWebGLRenderTargetCube?34067:3553,o=n.get(e).__webglTexture;r.bindTexture(i,o),x(i,e,t.width,t.height),r.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(u){var r=n.get(e);t.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,r.__webglFramebuffer);var i=e.width,o=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),S(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLRenderTargetCube&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?A(t,e):P(t,e)}}function ru(t,e,r){var n=r.isWebGL2;return{convert:function(t){var r;if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t)return n?5131:null!==(r=e.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(33776===t||33777===t||33778===t||33779===t){if(null===(r=e.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===t)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(null===(r=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===t)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return 36196===t?null!==(r=e.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null:37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t?null!==(r=e.get("WEBGL_compressed_texture_astc"))?t:null:1020===t?n?34042:null!==(r=e.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function nu(t,e,r,n){In.call(this,t,e,n),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=r}function iu(t,e){var r,n,i,o,a,s,u,l=t.extensions,c=t.properties,h=0;function p(t){return t.isArrayCamera?t.cameras:(a[0]=t,a)}this.isAvailable=function(){if(void 0===u){var t=l.get("OVR_multiview2");if(u=null!==t&&!1===e.getContextAttributes().antialias){h=e.getParameter(t.MAX_VIEWS_OVR),r=new nu(0,0,2),s=new vn,o=[],i=[],a=[];for(var n=0;n<h;n++)o[n]=new kn,i[n]=new En}}return u},this.attachCamera=function(e){!1!==function(t){if(void 0===t.isArrayCamera)return!0;var e=t.cameras;if(e.length>h)return!1;for(var r=1,n=e.length;r<n;r++)if(e[0].viewport.z!==e[r].viewport.z||e[0].viewport.w!==e[r].viewport.w)return!1;return!0}(e)&&(n=t.getRenderTarget(),function(e){if(n?s.set(n.width,n.height):t.getDrawingBufferSize(s),e.isArrayCamera){var i=e.cameras[0].viewport;r.setSize(i.z,i.w),r.setNumViews(e.cameras.length)}else r.setSize(s.x,s.y),r.setNumViews(2)}(e),t.setRenderTarget(r))},this.detachCamera=function(i){r===t.getRenderTarget()&&(t.setRenderTarget(n),function(t){var n=r,i=n.numViews,o=c.get(n).__webglViewFramebuffers,a=n.width,u=n.height;if(t.isArrayCamera)for(var l=0;l<i;l++){var h=t.cameras[l].viewport,p=h.x,d=h.y,f=p+h.z,m=d+h.w;e.bindFramebuffer(36008,o[l]),e.blitFramebuffer(0,0,a,u,p,d,f,m,16384,9728)}else e.bindFramebuffer(36008,o[0]),e.blitFramebuffer(0,0,a,u,0,0,s.x,s.y,16384,9728)}(i))},this.updateCameraProjectionMatricesUniform=function(t,r){for(var n=p(t),i=0;i<n.length;i++)o[i].copy(n[i].projectionMatrix);r.setValue(e,"projectionMatrices",o)},this.updateCameraViewMatricesUniform=function(t,r){for(var n=p(t),i=0;i<n.length;i++)o[i].copy(n[i].matrixWorldInverse);r.setValue(e,"viewMatrices",o)},this.updateObjectMatricesUniforms=function(t,r,n){for(var a=p(r),s=0;s<a.length;s++)o[s].multiplyMatrices(a[s].matrixWorldInverse,t.matrixWorld),i[s].getNormalMatrix(o[s]);n.setValue(e,"modelViewMatrices",o),n.setValue(e,"normalMatrices",i)}}function ou(){ri.call(this),this.type="Group"}function au(t){ta.call(this),this.cameras=t||[]}nu.prototype=Object.assign(Object.create(In.prototype),{constructor:nu,isWebGLMultiviewRenderTarget:!0,copy:function(t){return In.prototype.copy.call(this,t),this.numViews=t.numViews,this},setNumViews:function(t){return this.numViews!==t&&(this.numViews=t,this.dispose()),this}}),ou.prototype=Object.assign(Object.create(ri.prototype),{constructor:ou,isGroup:!0}),au.prototype=Object.assign(Object.create(ta.prototype),{constructor:au,isArrayCamera:!0});var su,uu=new _n,lu=new _n;function cu(t,e,r){uu.setFromMatrixPosition(e.matrixWorld),lu.setFromMatrixPosition(r.matrixWorld);var n=uu.distanceTo(lu),i=e.projectionMatrix.elements,o=r.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=a*c,d=a*h,f=n/(-c+h),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=a+f,v=s+f,y=p-m,x=d+(n-m),b=u*s/v*g,_=l*s/v*g;t.projectionMatrix.makePerspective(y,x,b,_,g,v)}function hu(t){var e,r,n=this,i=null,o=null,a=[],s=new kn,u=new kn,l=1,c="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(o=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",_,!1));var h=new kn,p=new yn,d=new _n,f=new ta,m=new ta;m.viewport=new Mn,m.layers.enable(1);var g=new ta;g.viewport=new Mn,g.layers.enable(2);var v=new au([m,g]);function y(){return null!==i&&!0===i.isPresenting}v.layers.enable(1),v.layers.enable(2);var x,b=new vn;function _(){if(y()){var o=i.getEyeParameters("left");e=2*o.renderWidth*l,r=o.renderHeight*l,x=t.getPixelRatio(),t.getSize(b),t.setDrawingBufferSize(e,r,1),m.viewport.set(0,0,e/2,r),g.viewport.set(e/2,0,e/2,r),A.start(),n.dispatchEvent({type:"sessionstart"})}else n.enabled&&t.setDrawingBufferSize(b.width,b.height,x),A.stop(),n.dispatchEvent({type:"sessionend"})}var w=[],T=[];function E(t){for(var e=navigator.getGamepads&&navigator.getGamepads(),r=0,n=e.length;r<n;r++){var i=e[r];if(i&&("Daydream Controller"===i.id||"Gear VR Controller"===i.id||"Oculus Go Controller"===i.id||"OpenVR Gamepad"===i.id||i.id.startsWith("Oculus Touch")||i.id.startsWith("HTC Vive Focus")||i.id.startsWith("Spatial Controller"))){var o=i.hand;if(0===t&&(""===o||"right"===o))return i;if(1===t&&"left"===o)return i}}}function S(t,n){null!==n&&4===n.length&&t.set(n[0]*e,n[1]*r,n[2]*e,n[3]*r)}this.enabled=!1,this.getController=function(t){var e=a[t];return void 0===e&&((e=new ou).matrixAutoUpdate=!1,e.visible=!1,a[t]=e),e},this.getDevice=function(){return i},this.setDevice=function(t){void 0!==t&&(i=t),A.setContext(t)},this.setFramebufferScaleFactor=function(t){l=t},this.setReferenceSpaceType=function(t){c=t},this.getCamera=function(t){var e="local-floor"===c?1.6:0;if(i.depthNear=t.near,i.depthFar=t.far,i.getFrameData(o),"local-floor"===c){var r=i.stageParameters;r?s.fromArray(r.sittingToStandingTransform):s.makeTranslation(0,e,0)}var n=o.pose;f.matrix.copy(s),f.matrix.decompose(f.position,f.quaternion,f.scale),null!==n.orientation&&(p.fromArray(n.orientation),f.quaternion.multiply(p)),null!==n.position&&(p.setFromRotationMatrix(s),d.fromArray(n.position),d.applyQuaternion(p),f.position.add(d)),f.updateMatrixWorld(),t.matrixWorld.copy(f.matrixWorld);for(var l=t.children,y=0,x=l.length;y<x;y++)l[y].updateMatrixWorld(!0);m.near=t.near,g.near=t.near,m.far=t.far,g.far=t.far,m.matrixWorldInverse.fromArray(o.leftViewMatrix),g.matrixWorldInverse.fromArray(o.rightViewMatrix),u.getInverse(s),"local-floor"===c&&(m.matrixWorldInverse.multiply(u),g.matrixWorldInverse.multiply(u));var b=t.parent;null!==b&&(h.getInverse(b.matrixWorld),m.matrixWorldInverse.multiply(h),g.matrixWorldInverse.multiply(h)),m.matrixWorld.getInverse(m.matrixWorldInverse),g.matrixWorld.getInverse(g.matrixWorldInverse),m.projectionMatrix.fromArray(o.leftProjectionMatrix),g.projectionMatrix.fromArray(o.rightProjectionMatrix),cu(v,m,g);var _=i.getLayers();if(_.length){var A=_[0];S(m.viewport,A.leftBounds),S(g.viewport,A.rightBounds)}return function(){for(var t=0;t<a.length;t++){var e=a[t],r=E(t);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var n=r.pose;!1===n.hasPosition&&e.position.set(.2,-.6,-.05),null!==n.position&&e.position.fromArray(n.position),null!==n.orientation&&e.quaternion.fromArray(n.orientation),e.matrix.compose(e.position,e.quaternion,e.scale),e.matrix.premultiply(s),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0,e.visible=!0;var i="Daydream Controller"===r.id?0:1;void 0===w[t]&&(w[t]=!1),w[t]!==r.buttons[i].pressed&&(w[t]=r.buttons[i].pressed,!0===w[t]?e.dispatchEvent({type:"selectstart"}):(e.dispatchEvent({type:"selectend"}),e.dispatchEvent({type:"select"}))),i=2,void 0===T[t]&&(T[t]=!1),void 0!==r.buttons[i]&&T[t]!==r.buttons[i].pressed&&(T[t]=r.buttons[i].pressed,!0===T[t]?e.dispatchEvent({type:"squeezestart"}):(e.dispatchEvent({type:"squeezeend"}),e.dispatchEvent({type:"squeeze"})))}else e.visible=!1}}(),v},this.getStandingMatrix=function(){return s},this.isPresenting=y;var A=new ca;this.setAnimationLoop=function(t){A.setAnimationLoop(t),y()&&A.start()},this.submitFrame=function(){y()&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",_)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function pu(t,e){var r=this,n=null,i=null,o="local-floor",a=null,s=[],u=[];var l=new ta;l.layers.enable(1),l.viewport=new Mn;var c=new ta;c.layers.enable(2),c.viewport=new Mn;var h=new au([l,c]);function p(t){for(var e=0;e<s.length;e++)u[e]===t.inputSource&&s[e].dispatchEvent({type:t.type})}function d(){t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),x.stop(),r.dispatchEvent({type:"sessionend"})}function f(t){i=t,x.setContext(n),x.start(),r.dispatchEvent({type:"sessionstart"})}function m(){for(var t=0;t<s.length;t++)u[t]=g(t)}function g(t){for(var e=n.inputSources,r=0;r<e.length;r++){var i=e[r],o=i.handedness;if(0===t&&("none"===o||"right"===o))return i;if(1===t&&"left"===o)return i}}function v(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}h.layers.enable(1),h.layers.enable(2),this.enabled=!1,this.getController=function(t){var e=s[t];return void 0===e&&((e=new ou).matrixAutoUpdate=!1,e.visible=!1,s[t]=e),e},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(t){o=t},this.getSession=function(){return n},this.setSession=function(t){null!==(n=t)&&(n.addEventListener("select",p),n.addEventListener("selectstart",p),n.addEventListener("selectend",p),n.addEventListener("squeeze",p),n.addEventListener("squeezestart",p),n.addEventListener("squeezeend",p),n.addEventListener("end",d),n.updateRenderState({baseLayer:new XRWebGLLayer(n,e)}),n.requestReferenceSpace(o).then(f),n.addEventListener("inputsourceschange",m),m())},this.getCamera=function(t){var e=t.parent,r=h.cameras;v(h,e);for(var n=0;n<r.length;n++)v(r[n],e);t.matrixWorld.copy(h.matrixWorld);for(var i=t.children,o=(n=0,i.length);n<o;n++)i[n].updateMatrixWorld(!0);return cu(h,l,c),h},this.isPresenting=function(){return null!==n&&null!==i};var y=null;var x=new ca;x.setAnimationLoop((function(e,r){if(null!==(a=r.getViewerPose(i))){var o=a.views,l=n.renderState.baseLayer;t.setFramebuffer(l.framebuffer);for(var c=0;c<o.length;c++){var p=o[c],d=l.getViewport(p),f=p.transform.inverse.matrix,m=h.cameras[c];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(p.projectionMatrix),m.viewport.set(d.x,d.y,d.width,d.height),0===c&&h.matrix.copy(m.matrix)}}for(c=0;c<s.length;c++){var g=s[c],v=u[c];if(v){var x=r.getPose(v.targetRaySpace,i);if(null!==x){g.matrix.fromArray(x.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.visible=!0;continue}}g.visible=!1}y&&y(e)})),this.setAnimationLoop=function(t){y=t},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new kn},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function du(t){var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,u=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,h=null,p=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,f,m,g,v,y,x,b,_,w,T,E,S,A,P,M,I,O,C=this,R=!1,L=null,N=0,F=0,D=null,U=null,k=-1,j={geometry:null,program:null,wireframe:!1},B=null,z=null,G=new Mn,V=new Mn,H=null,X=e.width,W=e.height,Y=1,q=new Mn(0,0,X,W),$=new Mn(0,0,X,W),Q=!1,Z=new aa,J=new va,K=!1,tt=!1,et=new kn,rt=new _n;function nt(){return null===D?Y:1}try{var it={alpha:n,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c,xrCompatible:!0};if(e.addEventListener("webglcontextlost",lt,!1),e.addEventListener("webglcontextrestored",ct,!1),null===(d=r||e.getContext("webgl",it)||e.getContext("experimental-webgl",it)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ot(){f=new ya(d),!1===(m=new ga(d,f,t)).isWebGL2&&(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),O=new ru(d,f,m),(g=new tu(d,f,m)).scissor(V.copy($).multiplyScalar(Y).floor()),g.viewport(G.copy(q).multiplyScalar(Y).floor()),v=new _a(d),y=new Bs,x=new eu(d,f,g,y,m,O,v),b=new ha(d),_=new xa(d,b,v),w=new Ea(d,_,b,v),P=new Ta(d),T=new js(C,f,m),E=new Hs,S=new Qs,A=new fa(C,g,w,s),M=new ma(d,f,v,m),I=new ba(d,f,v,m),v.programs=T.programs,C.capabilities=m,C.extensions=f,C.properties=y,C.renderLists=E,C.state=g,C.info=v}ot();var at="undefined"!=typeof navigator&&"xr"in navigator?new pu(C,d):new hu(C);this.vr=at;var st=new iu(C,d),ut=new Ks(C,w,m.maxTextureSize);function lt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function ct(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1,ot()}function ht(t){var e=t.target;e.removeEventListener("dispose",ht),function(t){pt(t),y.remove(t)}(e)}function pt(t){var e=y.get(t).program;t.program=void 0,void 0!==e&&T.releaseProgram(e)}this.shadowMap=ut,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var t=f.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=f.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(t){void 0!==t&&(Y=t,this.setSize(X,W,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new vn),t.set(X,W)},this.setSize=function(t,r,n){at.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(X=t,W=r,e.width=Math.floor(t*Y),e.height=Math.floor(r*Y),!1!==n&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new vn),t.set(X*Y,W*Y).floor()},this.setDrawingBufferSize=function(t,r,n){X=t,W=r,Y=n,e.width=Math.floor(t*n),e.height=Math.floor(r*n),this.setViewport(0,0,t,r)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Mn),t.copy(G)},this.getViewport=function(t){return t.copy(q)},this.setViewport=function(t,e,r,n){t.isVector4?q.set(t.x,t.y,t.z,t.w):q.set(t,e,r,n),g.viewport(G.copy(q).multiplyScalar(Y).floor())},this.getScissor=function(t){return t.copy($)},this.setScissor=function(t,e,r,n){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,r,n),g.scissor(V.copy($).multiplyScalar(Y).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(t){g.setScissorTest(Q=t)},this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(t,e,r){var n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===r||r)&&(n|=1024),d.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",lt,!1),e.removeEventListener("webglcontextrestored",ct,!1),E.dispose(),S.dispose(),y.dispose(),w.dispose(),at.dispose(),ft.stop()},this.renderBufferImmediate=function(t,e){g.initAttributes();var r=y.get(t);t.hasPositions&&!r.position&&(r.position=d.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),t.hasColors&&!r.color&&(r.color=d.createBuffer());var n=e.getAttributes();t.hasPositions&&(d.bindBuffer(34962,r.position),d.bufferData(34962,t.positionArray,35048),g.enableAttribute(n.position),d.vertexAttribPointer(n.position,3,5126,!1,0,0)),t.hasNormals&&(d.bindBuffer(34962,r.normal),d.bufferData(34962,t.normalArray,35048),g.enableAttribute(n.normal),d.vertexAttribPointer(n.normal,3,5126,!1,0,0)),t.hasUvs&&(d.bindBuffer(34962,r.uv),d.bufferData(34962,t.uvArray,35048),g.enableAttribute(n.uv),d.vertexAttribPointer(n.uv,2,5126,!1,0,0)),t.hasColors&&(d.bindBuffer(34962,r.color),d.bufferData(34962,t.colorArray,35048),g.enableAttribute(n.color),d.vertexAttribPointer(n.color,3,5126,!1,0,0)),g.disableUnusedAttributes(),d.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,n,i,o){var a=i.isMesh&&i.matrixWorld.determinant()<0;g.setMaterial(n,a);var s=xt(t,e,n,i),u=!1;j.geometry===r.id&&j.program===s.id&&j.wireframe===(!0===n.wireframe)||(j.geometry=r.id,j.program=s.id,j.wireframe=!0===n.wireframe,u=!0),i.morphTargetInfluences&&(P.update(i,r,n,s),u=!0);var l=r.index,c=r.attributes.position;if((null===l||0!==l.count)&&void 0!==c&&0!==c.count){var h,p=1;!0===n.wireframe&&(l=_.getWireframeAttribute(r),p=2);var v=M;null!==l&&(h=b.get(l),(v=I).setIndex(h)),u&&(!function(t,e,r,n){if(!1===m.isWebGL2&&(t.isInstancedMesh||e.isInstancedBufferGeometry)&&null===f.get("ANGLE_instanced_arrays"))return;g.initAttributes();var i=e.attributes,o=n.getAttributes(),a=r.defaultAttributeValues;for(var s in o){var u=o[s];if(u>=0){var l=i[s];if(void 0!==l){var c=l.normalized,h=l.itemSize;if(void 0===(T=b.get(l)))continue;var p=T.buffer,v=T.type,y=T.bytesPerElement;if(l.isInterleavedBufferAttribute){var x=l.data,_=x.stride,w=l.offset;x&&x.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(u,x.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=x.meshPerAttribute*x.count)):g.enableAttribute(u),d.bindBuffer(34962,p),d.vertexAttribPointer(u,h,v,c,_*y,w*y)}else l.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(u,l.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=l.meshPerAttribute*l.count)):g.enableAttribute(u),d.bindBuffer(34962,p),d.vertexAttribPointer(u,h,v,c,0,0)}else if("instanceMatrix"===s){var T;if(void 0===(T=b.get(t.instanceMatrix)))continue;p=T.buffer,v=T.type;g.enableAttributeAndDivisor(u+0,1),g.enableAttributeAndDivisor(u+1,1),g.enableAttributeAndDivisor(u+2,1),g.enableAttributeAndDivisor(u+3,1),d.bindBuffer(34962,p),d.vertexAttribPointer(u+0,4,v,!1,64,0),d.vertexAttribPointer(u+1,4,v,!1,64,16),d.vertexAttribPointer(u+2,4,v,!1,64,32),d.vertexAttribPointer(u+3,4,v,!1,64,48)}else if(void 0!==a){var E=a[s];if(void 0!==E)switch(E.length){case 2:d.vertexAttrib2fv(u,E);break;case 3:d.vertexAttrib3fv(u,E);break;case 4:d.vertexAttrib4fv(u,E);break;default:d.vertexAttrib1fv(u,E)}}}}g.disableUnusedAttributes()}(i,r,n,s),null!==l&&d.bindBuffer(34963,h.buffer));var y=1/0;null!==l?y=l.count:void 0!==c&&(y=c.count);var x=r.drawRange.start*p,w=r.drawRange.count*p,T=null!==o?o.start*p:0,E=null!==o?o.count*p:1/0,S=Math.max(x,T),A=Math.min(y,x+w,T+E)-1,O=Math.max(0,A-S+1);if(0!==O){if(i.isMesh)if(!0===n.wireframe)g.setLineWidth(n.wireframeLinewidth*nt()),v.setMode(1);else switch(i.drawMode){case 0:v.setMode(4);break;case 1:v.setMode(5);break;case 2:v.setMode(6)}else if(i.isLine){var C=n.linewidth;void 0===C&&(C=1),g.setLineWidth(C*nt()),i.isLineSegments?v.setMode(1):i.isLineLoop?v.setMode(2):v.setMode(3)}else i.isPoints?v.setMode(0):i.isSprite&&v.setMode(4);i.isInstancedMesh?v.renderInstances(r,S,O,i.count):r.isInstancedBufferGeometry?v.renderInstances(r,S,O,r.maxInstancedCount):v.render(S,O)}}},this.compile=function(t,e){(p=S.get(t,e)).init(),t.traverse((function(t){t.isLight&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(e),t.traverse((function(e){if(e.material)if(Array.isArray(e.material))for(var r=0;r<e.material.length;r++)yt(e.material[r],t.fog,e);else yt(e.material,t.fog,e)}))};var dt=null;var ft=new ca;function mt(t,e,r,n){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Z.intersectsSprite(t)){n&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(et);var i=w.update(t);(o=t.material).visible&&h.push(t,i,o,r,rt.z,null)}}else if(t.isImmediateRenderObject)n&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(et),h.push(t,null,t.material,r,rt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==v.render.frame&&(t.skeleton.update(),t.skeleton.frame=v.render.frame),!t.frustumCulled||Z.intersectsObject(t))){n&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(et);i=w.update(t);var o=t.material;if(Array.isArray(o))for(var a=i.groups,s=0,u=a.length;s<u;s++){var l=a[s],c=o[l.materialIndex];c&&c.visible&&h.push(t,i,c,r,rt.z,l)}else o.visible&&h.push(t,i,o,r,rt.z,null)}var d=t.children;for(s=0,u=d.length;s<u;s++)mt(d[s],e,r,n)}}function gt(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,u=a.geometry,l=void 0===n?a.material:n,c=a.group;if(r.isArrayCamera)if(z=r,at.enabled&&st.isAvailable())vt(s,e,r,u,l,c);else for(var h=r.cameras,d=0,f=h.length;d<f;d++){var m=h[d];s.layers.test(m.layers)&&(g.viewport(G.copy(m.viewport)),p.setupLights(m),vt(s,e,m,u,l,c))}else z=null,vt(s,e,r,u,l,c)}}function vt(t,e,r,n,i,o){if(t.onBeforeRender(C,e,r,n,i,o),p=S.get(e,z||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){g.setMaterial(i);var a=xt(r,e.fog,i,t);j.geometry=null,j.program=null,j.wireframe=!1,function(t,e){t.render((function(t){C.renderBufferImmediate(t,e)}))}(t,a)}else C.renderBufferDirect(r,e.fog,n,i,t,o);t.onAfterRender(C,e,r,n,i,o),p=S.get(e,z||r)}function yt(t,e,r){var n=y.get(t),i=p.state.lights,o=p.state.shadowsArray,a=i.state.version,s=T.getParameters(t,i.state,o,e,J.numPlanes,J.numIntersection,r),u=T.getProgramCacheKey(t,s),l=n.program,c=!0;if(void 0===l)t.addEventListener("dispose",ht);else if(l.cacheKey!==u)pt(t);else if(n.lightsStateVersion!==a)n.lightsStateVersion=a,c=!1;else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var h=la[s.shaderID];n.shader={name:t.type,uniforms:$o(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader,C),u=T.getProgramCacheKey(t,s),l=T.acquireProgram(t,n.shader,s,u),n.program=l,t.program=l}var d=l.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var f=0;f<C.maxMorphTargets;f++)d["morphTarget"+f]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(f=0;f<C.maxMorphNormals;f++)d["morphNormal"+f]>=0&&t.numSupportedMorphNormals++}var m=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=J.numPlanes,n.numIntersection=J.numIntersection,m.clippingPlanes=J.uniform),n.fog=e,n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(m.ambientLightColor.value=i.state.ambient,m.lightProbe.value=i.state.probe,m.directionalLights.value=i.state.directional,m.spotLights.value=i.state.spot,m.rectAreaLights.value=i.state.rectArea,m.pointLights.value=i.state.point,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);var g=n.program.getUniforms(),v=_s.seqWithValue(g.seq,m);n.uniformsList=v}function xt(t,e,r,n){x.resetTextureUnits();var i=y.get(r),o=p.state.lights;if(K&&(tt||t!==B)){var a=t===B&&r.id===k;J.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,i,a)}r.version===i.__version&&(void 0===i.program||r.fog&&i.fog!==e||i.needsLights&&i.lightsStateVersion!==o.state.version?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===J.numPlanes&&i.numIntersection===J.numIntersection||(r.needsUpdate=!0)),r.version!==i.__version&&(yt(r,e,n),i.__version=r.version);var s,u,l=!1,c=!1,h=!1,f=i.program,v=f.getUniforms(),b=i.shader.uniforms;if(g.useProgram(f.program)&&(l=!0,c=!0,h=!0),r.id!==k&&(k=r.id,c=!0),l||B!==t){if(f.numMultiviewViews>0?st.updateCameraProjectionMatricesUniform(t,v):v.setValue(d,"projectionMatrix",t.projectionMatrix),m.logarithmicDepthBuffer&&v.setValue(d,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),B!==t&&(B=t,c=!0,h=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var _=v.map.cameraPosition;void 0!==_&&_.setValue(d,rt.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&v.setValue(d,"isOrthographic",!0===t.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&(f.numMultiviewViews>0?st.updateCameraViewMatricesUniform(t,v):v.setValue(d,"viewMatrix",t.matrixWorldInverse))}if(r.skinning){v.setOptional(d,n,"bindMatrix"),v.setOptional(d,n,"bindMatrixInverse");var w=n.skeleton;if(w){var T=w.bones;if(m.floatVertexTextures){if(void 0===w.boneTexture){var E=Math.sqrt(4*T.length);E=gn.ceilPowerOfTwo(E),E=Math.max(E,4);var S=new Float32Array(E*E*4);S.set(w.boneMatrices);var A=new na(S,E,E,1023,1015);w.boneMatrices=S,w.boneTexture=A,w.boneTextureSize=E}v.setValue(d,"boneTexture",w.boneTexture,x),v.setValue(d,"boneTextureSize",w.boneTextureSize)}else v.setOptional(d,w,"boneMatrices")}}return(c||i.receiveShadow!==n.receiveShadow)&&(i.receiveShadow=n.receiveShadow,v.setValue(d,"receiveShadow",n.receiveShadow)),c&&(v.setValue(d,"toneMappingExposure",C.toneMappingExposure),v.setValue(d,"toneMappingWhitePoint",C.toneMappingWhitePoint),i.needsLights&&(u=h,(s=b).ambientLightColor.needsUpdate=u,s.lightProbe.needsUpdate=u,s.directionalLights.needsUpdate=u,s.pointLights.needsUpdate=u,s.spotLights.needsUpdate=u,s.rectAreaLights.needsUpdate=u,s.hemisphereLights.needsUpdate=u),e&&r.fog&&function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(b,e),r.isMeshBasicMaterial?bt(b,r):r.isMeshLambertMaterial?(bt(b,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(b,r)):r.isMeshPhongMaterial?(bt(b,r),r.isMeshToonMaterial?function(t,e){_t(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(b,r):_t(b,r)):r.isMeshStandardMaterial?(bt(b,r),r.isMeshPhysicalMaterial?function(t,e){wt(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transparency.value=e.transparency}(b,r):wt(b,r)):r.isMeshMatcapMaterial?(bt(b,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(b,r)):r.isMeshDepthMaterial?(bt(b,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(b,r)):r.isMeshDistanceMaterial?(bt(b,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(b,r)):r.isMeshNormalMaterial?(bt(b,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(b,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(b,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(b,r)):r.isPointsMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*Y,t.scale.value=.5*W,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(b,r):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(b,r):r.isShadowMaterial&&(b.color.value.copy(r.color),b.opacity.value=r.opacity),void 0!==b.ltc_1&&(b.ltc_1.value=ua.LTC_1),void 0!==b.ltc_2&&(b.ltc_2.value=ua.LTC_2),_s.upload(d,i.uniformsList,b,x),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(_s.upload(d,i.uniformsList,b,x),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&v.setValue(d,"center",n.center),f.numMultiviewViews>0?st.updateObjectMatricesUniforms(n,t,v):(v.setValue(d,"modelViewMatrix",n.modelViewMatrix),v.setValue(d,"normalMatrix",n.normalMatrix)),v.setValue(d,"modelMatrix",n.matrixWorld),f}function bt(t,e){var r;t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=y.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?r=e.map:e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}function _t(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function wt(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}ft.setAnimationLoop((function(t){at.isPresenting()||dt&&dt(t)})),"undefined"!=typeof window&&ft.setContext(window),this.setAnimationLoop=function(t){dt=t,at.setAnimationLoop(t),ft.start()},this.render=function(t,e){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),e&&e.isCamera){if(!R){j.geometry=null,j.program=null,j.wireframe=!1,k=-1,B=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),at.enabled&&at.isPresenting()&&(e=at.getCamera(e)),(p=S.get(t,e)).init(),t.onBeforeRender(C,t,e,r||D),et.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Z.setFromMatrix(et),tt=this.localClippingEnabled,K=J.init(this.clippingPlanes,tt,e),(h=E.get(t,e)).init(),mt(t,e,0,C.sortObjects),!0===C.sortObjects&&h.sort(),K&&J.beginShadows();var i=p.state.shadowsArray;ut.render(i,t,e),p.setupLights(e),K&&J.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),at.enabled&&st.isAvailable()&&st.attachCamera(e),A.render(h,t,e,n);var o=h.opaque,a=h.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;o.length&&gt(o,t,e,s),a.length&&gt(a,t,e,s)}else o.length&&gt(o,t,e),a.length&&gt(a,t,e);t.onAfterRender(C,t,e),null!==D&&(x.updateRenderTargetMipmap(D),x.updateMultisampleRenderTarget(D)),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),at.enabled&&(st.isAvailable()&&st.detachCamera(e),at.submitFrame()),h=null,p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){L!==t&&null===D&&d.bindFramebuffer(36160,t),L=t},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return D},this.setRenderTarget=function(t,e,r){D=t,N=e,F=r,t&&void 0===y.get(t).__webglFramebuffer&&x.setupRenderTarget(t);var n=L,i=!1;if(t){var o=y.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(n=o[e||0],i=!0):n=t.isWebGLMultisampleRenderTarget?y.get(t).__webglMultisampledFramebuffer:o,G.copy(t.viewport),V.copy(t.scissor),H=t.scissorTest}else G.copy(q).multiplyScalar(Y).floor(),V.copy($).multiplyScalar(Y).floor(),H=Q;if(U!==n&&(d.bindFramebuffer(36160,n),U=n),g.viewport(G),g.scissor(V),g.setScissorTest(H),i){var a=y.get(t.texture);d.framebufferTexture2D(36160,36064,34069+(e||0),a.__webglTexture,r||0)}},this.readRenderTargetPixels=function(t,e,r,n,i,o,a){if(t&&t.isWebGLRenderTarget){var s=y.get(t).__webglFramebuffer;if(t.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var u=!1;s!==U&&(d.bindFramebuffer(36160,s),u=!0);try{var l=t.texture,c=l.format,h=l.type;if(1023!==c&&O.convert(c)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===h||O.convert(h)===d.getParameter(35738)||1015===h&&(m.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||1016===h&&(m.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===d.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&r>=0&&r<=t.height-i&&d.readPixels(e,r,n,i,O.convert(c),O.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&d.bindFramebuffer(36160,U)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){void 0===r&&(r=0);var n=Math.pow(2,-r),i=Math.floor(e.image.width*n),o=Math.floor(e.image.height*n),a=O.convert(e.format);x.setTexture2D(e,0),d.copyTexImage2D(3553,r,a,t.x,t.y,i,o,0),g.unbindTexture()},this.copyTextureToTexture=function(t,e,r,n){var i=e.image.width,o=e.image.height,a=O.convert(r.format),s=O.convert(r.type);x.setTexture2D(r,0),e.isDataTexture?d.texSubImage2D(3553,n||0,t.x,t.y,i,o,a,s,e.image.data):d.texSubImage2D(3553,n||0,t.x,t.y,a,s,e.image),g.unbindTexture()},this.initTexture=function(t){x.setTexture2D(t,0),g.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function fu(t,e){this.name="",this.color=new Yi(t),this.density=void 0!==e?e:25e-5}function mu(t,e,r){this.name="",this.color=new Yi(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function gu(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function vu(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function yu(t){Ki.call(this),this.type="SpriteMaterial",this.color=new Yi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.assign(hu.prototype,dn.prototype),Object.assign(pu.prototype,dn.prototype),Object.assign(fu.prototype,{isFogExp2:!0,clone:function(){return new fu(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(mu.prototype,{isFog:!0,clone:function(){return new mu(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(gu.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(gu.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Object.defineProperties(vu.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(vu.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),yu.prototype=Object.create(Ki.prototype),yu.prototype.constructor=yu,yu.prototype.isSpriteMaterial=!0,yu.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var xu=new _n,bu=new _n,_u=new _n,wu=new vn,Tu=new vn,Eu=new kn,Su=new _n,Au=new _n,Pu=new _n,Mu=new vn,Iu=new vn,Ou=new vn;function Cu(t){if(ri.call(this),this.type="Sprite",void 0===su){su=new _o;var e=new gu(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);su.setIndex([0,1,2,0,2,3]),su.setAttribute("position",new vu(e,3,0,!1)),su.setAttribute("uv",new vu(e,2,3,!1))}this.geometry=su,this.material=void 0!==t?t:new yu,this.center=new vn(.5,.5)}function Ru(t,e,r,n,i,o){wu.subVectors(t,r).addScalar(.5).multiply(n),void 0!==i?(Tu.x=o*wu.x-i*wu.y,Tu.y=i*wu.x+o*wu.y):Tu.copy(wu),t.copy(e),t.x+=Tu.x,t.y+=Tu.y,t.applyMatrix4(Eu)}Cu.prototype=Object.assign(Object.create(ri.prototype),{constructor:Cu,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bu.setFromMatrixScale(this.matrixWorld),Eu.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_u.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&bu.multiplyScalar(-_u.z);var r,n,i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));var o=this.center;Ru(Su.set(-.5,-.5,0),_u,o,bu,r,n),Ru(Au.set(.5,-.5,0),_u,o,bu,r,n),Ru(Pu.set(.5,.5,0),_u,o,bu,r,n),Mu.set(0,0),Iu.set(1,0),Ou.set(1,1);var a=t.ray.intersectTriangle(Su,Au,Pu,!1,xu);if(null!==a||(Ru(Au.set(-.5,.5,0),_u,o,bu,r,n),Iu.set(0,1),null!==(a=t.ray.intersectTriangle(Su,Pu,Au,!1,xu)))){var s=t.ray.origin.distanceTo(xu);s<t.near||s>t.far||e.push({distance:s,point:xu.clone(),uv:Vi.getUV(xu,Su,Au,Pu,Mu,Iu,Ou,new vn),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return ri.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var Lu=new _n,Nu=new _n;function Fu(){ri.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Du(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),jo.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new kn,this.bindMatrixInverse=new kn}Fu.prototype=Object.assign(Object.create(ri.prototype),{constructor:Fu,isLOD:!0,copy:function(t){ri.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object}return null},raycast:function(t,e){if(this.levels.length>0){Lu.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(Lu);this.getObjectForDistance(r).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){Lu.setFromMatrixPosition(t.matrixWorld),Nu.setFromMatrixPosition(this.matrixWorld);var r=Lu.distanceTo(Nu);e[0].object.visible=!0;for(var n=1,i=e.length;n<i&&r>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(;n<i;n++)e[n].object.visible=!1}},toJSON:function(t){var e=ri.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Du.prototype=Object.assign(Object.create(jo.prototype),{constructor:Du,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Mn,e=this.geometry.attributes.skinWeight,r=0,n=e.count;r<n;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){jo.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Uu=new kn,ku=new kn;function ju(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new kn)}}function Bu(){ri.call(this),this.type="Bone"}Object.assign(ju.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new kn;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=t.length;i<o;i++){var a=t[i]?t[i].matrixWorld:ku;Uu.multiplyMatrices(a,e[i]),Uu.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new ju(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),Bu.prototype=Object.assign(Object.create(ri.prototype),{constructor:Bu,isBone:!0});var zu=new kn,Gu=new kn,Vu=[],Hu=new jo;function Xu(t,e,r){jo.call(this,t,e),this.instanceMatrix=new eo(new Float32Array(16*r),16),this.count=r}function Wu(t){Ki.call(this),this.type="LineBasicMaterial",this.color=new Yi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}Xu.prototype=Object.assign(Object.create(jo.prototype),{constructor:Xu,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var r=this.matrixWorld,n=this.count;if(Hu.geometry=this.geometry,Hu.material=this.material,void 0!==Hu.material)for(var i=0;i<n;i++)this.getMatrixAt(i,zu),Gu.multiplyMatrices(r,zu),Hu.matrixWorld=Gu,Hu.raycast(t,Vu),Vu.length>0&&(Vu[0].instanceId=i,Vu[0].object=this,e.push(Vu[0]),Vu.length=0)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Wu.prototype=Object.create(Ki.prototype),Wu.prototype.constructor=Wu,Wu.prototype.isLineBasicMaterial=!0,Wu.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var Yu=new _n,qu=new _n,$u=new kn,Qu=new Mi,Zu=new bi;function Ju(t,e,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),ri.call(this),this.type="Line",this.geometry=void 0!==t?t:new _o,this.material=void 0!==e?e:new Wu({color:16777215*Math.random()})}Ju.prototype=Object.assign(Object.create(ri.prototype),{constructor:Ju,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[0],n=1,i=e.count;n<i;n++)Yu.fromBufferAttribute(e,n-1),qu.fromBufferAttribute(e,n),r[n]=r[n-1],r[n]+=Yu.distanceTo(qu);t.setAttribute("lineDistance",new lo(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;(r=t.lineDistances)[0]=0;for(n=1,i=o.length;n<i;n++)r[n]=r[n-1],r[n]+=o[n-1].distanceTo(o[n])}return this},raycast:function(t,e){var r=t.linePrecision,n=this.geometry,i=this.matrixWorld;if(null===n.boundingSphere&&n.computeBoundingSphere(),Zu.copy(n.boundingSphere),Zu.applyMatrix4(i),Zu.radius+=r,!1!==t.ray.intersectsSphere(Zu)){$u.getInverse(i),Qu.copy(t.ray).applyMatrix4($u);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new _n,u=new _n,l=new _n,c=new _n,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var p=n.index,d=n.attributes.position.array;if(null!==p)for(var f=p.array,m=0,g=f.length-1;m<g;m+=h){var v=f[m],y=f[m+1];if(s.fromArray(d,3*v),u.fromArray(d,3*y),!(Qu.distanceSqToSegment(s,u,c,l)>a))c.applyMatrix4(this.matrixWorld),(_=t.ray.origin.distanceTo(c))<t.near||_>t.far||e.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,g=d.length/3-1;m<g;m+=h){if(s.fromArray(d,3*m),u.fromArray(d,3*m+3),!(Qu.distanceSqToSegment(s,u,c,l)>a))c.applyMatrix4(this.matrixWorld),(_=t.ray.origin.distanceTo(c))<t.near||_>t.far||e.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){var x=n.vertices,b=x.length;for(m=0;m<b-1;m+=h){var _;if(!(Qu.distanceSqToSegment(x[m],x[m+1],c,l)>a))c.applyMatrix4(this.matrixWorld),(_=t.ray.origin.distanceTo(c))<t.near||_>t.far||e.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ku=new _n,tl=new _n;function el(t,e){Ju.call(this,t,e),this.type="LineSegments"}function rl(t,e){Ju.call(this,t,e),this.type="LineLoop"}function nl(t){Ki.call(this),this.type="PointsMaterial",this.color=new Yi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}el.prototype=Object.assign(Object.create(Ju.prototype),{constructor:el,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[],n=0,i=e.count;n<i;n+=2)Ku.fromBufferAttribute(e,n),tl.fromBufferAttribute(e,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Ku.distanceTo(tl);t.setAttribute("lineDistance",new lo(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;for(r=t.lineDistances,n=0,i=o.length;n<i;n+=2)Ku.copy(o[n]),tl.copy(o[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Ku.distanceTo(tl)}return this}}),rl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:rl,isLineLoop:!0}),nl.prototype=Object.create(Ki.prototype),nl.prototype.constructor=nl,nl.prototype.isPointsMaterial=!0,nl.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var il=new kn,ol=new Mi,al=new bi,sl=new _n;function ul(t,e){ri.call(this),this.type="Points",this.geometry=void 0!==t?t:new _o,this.material=void 0!==e?e:new nl({color:16777215*Math.random()}),this.updateMorphTargets()}function ll(t,e,r,n,i,o,a){var s=ol.distanceSqToPoint(t);if(s<r){var u=new _n;ol.closestPointToPoint(t,u),u.applyMatrix4(n);var l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:e,face:null,object:a})}}function cl(t,e,r,n,i,o,a,s,u){Pn.call(this,t,e,r,n,i,o,a,s,u),this.format=void 0!==a?a:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==i?i:1006,this.generateMipmaps=!1}function hl(t,e,r,n,i,o,a,s,u,l,c,h){Pn.call(this,null,o,a,s,u,l,n,i,c,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function pl(t,e,r,n,i,o,a,s,u){Pn.call(this,t,e,r,n,i,o,a,s,u),this.needsUpdate=!0}function dl(t,e,r,n,i,o,a,s,u,l){if(1026!==(l=void 0!==l?l:1026)&&1027!==l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===l&&(r=1012),void 0===r&&1027===l&&(r=1020),Pn.call(this,null,n,i,o,a,s,l,r,u),this.image={width:t,height:e},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==s?s:1003,this.flipY=!1,this.generateMipmaps=!1}function fl(t){_o.call(this),this.type="WireframeGeometry";var e,r,n,i,o,a,s,u,l,c,h=[],p=[0,0],d={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var g=m[e];for(r=0;r<3;r++)s=g[f[r]],u=g[f[(r+1)%3]],p[0]=Math.min(s,u),p[1]=Math.max(s,u),void 0===d[l=p[0]+","+p[1]]&&(d[l]={index1:p[0],index2:p[1]})}for(l in d)a=d[l],c=t.vertices[a.index1],h.push(c.x,c.y,c.z),c=t.vertices[a.index2],h.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry){var v,y,x,b,_,w,T;if(c=new _n,null!==t.index){for(v=t.attributes.position,y=t.index,0===(x=t.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(e=_=(b=x[i]).start,n=_+b.count;e<n;e+=3)for(r=0;r<3;r++)s=y.getX(e+r),u=y.getX(e+(r+1)%3),p[0]=Math.min(s,u),p[1]=Math.max(s,u),void 0===d[l=p[0]+","+p[1]]&&(d[l]={index1:p[0],index2:p[1]});for(l in d)a=d[l],c.fromBufferAttribute(v,a.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(v,a.index2),h.push(c.x,c.y,c.z)}else for(e=0,n=(v=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)w=3*e+r,c.fromBufferAttribute(v,w),h.push(c.x,c.y,c.z),T=3*e+(r+1)%3,c.fromBufferAttribute(v,T),h.push(c.x,c.y,c.z)}this.setAttribute("position",new lo(h,3))}function ml(t,e,r){Wo.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new gl(t,e,r)),this.mergeVertices()}function gl(t,e,r){_o.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],a=[],s=[],u=[],l=1e-5,c=new _n,h=new _n,p=new _n,d=new _n,f=new _n;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(n=0;n<=r;n++){var g=n/r;for(i=0;i<=e;i++){var v=i/e;t(v,g,h),a.push(h.x,h.y,h.z),v-l>=0?(t(v-l,g,p),d.subVectors(h,p)):(t(v+l,g,p),d.subVectors(p,h)),g-l>=0?(t(v,g-l,p),f.subVectors(h,p)):(t(v,g+l,p),f.subVectors(p,h)),c.crossVectors(d,f).normalize(),s.push(c.x,c.y,c.z),u.push(v,g)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var y=n*m+i,x=n*m+i+1,b=(n+1)*m+i+1,_=(n+1)*m+i;o.push(y,x,_),o.push(x,b,_)}this.setIndex(o),this.setAttribute("position",new lo(a,3)),this.setAttribute("normal",new lo(s,3)),this.setAttribute("uv",new lo(u,2))}function vl(t,e,r,n){Wo.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new yl(t,e,r,n)),this.mergeVertices()}function yl(t,e,r,n){_o.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],o=[];function a(t,e,r,n){var i,o,a=Math.pow(2,n),u=[];for(i=0;i<=a;i++){u[i]=[];var l=t.clone().lerp(r,i/a),c=e.clone().lerp(r,i/a),h=a-i;for(o=0;o<=h;o++)u[i][o]=0===o&&i===a?l:l.clone().lerp(c,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var p=Math.floor(o/2);o%2==0?(s(u[i][p+1]),s(u[i+1][p]),s(u[i][p])):(s(u[i][p+1]),s(u[i+1][p+1]),s(u[i+1][p]))}}function s(t){i.push(t.x,t.y,t.z)}function u(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function l(t,e,r,n){n<0&&1===t.x&&(o[e]=t.x-1),0===r.x&&0===r.z&&(o[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){for(var r=new _n,n=new _n,i=new _n,o=0;o<e.length;o+=3)u(e[o+0],r),u(e[o+1],n),u(e[o+2],i),a(r,n,i,t)}(n=n||0),function(t){for(var e=new _n,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new _n,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=c(t)/2/Math.PI+.5,n=(a=t,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(r,1-n)}var a;(function(){for(var t=new _n,e=new _n,r=new _n,n=new _n,a=new vn,s=new vn,u=new vn,h=0,p=0;h<i.length;h+=9,p+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),a.set(o[p+0],o[p+1]),s.set(o[p+2],o[p+3]),u.set(o[p+4],o[p+5]),n.copy(t).add(e).add(r).divideScalar(3);var d=c(n);l(a,p+0,t,d),l(s,p+2,e,d),l(u,p+4,r,d)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],r=o[t+2],n=o[t+4],i=Math.max(e,r,n),a=Math.min(e,r,n);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),r<.2&&(o[t+2]+=1),n<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new lo(i,3)),this.setAttribute("normal",new lo(i.slice(),3)),this.setAttribute("uv",new lo(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function xl(t,e){Wo.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new bl(t,e)),this.mergeVertices()}function bl(t,e){yl.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function _l(t,e){Wo.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new wl(t,e)),this.mergeVertices()}function wl(t,e){yl.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Tl(t,e){Wo.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new El(t,e)),this.mergeVertices()}function El(t,e){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];yl.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Sl(t,e){Wo.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Al(t,e)),this.mergeVertices()}function Al(t,e){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];yl.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Pl(t,e,r,n,i,o){Wo.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Ml(t,e,r,n,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Ml(t,e,r,n,i){_o.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8,i=i||!1;var o=t.computeFrenetFrames(e,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,u=new _n,l=new _n,c=new vn,h=new _n,p=[],d=[],f=[],m=[];function g(i){h=t.getPointAt(i/e,h);var a=o.normals[i],c=o.binormals[i];for(s=0;s<=n;s++){var f=s/n*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);l.x=g*a.x+m*c.x,l.y=g*a.y+m*c.y,l.z=g*a.z+m*c.z,l.normalize(),d.push(l.x,l.y,l.z),u.x=h.x+r*l.x,u.y=h.y+r*l.y,u.z=h.z+r*l.z,p.push(u.x,u.y,u.z)}}!function(){for(a=0;a<e;a++)g(a);g(!1===i?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=n;s++)c.x=a/e,c.y=s/n,f.push(c.x,c.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=n;a++){var t=(n+1)*(s-1)+(a-1),r=(n+1)*s+(a-1),i=(n+1)*s+a,o=(n+1)*(s-1)+a;m.push(t,r,o),m.push(r,i,o)}}()}(),this.setIndex(m),this.setAttribute("position",new lo(p,3)),this.setAttribute("normal",new lo(d,3)),this.setAttribute("uv",new lo(f,2))}function Il(t,e,r,n,i,o,a){Wo.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ol(t,e,r,n,i,o)),this.mergeVertices()}function Ol(t,e,r,n,i,o){_o.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var a,s,u=[],l=[],c=[],h=[],p=new _n,d=new _n,f=new _n,m=new _n,g=new _n,v=new _n,y=new _n;for(a=0;a<=r;++a){var x=a/r*i*Math.PI*2;for(P(x,i,o,t,f),P(x+.01,i,o,t,m),v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,_=-e*Math.cos(b),w=e*Math.sin(b);p.x=f.x+(_*y.x+w*g.x),p.y=f.y+(_*y.y+w*g.y),p.z=f.z+(_*y.z+w*g.z),l.push(p.x,p.y,p.z),d.subVectors(p,f).normalize(),c.push(d.x,d.y,d.z),h.push(a/r),h.push(s/n)}}for(s=1;s<=r;s++)for(a=1;a<=n;a++){var T=(n+1)*(s-1)+(a-1),E=(n+1)*s+(a-1),S=(n+1)*s+a,A=(n+1)*(s-1)+a;u.push(T,E,A),u.push(E,S,A)}function P(t,e,r,n,i){var o=Math.cos(t),a=Math.sin(t),s=r/e*t,u=Math.cos(s);i.x=n*(2+u)*.5*o,i.y=n*(2+u)*a*.5,i.z=n*Math.sin(s)*.5}this.setIndex(u),this.setAttribute("position",new lo(l,3)),this.setAttribute("normal",new lo(c,3)),this.setAttribute("uv",new lo(h,2))}function Cl(t,e,r,n,i){Wo.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new Rl(t,e,r,n,i)),this.mergeVertices()}function Rl(t,e,r,n,i){_o.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],u=[],l=[],c=[],h=new _n,p=new _n,d=new _n;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var f=a/n*i,m=o/r*Math.PI*2;p.x=(t+e*Math.cos(m))*Math.cos(f),p.y=(t+e*Math.cos(m))*Math.sin(f),p.z=e*Math.sin(m),u.push(p.x,p.y,p.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),d.subVectors(p,h).normalize(),l.push(d.x,d.y,d.z),c.push(a/n),c.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++){var g=(n+1)*o+a-1,v=(n+1)*(o-1)+a-1,y=(n+1)*(o-1)+a,x=(n+1)*o+a;s.push(g,v,x),s.push(v,y,x)}this.setIndex(s),this.setAttribute("position",new lo(u,3)),this.setAttribute("normal",new lo(l,3)),this.setAttribute("uv",new lo(c,2))}ul.prototype=Object.assign(Object.create(ri.prototype),{constructor:ul,isPoints:!0,raycast:function(t,e){var r=this.geometry,n=this.matrixWorld,i=t.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),al.copy(r.boundingSphere),al.applyMatrix4(n),al.radius+=i,!1!==t.ray.intersectsSphere(al)){il.getInverse(n),ol.copy(t.ray).applyMatrix4(il);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(r.isBufferGeometry){var s=r.index,u=r.attributes.position.array;if(null!==s)for(var l=s.array,c=0,h=l.length;c<h;c++){var p=l[c];sl.fromArray(u,3*p),ll(sl,p,a,n,t,e,this)}else{c=0;for(var d=u.length/3;c<d;c++)sl.fromArray(u,3*c),ll(sl,c,a,n,t,e,this)}}else{var f=r.vertices;for(c=0,d=f.length;c<d;c++)ll(f[c],c,a,n,t,e,this)}}},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),cl.prototype=Object.assign(Object.create(Pn.prototype),{constructor:cl,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),hl.prototype=Object.create(Pn.prototype),hl.prototype.constructor=hl,hl.prototype.isCompressedTexture=!0,pl.prototype=Object.create(Pn.prototype),pl.prototype.constructor=pl,pl.prototype.isCanvasTexture=!0,dl.prototype=Object.create(Pn.prototype),dl.prototype.constructor=dl,dl.prototype.isDepthTexture=!0,fl.prototype=Object.create(_o.prototype),fl.prototype.constructor=fl,ml.prototype=Object.create(Wo.prototype),ml.prototype.constructor=ml,gl.prototype=Object.create(_o.prototype),gl.prototype.constructor=gl,vl.prototype=Object.create(Wo.prototype),vl.prototype.constructor=vl,yl.prototype=Object.create(_o.prototype),yl.prototype.constructor=yl,xl.prototype=Object.create(Wo.prototype),xl.prototype.constructor=xl,bl.prototype=Object.create(yl.prototype),bl.prototype.constructor=bl,_l.prototype=Object.create(Wo.prototype),_l.prototype.constructor=_l,wl.prototype=Object.create(yl.prototype),wl.prototype.constructor=wl,Tl.prototype=Object.create(Wo.prototype),Tl.prototype.constructor=Tl,El.prototype=Object.create(yl.prototype),El.prototype.constructor=El,Sl.prototype=Object.create(Wo.prototype),Sl.prototype.constructor=Sl,Al.prototype=Object.create(yl.prototype),Al.prototype.constructor=Al,Pl.prototype=Object.create(Wo.prototype),Pl.prototype.constructor=Pl,Ml.prototype=Object.create(_o.prototype),Ml.prototype.constructor=Ml,Ml.prototype.toJSON=function(){var t=_o.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Il.prototype=Object.create(Wo.prototype),Il.prototype.constructor=Il,Ol.prototype=Object.create(_o.prototype),Ol.prototype.constructor=Ol,Cl.prototype=Object.create(Wo.prototype),Cl.prototype.constructor=Cl,Rl.prototype=Object.create(_o.prototype),Rl.prototype.constructor=Rl;var Ll=function(t,e,r){r=r||2;var n,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*r:t.length,p=Nl(t,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Nl(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(Hl(a));for(s.sort(zl),i=0;i<s.length;i++)Gl(s[i],r),r=Fl(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)(s=t[f])<n&&(n=s),(u=t[f+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-n,a-i))?1/l:0}return Dl(p,d,r,n,i,l),d};function Nl(t,e,r,n,i){var o,a;if(i===function(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,r,n)>0)for(o=e;o<r;o+=n)a=Jl(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=Jl(o,t[o],t[o+1],a);return a&&ql(a,a.next)&&(Kl(a),a=a.next),a}function Fl(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!ql(n,n.next)&&0!==Yl(n.prev,n,n.next))n=n.next;else{if(Kl(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Dl(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Vl(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?kl(t,n,i,o):Ul(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),Kl(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Dl(t=jl(t,e,r),e,r,n,i,o,2):2===a&&Bl(t,e,r,n,i,o):Dl(Fl(t),e,r,n,i,o,1);break}}}function Ul(t){var e=t.prev,r=t,n=t.next;if(Yl(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Xl(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Yl(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function kl(t,e,r,n){var i=t.prev,o=t,a=t.next;if(Yl(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Vl(s,u,e,r,n),p=Vl(l,c,e,r,n),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&Xl(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Yl(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&Xl(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Yl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Xl(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Yl(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&Xl(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Yl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function jl(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!ql(i,o)&&$l(i,n,n.next,o)&&Ql(i,o)&&Ql(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Kl(n),Kl(n.next),n=t=o),n=n.next}while(n!==t);return n}function Bl(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Wl(a,s)){var u=Zl(a,s);return a=Fl(a,a.next),u=Fl(u,u.next),Dl(a,e,r,n,i,o),void Dl(u,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function zl(t,e){return t.x-e.x}function Gl(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var u,l=r,c=r.x,h=r.y,p=1/0;n=r.next;for(;n!==l;)i>=n.x&&n.x>=c&&i!==n.x&&Xl(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<p||u===p&&n.x>r.x)&&Ql(n,t)&&(r=n,p=u),n=n.next;return r}(t,e)){var r=Zl(e,t);Fl(r,r.next)}}function Vl(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hl(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Xl(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function Wl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&$l(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&Ql(t,e)&&Ql(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)}function Yl(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function ql(t,e){return t.x===e.x&&t.y===e.y}function $l(t,e,r,n){return!!(ql(t,r)&&ql(e,n)||ql(t,n)&&ql(r,e))||Yl(t,e,r)>0!=Yl(t,e,n)>0&&Yl(r,n,t)>0!=Yl(r,n,e)>0}function Ql(t,e){return Yl(t.prev,t,t.next)<0?Yl(t,e,t.next)>=0&&Yl(t,t.prev,e)>=0:Yl(t,e,t.prev)<0||Yl(t,t.next,e)<0}function Zl(t,e){var r=new tc(t.i,t.x,t.y),n=new tc(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Jl(t,e,r,n){var i=new tc(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Kl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function tc(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ec={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return ec.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];rc(t),nc(r,t);var o=t.length;e.forEach(rc);for(var a=0;a<e.length;a++)n.push(o),o+=e[a].length,nc(r,e[a]);var s=Ll(r,n);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function rc(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function nc(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function ic(t,e){Wo.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new oc(t,e)),this.mergeVertices()}function oc(t,e){_o.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var r=this,n=[],i=[],o=0,a=t.length;o<a;o++){s(t[o])}function s(t){var o=[],a=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,u=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:c-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3,f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:ac;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=e.amount);var g,v,y,x,b,_,w,T,E=!1;f&&(g=f.getSpacedPoints(s),E=!0,l=!1,v=f.computeFrenetFrames(s,!1),y=new _n,x=new _n,b=new _n),l||(d=0,c=0,h=0,p=0);var S=t.extractPoints(a),A=S.shape,P=S.holes;if(!ec.isClockWise(A))for(A=A.reverse(),w=0,T=P.length;w<T;w++)_=P[w],ec.isClockWise(_)&&(P[w]=_.reverse());var M=ec.triangulateShape(A,P),I=A;for(w=0,T=P.length;w<T;w++)_=P[w],A=A.concat(_);function O(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var C,R,L,N,F,D,U=A.length,k=M.length;function j(t,e,r){var n,i,o,a=t.x-e.x,s=t.y-e.y,u=r.x-t.x,l=r.y-t.y,c=a*a+s*s,h=a*l-s*u;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(c),d=Math.sqrt(u*u+l*l),f=e.x-s/p,m=e.y+a/p,g=((r.x-l/d-f)*l-(r.y+u/d-m)*u)/(a*l-s*u),v=(n=f+a*g-t.x)*n+(i=m+s*g-t.y)*i;if(v<=2)return new vn(n,i);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?u>Number.EPSILON&&(y=!0):a<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(n=-s,i=a,o=Math.sqrt(c)):(n=a,i=s,o=Math.sqrt(c/2))}return new vn(n/o,i/o)}for(var B=[],z=0,G=I.length,V=G-1,H=z+1;z<G;z++,V++,H++)V===G&&(V=0),H===G&&(H=0),B[z]=j(I[z],I[V],I[H]);var X,W,Y=[],q=B.concat();for(w=0,T=P.length;w<T;w++){for(_=P[w],X=[],z=0,V=(G=_.length)-1,H=z+1;z<G;z++,V++,H++)V===G&&(V=0),H===G&&(H=0),X[z]=j(_[z],_[V],_[H]);Y.push(X),q=q.concat(X)}for(C=0;C<d;C++){for(L=C/d,N=c*Math.cos(L*Math.PI/2),R=h*Math.sin(L*Math.PI/2)+p,z=0,G=I.length;z<G;z++)Q((F=O(I[z],B[z],R)).x,F.y,-N);for(w=0,T=P.length;w<T;w++)for(_=P[w],X=Y[w],z=0,G=_.length;z<G;z++)Q((F=O(_[z],X[z],R)).x,F.y,-N)}for(R=h+p,z=0;z<U;z++)F=l?O(A[z],q[z],R):A[z],E?(x.copy(v.normals[0]).multiplyScalar(F.x),y.copy(v.binormals[0]).multiplyScalar(F.y),b.copy(g[0]).add(x).add(y),Q(b.x,b.y,b.z)):Q(F.x,F.y,0);for(W=1;W<=s;W++)for(z=0;z<U;z++)F=l?O(A[z],q[z],R):A[z],E?(x.copy(v.normals[W]).multiplyScalar(F.x),y.copy(v.binormals[W]).multiplyScalar(F.y),b.copy(g[W]).add(x).add(y),Q(b.x,b.y,b.z)):Q(F.x,F.y,u/s*W);for(C=d-1;C>=0;C--){for(L=C/d,N=c*Math.cos(L*Math.PI/2),R=h*Math.sin(L*Math.PI/2)+p,z=0,G=I.length;z<G;z++)Q((F=O(I[z],B[z],R)).x,F.y,u+N);for(w=0,T=P.length;w<T;w++)for(_=P[w],X=Y[w],z=0,G=_.length;z<G;z++)F=O(_[z],X[z],R),E?Q(F.x,F.y+g[s-1].y,g[s-1].x+N):Q(F.x,F.y,u+N)}function $(t,e){var r,n;for(z=t.length;--z>=0;){r=z,(n=z-1)<0&&(n=t.length-1);var i=0,o=s+2*d;for(i=0;i<o;i++){var a=U*i,u=U*(i+1);J(e+r+a,e+n+a,e+n+u,e+r+u)}}}function Q(t,e,r){o.push(t),o.push(e),o.push(r)}function Z(t,e,i){K(t),K(e),K(i);var o=n.length/3,a=m.generateTopUV(r,n,o-3,o-2,o-1);tt(a[0]),tt(a[1]),tt(a[2])}function J(t,e,i,o){K(t),K(e),K(o),K(e),K(i),K(o);var a=n.length/3,s=m.generateSideWallUV(r,n,a-6,a-3,a-2,a-1);tt(s[0]),tt(s[1]),tt(s[3]),tt(s[1]),tt(s[2]),tt(s[3])}function K(t){n.push(o[3*t+0]),n.push(o[3*t+1]),n.push(o[3*t+2])}function tt(t){i.push(t.x),i.push(t.y)}!function(){var t=n.length/3;if(l){var e=0,i=U*e;for(z=0;z<k;z++)Z((D=M[z])[2]+i,D[1]+i,D[0]+i);for(i=U*(e=s+2*d),z=0;z<k;z++)Z((D=M[z])[0]+i,D[1]+i,D[2]+i)}else{for(z=0;z<k;z++)Z((D=M[z])[2],D[1],D[0]);for(z=0;z<k;z++)Z((D=M[z])[0]+U*s,D[1]+U*s,D[2]+U*s)}r.addGroup(t,n.length/3-t,0)}(),function(){var t=n.length/3,e=0;for($(I,e),e+=I.length,w=0,T=P.length;w<T;w++)$(_=P[w],e),e+=_.length;r.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new lo(n,3)),this.setAttribute("uv",new lo(i,2)),this.computeVertexNormals()}ic.prototype=Object.create(Wo.prototype),ic.prototype.constructor=ic,ic.prototype.toJSON=function(){var t=Wo.prototype.toJSON.call(this);return sc(this.parameters.shapes,this.parameters.options,t)},oc.prototype=Object.create(_o.prototype),oc.prototype.constructor=oc,oc.prototype.toJSON=function(){var t=_o.prototype.toJSON.call(this);return sc(this.parameters.shapes,this.parameters.options,t)};var ac={generateTopUV:function(t,e,r,n,i){var o=e[3*r],a=e[3*r+1],s=e[3*n],u=e[3*n+1],l=e[3*i],c=e[3*i+1];return[new vn(o,a),new vn(s,u),new vn(l,c)]},generateSideWallUV:function(t,e,r,n,i,o){var a=e[3*r],s=e[3*r+1],u=e[3*r+2],l=e[3*n],c=e[3*n+1],h=e[3*n+2],p=e[3*i],d=e[3*i+1],f=e[3*i+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(s-c)<.01?[new vn(a,1-u),new vn(l,1-h),new vn(p,1-f),new vn(m,1-v)]:[new vn(s,1-u),new vn(c,1-h),new vn(d,1-f),new vn(g,1-v)]}};function sc(t,e,r){if(r.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++){var o=t[n];r.shapes.push(o.uuid)}else r.shapes.push(t.uuid);return void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function uc(t,e){Wo.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new lc(t,e)),this.mergeVertices()}function lc(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Wo;var n=r.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),oc.call(this,n,e),this.type="TextBufferGeometry"}function cc(t,e,r,n,i,o,a){Wo.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new hc(t,e,r,n,i,o,a)),this.mergeVertices()}function hc(t,e,r,n,i,o,a){_o.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,u,l=Math.min(o+a,Math.PI),c=0,h=[],p=new _n,d=new _n,f=[],m=[],g=[],v=[];for(u=0;u<=r;u++){var y=[],x=u/r,b=0;for(0==u&&0==o?b=.5/e:u==r&&l==Math.PI&&(b=-.5/e),s=0;s<=e;s++){var _=s/e;p.x=-t*Math.cos(n+_*i)*Math.sin(o+x*a),p.y=t*Math.cos(o+x*a),p.z=t*Math.sin(n+_*i)*Math.sin(o+x*a),m.push(p.x,p.y,p.z),d.copy(p).normalize(),g.push(d.x,d.y,d.z),v.push(_+b,1-x),y.push(c++)}h.push(y)}for(u=0;u<r;u++)for(s=0;s<e;s++){var w=h[u][s+1],T=h[u][s],E=h[u+1][s],S=h[u+1][s+1];(0!==u||o>0)&&f.push(w,T,S),(u!==r-1||l<Math.PI)&&f.push(T,E,S)}this.setIndex(f),this.setAttribute("position",new lo(m,3)),this.setAttribute("normal",new lo(g,3)),this.setAttribute("uv",new lo(v,2))}function pc(t,e,r,n,i,o){Wo.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new dc(t,e,r,n,i,o)),this.mergeVertices()}function dc(t,e,r,n,i,o){_o.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,u,l=[],c=[],h=[],p=[],d=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new _n,g=new vn;for(s=0;s<=n;s++){for(u=0;u<=r;u++)a=i+u/r*o,m.x=d*Math.cos(a),m.y=d*Math.sin(a),c.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/e+1)/2,g.y=(m.y/e+1)/2,p.push(g.x,g.y);d+=f}for(s=0;s<n;s++){var v=s*(r+1);for(u=0;u<r;u++){var y=a=u+v,x=a+r+1,b=a+r+2,_=a+1;l.push(y,x,_),l.push(x,b,_)}}this.setIndex(l),this.setAttribute("position",new lo(c,3)),this.setAttribute("normal",new lo(h,3)),this.setAttribute("uv",new lo(p,2))}function fc(t,e,r,n){Wo.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new mc(t,e,r,n)),this.mergeVertices()}function mc(t,e,r,n){_o.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=gn.clamp(n,0,2*Math.PI);var i,o,a,s=[],u=[],l=[],c=1/e,h=new _n,p=new vn;for(o=0;o<=e;o++){var d=r+o*c*n,f=Math.sin(d),m=Math.cos(d);for(a=0;a<=t.length-1;a++)h.x=t[a].x*f,h.y=t[a].y,h.z=t[a].x*m,u.push(h.x,h.y,h.z),p.x=o/e,p.y=a/(t.length-1),l.push(p.x,p.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var g=i=a+o*t.length,v=i+t.length,y=i+t.length+1,x=i+1;s.push(g,v,x),s.push(v,y,x)}if(this.setIndex(s),this.setAttribute("position",new lo(u,3)),this.setAttribute("uv",new lo(l,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,_=new _n,w=new _n,T=new _n;for(i=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)_.x=b[a+0],_.y=b[a+1],_.z=b[a+2],w.x=b[i+a+0],w.y=b[i+a+1],w.z=b[i+a+2],T.addVectors(_,w).normalize(),b[a+0]=b[i+a+0]=T.x,b[a+1]=b[i+a+1]=T.y,b[a+2]=b[i+a+2]=T.z}}function gc(t,e){Wo.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new vc(t,e)),this.mergeVertices()}function vc(t,e){_o.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(t))l(t);else for(var u=0;u<t.length;u++)l(t[u]),this.addGroup(a,s,u),a+=s,s=0;function l(t){var a,u,l,c=n.length/3,h=t.extractPoints(e),p=h.shape,d=h.holes;for(!1===ec.isClockWise(p)&&(p=p.reverse()),a=0,u=d.length;a<u;a++)l=d[a],!0===ec.isClockWise(l)&&(d[a]=l.reverse());var f=ec.triangulateShape(p,d);for(a=0,u=d.length;a<u;a++)l=d[a],p=p.concat(l);for(a=0,u=p.length;a<u;a++){var m=p[a];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,u=f.length;a<u;a++){var g=f[a],v=g[0]+c,y=g[1]+c,x=g[2]+c;r.push(v,y,x),s+=3}}this.setIndex(r),this.setAttribute("position",new lo(n,3)),this.setAttribute("normal",new lo(i,3)),this.setAttribute("uv",new lo(o,2))}function yc(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++){var i=t[r];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}function xc(t,e){_o.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,o,a=[],s=Math.cos(gn.DEG2RAD*e),u=[0,0],l={},c=["a","b","c"];t.isBufferGeometry?(o=new Wo).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)r=m[c[g]],n=m[c[(g+1)%3]],u[0]=Math.min(r,n),u[1]=Math.max(r,n),void 0===l[i=u[0]+","+u[1]]?l[i]={index1:u[0],index2:u[1],face1:d,face2:void 0}:l[i].face2=d;for(i in l){var v=l[i];if(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new lo(a,3))}function bc(t,e,r,n,i,o,a,s){Wo.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new _c(t,e,r,n,i,o,a,s)),this.mergeVertices()}function _c(t,e,r,n,i,o,a,s){_o.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var u=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var l=[],c=[],h=[],p=[],d=0,f=[],m=r/2,g=0;function v(r){var i,o,f,v=new vn,y=new _n,x=0,b=!0===r?t:e,_=!0===r?1:-1;for(o=d,i=1;i<=n;i++)c.push(0,m*_,0),h.push(0,_,0),p.push(.5,.5),d++;for(f=d,i=0;i<=n;i++){var w=i/n*s+a,T=Math.cos(w),E=Math.sin(w);y.x=b*E,y.y=m*_,y.z=b*T,c.push(y.x,y.y,y.z),h.push(0,_,0),v.x=.5*T+.5,v.y=.5*E*_+.5,p.push(v.x,v.y),d++}for(i=0;i<n;i++){var S=o+i,A=f+i;!0===r?l.push(A,A+1,S):l.push(A+1,A,S),x+=3}u.addGroup(g,x,!0===r?1:2),g+=x}!function(){var o,v,y=new _n,x=new _n,b=0,_=(e-t)/r;for(v=0;v<=i;v++){var w=[],T=v/i,E=T*(e-t)+t;for(o=0;o<=n;o++){var S=o/n,A=S*s+a,P=Math.sin(A),M=Math.cos(A);x.x=E*P,x.y=-T*r+m,x.z=E*M,c.push(x.x,x.y,x.z),y.set(P,_,M).normalize(),h.push(y.x,y.y,y.z),p.push(S,1-T),w.push(d++)}f.push(w)}for(o=0;o<n;o++)for(v=0;v<i;v++){var I=f[v][o],O=f[v+1][o],C=f[v+1][o+1],R=f[v][o+1];l.push(I,O,R),l.push(O,C,R),b+=6}u.addGroup(g,b,0),g+=b}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new lo(c,3)),this.setAttribute("normal",new lo(h,3)),this.setAttribute("uv",new lo(p,2))}function wc(t,e,r,n,i,o,a){bc.call(this,0,t,e,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Tc(t,e,r,n,i,o,a){_c.call(this,0,t,e,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Ec(t,e,r,n){Wo.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new Sc(t,e,r,n)),this.mergeVertices()}function Sc(t,e,r,n){_o.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,a=[],s=[],u=[],l=[],c=new _n,h=new vn;for(s.push(0,0,0),u.push(0,0,1),l.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var p=r+o/e*n;c.x=t*Math.cos(p),c.y=t*Math.sin(p),s.push(c.x,c.y,c.z),u.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,l.push(h.x,h.y)}for(i=1;i<=e;i++)a.push(i,i+1,0);this.setIndex(a),this.setAttribute("position",new lo(s,3)),this.setAttribute("normal",new lo(u,3)),this.setAttribute("uv",new lo(l,2))}uc.prototype=Object.create(Wo.prototype),uc.prototype.constructor=uc,lc.prototype=Object.create(oc.prototype),lc.prototype.constructor=lc,cc.prototype=Object.create(Wo.prototype),cc.prototype.constructor=cc,hc.prototype=Object.create(_o.prototype),hc.prototype.constructor=hc,pc.prototype=Object.create(Wo.prototype),pc.prototype.constructor=pc,dc.prototype=Object.create(_o.prototype),dc.prototype.constructor=dc,fc.prototype=Object.create(Wo.prototype),fc.prototype.constructor=fc,mc.prototype=Object.create(_o.prototype),mc.prototype.constructor=mc,gc.prototype=Object.create(Wo.prototype),gc.prototype.constructor=gc,gc.prototype.toJSON=function(){var t=Wo.prototype.toJSON.call(this);return yc(this.parameters.shapes,t)},vc.prototype=Object.create(_o.prototype),vc.prototype.constructor=vc,vc.prototype.toJSON=function(){var t=_o.prototype.toJSON.call(this);return yc(this.parameters.shapes,t)},xc.prototype=Object.create(_o.prototype),xc.prototype.constructor=xc,bc.prototype=Object.create(Wo.prototype),bc.prototype.constructor=bc,_c.prototype=Object.create(_o.prototype),_c.prototype.constructor=_c,wc.prototype=Object.create(bc.prototype),wc.prototype.constructor=wc,Tc.prototype=Object.create(_c.prototype),Tc.prototype.constructor=Tc,Ec.prototype=Object.create(Wo.prototype),Ec.prototype.constructor=Ec,Sc.prototype=Object.create(_o.prototype),Sc.prototype.constructor=Sc;var Ac=Object.freeze({__proto__:null,WireframeGeometry:fl,ParametricGeometry:ml,ParametricBufferGeometry:gl,TetrahedronGeometry:xl,TetrahedronBufferGeometry:bl,OctahedronGeometry:_l,OctahedronBufferGeometry:wl,IcosahedronGeometry:Tl,IcosahedronBufferGeometry:El,DodecahedronGeometry:Sl,DodecahedronBufferGeometry:Al,PolyhedronGeometry:vl,PolyhedronBufferGeometry:yl,TubeGeometry:Pl,TubeBufferGeometry:Ml,TorusKnotGeometry:Il,TorusKnotBufferGeometry:Ol,TorusGeometry:Cl,TorusBufferGeometry:Rl,TextGeometry:uc,TextBufferGeometry:lc,SphereGeometry:cc,SphereBufferGeometry:hc,RingGeometry:pc,RingBufferGeometry:dc,PlaneGeometry:pa,PlaneBufferGeometry:da,LatheGeometry:fc,LatheBufferGeometry:mc,ShapeGeometry:gc,ShapeBufferGeometry:vc,ExtrudeGeometry:ic,ExtrudeBufferGeometry:oc,EdgesGeometry:xc,ConeGeometry:wc,ConeBufferGeometry:Tc,CylinderGeometry:bc,CylinderBufferGeometry:_c,CircleGeometry:Ec,CircleBufferGeometry:Sc,BoxGeometry:Yo,BoxBufferGeometry:qo});function Pc(t){Ki.call(this),this.type="ShadowMaterial",this.color=new Yi(0),this.transparent=!0,this.setValues(t)}function Mc(t){Jo.call(this,t),this.type="RawShaderMaterial"}function Ic(t){Ki.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Yi(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Oc(t){Ic.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new vn(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(t)}function Cc(t){Ki.call(this),this.type="MeshPhongMaterial",this.color=new Yi(16777215),this.specular=new Yi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Rc(t){Cc.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Lc(t){Ki.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Nc(t){Ki.call(this),this.type="MeshLambertMaterial",this.color=new Yi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Fc(t){Ki.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Yi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new vn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Dc(t){Wu.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Pc.prototype=Object.create(Ki.prototype),Pc.prototype.constructor=Pc,Pc.prototype.isShadowMaterial=!0,Pc.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this},Mc.prototype=Object.create(Jo.prototype),Mc.prototype.constructor=Mc,Mc.prototype.isRawShaderMaterial=!0,Ic.prototype=Object.create(Ki.prototype),Ic.prototype.constructor=Ic,Ic.prototype.isMeshStandardMaterial=!0,Ic.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Oc.prototype=Object.create(Ic.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isMeshPhysicalMaterial=!0,Oc.prototype.copy=function(t){return Ic.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearcoat=t.clearcoat,this.clearcoatRoughness=t.clearcoatRoughness,t.sheen?this.sheen=(this.sheen||new Yi).copy(t.sheen):this.sheen=null,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.transparency=t.transparency,this},Cc.prototype=Object.create(Ki.prototype),Cc.prototype.constructor=Cc,Cc.prototype.isMeshPhongMaterial=!0,Cc.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Rc.prototype=Object.create(Cc.prototype),Rc.prototype.constructor=Rc,Rc.prototype.isMeshToonMaterial=!0,Rc.prototype.copy=function(t){return Cc.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},Lc.prototype=Object.create(Ki.prototype),Lc.prototype.constructor=Lc,Lc.prototype.isMeshNormalMaterial=!0,Lc.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Nc.prototype=Object.create(Ki.prototype),Nc.prototype.constructor=Nc,Nc.prototype.isMeshLambertMaterial=!0,Nc.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Fc.prototype=Object.create(Ki.prototype),Fc.prototype.constructor=Fc,Fc.prototype.isMeshMatcapMaterial=!0,Fc.prototype.copy=function(t){return Ki.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Dc.prototype=Object.create(Wu.prototype),Dc.prototype.constructor=Dc,Dc.prototype.isLineDashedMaterial=!0,Dc.prototype.copy=function(t){return Wu.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Uc=Object.freeze({__proto__:null,ShadowMaterial:Pc,SpriteMaterial:yu,RawShaderMaterial:Mc,ShaderMaterial:Jo,PointsMaterial:nl,MeshPhysicalMaterial:Oc,MeshStandardMaterial:Ic,MeshPhongMaterial:Cc,MeshToonMaterial:Rc,MeshNormalMaterial:Lc,MeshLambertMaterial:Nc,MeshDepthMaterial:Zs,MeshDistanceMaterial:Js,MeshBasicMaterial:to,MeshMatcapMaterial:Fc,LineDashedMaterial:Dc,LineBasicMaterial:Wu,Material:Ki}),kc={arraySlice:function(t,e,r){return kc.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort((function(e,r){return t[e]-t[r]})),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*e,u=0;u!==e;++u)i[a++]=t[s+u];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(e.push(o.time),r.push.apply(r,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(e.push(o.time),a.toArray(r,r.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(e.push(o.time),r.push(a)),o=t[i++]}while(void 0!==o)}},subclip:function(t,e,r,n,i){i=i||30;var o=t.clone();o.name=e;for(var a=[],s=0;s<o.tracks.length;++s){for(var u=o.tracks[s],l=u.getValueSize(),c=[],h=[],p=0;p<u.times.length;++p){var d=u.times[p]*i;if(!(d<r||d>=n)){c.push(u.times[p]);for(var f=0;f<l;++f)h.push(u.values[p*l+f])}}0!==c.length&&(u.times=kc.convertArray(c,u.times.constructor),u.values=kc.convertArray(h,u.values.constructor),a.push(u))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o}};function jc(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function Bc(t,e,r,n){jc.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function zc(t,e,r,n){jc.call(this,t,e,r,n)}function Gc(t,e,r,n){jc.call(this,t,e,r,n)}function Vc(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=kc.convertArray(e,this.TimeBufferType),this.values=kc.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Hc(t,e,r){Vc.call(this,t,e,r)}function Xc(t,e,r,n){Vc.call(this,t,e,r,n)}function Wc(t,e,r,n){Vc.call(this,t,e,r,n)}function Yc(t,e,r,n){jc.call(this,t,e,r,n)}function qc(t,e,r,n){Vc.call(this,t,e,r,n)}function $c(t,e,r,n){Vc.call(this,t,e,r,n)}function Qc(t,e,r,n){Vc.call(this,t,e,r,n)}function Zc(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=gn.generateUUID(),this.duration<0&&this.resetDuration()}function Jc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wc;case"vector":case"vector2":case"vector3":case"vector4":return Qc;case"color":return Xc;case"quaternion":return qc;case"bool":case"boolean":return Hc;case"string":return $c}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],n=[];kc.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(jc.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var o;r:{n:if(!(t<n)){for(var a=r+2;;){if(void 0===n){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,i)}if(r===a)break;if(i=n,t<(n=e[++r]))break e}o=e.length;break r}if(t>=i)break t;var s=e[1];t<s&&(r=2,i=s);for(a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===a)break;if(n=i,t>=(i=e[--r-1]))break e}o=r,r=0}for(;r<o;){var u=r+o>>>1;t<e[u]?o=u:r=u+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,o=0;o!==n;++o)e[o]=r[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(jc.prototype,{beforeStart_:jc.prototype.copySampleValue_,afterEnd_:jc.prototype.copySampleValue_}),Bc.prototype=Object.assign(Object.create(jc.prototype),{constructor:Bc,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-r;break;case 2402:a=e+n[i=n.length-2]-n[i+1];break;default:i=t,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*r-e;break;case 2402:o=1,s=r+n[1]-n[0];break;default:o=t-1,s=e}var u=.5*(r-e),l=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(s-r),this._offsetPrev=i*l,this._offsetNext=o*l},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(r-e)/(n-e),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,x=p*m-p*f,b=0;b!==a;++b)i[b]=g*o[l+b]+v*o[u+b]+y*o[s+b]+x*o[c+b];return i}}),zc.prototype=Object.assign(Object.create(jc.prototype),{constructor:zc,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,l=(r-e)/(n-e),c=1-l,h=0;h!==a;++h)i[h]=o[u+h]*c+o[s+h]*l;return i}}),Gc.prototype=Object.assign(Object.create(jc.prototype),{constructor:Gc,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Vc,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:kc.convertArray(t.times,Array),values:kc.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(Vc.prototype,{constructor:Vc,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new Gc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new zc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Bc(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=kc.arraySlice(r,i,o),this.values=kc.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==n&&kc.isTypedArray(n)){a=0;for(var u=n.length;a!==u;++a){var l=n[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=t.length-1,a=1;a<o;++a){var s=!1,u=t[a];if(u!==t[a+1]&&(1!==a||u!==u[0]))if(n)s=!0;else for(var l=a*r,c=l-r,h=l+r,p=0;p!==r;++p){var d=e[l+p];if(d!==e[c+p]||d!==e[h+p]){s=!0;break}}if(s){if(a!==i){t[i]=t[a];var f=a*r,m=i*r;for(p=0;p!==r;++p)e[m+p]=e[f+p]}++i}}if(o>0){t[i]=t[o];for(f=o*r,m=i*r,p=0;p!==r;++p)e[m+p]=e[f+p];++i}return i!==t.length&&(this.times=kc.arraySlice(t,0,i),this.values=kc.arraySlice(e,0,i*r)),this},clone:function(){var t=kc.arraySlice(this.times,0),e=kc.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}),Hc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Hc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Xc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Xc,ValueTypeName:"color"}),Wc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Wc,ValueTypeName:"number"}),Yc.prototype=Object.assign(Object.create(jc.prototype),{constructor:Yc,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=(r-e)/(n-e),l=s+a;s!==l;s+=4)yn.slerpFlat(i,0,o,s-a,o,s,u);return i}}),qc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:qc,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new Yc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),$c.prototype=Object.assign(Object.create(Vc.prototype),{constructor:$c,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Qc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Qc,ValueTypeName:"vector"}),Object.assign(Zc,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(Jc(r[i]).scale(n));return new Zc(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},i=0,o=r.length;i!==o;++i)e.push(Vc.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var l=kc.getKeyframeOrder(s);s=kc.sortedArray(s,1,l),u=kc.sortedArray(u,1,l),n||0!==s[0]||(s.push(i),u.push(u[0])),o.push(new Wc(".morphTargetInfluences["+e[a].name+"]",s,u).scale(1/r))}return new Zc(t,-1,o)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var n=t;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===e)return r[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],u=s.name.match(i);if(u&&u.length>1){var l=n[h=u[1]];l||(n[h]=l=[]),l.push(s)}}var c=[];for(var h in n)c.push(Zc.CreateFromMorphTargetSequence(h,n[h],e,r));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var o=[],a=[];kc.flattenJSON(r,o,a,n),0!==o.length&&i.push(new t(e,o,a))}},n=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],u=0;u<s.length;u++){var l=s[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},h=0;h<l.length;h++)if(l[h].morphTargets)for(var p=0;p<l[h].morphTargets.length;p++)c[l[h].morphTargets[p]]=-1;for(var d in c){var f=[],m=[];for(p=0;p!==l[h].morphTargets.length;++p){var g=l[h];f.push(g.time),m.push(g.morphTarget===d?1:0)}n.push(new Wc(".morphTargetInfluence["+d+"]",f,m))}o=c.length*(a||1)}else{var v=".bones["+e[u].name+"]";r(Qc,v+".position",l,"pos",n),r(qc,v+".quaternion",l,"rot",n),r(Qc,v+".scale",l,"scl",n)}}return 0===n.length?null:new Zc(i,o,n)}}),Object.assign(Zc.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Zc(this.name,this.duration,t)}});var Kc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function th(t,e,r){var n=this,i=!1,o=0,a=0,s=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){a++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return u.push(t,e),this},this.removeHandler=function(t){var e=u.indexOf(t);return-1!==e&&u.splice(e,2),this},this.getHandler=function(t){for(var e=0,r=u.length;e<r;e+=2){var n=u[e],i=u[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}var eh=new th;function rh(t){this.manager=void 0!==t?t:eh,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(rh.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var nh={};function ih(t){rh.call(this,t)}function oh(t){rh.call(this,t)}function ah(t){rh.call(this,t)}function sh(t){rh.call(this,t)}function uh(t){rh.call(this,t)}function lh(t){rh.call(this,t)}function ch(t){rh.call(this,t)}function hh(){this.type="Curve",this.arcLengthDivisions=200}function ph(t,e,r,n,i,o,a,s){hh.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function dh(t,e,r,n,i,o){ph.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function fh(){var t=0,e=0,r=0,n=0;function i(i,o,a,s){t=i,e=a,r=-3*i+3*o-2*a-s,n=2*i-2*o+a+s}return{initCatmullRom:function(t,e,r,n,o){i(e,r,o*(r-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,o,a,s){var u=(e-t)/o-(r-t)/(o+a)+(r-e)/a,l=(r-e)/a-(n-e)/(a+s)+(n-r)/s;i(e,r,u*=a,l*=a)},calc:function(i){var o=i*i;return t+e*i+r*o+n*(o*i)}}}ih.prototype=Object.assign(Object.create(rh.prototype),{constructor:ih,load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Kc.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===nh[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],u=!!a[2],l=a[3];l=decodeURIComponent(l),u&&(l=atob(l));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(l.length),d=0;d<l.length;d++)p[d]=l.charCodeAt(d);c="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;c=f.parseFromString(l,s);break;case"json":c=JSON.parse(l);break;default:c=l}setTimeout((function(){e&&e(c),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{nh[t]=[],nh[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var g in m.open("GET",t,!0),m.addEventListener("load",(function(e){var r=this.response,n=nh[t];if(delete nh[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Kc.add(t,r);for(var o=0,a=n.length;o<a;o++){(s=n[o]).onLoad&&s.onLoad(r)}i.manager.itemEnd(t)}else{for(o=0,a=n.length;o<a;o++){var s;(s=n[o]).onError&&s.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),m.addEventListener("progress",(function(e){for(var r=nh[t],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(e)}}),!1),m.addEventListener("error",(function(e){var r=nh[t];delete nh[t];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),m.addEventListener("abort",(function(e){var r=nh[t];delete nh[t];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return i.manager.itemStart(t),m}nh[t].push({onLoad:e,onProgress:r,onError:n})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),oh.prototype=Object.assign(Object.create(rh.prototype),{constructor:oh,load:function(t,e,r,n){var i=this,o=new ih(i.manager);o.setPath(i.path),o.load(t,(function(t){e(i.parse(JSON.parse(t)))}),r,n)},parse:function(t){for(var e=[],r=0;r<t.length;r++){var n=Zc.parse(t[r]);e.push(n)}return e}}),ah.prototype=Object.assign(Object.create(rh.prototype),{constructor:ah,load:function(t,e,r,n){var i=this,o=[],a=new hl;a.image=o;var s=new ih(this.manager);function u(u){s.load(t[u],(function(t){var r=i.parse(t,!0);o[u]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(l+=1)&&(1===r.mipmapCount&&(a.minFilter=1006),a.format=r.format,a.needsUpdate=!0,e&&e(a))}),r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var l=0,c=0,h=t.length;c<h;++c)u(c);else s.load(t,(function(t){var r=i.parse(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){o[s]={mipmaps:[]};for(var u=0;u<r.mipmapCount;u++)o[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+u]),o[s].format=r.format,o[s].width=r.width,o[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=1006),a.format=r.format,a.needsUpdate=!0,e&&e(a)}),r,n);return a}}),sh.prototype=Object.assign(Object.create(rh.prototype),{constructor:sh,load:function(t,e,r,n){var i=this,o=new na,a=new ih(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,(function(t){var r=i.parse(t);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:1001,o.wrapT=void 0!==r.wrapT?r.wrapT:1001,o.magFilter=void 0!==r.magFilter?r.magFilter:1006,o.minFilter=void 0!==r.minFilter?r.minFilter:1006,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps,o.minFilter=1008),1===r.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,e&&e(o,r))}),r,n),o}}),uh.prototype=Object.assign(Object.create(rh.prototype),{constructor:uh,load:function(t,e,r,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Kc.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),Kc.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",u,!1),n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",u,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}),lh.prototype=Object.assign(Object.create(rh.prototype),{constructor:lh,load:function(t,e,r,n){var i=new Sa,o=new uh(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(r){o.load(t[r],(function(t){i.images[r]=t,6===++a&&(i.needsUpdate=!0,e&&e(i))}),void 0,n)}for(var u=0;u<t.length;++u)s(u);return i}}),ch.prototype=Object.assign(Object.create(rh.prototype),{constructor:ch,load:function(t,e,r,n){var i=new Pn,o=new uh(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(r){i.image=r;var n=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?1022:1023,i.needsUpdate=!0,void 0!==e&&e(i)}),r,n),i}}),Object.assign(hh.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=t;r++)o+=(e=this.getPoint(r/t)).distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e||t*n[o-1];for(var a,s=0,u=o-1;s<=u;)if((a=n[i=Math.floor(s+(u-s)/2)]-r)<0)s=i+1;else{if(!(a>0)){u=i;break}u=i-1}if(n[i=u]===r)return i/(o-1);var l=n[i];return(i+(r-l)/(n[i+1]-l))/(o-1)},getTangent:function(t){var e=1e-4,r=t-e,n=t+e;r<0&&(r=0),n>1&&(n=1);var i=this.getPoint(r);return this.getPoint(n).clone().sub(i).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,n,i,o=new _n,a=[],s=[],u=[],l=new _n,c=new kn;for(r=0;r<=t;r++)n=r/t,a[r]=this.getTangentAt(n),a[r].normalize();s[0]=new _n,u[0]=new _n;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),d=Math.abs(a[0].y),f=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),d<=h&&(h=d,o.set(0,1,0)),f<=h&&o.set(0,0,1),l.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],l),u[0].crossVectors(a[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),u[r]=u[r-1].clone(),l.crossVectors(a[r-1],a[r]),l.length()>Number.EPSILON&&(l.normalize(),i=Math.acos(gn.clamp(a[r-1].dot(a[r]),-1,1)),s[r].applyMatrix4(c.makeRotationAxis(l,i))),u[r].crossVectors(a[r],s[r]);if(!0===e)for(i=Math.acos(gn.clamp(s[0].dot(s[t]),-1,1)),i/=t,a[0].dot(l.crossVectors(s[0],s[t]))>0&&(i=-i),r=1;r<=t;r++)s[r].applyMatrix4(c.makeRotationAxis(a[r],i*r)),u[r].crossVectors(a[r],s[r]);return{tangents:a,normals:s,binormals:u}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),ph.prototype=Object.create(hh.prototype),ph.prototype.constructor=ph,ph.prototype.isEllipseCurve=!0,ph.prototype.getPoint=function(t,e){for(var r=e||new vn,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,p=u-this.aY;s=h*l-p*c+this.aX,u=h*c+p*l+this.aY}return r.set(s,u)},ph.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ph.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},ph.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},dh.prototype=Object.create(ph.prototype),dh.prototype.constructor=dh,dh.prototype.isArcCurve=!0;var mh=new _n,gh=new fh,vh=new fh,yh=new fh;function xh(t,e,r,n){hh.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function bh(t,e,r,n,i){var o=.5*(n-e),a=.5*(i-r),s=t*t;return(2*r-2*n+o+a)*(t*s)+(-3*r+3*n-2*o-a)*s+o*t+r}function _h(t,e,r,n){return function(t,e){var r=1-t;return r*r*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,r)+function(t,e){return t*t*e}(t,n)}function wh(t,e,r,n,i){return function(t,e){var r=1-t;return r*r*r*e}(t,e)+function(t,e){var r=1-t;return 3*r*r*t*e}(t,r)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,i)}function Th(t,e,r,n){hh.call(this),this.type="CubicBezierCurve",this.v0=t||new vn,this.v1=e||new vn,this.v2=r||new vn,this.v3=n||new vn}function Eh(t,e,r,n){hh.call(this),this.type="CubicBezierCurve3",this.v0=t||new _n,this.v1=e||new _n,this.v2=r||new _n,this.v3=n||new _n}function Sh(t,e){hh.call(this),this.type="LineCurve",this.v1=t||new vn,this.v2=e||new vn}function Ah(t,e){hh.call(this),this.type="LineCurve3",this.v1=t||new _n,this.v2=e||new _n}function Ph(t,e,r){hh.call(this),this.type="QuadraticBezierCurve",this.v0=t||new vn,this.v1=e||new vn,this.v2=r||new vn}function Mh(t,e,r){hh.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new _n,this.v1=e||new _n,this.v2=r||new _n}function Ih(t){hh.call(this),this.type="SplineCurve",this.points=t||[]}xh.prototype=Object.create(hh.prototype),xh.prototype.constructor=xh,xh.prototype.isCatmullRomCurve3=!0,xh.prototype.getPoint=function(t,e){var r,n,i,o,a=e||new _n,s=this.points,u=s.length,l=(u-(this.closed?0:1))*t,c=Math.floor(l),h=l-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/u)+1)*u:0===h&&c===u-1&&(c=u-2,h=1),this.closed||c>0?r=s[(c-1)%u]:(mh.subVectors(s[0],s[1]).add(s[0]),r=mh),n=s[c%u],i=s[(c+1)%u],this.closed||c+2<u?o=s[(c+2)%u]:(mh.subVectors(s[u-1],s[u-2]).add(s[u-1]),o=mh),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(r.distanceToSquared(n),p),f=Math.pow(n.distanceToSquared(i),p),m=Math.pow(i.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),gh.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,d,f,m),vh.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,d,f,m),yh.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(gh.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),vh.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),yh.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return a.set(gh.calc(h),vh.calc(h),yh.calc(h)),a},xh.prototype.copy=function(t){hh.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},xh.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},xh.prototype.fromJSON=function(t){hh.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new _n).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Th.prototype=Object.create(hh.prototype),Th.prototype.constructor=Th,Th.prototype.isCubicBezierCurve=!0,Th.prototype.getPoint=function(t,e){var r=e||new vn,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(wh(t,n.x,i.x,o.x,a.x),wh(t,n.y,i.y,o.y,a.y)),r},Th.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Th.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Th.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Eh.prototype=Object.create(hh.prototype),Eh.prototype.constructor=Eh,Eh.prototype.isCubicBezierCurve3=!0,Eh.prototype.getPoint=function(t,e){var r=e||new _n,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(wh(t,n.x,i.x,o.x,a.x),wh(t,n.y,i.y,o.y,a.y),wh(t,n.z,i.z,o.z,a.z)),r},Eh.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Eh.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Eh.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Sh.prototype=Object.create(hh.prototype),Sh.prototype.constructor=Sh,Sh.prototype.isLineCurve=!0,Sh.prototype.getPoint=function(t,e){var r=e||new vn;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},Sh.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Sh.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Sh.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Sh.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Sh.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ah.prototype=Object.create(hh.prototype),Ah.prototype.constructor=Ah,Ah.prototype.isLineCurve3=!0,Ah.prototype.getPoint=function(t,e){var r=e||new _n;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},Ah.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Ah.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ah.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ah.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ph.prototype=Object.create(hh.prototype),Ph.prototype.constructor=Ph,Ph.prototype.isQuadraticBezierCurve=!0,Ph.prototype.getPoint=function(t,e){var r=e||new vn,n=this.v0,i=this.v1,o=this.v2;return r.set(_h(t,n.x,i.x,o.x),_h(t,n.y,i.y,o.y)),r},Ph.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ph.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ph.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Mh.prototype=Object.create(hh.prototype),Mh.prototype.constructor=Mh,Mh.prototype.isQuadraticBezierCurve3=!0,Mh.prototype.getPoint=function(t,e){var r=e||new _n,n=this.v0,i=this.v1,o=this.v2;return r.set(_h(t,n.x,i.x,o.x),_h(t,n.y,i.y,o.y),_h(t,n.z,i.z,o.z)),r},Mh.prototype.copy=function(t){return hh.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Mh.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Mh.prototype.fromJSON=function(t){return hh.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ih.prototype=Object.create(hh.prototype),Ih.prototype.constructor=Ih,Ih.prototype.isSplineCurve=!0,Ih.prototype.getPoint=function(t,e){var r=e||new vn,n=this.points,i=(n.length-1)*t,o=Math.floor(i),a=i-o,s=n[0===o?o:o-1],u=n[o],l=n[o>n.length-2?n.length-1:o+1],c=n[o>n.length-3?n.length-1:o+2];return r.set(bh(a,s.x,u.x,l.x,c.x),bh(a,s.y,u.y,l.y,c.y)),r},Ih.prototype.copy=function(t){hh.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(n.clone())}return this},Ih.prototype.toJSON=function(){var t=hh.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var n=this.points[e];t.points.push(n.toArray())}return t},Ih.prototype.fromJSON=function(t){hh.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new vn).fromArray(n))}return this};var Oh=Object.freeze({__proto__:null,ArcCurve:dh,CatmullRomCurve3:xh,CubicBezierCurve:Th,CubicBezierCurve3:Eh,EllipseCurve:ph,LineCurve:Sh,LineCurve3:Ah,QuadraticBezierCurve:Ph,QuadraticBezierCurve3:Mh,SplineCurve:Ih});function Ch(){hh.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Rh(t){Ch.call(this),this.type="Path",this.currentPoint=new vn,t&&this.setFromPoints(t)}function Lh(t){Rh.call(this,t),this.uuid=gn.generateUUID(),this.type="Shape",this.holes=[]}function Nh(t,e){ri.call(this),this.type="Light",this.color=new Yi(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Fh(t,e,r){Nh.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ri.DefaultUp),this.updateMatrix(),this.groundColor=new Yi(e)}function Dh(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new vn(512,512),this.map=null,this.mapPass=null,this.matrix=new kn,this._frustum=new aa,this._frameExtents=new vn(1,1),this._viewportCount=1,this._viewports=[new Mn(0,0,1,1)]}function Uh(){Dh.call(this,new ta(50,1,.5,500))}function kh(t,e,r,n,i,o){Nh.call(this,t,e),this.type="SpotLight",this.position.copy(ri.DefaultUp),this.updateMatrix(),this.target=new ri,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Uh}function jh(){Dh.call(this,new ta(90,1,.5,500)),this._frameExtents=new vn(4,2),this._viewportCount=6,this._viewports=[new Mn(2,1,1,1),new Mn(0,1,1,1),new Mn(3,1,1,1),new Mn(1,1,1,1),new Mn(3,0,1,1),new Mn(1,0,1,1)],this._cubeDirections=[new _n(1,0,0),new _n(-1,0,0),new _n(0,0,1),new _n(0,0,-1),new _n(0,1,0),new _n(0,-1,0)],this._cubeUps=[new _n(0,1,0),new _n(0,1,0),new _n(0,1,0),new _n(0,1,0),new _n(0,0,1),new _n(0,0,-1)]}function Bh(t,e,r,n){Nh.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new jh}function zh(t,e,r,n,i,o){Ko.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Gh(){Dh.call(this,new zh(-5,5,5,-5,.5,500))}function Vh(t,e){Nh.call(this,t,e),this.type="DirectionalLight",this.position.copy(ri.DefaultUp),this.updateMatrix(),this.target=new ri,this.shadow=new Gh}function Hh(t,e){Nh.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Xh(t,e,r,n){Nh.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function Wh(t){rh.call(this,t),this.textures={}}Ch.prototype=Object.assign(Object.create(hh.prototype),{constructor:Ch,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Sh(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,o=this.curves[n],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),u=0;u<s.length;u++){var l=s[u];e&&e.equals(l)||(r.push(l),e=l)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){hh.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=hh.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++){var n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){hh.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new Oh[n.type]).fromJSON(n))}return this}}),Rh.prototype=Object.assign(Object.create(Ch.prototype),{constructor:Rh,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new Sh(this.currentPoint.clone(),new vn(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,n){var i=new Ph(this.currentPoint.clone(),new vn(t,e),new vn(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this},bezierCurveTo:function(t,e,r,n,i,o){var a=new Th(this.currentPoint.clone(),new vn(t,e),new vn(r,n),new vn(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(t){var e=new Ih([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,r,n,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,r,n,i,o),this},absarc:function(t,e,r,n,i,o){return this.absellipse(t,e,r,r,n,i,o),this},ellipse:function(t,e,r,n,i,o,a,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+u,e+l,r,n,i,o,a,s),this},absellipse:function(t,e,r,n,i,o,a,s){var u=new ph(t,e,r,n,i,o,a,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return Ch.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=Ch.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Ch.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Lh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Lh,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Rh.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){var t=Rh.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++){var n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){Rh.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new Rh).fromJSON(n))}return this}}),Nh.prototype=Object.assign(Object.create(ri.prototype),{constructor:Nh,isLight:!0,copy:function(t){return ri.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=ri.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Fh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Fh,isHemisphereLight:!0,copy:function(t){return Nh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Dh.prototype,{_projScreenMatrix:new kn,_lightPositionWorld:new _n,_lookTarget:new _n,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(e.projectionMatrix),r.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Uh.prototype=Object.assign(Object.create(Dh.prototype),{constructor:Uh,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,r=2*gn.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix()),Dh.prototype.updateMatrices.call(this,t)}}),kh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:kh,isSpotLight:!0,copy:function(t){return Nh.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),jh.prototype=Object.assign(Object.create(Dh.prototype),{constructor:jh,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var r=this.camera,n=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),r.position.copy(i),o.copy(r.position),o.add(this._cubeDirections[e]),r.up.copy(this._cubeUps[e]),r.lookAt(o),r.updateMatrixWorld(),n.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromMatrix(a)}}),Bh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Bh,isPointLight:!0,copy:function(t){return Nh.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),zh.prototype=Object.assign(Object.create(Ko.prototype),{constructor:zh,isOrthographicCamera:!0,copy:function(t,e){return Ko.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,o=r+t,a=n+e,s=n-e;if(null!==this.view&&this.view.enabled){var u=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;o=(i+=c*(this.view.offsetX/u))+c*(this.view.width/u),s=(a-=h*(this.view.offsetY/l))-h*(this.view.height/l)}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=ri.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Gh.prototype=Object.assign(Object.create(Dh.prototype),{constructor:Gh,isDirectionalLightShadow:!0,updateMatrices:function(t){Dh.prototype.updateMatrices.call(this,t)}}),Vh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Vh,isDirectionalLight:!0,copy:function(t){return Nh.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Hh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Hh,isAmbientLight:!0}),Xh.prototype=Object.assign(Object.create(Nh.prototype),{constructor:Xh,isRectAreaLight:!0,copy:function(t){return Nh.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Nh.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Wh.prototype=Object.assign(Object.create(rh.prototype),{constructor:Wh,load:function(t,e,r,n){var i=this,o=new ih(i.manager);o.setPath(i.path),o.load(t,(function(t){e(i.parse(JSON.parse(t)))}),r,n)},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new Uc[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new Yi).setHex(t.sheen)),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.uniforms)for(var i in t.uniforms){var o=t.uniforms[i];switch(n.uniforms[i]={},o.type){case"t":n.uniforms[i].value=r(o.value);break;case"c":n.uniforms[i].value=(new Yi).setHex(o.value);break;case"v2":n.uniforms[i].value=(new vn).fromArray(o.value);break;case"v3":n.uniforms[i].value=(new _n).fromArray(o.value);break;case"v4":n.uniforms[i].value=(new Mn).fromArray(o.value);break;case"m3":n.uniforms[i].value=(new En).fromArray(o.value);case"m4":n.uniforms[i].value=(new kn).fromArray(o.value);break;default:n.uniforms[i].value=o.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)n.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.matcap&&(n.matcap=r(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new vn).fromArray(s)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new vn).fromArray(t.clearcoatNormalScale)),n},setTextures:function(t){return this.textures=t,this}});var Yh=function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};function qh(){_o.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function $h(t,e,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),eo.call(this,t,e,r),this.meshPerAttribute=n||1}function Qh(t){rh.call(this,t)}qh.prototype=Object.assign(Object.create(_o.prototype),{constructor:qh,isInstancedBufferGeometry:!0,copy:function(t){return _o.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=_o.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}}),$h.prototype=Object.assign(Object.create(eo.prototype),{constructor:$h,isInstancedBufferAttribute:!0,copy:function(t){return eo.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=eo.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Qh.prototype=Object.assign(Object.create(rh.prototype),{constructor:Qh,load:function(t,e,r,n){var i=this,o=new ih(i.manager);o.setPath(i.path),o.load(t,(function(t){e(i.parse(JSON.parse(t)))}),r,n)},parse:function(t){var e=t.isInstancedBufferGeometry?new qh:new _o,r=t.data.index;if(void 0!==r){var n=new Zh[r.type](r.array);e.setIndex(new eo(n,1))}var i=t.data.attributes;for(var o in i){var a=i[o],s=(n=new Zh[a.type](a.array),new(a.isInstancedBufferAttribute?$h:eo)(n,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),e.setAttribute(o,s)}var u=t.data.morphAttributes;if(u)for(var o in u){for(var l=u[o],c=[],h=0,p=l.length;h<p;h++){a=l[h],s=new eo(n=new Zh[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),c.push(s)}e.morphAttributes[o]=c}t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);var d=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==d){h=0;for(var f=d.length;h!==f;++h){var m=d[h];e.addGroup(m.start,m.count,m.materialIndex)}}var g=t.data.boundingSphere;if(void 0!==g){var v=new _n;void 0!==g.center&&v.fromArray(g.center),e.boundingSphere=new bi(v,g.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var Zh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Jh(t){rh.call(this,t)}Jh.prototype=Object.assign(Object.create(rh.prototype),{constructor:Jh,load:function(t,e,r,n){var i=this,o=""===this.path?Yh(t):this.path;this.resourcePath=this.resourcePath||o;var a=new ih(i.manager);a.setPath(this.path),a.load(t,(function(r){var o=null;try{o=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),r,n)},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,(function(){void 0!==e&&e(s)})),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,n,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new Lh).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new Qh,i=0,o=t.length;i<o;i++){var a,s=t[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Ac[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Ac[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Ac[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Ac[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Ac[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Ac[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Ac[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Ac[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Ac[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Ac[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Ac[s.type]((new Oh[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Ac[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Ac[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],l=0,c=s.shapes.length;l<c;l++){var h=e[s.shapes[l]];u.push(h)}a=new Ac[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],l=0,c=s.shapes.length;l<c;l++){h=e[s.shapes[l]];u.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new Oh[p.type]).fromJSON(p)),a=new Ac[s.type](u,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}return r},parseMaterials:function(t,e){var r={},n={};if(void 0!==t){var i=new Wh;i.setTextures(e);for(var o=0,a=t.length;o<a;o++){var s=t[o];if("MultiMaterial"===s.type){for(var u=[],l=0;l<s.materials.length;l++){var c=s.materials[l];void 0===r[c.uuid]&&(r[c.uuid]=i.parse(c)),u.push(r[c.uuid])}n[s.uuid]=u}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r],i=Zc.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),e.push(i)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),o.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){var o=new uh(new th(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var u=t[a],l=u.url;if(Array.isArray(l)){n[u.uuid]=[];for(var c=0,h=l.length;c<h;c++){var p=l[c],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:r.resourcePath+p;n[u.uuid].push(i(d))}}else{d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.resourcePath+u.url;n[u.uuid]=i(d)}}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a,s=t[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(e[s.image])?new Sa(e[s.image]):new Pn(e[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,tp)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],ep),a.wrapT=r(s.wrap[1],ep)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,rp)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,rp)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),n[s.uuid]=a}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(r[o])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new ni,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Yi(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new mu(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new fu(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new ta(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new zh(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new Hh(t.color,t.intensity);break;case"DirectionalLight":n=new Vh(t.color,t.intensity);break;case"PointLight":n=new Bh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new Xh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new kh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new Fh(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=i(t.geometry),s=o(t.material);n=a.bones&&a.bones.length>0?new Du(a,s):new jo(a,s);break;case"InstancedMesh":a=i(t.geometry),s=o(t.material);var u=t.count,l=t.instanceMatrix;(n=new Xu(a,s,u)).instanceMatrix=new eo(new Float32Array(l.array),16);break;case"LOD":n=new Fu;break;case"Line":n=new Ju(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new rl(i(t.geometry),o(t.material));break;case"LineSegments":n=new el(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new ul(i(t.geometry),o(t.material));break;case"Sprite":n=new Cu(o(t.material));break;case"Group":n=new ou;break;default:n=new ri}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.layers&&(n.layers.mask=t.layers),void 0!==t.drawMode&&n.setDrawMode(t.drawMode),void 0!==t.children)for(var c=t.children,h=0;h<c.length;h++)n.add(this.parseObject(c[h],e,r));if("LOD"===t.type){void 0!==t.autoUpdate&&(n.autoUpdate=t.autoUpdate);for(var p=t.levels,d=0;d<p.length;d++){var f=p[d],m=n.getObjectByProperty("uuid",f.object);void 0!==m&&n.addLevel(m,f.distance)}}return n}});var Kh,tp={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},ep={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},rp={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};function np(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),rh.call(this,t),this.options=void 0}function ip(){this.type="ShapePath",this.color=new Yi,this.subPaths=[],this.currentPath=null}function op(t){this.type="Font",this.data=t}function ap(t,e,r,n,i){var o=i.glyphs[t]||i.glyphs["?"];if(o){var a,s,u,l,c,h,p,d,f=new ip;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*e+r,s=m[g++]*e+n,f.moveTo(a,s);break;case"l":a=m[g++]*e+r,s=m[g++]*e+n,f.lineTo(a,s);break;case"q":u=m[g++]*e+r,l=m[g++]*e+n,c=m[g++]*e+r,h=m[g++]*e+n,f.quadraticCurveTo(c,h,u,l);break;case"b":u=m[g++]*e+r,l=m[g++]*e+n,c=m[g++]*e+r,h=m[g++]*e+n,p=m[g++]*e+r,d=m[g++]*e+n,f.bezierCurveTo(c,h,p,d,u,l)}}return{offsetX:o.ha*e,path:f}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".")}function sp(t){rh.call(this,t)}np.prototype=Object.assign(Object.create(rh.prototype),{constructor:np,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Kc.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===i.options?createImageBitmap(t):createImageBitmap(t,i.options)})).then((function(r){Kc.add(t,r),e&&e(r),i.manager.itemEnd(t)})).catch((function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(ip.prototype,{moveTo:function(t,e){return this.currentPath=new Rh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,r,n){return this.currentPath.quadraticCurveTo(t,e,r,n),this},bezierCurveTo:function(t,e,r,n,i,o){return this.currentPath.bezierCurveTo(t,e,r,n,i,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new Lh;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=e[i],s=e[o],u=s.x-a.x,l=s.y-a.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(a=e[o],u=-u,s=e[i],l=-l),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var c=l*(t.x-a.x)-u*(t.y-a.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return n}var i=ec.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);var a,s,u,l=[];if(1===o.length)return s=o[0],(u=new Lh).curves=s.curves,l.push(u),l;var c=!i(o[0].getPoints());c=t?!c:c;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=i(h=(s=o[v]).getPoints()),(a=t?!a:a)?(!c&&f[g]&&g++,f[g]={s:new Lh,p:h},f[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var x=!1,b=[],_=0,w=f.length;_<w;_++)d[_]=[];for(_=0,w=f.length;_<w;_++)for(var T=m[_],E=0;E<T.length;E++){for(var S=T[E],A=!0,P=0;P<f.length;P++)n(S.p,f[P].p)&&(_!==P&&b.push({froms:_,tos:P,hole:E}),A?(A=!1,d[P].push(S)):x=!0);A&&d[_].push(S)}b.length>0&&(x||(m=d))}v=0;for(var M=f.length;v<M;v++){u=f[v].s,l.push(u);for(var I=0,O=(p=m[v]).length;I<O;I++)u.holes.push(p[I].h)}return l}}),Object.assign(op.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);for(var r=[],n=function(t,e,r){for(var n=Array.from?Array.from(t):String(t).split(""),i=e/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,a=[],s=0,u=0,l=0;l<n.length;l++){var c=n[l];if("\n"===c)s=0,u-=o;else{var h=ap(c,i,s,u,r);s+=h.offsetX,a.push(h.path)}}return a}(t,e,this.data),i=0,o=n.length;i<o;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),sp.prototype=Object.assign(Object.create(rh.prototype),{constructor:sp,load:function(t,e,r,n){var i=this,o=new ih(this.manager);o.setPath(this.path),o.load(t,(function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)}),r,n)},parse:function(t){return new op(t)}});var up=function(){return void 0===Kh&&(Kh=new(window.AudioContext||window.webkitAudioContext)),Kh};function lp(t){rh.call(this,t)}function cp(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new _n)}function hp(t,e){Nh.call(this,void 0,e),this.sh=void 0!==t?t:new cp}function pp(t,e,r){hp.call(this,void 0,r);var n=(new Yi).set(t),i=(new Yi).set(e),o=new _n(n.r,n.g,n.b),a=new _n(i.r,i.g,i.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(u)}function dp(t,e){hp.call(this,void 0,e);var r=(new Yi).set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}lp.prototype=Object.assign(Object.create(rh.prototype),{constructor:lp,load:function(t,e,r,n){var i=new ih(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(t,(function(t){var r=t.slice(0);up().decodeAudioData(r,(function(t){e(t)}))}),r,n)}}),Object.assign(cp.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var r=t.x,n=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScale(o[1],.488603*n),e.addScale(o[2],.488603*i),e.addScale(o[3],.488603*r),e.addScale(o[4],r*n*1.092548),e.addScale(o[5],n*i*1.092548),e.addScale(o[6],.315392*(3*i*i-1)),e.addScale(o[7],r*i*1.092548),e.addScale(o[8],.546274*(r*r-n*n)),e},getIrradianceAt:function(t,e){var r=t.x,n=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScale(o[1],1.023328*n),e.addScale(o[2],1.023328*i),e.addScale(o[3],1.023328*r),e.addScale(o[4],.858086*r*n),e.addScale(o[5],.858086*n*i),e.addScale(o[6],.743125*i*i-.247708),e.addScale(o[7],.858086*r*i),e.addScale(o[8],.429043*(r*r-n*n)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(t,e+3*n);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(t,e+3*n);return t}}),Object.assign(cp,{getBasisAt:function(t,e){var r=t.x,n=t.y,i=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*i,e[3]=.488603*r,e[4]=1.092548*r*n,e[5]=1.092548*n*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*r*i,e[8]=.546274*(r*r-n*n)}}),hp.prototype=Object.assign(Object.create(Nh.prototype),{constructor:hp,isLightProbe:!0,copy:function(t){return Nh.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){return Nh.prototype.toJSON.call(this,t)}}),pp.prototype=Object.assign(Object.create(hp.prototype),{constructor:pp,isHemisphereLightProbe:!0,copy:function(t){return hp.prototype.copy.call(this,t),this},toJSON:function(t){return hp.prototype.toJSON.call(this,t)}}),dp.prototype=Object.assign(Object.create(hp.prototype),{constructor:dp,isAmbientLightProbe:!0,copy:function(t){return hp.prototype.copy.call(this,t),this},toJSON:function(t){return hp.prototype.toJSON.call(this,t)}});var fp=new kn,mp=new kn;function gp(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ta,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ta,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var r,n,i=t.projectionMatrix.clone(),o=e.eyeSep/2,a=o*e.near/e.focus,s=e.near*Math.tan(gn.DEG2RAD*e.fov*.5)/e.zoom;mp.elements[12]=-o,fp.elements[12]=o,r=-s*e.aspect+a,n=s*e.aspect+a,i.elements[0]=2*e.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(i),r=-s*e.aspect-a,n=s*e.aspect-a,i.elements[0]=2*e.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(mp),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(fp)}}),Object.assign(gp.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var vp=new _n,yp=new yn,xp=new _n,bp=new _n;function _p(){ri.call(this),this.type="AudioListener",this.context=up(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new gp}function wp(t){ri.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}_p.prototype=Object.assign(Object.create(ri.prototype),{constructor:_p,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){ri.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(vp,yp,xp),bp.set(0,0,-1).applyQuaternion(yp),e.positionX){var n=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(vp.x,n),e.positionY.linearRampToValueAtTime(vp.y,n),e.positionZ.linearRampToValueAtTime(vp.z,n),e.forwardX.linearRampToValueAtTime(bp.x,n),e.forwardY.linearRampToValueAtTime(bp.y,n),e.forwardZ.linearRampToValueAtTime(bp.z,n),e.upX.linearRampToValueAtTime(r.x,n),e.upY.linearRampToValueAtTime(r.y,n),e.upZ.linearRampToValueAtTime(r.z,n)}else e.setPosition(vp.x,vp.y,vp.z),e.setOrientation(bp.x,bp.y,bp.z,r.x,r.y,r.z)}}),wp.prototype=Object.assign(Object.create(ri.prototype),{constructor:wp,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var Tp=new _n,Ep=new yn,Sp=new _n,Ap=new _n;function Pp(t){wp.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Mp(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Ip(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Pp.prototype=Object.assign(Object.create(wp.prototype),{constructor:Pp,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(t){if(ri.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Tp,Ep,Sp),Ap.set(0,0,1).applyQuaternion(Ep);var e=this.panner;if(e.positionX){var r=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Tp.x,r),e.positionY.linearRampToValueAtTime(Tp.y,r),e.positionZ.linearRampToValueAtTime(Tp.z,r),e.orientationX.linearRampToValueAtTime(Ap.x,r),e.orientationY.linearRampToValueAtTime(Ap.y,r),e.orientationZ.linearRampToValueAtTime(Ap.z,r)}else e.setPosition(Tp.x,Tp.y,Tp.z),e.setOrientation(Ap.x,Ap.y,Ap.z)}}}),Object.assign(Mp.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(Ip.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)r[i+a]=r[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=o},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*e;this._mixBufferRegion(r,n,a,1-i,e)}for(var s=e,u=e+e;s!==u;++s)if(r[s]!==r[s+e]){o.setValue(r,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,n=3*r;t.getValue(e,n);for(var i=r,o=n;i!==o;++i)e[i]=e[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)t[e+o]=t[r+o]},_slerp:function(t,e,r,n){yn.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[r+a]*n}}});var Op=new RegExp("[\\[\\]\\.:\\/]","g"),Cp="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Rp=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Lp=/(WCOD+)?/.source.replace("WCOD",Cp),Np=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Dp=new RegExp("^"+Rp+Lp+Np+Fp+"$"),Up=["material","materials","bones"];function kp(t,e,r){var n=r||jp.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function jp(t,e,r){this.path=e,this.parsedPath=r||jp.parseTrackName(e),this.node=jp.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Bp(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var n=e.tracks,i=n.length,o=new Array(i),a={endingStart:2400,endingEnd:2400},s=0;s!==i;++s){var u=n[s].createInterpolant(null);o[s]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function zp(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Gp(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Vp(t,e,r){gu.call(this,t,e),this.meshPerAttribute=r||1}function Hp(t,e,r,n){this.ray=new Mi(t,e),this.near=r||0,this.far=n||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Xp(t,e){return t.distance-e.distance}function Wp(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n))for(var i=t.children,o=0,a=i.length;o<a;o++)Wp(i[o],e,r,!0)}function Yp(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}Object.assign(kp.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(jp,{Composite:kp,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new jp.Composite(t,e,r):new jp(t,e,r)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Op,"")},parseTrackName:function(t){var e=Dp.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==Up.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r},findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var o=n(i.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(jp.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=jp.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[n];if(void 0!==s){var u=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(jp.prototype,{_getValue_unbound:jp.prototype.getValue,_setValue_unbound:jp.prototype.setValue}),Object.assign(function(){this.uuid=gn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,u=void 0,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],p=h.uuid,d=n[p];if(void 0===d){d=e++,n[p]=d,t.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new jp(h,i[f],o[f]))}else if(d<r){u=t[d];var g=--r,v=t[g];n[v.uuid]=d,t[d]=v,n[p]=g,t[g]=h;for(f=0,m=s;f!==m;++f){var y=a[f],x=y[g],b=y[d];y[d]=x,void 0===b&&(b=new jp(h,i[f],o[f])),y[g]=b}}else t[d]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],u=s.uuid,l=r[u];if(void 0!==l&&l>=e){var c=e++,h=t[c];r[h.uuid]=l,t[l]=h,r[u]=c,t[c]=s;for(var p=0,d=i;p!==d;++p){var f=n[p],m=f[c],g=f[l];f[l]=m,f[c]=g}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var u=arguments[a],l=u.uuid,c=n[l];if(void 0!==c)if(delete n[l],c<r){var h=--r,p=t[h],d=t[y=--e];n[p.uuid]=c,t[c]=p,n[d.uuid]=h,t[h]=d,t.pop();for(var f=0,m=o;f!==m;++f){var g=(x=i[f])[h],v=x[y];x[c]=g,x[h]=v,x.pop()}}else{var y;n[(d=t[y=--e]).uuid]=c,t[c]=d,t.pop();for(f=0,m=o;f!==m;++f){var x;(x=i[f])[c]=x[y],x.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,u=s.length,l=this.nCachedObjects_,c=new Array(u);n=i.length,r[t]=n,o.push(t),a.push(e),i.push(c);for(var h=l,p=s.length;h!==p;++h){var d=s[h];c[h]=new jp(d,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=r,o[r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign(Bp.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,o=i/n,a=n/i;t.warp(1,o,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=i,s[1]=i+r,u[0]=t/a,u[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*r;if(o<0||0===r)return;this._startTime=null,e=r*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var u=this._interpolants,l=this._propertyBindings,c=0,h=u.length;c!==h;++c)u[c].evaluate(a),l[c].accumulate(n,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,n=this.loop,i=this._loopCount,o=2202===n;if(0===t)return-1===i?e:o&&1==(1&i)?r-e:e;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var a=Math.floor(e/r);e-=r*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var u=t<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=e;if(o&&1==(1&i))return r-e}return e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=r,this}}),zp.prototype=Object.assign(Object.create(dn.prototype),{constructor:zp,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings,a=t._interpolants,s=r.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==i;++c){var h=n[c],p=h.name,d=l[p];if(void 0!==d)o[c]=d;else{if(void 0!==(d=o[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=e&&e._propertyBindings[c].binding.parsedPath;++(d=new Ip(jp.create(r,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[c]=d}a[c].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,u=s[s.length-1],l=t._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(i={},n[e]=i),i[r]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=e[e.length-1],u=t._cacheIndex;s._cacheIndex=u,e[u]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[n]},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new zc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Zc.findByName(r,t):t,o=null!==i?i.uuid:t,a=this._actionsByClip[o],s=null;if(void 0!==a){var u=a.actionByRoot[n];if(void 0!==u)return u;s=a.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var l=new Bp(this,i,e);return this._bindAction(l,s),this._addInactiveAction(l,o,n),l},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Zc.findByName(r,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==r;++a){e[a]._update(n,t,i,o)}var s=this._bindings,u=this._nActiveBindings;for(a=0;a!==u;++a)s[a].apply(o);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var u=o[a];this._deactivateAction(u);var l=u._cacheIndex,c=e[e.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,e[l]=c,e.pop(),this._removeInactiveBindingsForAction(u)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Gp.prototype.clone=function(){return new Gp(void 0===this.value.clone?this.value:this.value.clone())},Vp.prototype=Object.assign(Object.create(gu.prototype),{constructor:Vp,isInstancedInterleavedBuffer:!0,copy:function(t){return gu.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Hp.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return Wp(t,this,n,e),n.sort(Xp),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=t.length;i<o;i++)Wp(t[i],this,n,e);return n.sort(Xp),n}}),Object.assign(Yp.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(gn.clamp(e/this.radius,-1,1))),this}}),Object.assign(function(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}});var qp=new vn;function $p(t,e){this.min=void 0!==t?t:new vn(1/0,1/0),this.max=void 0!==e?e:new vn(-1/0,-1/0)}Object.assign($p.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=qp.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new vn),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new vn),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new vn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new vn),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return qp.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Qp=new _n,Zp=new _n;function Jp(t,e){this.start=void 0!==t?t:new _n,this.end=void 0!==e?e:new _n}function Kp(t){ri.call(this),this.material=t,this.render=function(){}}Object.assign(Jp.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new _n),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new _n),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new _n),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){Qp.subVectors(t,this.start),Zp.subVectors(this.end,this.start);var r=Zp.dot(Zp),n=Zp.dot(Qp)/r;return e&&(n=gn.clamp(n,0,1)),n},closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new _n),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Kp.prototype=Object.create(ri.prototype),Kp.prototype.constructor=Kp,Kp.prototype.isImmediateRenderObject=!0;var td=new _n,ed=new _n,rd=new En,nd=["a","b","c"];function id(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16711680,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var u=new _o,l=new lo(2*a*3,3);u.setAttribute("position",l),el.call(this,u,new Wu({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}id.prototype=Object.create(el.prototype),id.prototype.constructor=id,id.prototype.update=function(){this.object.updateMatrixWorld(!0),rd.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,e=this.geometry.attributes.position,r=this.object.geometry;if(r&&r.isGeometry)for(var n=r.vertices,i=r.faces,o=0,a=0,s=i.length;a<s;a++)for(var u=i[a],l=0,c=u.vertexNormals.length;l<c;l++){var h=n[u[nd[l]]],p=u.vertexNormals[l];td.copy(h).applyMatrix4(t),ed.copy(p).applyMatrix3(rd).normalize().multiplyScalar(this.size).add(td),e.setXYZ(o,td.x,td.y,td.z),o+=1,e.setXYZ(o,ed.x,ed.y,ed.z),o+=1}else if(r&&r.isBufferGeometry){var d=r.attributes.position,f=r.attributes.normal;for(o=0,l=0,c=d.count;l<c;l++)td.set(d.getX(l),d.getY(l),d.getZ(l)).applyMatrix4(t),ed.set(f.getX(l),f.getY(l),f.getZ(l)),ed.applyMatrix3(rd).normalize().multiplyScalar(this.size).add(td),e.setXYZ(o,td.x,td.y,td.z),o+=1,e.setXYZ(o,ed.x,ed.y,ed.z),o+=1}e.needsUpdate=!0};var od=new _n;function ad(t,e){ri.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new _o,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new lo(n,3));var u=new Wu({fog:!1});this.cone=new el(r,u),this.add(this.cone),this.update()}ad.prototype=Object.create(ri.prototype),ad.prototype.constructor=ad,ad.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ad.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),od.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(od),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var sd=new _n,ud=new kn,ld=new kn;function cd(t){var e=[];t&&t.isBone&&e.push(t);for(var r=0;r<t.children.length;r++)e.push.apply(e,cd(t.children[r]));return e}function hd(t){for(var e=cd(t),r=new _o,n=[],i=[],o=new Yi(0,0,1),a=new Yi(0,1,0),s=0;s<e.length;s++){var u=e[s];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.setAttribute("position",new lo(n,3)),r.setAttribute("color",new lo(i,3));var l=new Wu({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});el.call(this,r,l),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function pd(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new hc(e,4,2),i=new to({wireframe:!0,fog:!1});jo.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function dd(t,e){this.type="RectAreaLightHelper",this.light=t,this.color=e;var r=new _o;r.setAttribute("position",new lo([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var n=new Wu({fog:!1});Ju.call(this,r,n);var i=new _o;i.setAttribute("position",new lo([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new jo(i,new to({side:1,fog:!1}))),this.update()}hd.prototype=Object.create(el.prototype),hd.prototype.constructor=hd,hd.prototype.updateMatrixWorld=function(t){var e=this.bones,r=this.geometry,n=r.getAttribute("position");ld.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<e.length;i++){var a=e[i];a.parent&&a.parent.isBone&&(ud.multiplyMatrices(ld,a.matrixWorld),sd.setFromMatrixPosition(ud),n.setXYZ(o,sd.x,sd.y,sd.z),ud.multiplyMatrices(ld,a.parent.matrixWorld),sd.setFromMatrixPosition(ud),n.setXYZ(o+1,sd.x,sd.y,sd.z),o+=2)}r.getAttribute("position").needsUpdate=!0,ri.prototype.updateMatrixWorld.call(this,t)},pd.prototype=Object.create(jo.prototype),pd.prototype.constructor=pd,pd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},pd.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},dd.prototype=Object.create(Ju.prototype),dd.prototype.constructor=dd,dd.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var t=this.material.color,e=Math.max(t.r,t.g,t.b);e>1&&t.multiplyScalar(1/e),this.children[0].material.color.copy(this.material.color)}},dd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var fd=new _n,md=new Yi,gd=new Yi;function vd(t,e,r){ri.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new wl(e);n.rotateY(.5*Math.PI),this.material=new to({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.setAttribute("color",new eo(o,3)),this.add(new jo(n,this.material)),this.update()}function yd(t,e){this.lightProbe=t,this.size=e;var r={GAMMA_OUTPUT:""},n=new Jo({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),i=new hc(1,32,16);jo.call(this,i,n),this.onBeforeRender()}function xd(t,e,r,n){t=t||10,e=e||10,r=new Yi(void 0!==r?r:4473924),n=new Yi(void 0!==n?n:8947848);for(var i=e/2,o=t/e,a=t/2,s=[],u=[],l=0,c=0,h=-a;l<=e;l++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=l===i?r:n;p.toArray(u,c),c+=3,p.toArray(u,c),c+=3,p.toArray(u,c),c+=3,p.toArray(u,c),c+=3}var d=new _o;d.setAttribute("position",new lo(s,3)),d.setAttribute("color",new lo(u,3));var f=new Wu({vertexColors:2});el.call(this,d,f)}function bd(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new Yi(void 0!==i?i:4473924),o=new Yi(void 0!==o?o:8947848);var a,s,u,l,c,h,p,d=[],f=[];for(l=0;l<=e;l++)u=l/e*(2*Math.PI),a=Math.sin(u)*t,s=Math.cos(u)*t,d.push(0,0,0),d.push(a,0,s),p=1&l?i:o,f.push(p.r,p.g,p.b),f.push(p.r,p.g,p.b);for(l=0;l<=r;l++)for(p=1&l?i:o,h=t-t/r*l,c=0;c<n;c++)u=c/n*(2*Math.PI),a=Math.sin(u)*h,s=Math.cos(u)*h,d.push(a,0,s),f.push(p.r,p.g,p.b),u=(c+1)/n*(2*Math.PI),a=Math.sin(u)*h,s=Math.cos(u)*h,d.push(a,0,s),f.push(p.r,p.g,p.b);var m=new _o;m.setAttribute("position",new lo(d,3)),m.setAttribute("color",new lo(f,3));var g=new Wu({vertexColors:2});el.call(this,m,g)}function _d(t,e,r,n){this.audio=t,this.range=e||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=n||2;var i=new _o,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*o+3));i.setAttribute("position",new eo(a,3));var s=new Wu({color:65280}),u=new Wu({color:16776960});Ju.call(this,i,[u,s]),this.update()}vd.prototype=Object.create(ri.prototype),vd.prototype.constructor=vd,vd.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},vd.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");md.copy(this.light.color),gd.copy(this.light.groundColor);for(var r=0,n=e.count;r<n;r++){var i=r<n/2?md:gd;e.setXYZ(r,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(fd.setFromMatrixPosition(this.light.matrixWorld).negate())},yd.prototype=Object.create(jo.prototype),yd.prototype.constructor=yd,yd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},yd.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},xd.prototype=Object.assign(Object.create(el.prototype),{constructor:xd,copy:function(t){return el.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),bd.prototype=Object.create(el.prototype),bd.prototype.constructor=bd,_d.prototype=Object.create(Ju.prototype),_d.prototype.constructor=_d,_d.prototype.update=function(){var t,e,r=this.audio,n=this.range,i=this.divisionsInnerAngle,o=this.divisionsOuterAngle,a=gn.degToRad(r.panner.coneInnerAngle),s=gn.degToRad(r.panner.coneOuterAngle),u=a/2,l=s/2,c=0,h=0,p=this.geometry,d=p.attributes.position;function f(r,i,o,a){var s=(i-r)/o;for(d.setXYZ(c,0,0,0),h++,t=r;t<i;t+=s)e=c+h,d.setXYZ(e,Math.sin(t)*n,0,Math.cos(t)*n),d.setXYZ(e+1,Math.sin(Math.min(t+s,i))*n,0,Math.cos(Math.min(t+s,i))*n),d.setXYZ(e+2,0,0,0),h+=3;p.addGroup(c,h,a),c+=h,h=0}p.clearGroups(),f(-l,-u,o,0),f(-u,u,i,1),f(u,l,o,0),d.needsUpdate=!0,a===s&&(this.material[0].visible=!1)},_d.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var wd=new _n,Td=new _n,Ed=new En;function Sd(t,e,r,n){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==r?r:16776960,o=void 0!==n?n:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var u=new _o,l=new lo(2*a*3,3);u.setAttribute("position",l),el.call(this,u,new Wu({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}Sd.prototype=Object.create(el.prototype),Sd.prototype.constructor=Sd,Sd.prototype.update=function(){this.object.updateMatrixWorld(!0),Ed.getNormalMatrix(this.object.matrixWorld);for(var t=this.object.matrixWorld,e=this.geometry.attributes.position,r=this.object.geometry,n=r.vertices,i=r.faces,o=0,a=0,s=i.length;a<s;a++){var u=i[a],l=u.normal;wd.copy(n[u.a]).add(n[u.b]).add(n[u.c]).divideScalar(3).applyMatrix4(t),Td.copy(l).applyMatrix3(Ed).normalize().multiplyScalar(this.size).add(wd),e.setXYZ(o,wd.x,wd.y,wd.z),o+=1,e.setXYZ(o,Td.x,Td.y,Td.z),o+=1}e.needsUpdate=!0};var Ad=new _n,Pd=new _n,Md=new _n;function Id(t,e,r){ri.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new _o;n.setAttribute("position",new lo([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new Wu({fog:!1});this.lightPlane=new Ju(n,i),this.add(this.lightPlane),(n=new _o).setAttribute("position",new lo([0,0,0,0,0,1],3)),this.targetLine=new Ju(n,i),this.add(this.targetLine),this.update()}Id.prototype=Object.create(ri.prototype),Id.prototype.constructor=Id,Id.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Id.prototype.update=function(){Ad.setFromMatrixPosition(this.light.matrixWorld),Pd.setFromMatrixPosition(this.light.target.matrixWorld),Md.subVectors(Pd,Ad),this.lightPlane.lookAt(Pd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Pd),this.targetLine.scale.z=Md.length()};var Od=new _n,Cd=new Ko;function Rd(t){var e=new _o,r=new Wu({color:16777215,vertexColors:1}),n=[],i=[],o={},a=new Yi(16755200),s=new Yi(16711680),u=new Yi(43775),l=new Yi(16777215),c=new Yi(3355443);function h(t,e,r){p(t,r),p(e,r)}function p(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",u),h("u2","u3",u),h("u3","u1",u),h("c","t",l),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),e.setAttribute("position",new lo(n,3)),e.setAttribute("color",new lo(i,3)),el.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Ld(t,e,r,n,i,o,a){Od.set(i,o,a).unproject(n);var s=e[t];if(void 0!==s)for(var u=r.getAttribute("position"),l=0,c=s.length;l<c;l++)u.setXYZ(s[l],Od.x,Od.y,Od.z)}Rd.prototype=Object.create(el.prototype),Rd.prototype.constructor=Rd,Rd.prototype.update=function(){var t=this.geometry,e=this.pointMap;Cd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ld("c",e,t,Cd,0,0,-1),Ld("t",e,t,Cd,0,0,1),Ld("n1",e,t,Cd,-1,-1,-1),Ld("n2",e,t,Cd,1,-1,-1),Ld("n3",e,t,Cd,-1,1,-1),Ld("n4",e,t,Cd,1,1,-1),Ld("f1",e,t,Cd,-1,-1,1),Ld("f2",e,t,Cd,1,-1,1),Ld("f3",e,t,Cd,-1,1,1),Ld("f4",e,t,Cd,1,1,1),Ld("u1",e,t,Cd,.7,1.1,-1),Ld("u2",e,t,Cd,-.7,1.1,-1),Ld("u3",e,t,Cd,0,2,-1),Ld("cf1",e,t,Cd,-1,0,1),Ld("cf2",e,t,Cd,1,0,1),Ld("cf3",e,t,Cd,0,-1,1),Ld("cf4",e,t,Cd,0,1,1),Ld("cn1",e,t,Cd,-1,0,-1),Ld("cn2",e,t,Cd,1,0,-1),Ld("cn3",e,t,Cd,0,-1,-1),Ld("cn4",e,t,Cd,0,1,-1),t.getAttribute("position").needsUpdate=!0};var Nd=new vi;function Fd(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new _o;i.setIndex(new eo(r,1)),i.setAttribute("position",new eo(n,3)),el.call(this,i,new Wu({color:e})),this.matrixAutoUpdate=!1,this.update()}function Dd(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new _o;n.setIndex(new eo(r,1)),n.setAttribute("position",new lo([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),el.call(this,n,new Wu({color:e})),this.geometry.computeBoundingSphere()}function Ud(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new _o;i.setAttribute("position",new lo([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Ju.call(this,i,new Wu({color:n}));var o=new _o;o.setAttribute("position",new lo([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new jo(o,new to({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}Fd.prototype=Object.create(el.prototype),Fd.prototype.constructor=Fd,Fd.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Nd.setFromObject(this.object),!Nd.isEmpty()){var e=Nd.min,r=Nd.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=e.x,i[4]=r.y,i[5]=r.z,i[6]=e.x,i[7]=e.y,i[8]=r.z,i[9]=r.x,i[10]=e.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=e.z,i[15]=e.x,i[16]=r.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=r.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Fd.prototype.setFromObject=function(t){return this.object=t,this.update(),this},Fd.prototype.copy=function(t){return el.prototype.copy.call(this,t),this.object=t.object,this},Fd.prototype.clone=function(){return(new this.constructor).copy(this)},Dd.prototype=Object.create(el.prototype),Dd.prototype.constructor=Dd,Dd.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),ri.prototype.updateMatrixWorld.call(this,t))},Ud.prototype=Object.create(Ju.prototype),Ud.prototype.constructor=Ud,Ud.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),ri.prototype.updateMatrixWorld.call(this,t)};var kd,jd,Bd=new _n;function zd(t,e,r,n,i,o){ri.call(this),void 0===t&&(t=new _n(0,0,1)),void 0===e&&(e=new _n(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===kd&&((kd=new _o).setAttribute("position",new lo([0,0,0,0,1,0],3)),(jd=new _c(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Ju(kd,new Wu({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new jo(jd,new to({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function Gd(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new _o;r.setAttribute("position",new lo(e,3)),r.setAttribute("color",new lo([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Wu({vertexColors:2});el.call(this,r,n)}function Vd(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),xh.call(this,t),this.type="catmullrom"}
/*! Derived from https://github.com/marcofugaro/codrops-texture-projection and https://github.com/marcofugaro/three-projected-material (MIT) */
function Hd(t,{header:e="",main:r="",...n}){let i=t;return Object.keys(n).forEach((t=>{i=i.replace(t,n[t])})),i.replace("void main() {",`\n    ${e}\n    void main() {\n      ${r}\n    `)}zd.prototype=Object.create(ri.prototype),zd.prototype.constructor=zd,zd.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Bd.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Bd,e)}},zd.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},zd.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},zd.prototype.copy=function(t){return ri.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},zd.prototype.clone=function(){return(new this.constructor).copy(this)},Gd.prototype=Object.create(el.prototype),Gd.prototype.constructor=Gd,hh.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(hh.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(Ch.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Wo,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new _n(i.x,i.y,i.z||0))}return e}}),Object.assign(Rh.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Vd.prototype=Object.create(xh.prototype),Object.assign(Vd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),xd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},hd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(rh.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Yh(t)}}),rh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Jh.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign($p.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(vi.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Jp.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(gn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),gn.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),gn.ceilPowerOfTwo(t)}}),Object.assign(En.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(kn.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new _n).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,o)}}),Ri.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},yn.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Mi.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Vi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Vi,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Vi.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Vi.getNormal(t,e,r,n)}}),Object.assign(Lh.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ic(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new gc(this,t)}}),Object.assign(vn.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(_n.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Mn.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wo.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(ri.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(ri.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Fu.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ju.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Du.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(hh.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),ta.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Nh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(eo.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(eo.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(_o.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new eo(arguments[1],arguments[2])))},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)}}),Object.defineProperties(_o.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(gu.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(gu.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(oc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Gp.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Ki.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Yi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Cc.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Jo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(du.prototype,{clearTarget:function(t,e,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,n)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(du.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(Ks.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ra.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(In.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(hu.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Object.defineProperties(wp.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new lp).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Mp.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ea.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Sn.crossOrigin=void 0,Sn.loadTexture=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new ch;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},Sn.loadTextureCube=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new lh;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},Sn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Sn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"111"}}));class Xd extends Jo{constructor({camera:t,texture:e,color:r=16777215,...n}={}){if(!e||!e.isTexture)throw new Error("Invalid texture passed to the ProjectedMaterial");if(!t||!t.isCamera)throw new Error("Invalid camera passed to the ProjectedMaterial");t.updateProjectionMatrix(),t.updateMatrixWorld(),t.updateWorldMatrix();const i=t.matrixWorldInverse,o=t.projectionMatrix,a=t.matrixWorld,s=t.position;super({...n,lights:!0,uniforms:{...la.lambert.uniforms,baseColor:{value:new Yi(r)},texture:{value:e},viewMatrixCamera:{type:"m4",value:i},projectionMatrixCamera:{type:"m4",value:o},modelMatrixCamera:{type:"mat4",value:a},projPosition:{type:"v3",value:s}},vertexShader:Hd(sa.meshlambert_vert,{header:"\n          uniform mat4 viewMatrixCamera;\n          uniform mat4 projectionMatrixCamera;\n          uniform mat4 modelMatrixCamera;\n\n          varying vec4 vWorldPosition;\n          varying vec3 vNormal;\n          varying vec4 vTexCoords;\n          ",main:"\n          vNormal = mat3(modelMatrix) * normal;\n          vWorldPosition = modelMatrix * vec4(position, 1.0);\n          vTexCoords = projectionMatrixCamera * viewMatrixCamera * vWorldPosition;\n          "}),fragmentShader:Hd(sa.meshlambert_frag,{header:"\n          uniform vec3 baseColor;\n          uniform sampler2D texture;\n          uniform vec3 projPosition;\n\n          varying vec3 vNormal;\n          varying vec4 vWorldPosition;\n          varying vec4 vTexCoords;\n        ","vec4 diffuseColor = vec4( diffuse, opacity );":"\n          vec2 uv = (vTexCoords.xy / vTexCoords.w) * 0.5 + 0.5;\n\n          vec4 color = texture2D(texture, uv);\n\n          // this makes sure we don't sample out of the texture\n          // TODO handle alpha\n          bool inTexture = (max(uv.x, uv.y) <= 1.0 && min(uv.x, uv.y) >= 0.0);\n          if (!inTexture) {\n            color = vec4(baseColor, 1.0);\n          }\n\n          // this makes sure we don't render the texture also on the back of the object\n          vec3 projectorDirection = normalize(projPosition - vWorldPosition.xyz);\n          float dotProduct = dot(vNormal, projectorDirection);\n          if (dotProduct < 0.0) {\n            color = vec4(baseColor, 1.0);\n          }\n\n          vec4 diffuseColor = color;\n        "})}),this.isProjectedMaterial=!0}}var Wd=function(t,e){var r,n,i,o,a;void 0===e&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=e,this.enabled=!0,this.target=new _n,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:an,MIDDLE:sn,RIGHT:un},this.touches={ONE:ln,TWO:hn},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(u),s.update(),p=h.NONE},this.update=(r=new _n,n=(new yn).setFromUnitVectors(t.up,new _n(0,1,0)),i=n.clone().inverse(),o=new _n,a=new yn,function(){var t=s.object.position;return r.copy(t).sub(s.target),r.applyQuaternion(n),f.setFromVector3(r),s.autoRotate&&p===h.NONE&&I(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(f.theta+=m.theta*s.dampingFactor,f.phi+=m.phi*s.dampingFactor):(f.theta+=m.theta,f.phi+=m.phi),f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=g,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),!0===s.enableDamping?s.target.addScaledVector(v,s.dampingFactor):s.target.add(v),r.setFromSpherical(f),r.applyQuaternion(i),t.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),v.set(0,0,0)),g=1,!!(y||o.distanceToSquared(s.object.position)>d||8*(1-a.dot(s.object.quaternion))>d)&&(s.dispatchEvent(u),o.copy(s.object.position),a.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",K,!1),s.domElement.removeEventListener("mousedown",X,!1),s.domElement.removeEventListener("wheel",q,!1),s.domElement.removeEventListener("touchstart",Q,!1),s.domElement.removeEventListener("touchend",J,!1),s.domElement.removeEventListener("touchmove",Z,!1),document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",Y,!1),s.domElement.removeEventListener("keydown",$,!1)};var s=this,u={type:"change"},l={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=h.NONE,d=1e-6,f=new Yp,m=new Yp,g=1,v=new _n,y=!1,x=new vn,b=new vn,_=new vn,w=new vn,T=new vn,E=new vn,S=new vn,A=new vn,P=new vn;function M(){return Math.pow(.95,s.zoomSpeed)}function I(t){m.theta-=t}function O(t){m.phi-=t}var C,R=(C=new _n,function(t,e){C.setFromMatrixColumn(e,0),C.multiplyScalar(-t),v.add(C)}),L=function(){var t=new _n;return function(e,r){!0===s.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(s.object.up,t)),t.multiplyScalar(e),v.add(t)}}(),N=function(){var t=new _n;return function(e,r){var n=s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;t.copy(i).sub(s.target);var o=t.length();o*=Math.tan(s.object.fov/2*Math.PI/180),R(2*e*o/n.clientHeight,s.object.matrix),L(2*r*o/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(R(e*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),L(r*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function F(t){s.object.isPerspectiveCamera?g/=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*t)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function D(t){s.object.isPerspectiveCamera?g*=t:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/t)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function U(t){x.set(t.clientX,t.clientY)}function k(t){w.set(t.clientX,t.clientY)}function j(t){if(1==t.touches.length)x.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);x.set(e,r)}}function B(t){if(1==t.touches.length)w.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);w.set(e,r)}}function z(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);S.set(0,n)}function G(t){if(1==t.touches.length)b.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);b.set(e,r)}_.subVectors(b,x).multiplyScalar(s.rotateSpeed);var n=s.domElement;I(2*Math.PI*_.x/n.clientHeight),O(2*Math.PI*_.y/n.clientHeight),x.copy(b)}function V(t){if(1==t.touches.length)T.set(t.touches[0].pageX,t.touches[0].pageY);else{var e=.5*(t.touches[0].pageX+t.touches[1].pageX),r=.5*(t.touches[0].pageY+t.touches[1].pageY);T.set(e,r)}E.subVectors(T,w).multiplyScalar(s.panSpeed),N(E.x,E.y),w.copy(T)}function H(t){var e=t.touches[0].pageX-t.touches[1].pageX,r=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+r*r);A.set(0,n),P.set(0,Math.pow(A.y/S.y,s.zoomSpeed)),F(P.y),S.copy(A)}function X(t){if(!1!==s.enabled){switch(t.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),t.button){case 0:switch(s.mouseButtons.LEFT){case an:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enablePan)return;k(t),p=h.PAN}else{if(!1===s.enableRotate)return;U(t),p=h.ROTATE}break;case un:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===s.enableRotate)return;U(t),p=h.ROTATE}else{if(!1===s.enablePan)return;k(t),p=h.PAN}break;default:p=h.NONE}break;case 1:switch(s.mouseButtons.MIDDLE){case sn:if(!1===s.enableZoom)return;!function(t){S.set(t.clientX,t.clientY)}(t),p=h.DOLLY;break;default:p=h.NONE}break;case 2:switch(s.mouseButtons.RIGHT){case an:if(!1===s.enableRotate)return;U(t),p=h.ROTATE;break;case un:if(!1===s.enablePan)return;k(t),p=h.PAN;break;default:p=h.NONE}}p!==h.NONE&&(document.addEventListener("mousemove",W,!1),document.addEventListener("mouseup",Y,!1),s.dispatchEvent(l))}}function W(t){if(!1!==s.enabled)switch(t.preventDefault(),p){case h.ROTATE:if(!1===s.enableRotate)return;!function(t){b.set(t.clientX,t.clientY),_.subVectors(b,x).multiplyScalar(s.rotateSpeed);var e=s.domElement;I(2*Math.PI*_.x/e.clientHeight),O(2*Math.PI*_.y/e.clientHeight),x.copy(b),s.update()}(t);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(t){A.set(t.clientX,t.clientY),P.subVectors(A,S),P.y>0?F(M()):P.y<0&&D(M()),S.copy(A),s.update()}(t);break;case h.PAN:if(!1===s.enablePan)return;!function(t){T.set(t.clientX,t.clientY),E.subVectors(T,w).multiplyScalar(s.panSpeed),N(E.x,E.y),w.copy(T),s.update()}(t)}}function Y(t){!1!==s.enabled&&(document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",Y,!1),s.dispatchEvent(c),p=h.NONE)}function q(t){!1===s.enabled||!1===s.enableZoom||p!==h.NONE&&p!==h.ROTATE||(t.preventDefault(),t.stopPropagation(),s.dispatchEvent(l),function(t){t.deltaY<0?D(M()):t.deltaY>0&&F(M()),s.update()}(t),s.dispatchEvent(c))}function $(t){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(t){var e=!1;switch(t.keyCode){case s.keys.UP:N(0,s.keyPanSpeed),e=!0;break;case s.keys.BOTTOM:N(0,-s.keyPanSpeed),e=!0;break;case s.keys.LEFT:N(s.keyPanSpeed,0),e=!0;break;case s.keys.RIGHT:N(-s.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),s.update())}(t)}function Q(t){if(!1!==s.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(s.touches.ONE){case ln:if(!1===s.enableRotate)return;j(t),p=h.TOUCH_ROTATE;break;case cn:if(!1===s.enablePan)return;B(t),p=h.TOUCH_PAN;break;default:p=h.NONE}break;case 2:switch(s.touches.TWO){case hn:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&z(t),s.enablePan&&B(t)}(t),p=h.TOUCH_DOLLY_PAN;break;case pn:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&z(t),s.enableRotate&&j(t)}(t),p=h.TOUCH_DOLLY_ROTATE;break;default:p=h.NONE}break;default:p=h.NONE}p!==h.NONE&&s.dispatchEvent(l)}}function Z(t){if(!1!==s.enabled)switch(t.preventDefault(),t.stopPropagation(),p){case h.TOUCH_ROTATE:if(!1===s.enableRotate)return;G(t),s.update();break;case h.TOUCH_PAN:if(!1===s.enablePan)return;V(t),s.update();break;case h.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(t){s.enableZoom&&H(t),s.enablePan&&V(t)}(t),s.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(t){s.enableZoom&&H(t),s.enableRotate&&G(t)}(t),s.update();break;default:p=h.NONE}}function J(t){!1!==s.enabled&&(s.dispatchEvent(c),p=h.NONE)}function K(t){!1!==s.enabled&&t.preventDefault()}s.domElement.addEventListener("contextmenu",K,!1),s.domElement.addEventListener("mousedown",X,!1),s.domElement.addEventListener("wheel",q,!1),s.domElement.addEventListener("touchstart",Q,!1),s.domElement.addEventListener("touchend",J,!1),s.domElement.addEventListener("touchmove",Z,!1),s.domElement.addEventListener("keydown",$,!1),-1===s.domElement.tabIndex&&(s.domElement.tabIndex=0),this.update()};(Wd.prototype=Object.create(dn.prototype)).constructor=Wd;var Yd=function(t,e){Wd.call(this,t,e),this.mouseButtons.LEFT=un,this.mouseButtons.RIGHT=an,this.touches.ONE=cn,this.touches.TWO=pn};(Yd.prototype=Object.create(dn.prototype)).constructor=Yd;var qd=function(t,e,r){var n=new Ri,i=new Hp,o=new vn,a=new _n,s=new _n,u=new _n,l=new kn,c=null,h=null,p=this;function d(){r.addEventListener("mousemove",m,!1),r.addEventListener("mousedown",g,!1),r.addEventListener("mouseup",v,!1),r.addEventListener("mouseleave",v,!1),r.addEventListener("touchmove",y,!1),r.addEventListener("touchstart",x,!1),r.addEventListener("touchend",b,!1)}function f(){r.removeEventListener("mousemove",m,!1),r.removeEventListener("mousedown",g,!1),r.removeEventListener("mouseup",v,!1),r.removeEventListener("mouseleave",v,!1),r.removeEventListener("touchmove",y,!1),r.removeEventListener("touchstart",x,!1),r.removeEventListener("touchend",b,!1)}function m(d){d.preventDefault();var f=r.getBoundingClientRect();if(o.x=(d.clientX-f.left)/f.width*2-1,o.y=-(d.clientY-f.top)/f.height*2+1,i.setFromCamera(o,e),c&&p.enabled)return i.ray.intersectPlane(n,s)&&c.position.copy(s.sub(a).applyMatrix4(l)),void p.dispatchEvent({type:"drag",object:c});i.setFromCamera(o,e);var m=i.intersectObjects(t,!0);if(m.length>0){var g=m[0].object;n.setFromNormalAndCoplanarPoint(e.getWorldDirection(n.normal),u.setFromMatrixPosition(g.matrixWorld)),h!==g&&(p.dispatchEvent({type:"hoveron",object:g}),r.style.cursor="pointer",h=g)}else null!==h&&(p.dispatchEvent({type:"hoveroff",object:h}),r.style.cursor="auto",h=null)}function g(h){h.preventDefault(),i.setFromCamera(o,e);var d=i.intersectObjects(t,!0);d.length>0&&(c=d[0].object,i.ray.intersectPlane(n,s)&&(l.getInverse(c.parent.matrixWorld),a.copy(s).sub(u.setFromMatrixPosition(c.matrixWorld))),r.style.cursor="move",p.dispatchEvent({type:"dragstart",object:c}))}function v(t){t.preventDefault(),c&&(p.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor=h?"pointer":"auto"}function y(t){t.preventDefault(),t=t.changedTouches[0];var u=r.getBoundingClientRect();if(o.x=(t.clientX-u.left)/u.width*2-1,o.y=-(t.clientY-u.top)/u.height*2+1,i.setFromCamera(o,e),c&&p.enabled)return i.ray.intersectPlane(n,s)&&c.position.copy(s.sub(a).applyMatrix4(l)),void p.dispatchEvent({type:"drag",object:c})}function x(h){h.preventDefault(),h=h.changedTouches[0];var d=r.getBoundingClientRect();o.x=(h.clientX-d.left)/d.width*2-1,o.y=-(h.clientY-d.top)/d.height*2+1,i.setFromCamera(o,e);var f=i.intersectObjects(t,!0);f.length>0&&(c=f[0].object,n.setFromNormalAndCoplanarPoint(e.getWorldDirection(n.normal),u.setFromMatrixPosition(c.matrixWorld)),i.ray.intersectPlane(n,s)&&(l.getInverse(c.parent.matrixWorld),a.copy(s).sub(u.setFromMatrixPosition(c.matrixWorld))),r.style.cursor="move",p.dispatchEvent({type:"dragstart",object:c}))}function b(t){t.preventDefault(),c&&(p.dispatchEvent({type:"dragend",object:c}),c=null),r.style.cursor="auto"}d(),this.enabled=!0,this.activate=d,this.deactivate=f,this.dispose=function(){f()}};(qd.prototype=Object.create(dn.prototype)).constructor=qd;var $d,Qd,Zd,Jd={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")};function Kd(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Kd.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Kd.FullScreenQuad=($d=new zh(-1,1,1,-1,0,1),Qd=new da(2,2),Zd=function(t){this._mesh=new jo(Qd,t)},Object.defineProperty(Zd.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(Zd.prototype,{render:function(t){t.render(this._mesh,$d)}}),Zd);var tf=function(t,e){Kd.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Jo?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Zo.clone(t.uniforms),this.material=new Jo({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new Kd.FullScreenQuad(this.material)};tf.prototype=Object.assign(Object.create(Kd.prototype),{constructor:tf,render:function(t,e,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}});var ef=function(t,e){Kd.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};ef.prototype=Object.assign(Object.create(Kd.prototype),{constructor:ef,render:function(t,e,r){var n,i,o=t.getContext(),a=t.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(n=0,i=1):(n=1,i=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,n,4294967295),a.buffers.stencil.setClear(i),a.buffers.stencil.setLocked(!0),t.setRenderTarget(r),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var rf=function(){Kd.call(this),this.needsSwap=!1};rf.prototype=Object.create(Kd.prototype),Object.assign(rf.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}});var nf=function(t,e){if(this.renderer=t,void 0===e){var r={minFilter:1006,magFilter:1006,format:1023,stencilBuffer:!1},n=t.getSize(new vn);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new In(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===Jd&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===tf&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new tf(Jd),this.clock=new gp};Object.assign(nf.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,e){this.passes.splice(e,0,t)},isLastEnabledPass:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var e,r,n=this.renderer.getRenderTarget(),i=!1,o=this.passes.length;for(r=0;r<o;r++)if(!1!==(e=this.passes[r]).enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),e.needsSwap){if(i){var a=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),s.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==ef&&(e instanceof ef?i=!0:e instanceof rf&&(i=!1))}this.renderer.setRenderTarget(n)},reset:function(t){if(void 0===t){var e=this.renderer.getSize(new vn);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this._width=t,this._height=e;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var of=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(of.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),of.FullScreenQuad=function(){var t=new zh(-1,1,1,-1,0,1),e=new da(2,2),r=function(t){this._mesh=new jo(e,t)};return Object.defineProperty(r.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(r.prototype,{render:function(e){e.render(this._mesh,t)}}),r}();var af=function(t,e,r,n,i){Kd.call(this),this.scene=t,this.camera=e,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};af.prototype=Object.assign(Object.create(Kd.prototype),{constructor:af,render:function(t,e,r){var n,i,o=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(n=t.getClearColor().getHex(),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:r),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(n,i),this.scene.overrideMaterial=null,t.autoClear=o}});var sf={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Yi(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},uf=function(t,e,r,n){Kd.call(this),this.strength=void 0!==e?e:1,this.radius=r,this.threshold=n,this.resolution=void 0!==t?new vn(t.x,t.y):new vn(256,256),this.clearColor=new Yi(0,0,0);var i={minFilter:1006,magFilter:1006,format:1023};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new In(o,a,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var u=new In(o,a,i);u.texture.name="UnrealBloomPass.h"+s,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);var l=new In(o,a,i);l.texture.name="UnrealBloomPass.v"+s,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),a=Math.round(a/2)}void 0===sf&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var c=sf;this.highPassUniforms=Zo.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Jo({uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new vn(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new _n(1,1,1),new _n(1,1,1),new _n(1,1,1),new _n(1,1,1),new _n(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===Jd&&console.error("UnrealBloomPass relies on CopyShader");var p=Jd;this.copyUniforms=Zo.clone(p.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Jo({uniforms:this.copyUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Yi,this.oldClearAlpha=1,this.basic=new to,this.fsQuad=new Kd.FullScreenQuad(null)};uf.prototype=Object.assign(Object.create(Kd.prototype),{constructor:uf,dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,e){var r=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new vn(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(t,e,r,n,i){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),i&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=uf.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[s]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=uf.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[s]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(r),this.fsQuad.render(t)),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getSeperableBlurMaterial:function(t){return new Jo({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new vn(.5,.5)},direction:{value:new vn(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(t){return new Jo({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),uf.BlurDirectionX=new vn(1,0),uf.BlurDirectionY=new vn(0,1);var lf={uniforms:{tDiffuse:{value:null},resolution:{value:new vn(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};const cf=new class extends class{constructor(){this.scene=new ni}}{constructor(){super()}},hf={renderer:{antialias:!1,alpha:!0,pixelRatio:window.devicePixelRatio,size:{width:600,height:400,updateStyle:!1},clearColor:{color:0,alpha:0}},camera:{type:"perspective",fov:45,near:1,far:3e3,up:[0,0,1],position:[150,-450,200],lookAt:[0,0,0]},orbitControls:{enabled:!0}};var pf=Qr((function(t){!function(t,e,r){function n(t){var e,r=this,n=(e=4022871197,function(t){t=String(t);for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=t.charCodeAt(r));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)});r.next=function(){var t=2091639*r.s0+2.3283064365386963e-10*r.c;return r.s0=r.s1,r.s1=r.s2,r.s2=t-(r.c=0|t)},r.c=1,r.s0=n(" "),r.s1=n(" "),r.s2=n(" "),r.s0-=n(t),r.s0<0&&(r.s0+=1),r.s1-=n(t),r.s1<0&&(r.s1+=1),r.s2-=n(t),r.s2<0&&(r.s2+=1),n=null}function i(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var r=new n(t),o=e&&e.state,a=r.next;return a.int32=function(){return 4294967296*r.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&i(o,r),a.state=function(){return i(r,{})}),a}e&&e.exports?e.exports=o:this.alea=o}(0,t)})),df=Qr((function(t){!function(t,e,r){function n(t){var e=this,r="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var r=new n(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&i(o,r),a.state=function(){return i(r,{})}),a}e&&e.exports?e.exports=o:this.xor128=o}(0,t)})),ff=Qr((function(t){!function(t,e,r){function n(t){var e=this,r="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:r+=t;for(var n=0;n<r.length+64;n++)e.x^=0|r.charCodeAt(n),n==r.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function i(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var r=new n(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&i(o,r),a.state=function(){return i(r,{})}),a}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)})),mf=Qr((function(t){!function(t,e,r){function n(t){var e=this;e.next=function(){var t,r,n=e.x,i=e.i;return t=n[i],r=(t^=t>>>7)^t<<24,r^=(t=n[i+1&7])^t>>>10,r^=(t=n[i+3&7])^t>>>3,r^=(t=n[i+4&7])^t<<7,t=n[i+7&7],r^=(t^=t<<13)^t<<9,n[i]=r,e.i=i+1&7,r},function(t,e){var r,n=[];if(e===(0|e))n[0]=e;else for(e=""+e,r=0;r<e.length;++r)n[7&r]=n[7&r]<<15^e.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r&&(n[7]=-1),t.x=n,t.i=0,r=256;r>0;--r)t.next()}(e,t)}function i(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var r=new n(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&(o.x&&i(o,r),a.state=function(){return i(r,{})}),a}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)})),gf=Qr((function(t){!function(t,e,r){function n(t){var e=this;e.next=function(){var t,r,n=e.w,i=e.X,o=e.i;return e.w=n=n+1640531527|0,r=i[o+34&127],t=i[o=o+1&127],r^=r<<13,t^=t<<17,r^=r>>>15,t^=t>>>12,r=i[o]=r^t,e.i=o,r+(n^n>>>16)|0},function(t,e){var r,n,i,o,a,s=[],u=128;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(n^=e.charCodeAt((o+32)%e.length)),0===o&&(a=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,o>=0&&(a=a+1640531527|0,i=0==(r=s[127&o]^=n+a)?i+1:0);for(i>=128&&(s[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)n=s[i+34&127],r=s[i=i+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,s[i]=n^r;t.w=a,t.X=s,t.i=i}(e,t)}function i(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var r=new n(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&(o.X&&i(o,r),a.state=function(){return i(r,{})}),a}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)})),vf=Qr((function(t){!function(t,e,r){function n(t){var e=this,r="";e.next=function(){var t=e.b,r=e.c,n=e.d,i=e.a;return t=t<<25^t>>>7^r,r=r-n|0,n=n<<24^n>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-n|0,e.d=n<<16^r>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):r+=t;for(var n=0;n<r.length+20;n++)e.b^=0|r.charCodeAt(n),e.next()}function i(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var r=new n(t),o=e&&e.state,a=function(){return(r.next()>>>0)/4294967296};return a.double=function(){do{var t=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=r.next,a.quick=a,o&&("object"==typeof o&&i(o,r),a.state=function(){return i(r,{})}),a}e&&e.exports?e.exports=o:this.tychei=o}(0,t)})),yf=Zr(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:{}})),xf=Qr((function(t){!function(e,r,n){var i,o=256,a=n.pow(o,6),s=n.pow(2,52),u=2*s,l=255;function c(t,l,c){var g=[],v=f(d((l=1==l?{entropy:!0}:l||{}).entropy?[t,m(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,m(r)]}}():t,3),g),y=new h(g),x=function(){for(var t=y.g(6),e=a,r=0;t<s;)t=(t+r)*o,e*=o,r=y.g(1);for(;t>=u;)t/=2,e/=2,r>>>=1;return(t+r)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,f(m(y.S),r),(l.pass||c||function(t,e,r,i){return i&&(i.S&&p(i,y),t.state=function(){return p(y,{})}),r?(n.random=t,e):t})(x,v,"global"in l?l.global:this==n,l.state)}function h(t){var e,r=t.length,n=this,i=0,a=n.i=n.j=0,s=n.S=[];for(r||(t=[r++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=l&a+t[i%r]+(e=s[i])],s[a]=e;(n.g=function(t){for(var e,r=0,i=n.i,a=n.j,s=n.S;t--;)e=s[i=l&i+1],r=r*o+s[l&(s[i]=s[a=l&a+e])+(s[a]=e)];return n.i=i,n.j=a,r})(o)}function p(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){var r,n=[],i=typeof t;if(e&&"object"==i)for(r in t)try{n.push(d(t[r],e-1))}catch(t){}return n.length?n:"string"==i?t:t+"\0"}function f(t,e){for(var r,n=t+"",i=0;i<n.length;)e[l&i]=l&(r^=19*e[l&i])+n.charCodeAt(i++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(f(n.random(),r),t.exports){t.exports=c;try{i=yf}catch(t){}}else n.seedrandom=c}("undefined"!=typeof self?self:$r,[],Math)}));xf.alea=pf,xf.xor128=df,xf.xorwow=ff,xf.xorshift7=mf,xf.xor4096=gf,xf.tychei=vf;var bf=xf;class _f{constructor(t,e){this.random=e;let r=Array.from([[0,0,0,100,100,100,0,0,0],[100,0,0,100,100,100,0,0,0],[0,100,0,100,100,100,0,0,0],[0,25,-100,100,100,150,0,0,0]],(t=>({posX:t[0],posY:t[1],posZ:t[2],sizeX:t[3],sizeY:t[4],sizeZ:t[5],rotateX:t[6],rotateY:t[7],rotateZ:t[8]})));const n=new Wo;r.forEach(((t,r)=>{let i=new jo(new Yo(t.sizeX,t.sizeY,t.sizeZ));i.position.x=t.posX,i.position.z=t.posY,i.position.y=t.posZ,i.rotation.x=t.rotateX,i.rotation.y=t.rotateY,i.rotation.z=t.rotateZ,e&&(i.position.x+=.5*(100*Math.random()-50),i.position.z+=.5*(100*Math.random()-50),i.position.y+=.5*(100*Math.random()-50),i.rotation.x+=-Math.PI/16+Math.PI/8*Math.random(),i.rotation.y+=-Math.PI/16+Math.PI/8*Math.random(),i.rotation.z+=-Math.PI/16+Math.PI/8*Math.random()),n.mergeMesh(i)}));const i=new jo(n,t);i.rotation.set(0,0,-.25*Math.PI),i.position.y=200,i.castShadow=!0,i.receiveShadow=!0,this.geometry=null,this.material=t,this.mesh=i}}function wf(e){let r;return{c(){r=g("div"),w(r,"id","stage"),w(r,"class","svelte-cv64l1")},m(t,n){d(t,r,n),e[4](r)},p:t,i:t,o:t,d(t){t&&f(r),e[4](null)}}}function Tf(t,e,r){let n,{canvas:i}=e,{stageSetup:o}=e;const a=new URLSearchParams(window.location.search);"2"===a.get("hd")?(hf.renderer.size.width*=2,hf.renderer.size.height*=2):"full"===a.get("hd")&&(hf.renderer.size.width=window.innerWidth,hf.renderer.size.height=window.innerHeight,hf.renderer.pixelRatio=window.devicePixelRatio);let s=o;var u;I((async()=>{await _(),w()})),u=()=>{cf.scene=null,cf.scene=new ni,window.removeEventListener("resize",f)},M().$$.on_destroy.push(u);const l=(t,e)=>{t.renderer=new du({antialias:e.renderer.antialias,alpha:e.renderer.alpha}),t.renderer.setPixelRatio(e.renderer.pixelRatio),t.renderer.setSize(e.renderer.size.width,e.renderer.size.height,e.renderer.size.updateStyle),t.renderer.setClearColor(e.renderer.clearColor.color,e.renderer.clearColor.alpha),t.renderer.shadowMap.enabled=!0,t.renderer.shadowMap.type=0,t.composer=new nf(t.renderer)},c=(t,e)=>{"perspective"===e.camera.type&&(t.camera=new ta(e.camera.fov,e.renderer.size.width/e.renderer.size.height,e.camera.near,e.camera.far),t.camera.up.set(...e.camera.up),o.camera&&o.camera.position?t.camera.position.set(...o.camera.position):t.camera.position.set(...e.camera.position),t.camera.lookAt(...e.camera.lookAt))},h=(t,e)=>{const r=new Wd(t.camera,t.renderer.domElement);r.target.set(0,0,0),r.minDistance=100,r.maxDistance=1500,t.orbitControls=r},p=(t,e)=>{t.mouse=new vn};class d{constructor(t,e,r,n,i){this.camera=t,this.x=e,this.y=r,this.z=n,this.camera.position.set(this.x,this.y,this.z),this.camera.up.set(0,0,1),o.projector&&o.projector.lookAt?this.camera.lookAt(...o.projector.lookAt):this.camera.lookAt(0,0,0),this.helper=new Rd(this.camera),this.light=new kh(4210752,1,i.camera.far,Math.PI/8,0,0),this.light.up.set(0,0,1),this.light.position.set(this.x,this.y,this.z),this.light.lookAt(0,0,0),this.light.castShadow=!0,this.light.shadow.bias=-.005,this.light.shadow.camera.near=216,this.light.shadow.camera.far=1024,this.light.shadow.camera.fov=Math.PI/4,this.light.layers.enable(1),this.lightHelper=new ad(this.light),this.handle=this._setupHandle()}update(){this.camera.position.set(this.handle.position.x,this.handle.position.y,this.handle.position.z),this.camera.lookAt(0,0,0),this.camera.updateMatrixWorld(),this.helper.update(),this.light.position.set(this.handle.position.x,this.handle.position.y,this.handle.position.z),this.light.lookAt(0,0,0),this.lightHelper.update()}attachDragControls(t){this.dragControls=t,this.dragControls.transformGroup=!0,this.dragControls.addEventListener("drag",(()=>{this.update()}))}_setupHandle(){let t=new cc(20,12,12),e=new to({transparent:!0,opacity:0});const r=new jo(t,e);return t=new cc(5,8,8),e=new to({color:16776960}),r.add(new jo(t,e)),r.position.set(this.x,this.y,this.z),r}}function f(){const t=window.innerWidth,e=window.innerHeight;cf.renderer.setSize(t,e),cf.camera.aspect=t/e,cf.camera.updateProjectionMatrix()}let m,g,v,y,x,b;async function _(){let t,e,r;l(cf,hf),n.appendChild(cf.renderer.domElement),c(cf,hf),h(cf,hf),p(cf,hf),f(),window.addEventListener("resize",f),y=new In(hf.renderer.size.width,hf.renderer.size.height),x=new In(hf.renderer.size.width,hf.renderer.size.height),b=new In(hf.renderer.size.width,hf.renderer.size.height);new af(cf.scene,cf.camera);m=new uf(new vn(hf.renderer.size.width,hf.renderer.size.height),1,0,0),g=new tf(new Jo({uniforms:{tDiffuse:{value:null},bloomTexture:{value:y}},vertexShader:"varying vec2 vUv;\n          void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n          }",fragmentShader:"uniform sampler2D tDiffuse;\n          uniform sampler2D bloomTexture;\n          varying vec2 vUv;\n          vec4 getTexture( sampler2D texelToLinearTexture ) {\n            return mapTexelToLinear( texture2D( texelToLinearTexture , vUv ) );\n          }\n          void main() {\n            gl_FragColor = ( getTexture(tDiffuse) + vec4( 1.0 ) * getTexture( bloomTexture ) );\n          }",defines:{}})),v=new tf(lf),cf.scene.add((e=new to({color:3355443,wireframe:!0}),e.polygonOffset=!0,e.polygonOffsetFactor=1,r=new jo(new da(1024,1024,32,32),e),r.position.set(0,0,-50),r));const a=new ta(30,1.5,1,100);o.projector&&o.projector.position?cf.projector=new d(a,...o.projector.position,hf):cf.projector=new d(a,0,-512,0,hf),cf.scene.add(cf.projector.helper),cf.scene.add(cf.projector.light),cf.scene.add(cf.projector.lightHelper),cf.scene.add(cf.projector.handle);const s=new qd([cf.projector.handle],cf.camera,cf.renderer.domElement);s.addEventListener("dragstart",(()=>{cf.orbitControls.enabled=!1})),s.addEventListener("dragend",(()=>{cf.orbitControls.enabled=!0})),cf.projector.attachDragControls(s),cf.scene.add((()=>{t=new pl(i),t.minFilter=1006,cf.projectedMaterial=new Xd({camera:cf.projector.camera,texture:t,color:"#000000"});let e,r=new ou;return e=o.camera&&o.camera.position?new o.stageSet(cf.projectedMaterial):new _f(cf.projectedMaterial,!0),r.add(e.mesh),r.traverse((t=>{t.layers.enable(1)})),r})()),cf.renderer.autoClear=!1}function w(){requestAnimationFrame(w),function(){cf.projectedMaterial&&cf.projectedMaterial.map&&(cf.projectedMaterial.map.needsUpdate=!0);cf.projectedMaterial&&cf.projectedMaterial.uniforms&&(cf.projectedMaterial.uniforms.texture.value.needsUpdate=!0);cf.renderer.setRenderTarget(y),cf.renderer.clear(),cf.renderer.clearDepth(),cf.camera.layers.set(1),cf.renderer.render(cf.scene,cf.camera),m.render(cf.renderer,null,y,0,!1),cf.renderer.setRenderTarget(x),cf.renderer.clear(),cf.renderer.clearDepth(),cf.camera.layers.set(0),cf.renderer.render(cf.scene,cf.camera),g.renderToScreen=!1,g.render(cf.renderer,b,x),v.renderToScreen=!0,v.render(cf.renderer,null,b)}()}return t.$$set=t=>{"canvas"in t&&r(1,i=t.canvas),"stageSetup"in t&&r(2,o=t.stageSetup)},t.$$.update=()=>{12&t.$$.dirty&&o!==s&&(cf.scene=null,cf.scene=new ni,window.removeEventListener("resize",f),(async()=>{await _(),w()})(),r(3,s=o))},[n,i,o,s,function(t){R[t?"unshift":"push"]((()=>{n=t,r(0,n)}))}]}class Ef extends et{constructor(t){super(),tt(this,t,Tf,wf,o,{canvas:1,stageSetup:2})}}const Sf={manager:nt(null)};var Af={word:nt(null),char:nt(null),beat:{progress:nt(0),position:nt({position:1,length:1})},chorus:{now:nt(!1)},vocalAmplitude:{ratio:nt(0)}},Pf="object"==typeof global&&global&&global.Object===Object&&global,Mf="object"==typeof self&&self&&self.Object===Object&&self,If=Pf||Mf||Function("return this")(),Of=If.Symbol,Cf=Object.prototype,Rf=Cf.hasOwnProperty,Lf=Cf.toString,Nf=Of?Of.toStringTag:void 0;var Ff=Object.prototype.toString;var Df=Of?Of.toStringTag:void 0;function Uf(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Df&&Df in Object(t)?function(t){var e=Rf.call(t,Nf),r=t[Nf];try{t[Nf]=void 0;var n=!0}catch(t){}var i=Lf.call(t);return n&&(e?t[Nf]=r:delete t[Nf]),i}(t):function(t){return Ff.call(t)}(t)}function kf(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var jf=/^\s+|\s+$/g,Bf=/^[-+]0x[0-9a-f]+$/i,zf=/^0b[01]+$/i,Gf=/^0o[0-7]+$/i,Vf=parseInt;function Hf(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==Uf(t)}(t))return NaN;if(kf(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=kf(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(jf,"");var r=zf.test(t);return r||Gf.test(t)?Vf(t.slice(2),r?2:8):Bf.test(t)?NaN:+t}var Xf=function(){return If.Date.now()},Wf=Math.max,Yf=Math.min;function qf(t,e,r){var n,i,o,a,s,u,l=0,c=!1,h=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function d(e){var r=n,o=i;return n=i=void 0,l=e,a=t.apply(o,r)}function f(t){return l=t,s=setTimeout(g,e),c?d(t):a}function m(t){var r=t-u;return void 0===u||r>=e||r<0||h&&t-l>=o}function g(){var t=Xf();if(m(t))return v(t);s=setTimeout(g,function(t){var r=e-(t-u);return h?Yf(r,o-(t-l)):r}(t))}function v(t){return s=void 0,p&&n?d(t):(n=i=void 0,a)}function y(){var t=Xf(),r=m(t);if(n=arguments,i=this,u=t,r){if(void 0===s)return f(u);if(h)return clearTimeout(s),s=setTimeout(g,e),d(u)}return void 0===s&&(s=setTimeout(g,e)),a}return e=Hf(e)||0,kf(r)&&(c=!!r.leading,o=(h="maxWait"in r)?Wf(Hf(r.maxWait)||0,e):o,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==s&&clearTimeout(s),l=0,n=u=i=s=void 0},y.flush=function(){return void 0===s?a:v(Xf())},y}function $f(e){let r,n,i;return{c(){r=v("svg"),n=v("circle"),w(n,"role","presentation"),w(n,"cx","16"),w(n,"cy","16"),w(n,"r",e[4]),w(n,"stroke",e[2]),w(n,"fill","none"),w(n,"stroke-width",e[3]),w(n,"stroke-dasharray",i=e[5]+",100"),w(n,"stroke-linecap","round"),w(r,"height",e[0]),w(r,"width",e[0]),E(r,"animation-duration",e[1]+"ms"),w(r,"class","svelte-spinner svelte-e7457c"),w(r,"viewBox","0 0 32 32")},m(t,e){d(t,r,e),p(r,n)},p(t,[e]){16&e&&w(n,"r",t[4]),4&e&&w(n,"stroke",t[2]),8&e&&w(n,"stroke-width",t[3]),32&e&&i!==(i=t[5]+",100")&&w(n,"stroke-dasharray",i),1&e&&w(r,"height",t[0]),1&e&&w(r,"width",t[0]),2&e&&E(r,"animation-duration",t[1]+"ms")},i:t,o:t,d(t){t&&f(r)}}}function Qf(t,e,r){let n,{size:i=25}=e,{speed:o=750}=e,{color:a="rgba(0,0,0,0.4)"}=e,{thickness:s=2}=e,{gap:u=40}=e,{radius:l=10}=e;return t.$$set=t=>{"size"in t&&r(0,i=t.size),"speed"in t&&r(1,o=t.speed),"color"in t&&r(2,a=t.color),"thickness"in t&&r(3,s=t.thickness),"gap"in t&&r(6,u=t.gap),"radius"in t&&r(4,l=t.radius)},t.$$.update=()=>{80&t.$$.dirty&&r(5,n=2*Math.PI*l*(100-u)/100)},[i,o,a,s,l,n,u]}class Zf extends et{constructor(t){super(),tt(this,t,Qf,$f,o,{size:0,speed:1,color:2,thickness:3,gap:6,radius:4})}}function Jf(t){let e,r,n;return r=new Zf({props:{size:"70",speed:"2500",color:"#319795",thickness:"3",gap:"40"}}),{c(){e=g("div"),Q(r.$$.fragment),w(e,"class","z-10 absolute top-0 bottom-0 left-0 right-0 flex items-center justify-center")},m(t,i){d(t,e,i),Z(r,e,null),n=!0},i(t){n||(Y(r.$$.fragment,t),n=!0)},o(t){q(r.$$.fragment,t),n=!1},d(t){t&&f(e),J(r)}}}function Kf(t){let e,r,n,i,o=t[0]&&Jf();return{c(){e=g("div"),r=x(),o&&o.c(),n=b()},m(a,s){d(a,e,s),t[7](e),d(a,r,s),o&&o.m(a,s),d(a,n,s),i=!0},p(t,[e]){t[0]?o?1&e&&Y(o,1):(o=Jf(),o.c(),Y(o,1),o.m(n.parentNode,n)):o&&(X(),q(o,1,1,(()=>{o=null})),W())},i(t){i||(Y(o),i=!0)},o(t){q(o),i=!1},d(i){i&&f(e),t[7](null),i&&f(r),o&&o.d(i),i&&f(n)}}}function tm(t,e,r){let{source:n=""}=e,{canvas:i=null}=e,{editMode:o}=e;const a=nt(o);let s,u,l,c,h,p={id:0,name:"App",type:"svelte",source:n},d=[p];const f=new Worker("./build/workers/repl.js");f.addEventListener("message",(t=>{r(5,s=t.data),r(0,l=!1),r(6,u=!0)}));const m=qf((t=>{return e=t,r(0,l=!0),void f.postMessage(e);var e}),1e3);return t.$$set=t=>{"source"in t&&r(2,n=t.source),"canvas"in t&&r(3,i=t.canvas),"editMode"in t&&r(4,o=t.editMode)},t.$$.update=()=>{16&t.$$.dirty&&a.set(o),4&t.$$.dirty&&n&&(p.source=n,m(d)),96&t.$$.dirty&&u&&function(t){if(r(6,u=null),!h)return;const e=new Blob([t],{type:"text/javascript"}),n=URL.createObjectURL(e);import(n).then((({default:t})=>{c&&c.$destroy(),r(1,h.innerHTML="",h),c=new t({target:h,props:{canvas:i,editMode:a,store:Af}})}))}(s)},[l,h,n,i,o,s,u,function(t){R[t?"unshift":"push"]((()=>{h=t,r(1,h)}))}]}class em extends et{constructor(t){super(),tt(this,t,tm,Kf,o,{source:2,canvas:3,editMode:4})}}function rm(t,e,r={}){const n=Object.assign({tab:"\t",indentOn:/{$/,spellcheck:!1,addClosing:!0},r);let i,o,a=[],s=[],u=-1,l=!1,c=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;t.setAttribute("contentEditable",c?"true":"plaintext-only"),t.setAttribute("spellcheck",n.spellcheck?"true":"false"),t.style.outline="none",t.style.overflowWrap="break-word",t.style.overflowY="auto",t.style.resize="vertical",t.style.whiteSpace="pre-wrap",e(t);const h=A((()=>{const r=g();e(t),v(r)}),30);let p=!1;const d=t=>!T(t)&&!E(t)&&"Meta"!==t.key&&"Control"!==t.key&&"Alt"!==t.key&&!t.key.startsWith("Arrow"),f=A((t=>{d(t)&&(b(),p=!1)}),300),m=(e,r)=>{a.push([e,r]),t.addEventListener(e,r)};function g(){const e=window.getSelection(),r={start:0,end:0,dir:void 0};return _(t,(t=>{if(t===e.anchorNode&&t===e.focusNode)return r.start+=e.anchorOffset,r.end+=e.focusOffset,r.dir=e.anchorOffset<=e.focusOffset?"->":"<-","stop";if(t===e.anchorNode){if(r.start+=e.anchorOffset,r.dir)return"stop";r.dir="->"}else if(t===e.focusNode){if(r.end+=e.focusOffset,r.dir)return"stop";r.dir="<-"}t.nodeType===Node.TEXT_NODE&&("->"!=r.dir&&(r.start+=t.nodeValue.length),"<-"!=r.dir&&(r.end+=t.nodeValue.length))})),r}function v(e){const r=window.getSelection();let n,i,o=0,a=0;if(e.dir||(e.dir="->"),e.start<0&&(e.start=0),e.end<0&&(e.end=0),"<-"==e.dir){const{start:t,end:r}=e;e.start=r,e.end=t}let s=0;_(t,(t=>{if(t.nodeType!==Node.TEXT_NODE)return;const r=(t.nodeValue||"").length;if(s+r>=e.start&&(n||(n=t,o=e.start-s),s+r>=e.end))return i=t,a=e.end-s,"stop";s+=r})),n||(n=t),i||(i=t),"<-"==e.dir&&([n,o,i,a]=[i,a,n,o]),r.setBaseAndExtent(n,o,i,a)}function y(){const e=window.getSelection().getRangeAt(0),r=document.createRange();return r.selectNodeContents(t),r.setEnd(e.startContainer,e.startOffset),r.toString()}function x(){const e=window.getSelection().getRangeAt(0),r=document.createRange();return r.selectNodeContents(t),r.setStart(e.endContainer,e.endOffset),r.toString()}function b(){if(!l)return;const e=t.innerHTML,r=g(),n=s[u];if(n&&n.html===e&&n.pos.start===r.start&&n.pos.end===r.end)return;u++,s[u]={html:e,pos:r},s.splice(u+1);u>300&&(u=300,s.splice(0,1))}function _(t,e){const r=[];t.firstChild&&r.push(t.firstChild);let n=r.pop();for(;n&&"stop"!==e(n);)n.nextSibling&&r.push(n.nextSibling),n.firstChild&&r.push(n.firstChild),n=r.pop()}function w(t){return t.metaKey||t.ctrlKey}function T(t){return w(t)&&!t.shiftKey&&"z"===t.key}function E(t){return w(t)&&t.shiftKey&&"z"===t.key}function S(t){t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),document.execCommand("insertHTML",!1,t)}function A(t,e){let r=0;return(...n)=>{clearTimeout(r),r=window.setTimeout((()=>t(...n)),e)}}function P(t){let e=t.length-1;for(;e>=0&&"\n"!==t[e];)e--;e++;let r=e;for(;r<t.length&&/[ \t]/.test(t[r]);)r++;return[t.substring(e,r)||"",e,r]}function M(){return t.textContent||""}function I(t){t.preventDefault()}return m("keydown",(e=>{e.defaultPrevented||(o=M(),function(t){if("Enter"===t.key){const e=y(),r=x();let[i]=P(e),o=i;if(n.indentOn.test(e)&&(o+=n.tab),(c||o.length>0)&&(I(t),S("\n"+o)),o!==i&&"}"===r[0]){const t=g();S("\n"+i),v(t)}}}(e),function(t){if("Tab"===t.key)if(I(t),t.shiftKey){const t=y();let[e,r]=P(t);if(e.length>0){const t=g(),i=Math.min(n.tab.length,e.length);v({start:r,end:r+i}),document.execCommand("delete"),t.start-=i,t.end-=i,v(t)}}else S(n.tab)}(e),n.addClosing&&function(t){const e="([{'\"",r=")]}'\"",n=x();if(r.includes(t.key)&&n.substr(0,1)===t.key){const e=g();I(t),e.start=++e.end,v(e)}else if(e.includes(t.key)){const n=g();I(t);S(t.key+r[e.indexOf(t.key)]),n.start=++n.end,v(n)}}(e),function(e){if(T(e)){I(e),u--;const r=s[u];r&&(t.innerHTML=r.html,v(r.pos)),u<0&&(u=0)}if(E(e)){I(e),u++;const r=s[u];r&&(t.innerHTML=r.html,v(r.pos)),u>=s.length&&u--}}(e),d(e)&&!p&&(b(),p=!0))})),m("keyup",(t=>{t.defaultPrevented||t.isComposing||(o!==M()&&h(),f(t),i&&i(M()))})),m("focus",(t=>{l=!0})),m("blur",(t=>{l=!1})),m("paste",(r=>{b(),function(r){I(r);const n=(r.originalEvent||r).clipboardData.getData("text/plain"),i=g();S(n),e(t),v({start:i.start+n.length,end:i.start+n.length})}(r),b(),i&&i(M())})),{updateOptions(t){t=Object.assign(Object.assign({},t),t)},updateCode(r){t.textContent=r,e(t)},onUpdate(t){i=t},toString:M,destroy(){for(let[e,r]of a)t.removeEventListener(e,r)}}}var nm=Qr((function(t){var e=function(t){var e=/\blang(?:uage)?-([\w-]+)\b/i,r=0,n={manual:t.Prism&&t.Prism.manual,disableWorkerMessageHandler:t.Prism&&t.Prism.disableWorkerMessageHandler,util:{encode:function t(e){return e instanceof i?new i(e.type,t(e.content),e.alias):Array.isArray(e)?e.map(t):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(t){return Object.prototype.toString.call(t).slice(8,-1)},objId:function(t){return t.__id||Object.defineProperty(t,"__id",{value:++r}),t.__id},clone:function t(e,r){var i,o;switch(r=r||{},n.util.type(e)){case"Object":if(o=n.util.objId(e),r[o])return r[o];for(var a in i={},r[o]=i,e)e.hasOwnProperty(a)&&(i[a]=t(e[a],r));return i;case"Array":return o=n.util.objId(e),r[o]?r[o]:(i=[],r[o]=i,e.forEach((function(e,n){i[n]=t(e,r)})),i);default:return e}},getLanguage:function(t){for(;t&&!e.test(t.className);)t=t.parentElement;return t?(t.className.match(e)||[,"none"])[1].toLowerCase():"none"},currentScript:function(){if("undefined"==typeof document)return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(n){var t=(/at [^(\r\n]*\((.*):.+:.+\)$/i.exec(n.stack)||[])[1];if(t){var e=document.getElementsByTagName("script");for(var r in e)if(e[r].src==t)return e[r]}return null}},isActive:function(t,e,r){for(var n="no-"+e;t;){var i=t.classList;if(i.contains(e))return!0;if(i.contains(n))return!1;t=t.parentElement}return!!r}},languages:{extend:function(t,e){var r=n.util.clone(n.languages[t]);for(var i in e)r[i]=e[i];return r},insertBefore:function(t,e,r,i){var o=(i=i||n.languages)[t],a={};for(var s in o)if(o.hasOwnProperty(s)){if(s==e)for(var u in r)r.hasOwnProperty(u)&&(a[u]=r[u]);r.hasOwnProperty(s)||(a[s]=o[s])}var l=i[t];return i[t]=a,n.languages.DFS(n.languages,(function(e,r){r===l&&e!=t&&(this[e]=a)})),a},DFS:function t(e,r,i,o){o=o||{};var a=n.util.objId;for(var s in e)if(e.hasOwnProperty(s)){r.call(e,s,e[s],i||s);var u=e[s],l=n.util.type(u);"Object"!==l||o[a(u)]?"Array"!==l||o[a(u)]||(o[a(u)]=!0,t(u,r,s,o)):(o[a(u)]=!0,t(u,r,null,o))}}},plugins:{},highlightAll:function(t,e){n.highlightAllUnder(document,t,e)},highlightAllUnder:function(t,e,r){var i={callback:r,container:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",i),i.elements=Array.prototype.slice.apply(i.container.querySelectorAll(i.selector)),n.hooks.run("before-all-elements-highlight",i);for(var o,a=0;o=i.elements[a++];)n.highlightElement(o,!0===e,i.callback)},highlightElement:function(r,i,o){var a=n.util.getLanguage(r),s=n.languages[a];r.className=r.className.replace(e,"").replace(/\s+/g," ")+" language-"+a;var u=r.parentElement;u&&"pre"===u.nodeName.toLowerCase()&&(u.className=u.className.replace(e,"").replace(/\s+/g," ")+" language-"+a);var l={element:r,language:a,grammar:s,code:r.textContent};function c(t){l.highlightedCode=t,n.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,n.hooks.run("after-highlight",l),n.hooks.run("complete",l),o&&o.call(l.element)}if(n.hooks.run("before-sanity-check",l),!l.code)return n.hooks.run("complete",l),void(o&&o.call(l.element));if(n.hooks.run("before-highlight",l),l.grammar)if(i&&t.Worker){var h=new Worker(n.filename);h.onmessage=function(t){c(t.data)},h.postMessage(JSON.stringify({language:l.language,code:l.code,immediateClose:!0}))}else c(n.highlight(l.code,l.grammar,l.language));else c(n.util.encode(l.code))},highlight:function(t,e,r){var o={code:t,grammar:e,language:r};return n.hooks.run("before-tokenize",o),o.tokens=n.tokenize(o.code,o.grammar),n.hooks.run("after-tokenize",o),i.stringify(n.util.encode(o.tokens),o.language)},tokenize:function(t,e){var r=e.rest;if(r){for(var n in r)e[n]=r[n];delete e.rest}var i=new s;return u(i,i.head,t),a(t,i,e,i.head,0),function(t){var e=[],r=t.head.next;for(;r!==t.tail;)e.push(r.value),r=r.next;return e}(i)},hooks:{all:{},add:function(t,e){var r=n.hooks.all;r[t]=r[t]||[],r[t].push(e)},run:function(t,e){var r=n.hooks.all[t];if(r&&r.length)for(var i,o=0;i=r[o++];)i(e)}},Token:i};function i(t,e,r,n){this.type=t,this.content=e,this.alias=r,this.length=0|(n||"").length}function o(t,e,r,n){t.lastIndex=e;var i=t.exec(r);if(i&&n&&i[1]){var o=i[1].length;i.index+=o,i[0]=i[0].slice(o)}return i}function a(t,e,r,s,c,h){for(var p in r)if(r.hasOwnProperty(p)&&r[p]){var d=r[p];d=Array.isArray(d)?d:[d];for(var f=0;f<d.length;++f){if(h&&h.cause==p+","+f)return;var m=d[f],g=m.inside,v=!!m.lookbehind,y=!!m.greedy,x=m.alias;if(y&&!m.pattern.global){var b=m.pattern.toString().match(/[imsuy]*$/)[0];m.pattern=RegExp(m.pattern.source,b+"g")}for(var _=m.pattern||m,w=s.next,T=c;w!==e.tail&&!(h&&T>=h.reach);T+=w.value.length,w=w.next){var E=w.value;if(e.length>t.length)return;if(!(E instanceof i)){var S,A=1;if(y){if(!(S=o(_,T,t,v)))break;var P=S.index,M=S.index+S[0].length,I=T;for(I+=w.value.length;P>=I;)I+=(w=w.next).value.length;if(T=I-=w.value.length,w.value instanceof i)continue;for(var O=w;O!==e.tail&&(I<M||"string"==typeof O.value);O=O.next)A++,I+=O.value.length;A--,E=t.slice(T,I),S.index-=T}else if(!(S=o(_,0,E,v)))continue;P=S.index;var C=S[0],R=E.slice(0,P),L=E.slice(P+C.length),N=T+E.length;h&&N>h.reach&&(h.reach=N);var F=w.prev;R&&(F=u(e,F,R),T+=R.length),l(e,F,A),w=u(e,F,new i(p,g?n.tokenize(C,g):C,x,C)),L&&u(e,w,L),A>1&&a(t,e,r,w.prev,T,{cause:p+","+f,reach:N})}}}}}function s(){var t={value:null,prev:null,next:null},e={value:null,prev:t,next:null};t.next=e,this.head=t,this.tail=e,this.length=0}function u(t,e,r){var n=e.next,i={value:r,prev:e,next:n};return e.next=i,n.prev=i,t.length++,i}function l(t,e,r){for(var n=e.next,i=0;i<r&&n!==t.tail;i++)n=n.next;e.next=n,n.prev=e,t.length-=i}if(t.Prism=n,i.stringify=function t(e,r){if("string"==typeof e)return e;if(Array.isArray(e)){var i="";return e.forEach((function(e){i+=t(e,r)})),i}var o={type:e.type,content:t(e.content,r),tag:"span",classes:["token",e.type],attributes:{},language:r},a=e.alias;a&&(Array.isArray(a)?Array.prototype.push.apply(o.classes,a):o.classes.push(a)),n.hooks.run("wrap",o);var s="";for(var u in o.attributes)s+=" "+u+'="'+(o.attributes[u]||"").replace(/"/g,"&quot;")+'"';return"<"+o.tag+' class="'+o.classes.join(" ")+'"'+s+">"+o.content+"</"+o.tag+">"},!t.document)return t.addEventListener?(n.disableWorkerMessageHandler||t.addEventListener("message",(function(e){var r=JSON.parse(e.data),i=r.language,o=r.code,a=r.immediateClose;t.postMessage(n.highlight(o,n.languages[i],i)),a&&t.close()}),!1),n):n;var c=n.util.currentScript();function h(){n.manual||n.highlightAll()}if(c&&(n.filename=c.src,c.hasAttribute("data-manual")&&(n.manual=!0)),!n.manual){var p=document.readyState;"loading"===p||"interactive"===p&&c&&c.defer?document.addEventListener("DOMContentLoaded",h):window.requestAnimationFrame?window.requestAnimationFrame(h):window.setTimeout(h,16)}return n}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{});
/**
   * Prism: Lightweight, robust, elegant syntax highlighting
   *
   * @license MIT <https://opensource.org/licenses/MIT>
   * @author Lea Verou <https://lea.verou.me>
   * @namespace
   * @public
   */t.exports&&(t.exports=e),void 0!==$r&&($r.Prism=e),e.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/,name:/[^\s<>'"]+/}},cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},e.languages.markup.tag.inside["attr-value"].inside.entity=e.languages.markup.entity,e.languages.markup.doctype.inside["internal-subset"].inside=e.languages.markup,e.hooks.add("wrap",(function(t){"entity"===t.type&&(t.attributes.title=t.content.replace(/&amp;/,"&"))})),Object.defineProperty(e.languages.markup.tag,"addInlined",{value:function(t,r){var n={};n["language-"+r]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:e.languages[r]},n.cdata=/^<!\[CDATA\[|\]\]>$/i;var i={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};i["language-"+r]={pattern:/[\s\S]+/,inside:e.languages[r]};var o={};o[t]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,(function(){return t})),"i"),lookbehind:!0,greedy:!0,inside:i},e.languages.insertBefore("markup","cdata",o)}}),e.languages.html=e.languages.markup,e.languages.mathml=e.languages.markup,e.languages.svg=e.languages.markup,e.languages.xml=e.languages.extend("markup",{}),e.languages.ssml=e.languages.xml,e.languages.atom=e.languages.xml,e.languages.rss=e.languages.xml,function(t){var e=/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/;t.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-](?:[^;{\s]|\s+(?![\s{]))*(?:;|(?=\s*\{))/,inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+e.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+e.source+"$"),alias:"url"}}},selector:RegExp("[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+e.source+")*(?=\\s*\\{)"),string:{pattern:e,greedy:!0},property:/(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,important:/!important\b/i,function:/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:,]/},t.languages.css.atrule.inside.rest=t.languages.css;var r=t.languages.markup;r&&(r.tag.addInlined("style","css"),t.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/(^|["'\s])style\s*=\s*(?:"[^"]*"|'[^']*')/i,lookbehind:!0,inside:{"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{style:{pattern:/(["'])[\s\S]+(?=["']$)/,lookbehind:!0,alias:"language-css",inside:t.languages.css},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}},"attr-name":/^style/i}}},r.tag))}(e),e.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|interface|extends|implements|trait|instanceof|new)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(?:true|false)\b/,function:/\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},e.languages.javascript=e.languages.extend("clike",{"class-name":[e.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:prototype|constructor))/,lookbehind:!0}],keyword:[{pattern:/((?:^|})\s*)(?:catch|finally)\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|(?:get|set)(?=\s*[\[$\w\xA0-\uFFFF])|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:/\b(?:(?:0[xX](?:[\dA-Fa-f](?:_[\dA-Fa-f])?)+|0[bB](?:[01](?:_[01])?)+|0[oO](?:[0-7](?:_[0-7])?)+)n?|(?:\d(?:_\d)?)+n|NaN|Infinity)\b|(?:\b(?:\d(?:_\d)?)+\.?(?:\d(?:_\d)?)*|\B\.(?:\d(?:_\d)?)+)(?:[Ee][+-]?(?:\d(?:_\d)?)+)?/,operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),e.languages.javascript["class-name"][0].pattern=/(\b(?:class|interface|extends|implements|instanceof|new)\s+)[\w.\\]+/,e.languages.insertBefore("javascript","keyword",{regex:{pattern:/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)\/(?:\[(?:[^\]\\\r\n]|\\.)*]|\\.|[^/\\\[\r\n])+\/[gimyus]{0,6}(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/,lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:e.languages.regex},"regex-flags":/[a-z]+$/,"regex-delimiter":/^\/|\/$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:e.languages.javascript},{pattern:/(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,inside:e.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:e.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:e.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),e.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}|(?!\${)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\${|}$/,alias:"punctuation"},rest:e.languages.javascript}},string:/[\s\S]+/}}}),e.languages.markup&&e.languages.markup.tag.addInlined("script","javascript"),e.languages.js=e.languages.javascript,function(){if("undefined"!=typeof self&&self.Prism&&self.document){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var t=window.Prism,e={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},r="data-src-status",n="loading",i="loaded",o='pre[data-src]:not([data-src-status="loaded"]):not([data-src-status="loading"])',a=/\blang(?:uage)?-([\w-]+)\b/i;t.hooks.add("before-highlightall",(function(t){t.selector+=", "+o})),t.hooks.add("before-sanity-check",(function(a){var s=a.element;if(s.matches(o)){a.code="",s.setAttribute(r,n);var l=s.appendChild(document.createElement("CODE"));l.textContent="Loading…";var c=s.getAttribute("data-src"),h=a.language;if("none"===h){var p=(/\.(\w+)$/.exec(c)||[,"none"])[1];h=e[p]||p}u(l,h),u(s,h);var d=t.plugins.autoloader;d&&d.loadLanguages(h);var f=new XMLHttpRequest;f.open("GET",c,!0),f.onreadystatechange=function(){var e,n;4==f.readyState&&(f.status<400&&f.responseText?(s.setAttribute(r,i),l.textContent=f.responseText,t.highlightElement(l)):(s.setAttribute(r,"failed"),f.status>=400?l.textContent=(e=f.status,n=f.statusText,"✖ Error "+e+" while fetching file: "+n):l.textContent="✖ Error: File does not exist or is empty"))},f.send(null)}})),t.plugins.fileHighlight={highlight:function(e){for(var r,n=(e||document).querySelectorAll(o),i=0;r=n[i++];)t.highlightElement(r)}};var s=!1;t.fileHighlight=function(){s||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),s=!0),t.plugins.fileHighlight.highlight.apply(this,arguments)}}function u(t,e){var r=t.className;r=r.replace(a," ")+" language-"+e,t.className=r.replace(/\s+/g," ").trim()}}()}));const im="(if|else if|await|then|catch|each|html|debug)";function om(e){let r,n;return{c(){r=g("div"),n=g("div"),w(n,"class","editor language-svelte svelte-wmc9wv"),w(r,"class","input-outer svelte-wmc9wv")},m(t,i){d(t,r,i),p(r,n),e[2](n)},p:t,i:t,o:t,d(t){t&&f(r),e[2](null)}}}function am(t,e,r){let n,i,{code:o=""}=e;return I((()=>{i=rm(n,nm.highlightElement,{tab:"    "}),i.updateCode(o),i.onUpdate((t=>{r(1,o=t)}))})),t.$$set=t=>{"code"in t&&r(1,o=t.code)},[n,o,function(t){R[t?"unshift":"push"]((()=>{n=t,r(0,n)}))}]}Prism.languages.svelte=Prism.languages.extend("markup",{each:{pattern:new RegExp("{[#/]each(?:(?:\\{(?:(?:\\{(?:[^{}])*\\})|(?:[^{}]))*\\})|(?:[^{}]))*}"),inside:{"language-javascript":[{pattern:/(as[\s\S]*)\([\s\S]*\)(?=\s*\})/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(as[\s]*)[\s\S]*(?=\s*)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(#each[\s]*)[\s\S]*(?=as)/,lookbehind:!0,inside:Prism.languages.javascript}],keyword:/[#/]each|as/,punctuation:/{|}/}},block:{pattern:new RegExp("{[#:/@]/s"+im+"(?:(?:\\{(?:(?:\\{(?:[^{}])*\\})|(?:[^{}]))*\\})|(?:[^{}]))*}"),inside:{punctuation:/^{|}$/,keyword:[new RegExp("[#:/@]"+im+"( )*"),/as/,/then/],"language-javascript":{pattern:/[\s\S]*/,inside:Prism.languages.javascript}}},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?:"[^"]*"|'[^']*'|{[\s\S]+?}(?=[\s/>])))|(?=[\s/>])))+)?\s*\/?>/i,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"language-javascript":{pattern:/\{(?:(?:\{(?:(?:\{(?:[^{}])*\})|(?:[^{}]))*\})|(?:[^{}]))*\}/,inside:Prism.languages.javascript},"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/i,inside:{punctuation:[/^=/,{pattern:/^(\s*)["']|["']$/,lookbehind:!0}],"language-javascript":{pattern:/{[\s\S]+}/,inside:Prism.languages.javascript}}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},"language-javascript":{pattern:/\{(?:(?:\{(?:(?:\{(?:[^{}])*\})|(?:[^{}]))*\})|(?:[^{}]))*\}/,lookbehind:!0,inside:Prism.languages.javascript}}),Prism.languages.svelte.tag.inside["attr-value"].inside.entity=Prism.languages.svelte.entity,Prism.hooks.add("wrap",(t=>{"entity"===t.type&&(t.attributes.title=t.content.replace(/&amp;/,"&"))})),Object.defineProperty(Prism.languages.svelte.tag,"addInlined",{value:function(t,e){const r={};r["language-"+e]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:Prism.languages[e]},r.cdata=/^<!\[CDATA\[|\]\]>$/i;const n={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:r}};n["language-"+e]={pattern:/[\s\S]+/,inside:Prism.languages[e]};const i={};i[t]={pattern:RegExp(/(<__[\s\S]*?>)(?:<!\[CDATA\[[\s\S]*?\]\]>\s*|[\s\S])*?(?=<\/__>)/.source.replace(/__/g,t),"i"),lookbehind:!0,greedy:!0,inside:n},Prism.languages.insertBefore("svelte","cdata",i)}}),Prism.languages.svelte.tag.addInlined("style","css"),Prism.languages.svelte.tag.addInlined("script","javascript");class sm extends et{constructor(t){super(),tt(this,t,am,om,o,{code:1})}}var um=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}},lm=Object.prototype.toString;function cm(t){return"[object Array]"===lm.call(t)}function hm(t){return void 0===t}function pm(t){return null!==t&&"object"==typeof t}function dm(t){return"[object Function]"===lm.call(t)}function fm(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),cm(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}var mm={isArray:cm,isArrayBuffer:function(t){return"[object ArrayBuffer]"===lm.call(t)},isBuffer:function(t){return null!==t&&!hm(t)&&null!==t.constructor&&!hm(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:pm,isUndefined:hm,isDate:function(t){return"[object Date]"===lm.call(t)},isFile:function(t){return"[object File]"===lm.call(t)},isBlob:function(t){return"[object Blob]"===lm.call(t)},isFunction:dm,isStream:function(t){return pm(t)&&dm(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:fm,merge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]=r}for(var n=0,i=arguments.length;n<i;n++)fm(arguments[n],r);return e},deepMerge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]="object"==typeof r?t({},r):r}for(var n=0,i=arguments.length;n<i;n++)fm(arguments[n],r);return e},extend:function(t,e,r){return fm(e,(function(e,n){t[n]=r&&"function"==typeof e?um(e,r):e})),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}};function gm(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var vm=function(t,e,r){if(!e)return t;var n;if(r)n=r(e);else if(mm.isURLSearchParams(e))n=e.toString();else{var i=[];mm.forEach(e,(function(t,e){null!=t&&(mm.isArray(t)?e+="[]":t=[t],mm.forEach(t,(function(t){mm.isDate(t)?t=t.toISOString():mm.isObject(t)&&(t=JSON.stringify(t)),i.push(gm(e)+"="+gm(t))})))})),n=i.join("&")}if(n){var o=t.indexOf("#");-1!==o&&(t=t.slice(0,o)),t+=(-1===t.indexOf("?")?"?":"&")+n}return t};function ym(){this.handlers=[]}ym.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},ym.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},ym.prototype.forEach=function(t){mm.forEach(this.handlers,(function(e){null!==e&&t(e)}))};var xm=ym,bm=function(t,e,r){return mm.forEach(r,(function(r){t=r(t,e)})),t},_m=function(t){return!(!t||!t.__CANCEL__)},wm=function(t,e){mm.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))},Tm=function(t,e,r,n,i){return function(t,e,r,n,i){return t.config=e,r&&(t.code=r),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}(new Error(t),e,r,n,i)},Em=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Sm=mm.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=n(window.location.href),function(e){var r=mm.isString(e)?n(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0},Am=mm.isStandardBrowserEnv()?{write:function(t,e,r,n,i,o){var a=[];a.push(t+"="+encodeURIComponent(e)),mm.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),mm.isString(n)&&a.push("path="+n),mm.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Pm=function(t){return new Promise((function(e,r){var n=t.data,i=t.headers;mm.isFormData(n)&&delete i["Content-Type"];var o=new XMLHttpRequest;if(t.auth){var a=t.auth.username||"",s=t.auth.password||"";i.Authorization="Basic "+btoa(a+":"+s)}var u,l,c=(u=t.baseURL,l=t.url,u&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(l)?function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}(u,l):l);if(o.open(t.method.toUpperCase(),vm(c,t.params,t.paramsSerializer),!0),o.timeout=t.timeout,o.onreadystatechange=function(){if(o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))){var n,i,a,s,u,l="getAllResponseHeaders"in o?(n=o.getAllResponseHeaders(),u={},n?(mm.forEach(n.split("\n"),(function(t){if(s=t.indexOf(":"),i=mm.trim(t.substr(0,s)).toLowerCase(),a=mm.trim(t.substr(s+1)),i){if(u[i]&&Em.indexOf(i)>=0)return;u[i]="set-cookie"===i?(u[i]?u[i]:[]).concat([a]):u[i]?u[i]+", "+a:a}})),u):u):null,c={data:t.responseType&&"text"!==t.responseType?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:l,config:t,request:o};!function(t,e,r){var n=r.config.validateStatus;!n||n(r.status)?t(r):e(Tm("Request failed with status code "+r.status,r.config,null,r.request,r))}(e,r,c),o=null}},o.onabort=function(){o&&(r(Tm("Request aborted",t,"ECONNABORTED",o)),o=null)},o.onerror=function(){r(Tm("Network Error",t,null,o)),o=null},o.ontimeout=function(){var e="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),r(Tm(e,t,"ECONNABORTED",o)),o=null},mm.isStandardBrowserEnv()){var h=Am,p=(t.withCredentials||Sm(c))&&t.xsrfCookieName?h.read(t.xsrfCookieName):void 0;p&&(i[t.xsrfHeaderName]=p)}if("setRequestHeader"in o&&mm.forEach(i,(function(t,e){void 0===n&&"content-type"===e.toLowerCase()?delete i[e]:o.setRequestHeader(e,t)})),mm.isUndefined(t.withCredentials)||(o.withCredentials=!!t.withCredentials),t.responseType)try{o.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&o.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&o.upload&&o.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){o&&(o.abort(),r(t),o=null)})),void 0===n&&(n=null),o.send(n)}))},Mm={"Content-Type":"application/x-www-form-urlencoded"};function Im(t,e){!mm.isUndefined(t)&&mm.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var Om,Cm={adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Om=Pm),Om),transformRequest:[function(t,e){return wm(e,"Accept"),wm(e,"Content-Type"),mm.isFormData(t)||mm.isArrayBuffer(t)||mm.isBuffer(t)||mm.isStream(t)||mm.isFile(t)||mm.isBlob(t)?t:mm.isArrayBufferView(t)?t.buffer:mm.isURLSearchParams(t)?(Im(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):mm.isObject(t)?(Im(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};Cm.headers={common:{Accept:"application/json, text/plain, */*"}},mm.forEach(["delete","get","head"],(function(t){Cm.headers[t]={}})),mm.forEach(["post","put","patch"],(function(t){Cm.headers[t]=mm.merge(Mm)}));var Rm=Cm;function Lm(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var Nm=function(t){return Lm(t),t.headers=t.headers||{},t.data=bm(t.data,t.headers,t.transformRequest),t.headers=mm.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),mm.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||Rm.adapter)(t).then((function(e){return Lm(t),e.data=bm(e.data,e.headers,t.transformResponse),e}),(function(e){return _m(e)||(Lm(t),e&&e.response&&(e.response.data=bm(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))},Fm=function(t,e){e=e||{};var r={},n=["url","method","params","data"],i=["headers","auth","proxy"],o=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];mm.forEach(n,(function(t){void 0!==e[t]&&(r[t]=e[t])})),mm.forEach(i,(function(n){mm.isObject(e[n])?r[n]=mm.deepMerge(t[n],e[n]):void 0!==e[n]?r[n]=e[n]:mm.isObject(t[n])?r[n]=mm.deepMerge(t[n]):void 0!==t[n]&&(r[n]=t[n])})),mm.forEach(o,(function(n){void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n])}));var a=n.concat(i).concat(o),s=Object.keys(e).filter((function(t){return-1===a.indexOf(t)}));return mm.forEach(s,(function(n){void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n])})),r};function Dm(t){this.defaults=t,this.interceptors={request:new xm,response:new xm}}Dm.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=Fm(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=[Nm,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach((function(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function(t){e.push(t.fulfilled,t.rejected)}));e.length;)r=r.then(e.shift(),e.shift());return r},Dm.prototype.getUri=function(t){return t=Fm(this.defaults,t),vm(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},mm.forEach(["delete","get","head","options"],(function(t){Dm.prototype[t]=function(e,r){return this.request(mm.merge(r||{},{method:t,url:e}))}})),mm.forEach(["post","put","patch"],(function(t){Dm.prototype[t]=function(e,r,n){return this.request(mm.merge(n||{},{method:t,url:e,data:r}))}}));var Um=Dm;function km(t){this.message=t}km.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},km.prototype.__CANCEL__=!0;var jm=km;function Bm(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var r=this;t((function(t){r.reason||(r.reason=new jm(t),e(r.reason))}))}Bm.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Bm.source=function(){var t;return{token:new Bm((function(e){t=e})),cancel:t}};var zm=Bm;function Gm(t){var e=new Um(t),r=um(Um.prototype.request,e);return mm.extend(r,Um.prototype,e),mm.extend(r,e),r}var Vm=Gm(Rm);Vm.Axios=Um,Vm.create=function(t){return Gm(Fm(Vm.defaults,t))},Vm.Cancel=jm,Vm.CancelToken=zm,Vm.isCancel=_m,Vm.all=function(t){return Promise.all(t)},Vm.spread=function(t){return function(e){return t.apply(null,e)}};var Hm=Vm,Xm=Vm;Hm.default=Xm;var Wm=Hm,Ym={NONE:0,PHRASE:1,WORD:2,CHAR:4,GRAPHIC:8,ALL:63,PUBLIC:64},qm=/^https?:\/\/uploader\.ongaaccel\.jp\/files\?guid=([a-zA-Z0-9]+)/i,$m=/^https?:\/\/songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,Qm=/^uploaded:([a-zA-Z0-9]+)$/i,Zm=/^songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,Jm=/^https?:\/\/piapro\.jp\/t\/([^/]+)(\/[0-9]+)?$/i,Km={getSongPathFromUrl:function(t){if(Km.isUploaderUrl(t)){var e=$m.exec(t);if(e)return"songle.jp/uploads/"+e[1]+".mp3";var r=qm.exec(t);if(r)return"songle.jp/uploads/"+r[1]+".mp3"}return/https?:\/\/(.+)/.exec(t)[1]},isUploaderUrl:function(t){return $m.test(t)||qm.test(t)},isUploaderPath:function(t){return Zm.test(t)||Qm.test(t)},getUploaderGuid:function(t){var e=Zm.exec(t);if(e)return e[1];var r=Qm.exec(t);return r?r[1]:null},getSongUrlFromUploaderGuid:function(t){return t?"https://songle.jp/uploads/"+t+".mp3":null},getAltSongUrlFromUploaderGuid:function(t){return t?"https://api.textalive.jp/songle/me/uploads/"+t:null},getSongUrlFromPath:function(t){var e=Km.getUploaderGuid(t);return e?Km.getSongUrlFromUploaderGuid(e):"https://"+t},isYouTubeUrl:function(t){return/^https?:\/\/((www|m)\.)?youtube\.com/i.test(t)},isNicovideoUrl:function(t){return/^https?:\/\/(www\.)?nicovideo.jp/i.test(t)},isVideoSiteUrl:function(t){return Km.isYouTubeUrl(t)||Km.isNicovideoUrl(t)},isPiaproUrl:function(t){return Jm.test(t)}},tg=/^https:\/\/songle\.jp\/api\/v[0-9]+\/users\/(.+)\/uploads\/(.+)$/,eg=function(t){return tg.test(t)},rg=function(){function t(){}return t.prototype.isLicenseLoading=function(t){return!t||!t.song||void 0===t.lyrics||void 0===t.backgroundImage},t.prototype.checkLicenses=function(t){return!this.isLicenseLoading(t)&&this.checkLicense(t.song)&&this.checkLicense(t.lyrics)&&this.checkLicense(t.backgroundImage)},t.prototype.checkLicense=function(t){return null===t||(1===t.contentType?this.checkMusicLicense(t.license):2===t.contentType?this.checkTextLicense(t.license):0===t.contentType&&(!!this.isBackgroundColorAsset(t)||this.checkBackgroundImageLicense(t.license)))},t.prototype.checkMusicLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.checkTextLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.org||t.condition.clb)},t.prototype.checkBackgroundImageLicense=function(t){return!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.isUploaderAsset=function(t){return t&&t.url&&(Km.isUploaderUrl(t.url)||eg(t.url))},t.prototype.isPiaproAsset=function(t){return t&&t.url&&Km.isPiaproUrl(t.url)},t.prototype.isBlankBackgroundAsset=function(t){return!t||!t.originalUrl},t.prototype.isBackgroundColorAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^#[0-9a-fA-F]{3,6}$/.test(e)},t.prototype.isBackgroundPiaproImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return Km.isPiaproUrl(e)},t.prototype.isBackgroundSpecialImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^snowmiku2016-([0-9]{2})$/.test(e)},t.prototype.getQueryParameter=function(t){return!t||t.license&&!this.checkBackgroundImageLicense(t.license)?null:t.originalUrl},t}(),ng=function(t,e){return(ng=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},ig=function(){return(ig=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function og(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))}function ag(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var sg={fallback:{protocol:"https"},songle:{domain:"songle.jp"},textalive:{domain:"api.textalive.jp"}};function ug(t){var e,r,n=0;if(0===t.length)return n;for(e=0,r=t.length;e<r;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}sg.songle.protocol=sg.songle.protocol||sg.fallback.protocol,sg.songle.server=sg.songle.protocol+"://"+sg.songle.domain,sg.textalive.protocol=sg.textalive.protocol||sg.fallback.protocol,sg.textalive.server=sg.textalive.protocol+"://"+sg.textalive.domain;var lg=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}ng(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"endpoint",{get:function(){return sg.textalive.server+"/etc/license"},enumerable:!1,configurable:!0}),e.prototype.read=function(t,e){var r;return void 0===e&&(e=!0),og(this,void 0,void 0,(function(){var n,i;return ag(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Wm.get(this.endpoint,{params:{url:t,token:ug("ta"+t),skipOptoutCheck:!!e||void 0}})];case 1:return n=o.sent(),[3,3];case 2:return o.sent(),[3,3];case 3:return!n||200!==n.status||(null===(r=n.data)||void 0===r?void 0:r.error)?[2,{originalUrl:null,license:{code:n?n.status:404}}]:((i=n.data).license.code=n.status,0===i.contentType&&(i.css='url("'+i.contentUrl+'")'),[2,i])}}))}))},e}(rg));function cg(t){return"string"==typeof t&&0===t.indexOf("data:text/plain;base64,")}function hg(t){if(!cg(t))return null;var e=t.split(",")[1];return decodeURIComponent(atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function pg(t,e,r,n,i){var o=void 0===window.screenLeft?screen.left:window.screenLeft,a=void 0===window.screenTop?screen.top:window.screenTop,s=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-r/2+o,u=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-n/2+a,l=window.open(t,e,"width="+r+",height="+n+",top="+u+",left="+s+(i?","+i:""));return window.focus&&l.focus(),l}var dg=new(function(){function t(){this.listeners=[],this.pollingTimeout=null}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.textalive.server+"/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return sg.songle.server+"/"},enumerable:!1,configurable:!0}),t.prototype.isLoading=function(){return!!this.userProfile},t.prototype.spoof=function(t){this.userProfile=t},t.prototype.getServerStatus=function(){return og(this,void 0,void 0,(function(){return ag(this,(function(t){return[2,this.serverStatus||this.doGetServerStatus()]}))}))},t.prototype.doGetServerStatus=function(){return og(this,void 0,void 0,(function(){var t;return ag(this,(function(e){switch(e.label){case 0:this.serverStatusRequest||(this.serverStatusRequest=Wm.get(this.endpoint,{withCredentials:!0})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.serverStatusRequest];case 2:return t=e.sent(),this.serverStatusRequest=null,t&&200===t.status?(this.serverStatus=t.data,[2,this.serverStatus]):[2,null];case 3:return e.sent(),[2,null];case 4:return[2]}}))}))},t.prototype.getProfile=function(){return og(this,void 0,void 0,(function(){return ag(this,(function(t){return[2,this.userProfile||this.doGetProfile()]}))}))},t.prototype.doGetProfile=function(){return og(this,void 0,void 0,(function(){var t;return ag(this,(function(e){switch(e.label){case 0:this.userProfileRequest||(this.userProfileRequest=Wm.get(this.endpoint+"profile",{withCredentials:!0})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.userProfileRequest];case 2:return t=e.sent(),this.userProfileRequest=null,t&&200===t.status?(this.emitUserProfile(t.data),this.userProfile=t.data,[2,this.userProfile]):[2,null];case 3:return e.sent(),[2,null];case 4:return[2]}}))}))},t.prototype.getMergingUsers=function(){return og(this,void 0,void 0,(function(){var t;return ag(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"profile/merge",{withCredentials:!0})];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,[t.data.user,t.data.mergeWith]]:[2,[null,null]];case 2:return e.sent(),[2,[null,null]];case 3:return[2]}}))}))},t.prototype.mergeUsers=function(){var t;return og(this,void 0,void 0,(function(){var e,r,n,i,o,a;return ag(this,(function(s){switch(s.label){case 0:return[4,this.getToken()];case 1:e=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,Wm.post(this.endpoint+"profile/merge",{token:e},{withCredentials:!0})];case 3:if(!(r=s.sent())||200!==r.status||!(null===(t=r.data)||void 0===t?void 0:t.success))return[2,null];for(n=r.data.user,i=0,o=this.listeners;i<o.length;i++)(a=o[i]).onUserMerged&&a.onUserMerged(n);return[2,n];case 4:return s.sent(),[2,null];case 5:return[2]}}))}))},t.prototype.updateUser=function(t){var e;return og(this,void 0,void 0,(function(){var r,n,i;return ag(this,(function(o){switch(o.label){case 0:return[4,this.getToken()];case 1:r=o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,Wm.post(this.endpoint+"profile",ig(ig({},t),{token:r}),{withCredentials:!0})];case 3:return(n=o.sent())&&200===n.status&&(null===(e=n.data)||void 0===e?void 0:e.success)?(i=n.data.user,this.emitUserProfile(i),[2,i]):[2,null];case 4:return o.sent(),[2,null];case 5:return[2]}}))}))},t.prototype.isYouTubeUser=function(t){return t&&t.user&&"string"==typeof t.user.youtubeIdString},t.prototype.isPiaproUser=function(t){return t&&t.user&&"string"==typeof t.user.piaproIdString},t.prototype.isSongleUser=function(t){return t&&t.user&&("number"==typeof t.user.songleUserId&&t.user.songleUserId>=0||"string"==typeof t.user.songleAccessToken)},t.prototype.isSpoofingSongleUser=function(t){return this.isSongleUser(t)&&("number"!=typeof t.user.id||t.user.id<0)},t.prototype.addListener=function(t){t&&this.listeners.push(t)},t.prototype.removeListener=function(t){this.listeners=this.listeners.filter((function(e){return e!==t}))},t.prototype.emitUserProfile=function(t){this.userProfile=t;for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onUserProfileUpdated&&n.onUserProfileUpdated(t),this.userProfile.user?n.onUserLoggedIn&&n.onUserLoggedIn(t.user):n.onUserLoggedOut&&n.onUserLoggedOut()}},t.prototype.authenticate=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"profile/logins/basic",{auth:{username:String(t),password:e},withCredentials:!0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,r.data]:[2,null];case 2:return n.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loginTwitter=function(t){return this.login(t,"twitter")},t.prototype.loginGitHub=function(t){return this.login(t,"github")},t.prototype.loginYouTube=function(t){return this.login(t,"youtube")},t.prototype.loginPiapro=function(t){return this.login(t,"piapro")},t.prototype.loginSongle=function(t){return this.login(t,"songle")},t.prototype.login=function(t,e){return t&&t.preventDefault(),!!e&&(pg(this.endpoint+"profile/logins/"+e,"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1)},t.prototype.logoutTwitter=function(t){return this.logout(t,"twitter")},t.prototype.logoutGitHub=function(t){return this.logout(t,"github")},t.prototype.logoutYouTube=function(t){return this.logout(t,"youtube")},t.prototype.logoutPiapro=function(t){return this.logout(t,"piapro")},t.prototype.logoutSongle=function(t){return this.logout(t,"songle")},t.prototype.logout=function(t,e){return void 0===e&&(e=null),t&&t.preventDefault(),pg(this.endpoint+"profile/logouts/"+(e||"all"),"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1},t.prototype.startMonitoringAuthState=function(){var t=this;this.pollingTimeout&&(clearTimeout(this.pollingTimeout),this.pollingTimeout=null);var e=function(r){if(r.data&&r.data.textalive){if(r.source.postMessage("close",r.origin),r.data.merge)return t.getMergingUsers().then((function(e){for(var r=e[0],n=e[1],i=0,o=t.listeners;i<o.length;i++){var a=o[i];a.onUserMergeRequired&&a.onUserMergeRequired(r,n)}})).catch((function(){})),void window.removeEventListener("message",e);t.doGetProfile(),window.removeEventListener("message",e)}};window.addEventListener("message",e)},t.prototype.getToken=function(){return og(this,void 0,void 0,(function(){return ag(this,(function(t){return this.userProfile?[2,this.userProfile.status.token]:this.token?[2,this.token]:[2,this.doGetToken()]}))}))},t.prototype.doGetToken=function(){var t;return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"profile/token",{withCredentials:!0})];case 1:return e=r.sent(),(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.token)&&(this.token=e.data.token),[2,this.token];case 2:return r.sent(),[2,""];case 3:return[2]}}))}))},t}()),fg=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.textalive.server+"/text-parser/"},enumerable:!1,configurable:!0}),t.prototype.parse=function(t){return og(this,void 0,void 0,(function(){var e,r;return ag(this,(function(n){switch(n.label){case 0:return[4,dg.getToken()];case 1:e=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,Wm.post(this.endpoint,{text:t,token:e},{withCredentials:!0,responseType:"json"})];case 3:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null];case 4:return n.sent(),[2,null];case 5:return[2]}}))}))},t}()),mg=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.textalive.server+"/fonts"},enumerable:!1,configurable:!0}),t.prototype.listAvailableFonts=function(){return og(this,void 0,void 0,(function(){var t=this;return ag(this,(function(e){switch(e.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:e.sent(),e.label=2;case 2:return this.data&&this.data.fontFamilies?[2,Object.keys(this.data.fontFamilies).map((function(e){return ig({key:e},t.data.fontFamilies[e])}))]:[2,[]]}}))}))},t.prototype.getFrequentChars=function(){return og(this,void 0,void 0,(function(){return ag(this,(function(t){switch(t.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:t.sent(),t.label=2;case 2:return[2,this.data&&this.data.frequentChars||""]}}))}))},t.prototype.fetchInfo=function(){return og(this,void 0,void 0,(function(){var t;return ag(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"/index.json")];case 1:return(t=e.sent())&&200===t.status&&t.data?(this.data=t.data,[3,3]):(this.data=null,[2,null]);case 2:return e.sent(),this.data=null,[3,3];case 3:return[2]}}))}))},t}()),gg=new RegExp("\\b([CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*(?:[CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*)*\\-){2}");function vg(t,e,r){return!gg.test(t)&&!t.match(/[（(].+(?:転載|書き起こし).*[）)]/)&&(!t.match(/(作詞|作曲).+(作詞|作曲)/)||0!==e&&e!==r.length-2)}function yg(t){return!t.match(new RegExp("[（(]?※"))}var xg={},bg={};function _g(t,e,r){var n,i,o,a=this;return"undefined"==typeof window||!(null===(n=null===window||void 0===window?void 0:window.navigator)||void 0===n?void 0:n.userAgent)||window.navigator.userAgent.includes("Node.js")||window.navigator.userAgent.includes("jsdom")?(i=t,o=e,r&&console.log("parse lyrics: loading on Node.js",i),new Promise((function(t,e){Wm.get(i,{responseType:"text/plain"}).then((function(r){var n=r.data,i=new Function("let g=global;global={};"+n+";let res=global;global=g"),a={};try{i.bind(a)(),t(o(a))}catch(t){e(t)}})).catch(e)}))):(r&&console.log("parse lyrics: loading",t),new Promise((function(n,i){try{var o=document.createElement("script"),s=null;window.module&&(s=window.module,delete window.module),o.src=t,o.onload=function(){return og(a,void 0,void 0,(function(){var a,u;return ag(this,(function(l){switch(l.label){case 0:document.body.removeChild(o),r&&console.log("parse lyrics: load",t),window.Songle&&window.Songle.Utils&&window.Songle.Utils.url2Lyric||(s&&(window.module=s),i("url2Lyric not found")),l.label=1;case 1:return l.trys.push([1,3,4,5]),a=n,[4,e(window)];case 2:return a.apply(void 0,[l.sent()]),[3,5];case 3:return u=l.sent(),i(u),[3,5];case 4:return s&&(window.module=s),[7];case 5:return[2]}}))}))},o.onerror=function(t){return i(t.message)},document.body.appendChild(o)}catch(e){console.error("failed to call lyrics parser",t,e)}})))}var wg=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.songle.server+"/lyrics/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localLyricsEndpoint",{get:function(){return sg.textalive.server+"/etc/lyrics"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timingEndpoint",{get:function(){return sg.songle.server+"/songs/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsParserEndpoint",{get:function(){return sg.songle.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsPostEndpoint",{get:function(){return sg.songle.server},enumerable:!1,configurable:!0}),t.prototype.isUploaderUrl=function(t){return eg(t)},t.prototype.parseUploaderUrl=function(t){return function(t){var e=tg.exec(t);return e?{user:e[1],identifier:e[2]}:{user:null,identifier:null}}(t)},t.prototype.getRecentlySynchronizedCount=function(){return og(this,void 0,void 0,(function(){var t;return ag(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"recently_synchronized_count.json")];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,t.data.count]:[2,-1];case 2:return e.sent(),[2,-1];case 3:return[2]}}))}))},t.prototype.getRecentlySynchronizedList=function(t,e){return void 0===t&&(t=1),og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"recently_synchronized.json",{params:ig({page:t},e)})];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return n.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.load=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(this.timingEndpoint+t+"/lyrics.json")];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loadDetail=function(t,e){return og(this,void 0,void 0,(function(){var r,n;return ag(this,(function(i){switch(i.label){case 0:if(xg[t]&&xg[t][e])return[2,xg[t][e]];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Wm.get(this.timingEndpoint+t+"/lyrics/"+(e<0?"latest":e)+".json")];case 2:return(n=i.sent())&&200===n.status?(r=n.data,[3,4]):[2,null];case 3:return i.sent(),[2,null];case 4:return xg[t]||(xg[t]={}),xg[t][r.id]=r,e<0&&(xg[t][-1]=r),[2,r]}}))}))},t.prototype.loadDiffs=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(this.timingEndpoint+t+"/lyrics/"+e+"/diffs.json")];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return n.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loadDiff=function(t,e,r){return og(this,void 0,void 0,(function(){return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(this.timingEndpoint+t+"/lyrics/"+e+(r<0?"":0===r?"/original":"/diffs/"+r+"/lyrics")+".json")];case 1:return[2,n.sent().data];case 2:return n.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loadAllRevisionsForSong=function(t){return og(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,u,l,c;return ag(this,(function(h){switch(h.label){case 0:return[4,this.load(t)];case 1:e=h.sent(),r=[],n=0,i=e.lyrics,h.label=2;case 2:return n<i.length?(o=i[n],[4,this.loadDetail(t,o.id)]):[3,6];case 3:return a=h.sent(),[4,this.loadDiffs(t,a.id)];case 4:if(s=h.sent(),r.push({lyrics:a,updated_at:new Date(a.created_at)}),Array.isArray(s))for(u=0,l=s;u<l.length;u++)c=l[u],r.push({diff_id:c.id,source_id:c.source_id,lyrics:a,updated_at:new Date(c.updated_at)});h.label=5;case 5:return n++,[3,2];case 6:return[2,r.sort((function(t,e){var r=e.updated_at.getTime()-t.updated_at.getTime();return 0===r?e.diff_id-t.diff_id:r}))]}}))}))},t.prototype.getLatestRevision=function(t){return t.filter((function(t){return!(t.lyrics.processing||t.lyrics.failed)}))[0]},t.prototype.fetchLocalLyricBody=function(t){var e,r;return og(this,void 0,void 0,(function(){var n,i,o;return ag(this,(function(a){switch(a.label){case 0:this.verbose&&("string"==typeof t?console.log("load locally-stored lyrics for song code",t):console.log("load locally-stored lyrics for lyric id",t)),i={},"string"==typeof t?i.code=t:i.lyricId=t,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Wm.get(this.localLyricsEndpoint+"/token",{params:i})];case 2:return!(o=a.sent())||200!==o.status||o.data.error?[2,null]:(n=o.data.token,[3,4]);case 3:return a.sent(),[2,null];case 4:return a.trys.push([4,6,,7]),i.token=n,[4,Wm.get(this.localLyricsEndpoint,{params:i})];case 5:return(o=a.sent())&&200===o.status&&!(null===(e=o.data)||void 0===e?void 0:e.error)&&(null===(r=o.data)||void 0===r?void 0:r.text)?(this.verbose&&console.log("loaded locally-stored lyrics with params",i),[2,o.data]):[2,null];case 6:return a.sent(),[2,null];case 7:return[2]}}))}))},t.prototype.fetchSongleLyricBody=function(t,e){return og(this,void 0,void 0,(function(){var r,n,i,o,a,s,u,l,c,h,p,d;return ag(this,(function(f){switch(f.label){case 0:if(!(r=this.parseUploaderUrl(t)).identifier)throw new Error("unsupported lyrics url "+t);return[4,dg.getProfile()];case 1:if(n=f.sent(),!dg.isSongleUser(n))throw new Error("Songle authentication is required");if(bg[i=t+"//"+e])return[2,bg[i]];dg.isSpoofingSongleUser(n)&&(a=n.user,s=a.songleUserId,u=a.songleAccessToken,l=a.songleRefreshToken,o={songleUserId:s,songleAccessToken:u,songleRefreshToken:l}),c=sg.textalive.server+"/songle/users/"+r.user+"/uploads/"+r.identifier,f.label=2;case 2:return f.trys.push([2,4,,5]),[4,Wm.get(c,{withCredentials:!0,params:o})];case 3:return p=f.sent(),h=p.data,[3,5];case 4:return f.sent(),[3,5];case 5:return d=h?{text:h,url:t}:null,h&&(bg[i]=d),[2,d]}}))}))},t.prototype.fetchPiaproLyricBody=function(t,e){return og(this,void 0,void 0,(function(){var r,n,i,o,a;return ag(this,(function(s){switch(s.label){case 0:if(!Km.isPiaproUrl(t))throw new Error("unsupported lyrics url "+t);return bg[r=t+"//"+e]?[2,bg[r]]:[4,lg.read(t,!0)];case 1:if(n=s.sent(),!lg.isPiaproAsset(n))throw new Error("unsupported piapro lyrics url "+t);return i=hg(n.contentUrl),[4,this.parseLyricBody(i,e)];case 2:return o=s.sent(),(a=o?{text:o,artist:{name:n.authorName,url:n.authorPath?"https://piapro.jp"+n.authorPath:null},name:n.name,url:t}:null)&&(bg[r]=a),[2,a]}}))}))},t.prototype.fetchInternalLyricBody=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){if(r=new URL(t),"undefined"==typeof location||location.protocol!==r.protocol||location.hostname!==r.hostname)throw new Error("direct access not supported for lyrics url "+t);return[2,this.fetchCrossOriginLyricBody(t,e)]}))}))},t.prototype.fetchCrossOriginLyricBody=function(t,e){return og(this,void 0,void 0,(function(){var r,n,i,o,a;return ag(this,(function(s){switch(s.label){case 0:if(bg[r=t+"//"+e])return[2,bg[r]];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Wm.get(t,{responseType:"text"})];case 2:return i=s.sent(),n=i.data,[3,4];case 3:return s.sent(),this.verbose&&console.error("direct access not supported for lyrics url "+t),[2,this.fetchProxiedLyricBody(t,e)];case 4:return[4,this.parseLyricBody(n,e)];case 5:return o=s.sent(),(a=o?{text:o,url:t}:null)&&(bg[r]=a),[2,a]}}))}))},t.prototype.fetchProxiedLyricBody=function(t,e){return og(this,void 0,void 0,(function(){var r,n,i;return ag(this,(function(o){switch(o.label){case 0:return bg[r=t+"//"+e]?[2,bg[r]]:(this.verbose&&console.log("load lyrics from the external server",t),[4,_g(this.lyricsParserEndpoint+e,(function(e){return new Promise((function(r,n){e.Songle.Utils.url2Lyric(t,(function(t){return r(t)}),(function(t){return n(t)}))}))}),this.verbose)]);case 1:return n=o.sent(),(i=n?{text:n,url:t}:null)&&(bg[r]=i),[2,i]}}))}))},t.prototype.parseLyricBody=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,_g(this.lyricsParserEndpoint+e,(function(e){return e.Songle.Utils.parseLyric(t)}),this.verbose)];case 1:return r=n.sent(),[3,3];case 2:return n.sent(),r=function(t){var e=new RegExp("[\\u4E00-\\u9FAF|\\uFF66-\\uFF9D|\\u31F0-\\u31FF]+[（\\(]([\\u3041-\\u3096\\u309D-\\u309F]+)[\\)）]","g");return t.replace(e,(function(t,e){return e}))}(function(t){for(var e,r,n,i,o,a=new RegExp("[（(]?(.)繰り返し[)）]?","g");null!==(r=a.exec(t));)n=r[1],i=new RegExp("^("+n+"[\\s\\S]+?)(?=\\n\\n[^\\u3000|\\s])","m"),null!==(o=t.match(i))&&(e=o[1].replace(new RegExp("^"+n,"m"),"").replace(new RegExp("^\\n"),"").replace(new RegExp("^\\u3000","mg"),""),t=(t=t.replace(i,(function(){return e}))).replace(new RegExp("[（\\(]?"+n+"繰り返し[\\)）]?","g"),e).replace(new RegExp("^"+n,"m"),""));return t}((i=t.replace(/^\ufeff/,"").replace(/\r/,"").split(/\n/).filter(vg).filter((function(t){return!t.match(/^#/)})).join("\n").replace(/^\s+/,""),a=i.split(/\n/),a.forEach((function(t,e){t.match(/^\S+：\S+$/m)&&(o=e)})),void 0!==o&&o<5?a.slice(o+1).join("\n"):i).split(/\n/).filter(vg).join("\n"))).split(/\n/).filter(yg).join("\n").replace(/\n\n+/g,"\n\n").replace(/\n+$/g,"\n"),[3,3];case 3:return[2,r]}var i,o,a}))}))},t.prototype.fetchLyricBody=function(t,e){var r=e.parserPath,n=e.directAccess;return og(this,void 0,void 0,(function(){var e,i;return ag(this,(function(o){switch(o.label){case 0:if(cg(t))return this.verbose&&console.log("load lyrics from the data url",t),[2,{text:hg(t)}];if(this.isUploaderUrl(t))return[2,this.fetchSongleLyricBody(t,r)];if(Km.isPiaproUrl(t))return[2,this.fetchPiaproLyricBody(t,r)];o.label=1;case 1:return o.trys.push([1,6,,7]),e=new URL(t),n||"undefined"!=typeof location&&location.protocol!==e.protocol&&"https:"!==e.protocol?[3,5]:"undefined"!=typeof location&&location.hostname!==e.hostname?[3,2]:(n=!0,[3,5]);case 2:return o.trys.push([2,4,,5]),[4,Wm.get(this.localLyricsEndpoint+"/cors",{params:{url:t}})];case 3:return i=o.sent(),n=i&&200===i.status&&i.data.data.enabled,[3,5];case 4:return o.sent(),[3,5];case 5:return n?(this.verbose&&console.log("load lyrics directly",t),[2,this.fetchCrossOriginLyricBody(t,r)]):[3,7];case 6:return o.sent(),[3,7];case 7:return[2,this.fetchProxiedLyricBody(t,r)]}}))}))},t.prototype.post=function(t){return og(this,void 0,void 0,(function(){var e,r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=t.forceUpdate?{url:t.lyricsUrl,force_create:"true"}:{url:t.lyricsUrl},[4,Wm.post(this.lyricsPostEndpoint+"/songs/"+t.songId+"/lyrics.json",e,{responseType:"json"})];case 1:return[2,{success:200===(r=n.sent()).status,lyricsId:r.data.id}];case 2:return[2,{success:!1,error:n.sent().message}];case 3:return[2]}}))}))},t.prototype.postPrivate=function(t){return og(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,u,l,c,h,p;return ag(this,(function(d){switch(d.label){case 0:return[4,dg.getProfile()];case 1:if(e=d.sent(),!dg.isSongleUser(e))throw new Error("Songle authentication is required");dg.isSpoofingSongleUser(e)?(n=e.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,s={songleUserId:i,songleAccessToken:o,songleRefreshToken:a},r="?"+Object.keys(s).map((function(t){return t+"="+encodeURIComponent(s[t])})).join("&")):r="",u=t.songId,l=t.lyricsText,(c=new FormData).append("text",l),d.label=2;case 2:return d.trys.push([2,4,,5]),[4,Wm.post(sg.textalive.server+"/songle/me/songs/"+u+"/lyrics.json"+r,c,{withCredentials:!0})];case 3:return h=d.sent(),p=h.data.data.lyric,[2,{success:200===h.status,error:null,lyrics:p}];case 4:return[2,{success:!1,error:d.sent().message}];case 5:return[2]}}))}))},t.prototype.update=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.post(this.lyricsPostEndpoint+"/songs/"+t.songCode+"/lyrics/"+t.lyricsId+"/diffs.json",t.lyricsData?{lyric:JSON.stringify(t.lyricsData)}:{source_diff_id:t.lyricsDiffId},{responseType:"json"})];case 1:return[2,(e=r.sent()).data&&e.data.lyric_diff?{success:200===e.status,lyricsId:e.data.lyric_diff.lyric_id,lyricsDiffId:e.data.lyric_diff.id}:{success:200===e.status}];case 2:return[2,{success:!1,error:r.sent().message}];case 3:return[2]}}))}))},t}()),Tg={},Eg={},Sg=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.textalive.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return sg.songle.server},enumerable:!1,configurable:!0}),t.prototype.getSongPathFromUrl=function(t){return Km.getSongPathFromUrl(t)},t.prototype.isUploaderUrl=function(t){return Km.isUploaderUrl(t)},t.prototype.isUploaderPath=function(t){return Km.isUploaderPath(t)},t.prototype.getUploaderGuid=function(t){return Km.getUploaderGuid(t)},t.prototype.getAltSongUrlFromUploaderGuid=function(t){return Km.getAltSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromUploaderGuid=function(t){return Km.getSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromPath=function(t){return Km.getSongUrlFromPath(t)},t.prototype.isYouTubeUrl=function(t){return Km.isYouTubeUrl(t)},t.prototype.isNicovideoUrl=function(t){return Km.isNicovideoUrl(t)},t.prototype.isVideoSiteUrl=function(t){return Km.isVideoSiteUrl(t)},t.prototype.isPiaproUrl=function(t){return Km.isPiaproUrl(t)},t.prototype.load=function(t){return og(this,void 0,void 0,(function(){var e,r;return ag(this,(function(n){switch(n.label){case 0:return e=t.code||"number"==typeof t.id&&String(t.id)||encodeURIComponent(t.songPath),Tg[e]?[2,Tg[e]]:(Tg[e]=this.doLoad(e),[4,Tg[e]]);case 1:return r=n.sent(),this.use(r),[2,r]}}))}))},t.prototype.use=function(t){if(t){var e=String(t.song.id),r=t.song.code,n=this.getSongPathFromUrl(t.song.permalink);Tg[e]=Tg[r]=Tg[n]=Promise.resolve(t)}},t.prototype.doLoad=function(t){return og(this,void 0,void 0,(function(){var e,r,n;return ag(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,Wm.get(this.songleEndpoint+"/songs/"+t+"?format=json")];case 1:if(!(e=i.sent())||200!==e.status)return[2,null];if(r=e.data,!this.isUploaderUrl(r.song.permalink))return[3,5];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.doLoadPrivateSong(r.song.id)];case 3:return(n=i.sent())?[2,ig(ig({},r),{song:n})]:[3,5];case 4:return i.sent(),[3,5];case 5:return[2,r];case 6:return i.sent(),[2,null];case 7:return[2]}}))}))},t.prototype.doLoadPrivateSong=function(t){return og(this,void 0,void 0,(function(){var e,r,n,i,o,a,s;return ag(this,(function(u){switch(u.label){case 0:return[4,dg.getProfile()];case 1:if(e=u.sent(),!dg.isSongleUser(e))return[2,null];dg.isSpoofingSongleUser(e)&&(n=e.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,r={songleUserId:i,songleAccessToken:o,songleRefreshToken:a}),u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Wm.get(this.endpoint+"/songle/me/songs/"+t+".json",{withCredentials:!0,params:r})];case 3:return(s=u.sent())&&200===s.status&&s.data&&s.data.data&&s.data.data.song?[2,s.data.data.song]:[2,null];case 4:return u.sent(),[2,null];case 5:return[2]}}))}))},t.prototype.loadInfo=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){return r=this.cacheKey(t,e),Eg[r]||(Eg[r]=this.doLoadInfo(t,{min:!0,revisions:null==e?void 0:e.revisions})),[2,Eg[r]]}))}))},t.prototype.loadDetailInfo=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){return r=this.cacheKey(t,e)+"/dt",Eg[r]||(Eg[r]=this.doLoadInfo(t,{min:!1,revisions:null==e?void 0:e.revisions})),[2,Eg[r]]}))}))},t.prototype.cacheKey=function(t,e){var r=String(t);return(null==e?void 0:e.revisions)&&("number"==typeof e.revisions.chord&&(r+="/cd"+e.revisions.chord),"number"==typeof e.revisions.beat&&(r+="/bt"+e.revisions.beat),"number"==typeof e.revisions.chorus&&(r+="/cr"+e.revisions.chorus)),r},t.prototype.doLoadInfo=function(t,e){var r=void 0===e?{min:!0}:e,n=r.min,i=r.revisions;return og(this,void 0,void 0,(function(){var e,r;return ag(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),e={min:n?1:0},"number"==typeof(null==i?void 0:i.chord)&&(e.chord_revision_id=i.chord),"number"==typeof(null==i?void 0:i.beat)&&(e.beat_revision_id=i.beat),"number"==typeof(null==i?void 0:i.chorus)&&(e.chorus_revision_id=i.chorus),[4,Wm.get(this.songleEndpoint+"/songs/"+t+"/info.json",{params:e})];case 1:return(r=o.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return o.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loadVocalAmplitude=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(this.songleEndpoint+"/songs/"+t+"/vamplitude.json")];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loadValenceArousal=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(this.songleEndpoint+"/songs/"+t+"/av.json")];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.list=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:void 0===t&&(t={}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Wm.get(this.endpoint+"/songs",{params:t})];case 2:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},t.prototype.listPrivate=function(){return og(this,void 0,void 0,(function(){var t,e,r,n,i,o,a,s;return ag(this,(function(u){switch(u.label){case 0:return[4,dg.getProfile()];case 1:if(t=u.sent(),!dg.isSongleUser(t))return[2,{data:null,error:{code:401,message:"Songle authentication is required"}}];dg.isSpoofingSongleUser(t)&&(r=t.user,n=r.songleUserId,i=r.songleAccessToken,o=r.songleRefreshToken,e={songleUserId:n,songleAccessToken:i,songleRefreshToken:o}),u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Wm.get(this.endpoint+"/songle/me/songs.json",{withCredentials:!0,params:ig(ig({},e),{private:!0})})];case 3:return(a=u.sent())&&200===a.status?[2,a.data]:[2,{data:null,error:{code:a.status,message:a.data.message}}];case 4:return[2,{data:null,error:{code:(s=u.sent()).response&&s.response.status?s.response.status:-1,message:s.response&&s.response.data?s.response.data.message:s.message}}];case 5:return[2]}}))}))},t.prototype.create=function(t){return og(this,void 0,void 0,(function(){return ag(this,(function(e){return[2,this.doCreate(t,!1)]}))}))},t.prototype.createPrivate=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return[4,dg.getProfile()];case 1:return e=r.sent(),dg.isSongleUser(e)?[2,this.doCreate(t,!0)]:[2,{success:!1,song:null,error:"Songle authentication is required"}]}}))}))},t.prototype.doCreate=function(t,e){return og(this,void 0,void 0,(function(){var r,n,i,o,a,s;return ag(this,(function(u){switch(u.label){case 0:return r=t.url,n=t.name,i=t.artistName,[4,dg.getToken()];case 1:o=u.sent(),u.label=2;case 2:return u.trys.push([2,4,,5]),[4,Wm.post(e?this.endpoint+"/etc/songs/private":this.endpoint+"/etc/songs",{token:o,url:r,name:n,artist:i},{withCredentials:!0})];case 3:return(a=u.sent())&&200===a.status?e?[2,{success:!0,song:a.data.data.song}]:[2,{success:!0,song:a.data.song}]:[2,{success:!1,error:(a.data.data?a.data.data:a.data).message}];case 4:return s=u.sent(),console.error(s),[2,{success:!1,error:s.response&&s.response.data?s.response.data.message:s.message}];case 5:return[2]}}))}))},t.prototype.uploadPrivate=function(t){return og(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,u,l;return ag(this,(function(c){switch(c.label){case 0:return[4,dg.getProfile()];case 1:if(e=c.sent(),!dg.isSongleUser(e))throw new Error("Songle authentication is required");dg.isSpoofingSongleUser(e)?(n=e.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,s={songleUserId:i,songleAccessToken:o,songleRefreshToken:a},r="?"+Object.keys(s).map((function(t){return t+"="+encodeURIComponent(s[t])})).join("&")):r="",c.label=2;case 2:return c.trys.push([2,4,,5]),(u=new FormData).append("file",t),[4,Wm.post(this.endpoint+"/songle/me/uploads.json"+r,u,{withCredentials:!0})];case 3:return(l=c.sent())&&200===l.status&&l.data?[2,l.data.data]:[3,5];case 4:return c.sent(),[3,5];case 5:return[2,null]}}))}))},t.prototype.search=function(t,e){return void 0===e&&(e=!0),og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(this.songleEndpoint+"/songs/search.json",{params:{q:t,lyrics:e?1:0}})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,data:r.data}]:[2,{success:!1}];case 2:return n.sent(),[2,{success:!1}];case 3:return[2]}}))}))},t.prototype.copySongMap=function(t){var e;return og(this,void 0,void 0,(function(){var r,n,i,o;return ag(this,(function(a){switch(a.label){case 0:r=t.sourceId,n=t.destinationId,i=t.types||["beat","chord","chorus","melody"],a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Wm.post(this.endpoint+"/songle/me/songs/"+n+"/actions/copy_music_map.json",{source_id:r,types:i},{withCredentials:!0,responseType:"json"})];case 2:return(o=a.sent())&&(null===(e=o.data)||void 0===e?void 0:e.success)?[2,{success:!0}]:[2,{success:!1,error:null==o?void 0:o.data}];case 3:return a.sent(),[2,{success:!1}];case 4:return[2]}}))}))},t.prototype.createStage=function(){return og(this,void 0,void 0,(function(){var t,e;return ag(this,(function(r){switch(r.label){case 0:return[4,dg.getProfile()];case 1:t=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,Wm.post(this.endpoint+"/etc/songs/stage",{token:t.status.token},{withCredentials:!0})];case 3:return[2,(e=r.sent())?e.data:null];case 4:return r.sent(),[2,null];case 5:return[2]}}))}))},t}()),Ag=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.textalive.server+"/templates/"},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(""+this.endpoint,{params:t})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.load=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(""+(this.endpoint+t),{params:{format:"json"}})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.loadByName=function(t){return og(this,void 0,void 0,(function(){var e,r,n;return ag(this,(function(i){switch(i.label){case 0:r="latest",t&&(e=t.match(/(.+)@([0-9]+)/))&&(t=e[1],r=e[2]),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Wm.get(this.endpoint+t+"/"+r,{params:{format:"json"}})];case 2:return(n=i.sent())&&200===n.status?[2,n.data]:"latest"!==r?[2,this.loadByName(t)]:[2,null];case 3:return i.sent(),[2,null];case 4:return[2]}}))}))},t.prototype.loadForVideo=function(t,e){return void 0===e&&(e={withoutAuthors:!0,withScript:!0}),og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(this.endpoint+"for/"+t,{params:e})];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return n.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.create=function(t){return og(this,void 0,void 0,(function(){var e,r,n;return ag(this,(function(i){switch(i.label){case 0:return[4,dg.getToken()];case 1:e=i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,Wm.post(this.endpoint,ig(ig({},t),{token:e}),{withCredentials:!0})];case 3:return(r=i.sent())?200!==r.status||Array.isArray(r.data)||r.data.error?(n=Array.isArray(r.data)?{parseErrors:r.data}:r.data,[2,ig(ig({},n),{success:!1})]):[2,ig(ig({},r.data),{success:!0})]:[2,{success:!1}];case 4:return[2,{error:i.sent().message,success:!1}];case 5:return[2]}}))}))},t.prototype.listContributors=function(t,e){return og(this,void 0,void 0,(function(){var r;return ag(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Wm.get(""+this.endpoint+t+"/"+e+"/contributors",{withCredentials:!0})];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null];case 2:return n.sent(),[2,null];case 3:return[2]}}))}))},t}()),Pg=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return sg.textalive.server+"/videos/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendererEndpoint",{get:function(){return sg.textalive.server+"/renderer/"},enumerable:!1,configurable:!0}),t.prototype.load=function(t){return og(this,void 0,void 0,(function(){var e,r,n,i,o,a,s;return ag(this,(function(u){switch(u.label){case 0:return u.trys.push([0,3,,4]),e={format:"json"},[4,dg.getProfile()];case 1:return r=u.sent(),dg.isSpoofingSongleUser(r)&&(n=r.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,e=ig(ig({},e),{songleUserId:i,songleAccessToken:o,songleRefreshToken:a})),[4,Wm.get(""+(this.endpoint+t),{params:e,withCredentials:!0})];case 2:return(s=u.sent())&&200===s.status?[2,s.data]:[2,null];case 3:return u.sent(),[2,null];case 4:return[2]}}))}))},t.prototype.create=function(t){return og(this,void 0,void 0,(function(){var e,r;return ag(this,(function(n){switch(n.label){case 0:return[4,dg.getToken()];case 1:e=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,Wm.post(this.endpoint,ig(ig({},t),{token:e}),{withCredentials:!0})];case 3:return(r=n.sent())?200!==r.status||r.data.error?[2,ig(ig({},r.data),{success:!1})]:[2,ig(ig({},r.data),{success:!0})]:[2,{success:!1}];case 4:return[2,{error:n.sent().message,success:!1}];case 5:return[2]}}))}))},t.prototype.delete=function(t){return og(this,void 0,void 0,(function(){var e,r;return ag(this,(function(n){switch(n.label){case 0:return[4,dg.getToken()];case 1:e=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,Wm.post(this.endpoint+"delete",{token:e,id:t},{withCredentials:!0})];case 3:return(r=n.sent())&&200===r.status?[2,{success:!0,video:r.data}]:[2,{success:!1,video:null}];case 4:return[2,{success:!0,error:n.sent(),video:null}];case 5:return[2]}}))}))},t.prototype.listContributors=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(""+this.endpoint+t+"/contributors",{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.listRenderings=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(this.rendererEndpoint+"list",{params:{videoId:t},withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.getRenderingStatus=function(t){return og(this,void 0,void 0,(function(){var e;return ag(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Wm.get(this.rendererEndpoint+"status",{params:{id:t},withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.render=function(t,e,r){return og(this,void 0,void 0,(function(){var n,i,o;return ag(this,(function(a){switch(a.label){case 0:return[4,dg.getToken()];case 1:n=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),i={token:n,videoId:t,quality:e},r&&(i.authentication=!0),[4,Wm.post(this.rendererEndpoint+"render",i,{withCredentials:!0})];case 3:return(o=a.sent())&&200===o.status?[2,o.data]:[2,null];case 4:return a.sent(),[2,null];case 5:return[2]}}))}))},t.prototype.getDownloadInfo=function(){return og(this,void 0,void 0,(function(){var t;return ag(this,(function(e){switch(e.label){case 0:return t={endpoint:this.rendererEndpoint+"download"},[4,dg.getToken()];case 1:return[2,(t.token=e.sent(),t)]}}))}))},t}()),Mg={asset:lg,endpoint:sg,lyrics:wg,song:Sg,template:Ag,text:fg,font:mg,user:dg,video:Pg},Ig=function(t,e){return(Ig=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Og(t,e){function r(){this.constructor=t}Ig(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Cg=function(){function t(){this._parent=null,this._children=[],this._previous=null,this._next=null,this._runtime=null,this._templates=[]}return Object.defineProperty(t.prototype,"video",{get:function(){return this.parent&&this.parent.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._data?this._data.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this._data?this._data.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime?this._runtime.rendering:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._runtime?this._runtime.graphics:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateCount",{get:function(){return this._templates.length},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t.prototype.moveStartTime=function(t){t=Math.min(Math.max(t,0),this._data.endTime),null!=this._parent&&(t=Math.max(t,this._parent.startTime)),null!=this._previous&&(t=Math.max(t,this._previous.endTime)),this._children.length>0&&(t=Math.min(t,this._children[0].startTime));var e=this.startTime!==t;return this._data.startTime=t,e},t.prototype.moveStartTimeAndShrink=function(t){var e=this.endTime;if(this._children.length>0)this._children.forEach((function(t){e-=t.duration}));else if(t+30>e)return!1;t=Math.min(Math.max(t,0),e),null!=this._parent&&(t=Math.max(t,this._parent.startTime)),null!=this._previous&&(t=Math.max(t,this._previous.endTime));var r=this.startTime!==t;if(this._data.startTime=t,r&&this._children.length>0)for(var n=0,i=this._children;n<i.length;n++){var o=i[n];if(o.startTime>=t)break;o.moveWithChildren(t-o.startTime),t=o.endTime}return r},t.prototype.moveEndTime=function(t){var e=this.video.duration;t=Math.max(Math.min(t,e),this.startTime),null!=this._parent&&(t=Math.min(t,this._parent.endTime)),null!=this._next&&(t=Math.min(t,this._next.startTime)),this._children.length>0&&(t=Math.max(t,this._children[this._children.length-1].endTime));var r=this.endTime!==t;return this._data.endTime=t,r},t.prototype.moveEndTimeAndShrink=function(t){var e=this.startTime;if(this._children.length>0)this._children.forEach((function(t){e+=t.duration}));else if(t-30<e)return!1;var r=this.video.duration;t=Math.max(Math.min(t,r),e),null!=this._parent&&(t=Math.min(t,this._parent.endTime)),null!=this._next&&(t=Math.min(t,this._next.startTime));var n=this.endTime!==t;if(this._data.endTime=t,n&&this._children.length>0)for(var i=this._children.length-1;i>=0;i--){var o=this._children[i];if(o.endTime<=t)break;o.moveWithChildren(t-o.endTime),t=o.startTime}return n},t.prototype.move=function(t){var e=0,r=this.video.duration;null!=this._parent&&(e=Math.max(e,this._parent.startTime),r=Math.min(r,this._parent.endTime)),null!=this._previous&&(e=Math.max(e,this._previous.endTime)),null!=this._next&&(r=Math.min(r,this._next.startTime)),this.startTime+t<e&&(t=e-this.startTime),this.endTime+t>r&&(t=r-this.endTime),this.moveWithChildren(t)},t.prototype.maximize=function(){var t=!1,e=this.endTime,r=Math.max(null===this._parent?0:this._parent.startTime,null===this._previous?0:this._previous.endTime);r!==this.startTime&&(this.moveWithChildren(r-this.startTime),t=!0);var n=Math.min(null===this._parent?this.video.duration:this._parent.endTime,null===this._next?this.video.duration:this._next.startTime);return n!==this.endTime&&(this._data.endTime=n,t=e!==n),t},t.prototype.moveStartTimeAndExtend=function(t){return this.moveAndExtend(t,1)},t.prototype.moveEndTimeAndExtend=function(t){return this.moveAndExtend(t,2)},t.prototype.moveAndExtend=function(t,e){if(void 0===e&&(e=0),0===t)return!1;var r,n,i=this._parent?this._parent.startTime:this._previous?this._previous.endTime:0,o=this._parent?this._parent.endTime:this._next?this._next.startTime:this.video.duration;if(this._parent){if(null!==this._next)for(r=this._next;null===r._parent&&null!==r._next||r._parent===this._parent;)o-=r.duration,r=r._next;if(null!==this._previous)for(r=this._previous;null===r._parent&&null!==r._previous||r._parent===this._parent;)i+=r.duration,r=r._previous}if(0===e){if(this.startTime+t<i&&(t=i-this.startTime),this.endTime+t>o&&(t=o-this.endTime),0===t)return!1;this.moveWithChildren(t)}else if(1===e){if(this.startTime+t<i&&(t=i-this.startTime),0===t)return!1;this._data.startTime+=t}else{if(this.endTime+t>o&&(t=o-this.endTime),0===t)return!1;this._data.endTime+=t}for(n=this;null!==n;){var a=n.moveBackward(),s=n.moveForward();if(null===n._parent)break;var u=n._parent;a<u.startTime&&(u._data.startTime=a,u.moveBackward()),s>u.endTime&&(u._data.endTime=s,u.moveForward()),n=u}return!0},t.prototype.moveBackward=function(){for(var t=this,e=this.startTime;null!==t._previous&&t._parent===t._previous._parent&&t._previous.endTime>t.startTime;){var r=t.startTime-t._previous.endTime;t._previous.moveWithChildren(r),e=(t=t._previous).startTime}return e},t.prototype.moveForward=function(){for(var t=this,e=this.endTime;null!==t._next&&t._parent===t._next._parent&&t._next.startTime<t.endTime;){var r=t.endTime-t._next.startTime;t._next.moveWithChildren(r),e=(t=t._next).endTime}return e},t.prototype.moveWithChildren=function(t){var e=[];for(e.push(this);e.length>0;){var r=e.pop();null!=r._children&&r._children.forEach((function(t){return e.push(t)})),r._data.startTime+=t,r._data.endTime+=t}},t.prototype.getTemplate=function(t){return void 0===t&&(t=0),t<0||t>=this._templates.length?null:this._templates[t]},t.prototype.addTemplateAt=function(t,e){this._templates.splice(e,0,t),t.assignedUnit=this},t.prototype.addTemplate=function(t){this._templates.push(t),t.assignedUnit=this},t.prototype.removeTemplates=function(){for(var t=this._templates.slice();this._templates.length>0;)this._templates.pop();return t},t.prototype.removeTemplateAt=function(t){if(t<0||t>=this._templates.length)return null;var e=this._templates.splice(t,1)[0];return e.assignedUnit=null,e},t.prototype.removeTemplate=function(t){for(var e=0;e<this._templates.length;e++){var r=this._templates[e];if(r===t)return this._templates.splice(e,1),t.assignedUnit=null,r}return null},t.prototype.getType=function(){return Ym.NONE},t.prototype.toString=function(){return"RenderingUnit"},t}();function Rg(t,e){return void 0!==e&&e<t?e:t}function Lg(t,e){return void 0!==e&&e>t?e:t}var Ng=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Og(e,t),Object.defineProperty(e.prototype,"text",{get:function(){var t="";return this.children.forEach((function(e){t+=e.text})),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.children.reduce((function(t,e){return null===t?e.color:void 0===t||t.eq(e.color)?t:void 0}),null)},set:function(t){null!==t&&this.children.forEach((function(e){e.color=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{set:function(t){null!==t&&this.children.forEach((function(e){e.font=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.children.reduce((function(t,e){var r=e.fontFamily;return void 0===t||null!==t&&t!==r?void 0:r}),null)},set:function(t){this.children.forEach((function(e){e.fontFamily=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.children.reduce((function(t,e){var r=e.fontStyle;return void 0===t||null!==t&&t!==r?void 0:r}),null)},set:function(t){this.children.forEach((function(e){e.fontStyle=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.children.length<=0?0:this.children.reduce((function(t,e){return t+e.fontSize}),0)/this.children.length},set:function(t){this.children.forEach((function(e){e.fontSize=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this.children.reduce((function(t,e){return t+e.advance}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this.children.reduce((function(t,e){return Math.max(t,e.ascent)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this.children.reduce((function(t,e){return Math.max(t,e.descent)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ascent+this.descent},enumerable:!1,configurable:!0}),e.prototype.expandTime=function(t){return{startTime:Rg(this.startTime,t.startTime),endTime:Lg(this.endTime,t.endTime)}},e.prototype.toString=function(){return this.text},e}(Cg),Fg=function(){function t(t){this.a=0,this.r=0,this.g=0,this.b=0,this.from(t)}return Object.defineProperty(t.prototype,"value",{get:function(){return(((this.a<<8)+this.r<<8)+this.g<<8)+this.b},set:function(t){this.fromNumber(t,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},enumerable:!1,configurable:!0}),t.prototype.eq=function(e){return typeof this==typeof e&&e instanceof t&&this.value===e.value},t.prototype.toString=function(t){return void 0===t&&(t=!0),t?this.rgba:this.rgb},t.prototype.from=function(t){if(void 0===t&&(t="#000"),"object"==typeof t){if(!t)return;return"number"==typeof t.value?void(this.value=t.value):"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b?(this.a="number"==typeof t.a?t.a:255,this.r=t.r,this.g=t.g,void(this.b=t.b)):void 0}"string"==typeof t?this.fromString(t):"number"==typeof t&&this.fromNumber(t)},t.prototype.fromString=function(t){if(t){if("#"===t.charAt(0)&&(t=t.substr(1)),4===t.length){var e=t.charAt(0),r=t.charAt(1),n=t.charAt(2),i=t.charAt(3);t=""+e+e+r+r+n+n+i+i}3===t.length&&(r=t.charAt(0),n=t.charAt(1),i=t.charAt(2),t=""+r+r+n+n+i+i);var o=parseInt(t,16);this.fromNumber(o,8===t.length)}},t.prototype.fromNumber=function(t,e){void 0===e&&(e=!0),isNaN(t)||(this.a=e?t>>24&255:255,this.r=t>>16&255,this.g=t>>8&255,this.b=255&t)},t}(),Dg=function(){function t(t,e,r){void 0===t&&(t="Noto Sans Japanese"),void 0===e&&(e=40),void 0===r&&(r=""),this._family=t,this._size=e,this._style=r}return Object.defineProperty(t.prototype,"family",{get:function(){return this._family},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),t.prototype.deriveFamily=function(e){return new t(e,this._size,this._style)},t.prototype.deriveStyle=function(e){return new t(this._family,this._size,e)},t.prototype.deriveSize=function(e){return new t(this._family,e,this._style)},t.prototype.clone=function(){return new t(this._family,this._size,this._style)},t.prototype.eq=function(t){return this._family===t._family&&this._size===t._size&&this._style===t._style},t.prototype.toString=function(t){return void 0===t&&(t=1),this._style+(this._style.length>0?" ":"")+this._size*t+"px '"+this._family+"'"},t}(),Ug=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r._font=new Dg(e&&e.fontFamily,e&&e.fontSize,e&&e.fontStyle),r._color=new Fg,r}return Og(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._data&&this._data.char||"?"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this._runtime?this._runtime.advance:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this._runtime?this._runtime.ascent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._runtime?this._runtime.descent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){null===t||this.font.eq(t)||(this._font=t.clone(),this._data.fontFamily=t.family,this._data.fontSize=t.size,this._data.fontStyle=t.style,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.font.family},set:function(t){this.font.family!==t&&(this._font=this.font.deriveFamily(t),this._data.fontFamily=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.font.style},set:function(t){this.font.style!==t&&(this._font=this.font.deriveStyle(t),this._data.fontStyle=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.font.size},set:function(t){isNaN(t)||this.font.size===t||(this._font=this.font.deriveSize(t),this._data.fontSize=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){t&&!t.eq(this.color)&&(this._color=t,this._runtime&&this._runtime.onColorUpdate(t))},enumerable:!1,configurable:!0}),e.prototype.getType=function(){return Ym.CHAR},e}(Ng),kg=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return Og(e,t),e.prototype.getType=function(){return Ym.GRAPHIC},e.prototype.toString=function(){return"Graphic"},e}(Cg),jg=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return Og(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._data&&this._data.pos||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawPos",{get:function(){return this._data&&this._data.rawPoS||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._data&&this._data.language||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),e.prototype.addChar=function(t){if(null!==t){this._children.length>0&&(t._previous=this.lastChar,this.lastChar._next=t),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){return t instanceof Ug?this._children.indexOf(t):-1},e.prototype.getType=function(){return Ym.WORD},e}(Ng),Bg=function(t){function e(e,r){var n=t.call(this)||this;return n._video=e,n._data=r,n}return Og(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.reduce((function(t,e){return t+e.charCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstWord",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastWord",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!1,configurable:!0}),e.prototype.getWord=function(t){return t<0||t>=this._children.length?null:this._children[t]},e.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},e.prototype.addWord=function(t){if(null!==t){this._children.length>0&&(t._previous=this.lastWord,t._previous._next=t,t.firstChar._previous=t._previous.lastChar,t._previous.lastChar._next=t.firstChar),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){if(t instanceof jg)return this._children.indexOf(t);if(t instanceof Ug){for(var e=0,r=!1,n=0,i=this._children;n<i.length;n++){var o=i[n],a=o.findIndex(t);if(!(a<0)){e+=a,r=!0;break}e+=o.charCount}return r?e:-1}return-1},e.prototype.getType=function(){return Ym.PHRASE},e}(Ng);function zg(t,e,r){r||(r=function(t){return t});for(var n="number"==typeof e?e:r(e),i=0,o=t.length;i<o;){var a=Math.floor((i+o)/2);r(t[a])<n?i=a+1:o=a}return i}function Gg(t,e,r){if(!t||t.length<=0)return null;var n=zg(t,e,(function(t){return t.endTime}));if(n<0)return null;if("number"==typeof(null==r?void 0:r.endTime)){n>=t.length&&(n=t.length-1);var i=e,o=r.endTime;return t[n].overlaps(i,o)?t[n]:n<1?null:t[n-1].overlaps(i,o)?t[n-1]:null}return n>=t.length?null:(null==r?void 0:r.loose)||t[n].contains(e)?t[n]:null}var Vg,Hg=function(){function t(t){this._phrases=[],this._graphics=[],this.data=t,this.createUnits()}return Object.defineProperty(t.prototype,"phrases",{get:function(){return this._phrases.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime.rendering},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.data.duration},set:function(t){this.data.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this.data.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this.data.endTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phraseCount",{get:function(){return this._phrases.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphicCount",{get:function(){return this._graphics.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordCount",{get:function(){return this._phrases.reduce((function(t,e){return t+e.wordCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"charCount",{get:function(){return this._phrases.reduce((function(t,e){return t+e.charCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[this._phrases.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstWord",{get:function(){var t=this.firstPhrase;return null===t?null:t.firstWord},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastWord",{get:function(){var t=this.lastPhrase;return null===t?null:t.lastWord},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[this._graphics.length-1]},enumerable:!1,configurable:!0}),t.prototype.createUnits=function(){var t=this;Array.isArray(this.data.phrases)&&(this.data.phrases.forEach((function(e){var r=new Bg(t,e);e.words.forEach((function(t){var e=new jg(t);t.characters.forEach((function(t){return e.addChar(new Ug(t))})),r.addWord(e)})),t.addPhrase(r)})),this.organizeTimings()),Array.isArray(this.data.graphics)&&this.data.graphics.forEach((function(e){var r=new kg(e);t.addGraphic(r)}))},t.prototype.organizeTimings=function(){for(var t=this.firstChar;null!==t;)t.startTime===t.endTime&&t.maximize(),t=t.next},t.prototype.exportData=function(e){this.updateTemplateData(e);for(var r=t.exportUnitData(this.data.phrases,!1),n=r.units,i=r.templateClasses,o=t.exportUnitData(this.data.graphics,!0),a=o.units,s=o.templateClasses,u=i.concat(s).filter((function(t,e,r){return r.indexOf(t)===e})),l={};u.length>0;){var c=u.shift(),h=e.getByName(c);if(h){l[c]=h.id;for(var p=0,d=e.getRequiredTemplates(h.script);p<d.length;p++){var f=d[p];l[f]||u.push(f)}}else console.log("template class not found",c)}return{phrases:n,graphics:a,templateClasses:l}},t.exportUnitData=function(e,r){if(void 0===r&&(r=!1),!e)return{units:[],templateClasses:[]};for(var n=[],i=[],o=0,a=e;o<a.length;o++){var s=a[o],u={templates:s.templates?s.templates.map((function(t){var e=t.type;i.push(e);var r={};return Object.keys(t.value).forEach((function(e){var n=t.value[e];r[e]="object"==typeof n?Object.assign({},n):n})),{type:e,value:r}})):[]},l=void 0;if(s.words){var c=s,h=t.exportUnitData(c.words);u.words=h.units,l=h.templateClasses}else if(s.characters){var p=s,d=t.exportUnitData(p.characters);u.characters=d.units,l=d.templateClasses}else{for(var f=0,m=["fontFamily","fontSize","fontStyle"];f<m.length;f++){var g=m[f];s[g]&&(u[g]=s[g])}l=[]}r&&(u.startTime=s.startTime,u.endTime=s.endTime),n.push(u),i=i.concat(l)}return{units:n,templateClasses:i=i.filter((function(t,e,r){return r.indexOf(t)===e}))}},t.prototype.updateTemplateData=function(e){t.updateTemplateDataForUnits(e,this.firstPhrase,this.data.phrases),t.updateTemplateDataForUnits(e,this.firstGraphic,this.data.graphics)},t.updateTemplateDataForUnits=function(e,r,n){if(r&&n)for(var i=0,o=n;i<o.length;i++){var a=o[i];a.templates=[];for(var s=0;s<r.templateCount;s++){var u=r.getTemplate(s),l=e.exportInstance(u);a.templates.push(l)}if(a.words){var c=a;t.updateTemplateDataForUnits(e,r.children[0],c.words)}else if(a.characters){var h=a;t.updateTemplateDataForUnits(e,r.children[0],h.characters)}r=r.next}},t.prototype.addPhrase=function(t){if(t){if(this._phrases.length>0&&(t._previous=this.lastPhrase,t._previous._next=t,t.wordCount>0)){for(var e=this.lastPhrase;e&&null===e.lastWord;)e=e.previous;if(e&&(t.firstWord._previous=e.lastWord,e.lastWord._next=t.firstWord),t.charCount>0){for(var r=e.lastWord;r&&null===r.lastChar;)r=r.previous;t.firstChar._previous=r.lastChar,r.lastChar._next=t.firstChar}}this._phrases.push(t);var n=this.expandTime(t),i=n.startTime,o=n.endTime;this.data.startTime=i,this.data.endTime=o}},t.prototype.addGraphic=function(t){if(t){if(this._graphics.length<=0)this._graphics.push(t),this.data.graphics=[t._data];else{var e=zg(this._graphics,t,(function(t){return t.startTime})),r=e>0?this._graphics[e-1]:null,n=e<this._graphics.length?this._graphics[e]:null;this._graphics.splice(e,0,t),this.data.graphics.splice(e,0,t._data),null!==r&&(r._next=t,t._previous=r),null!==n&&(n._previous=t,t._next=n)}this._runtime&&this._runtime.addGraphic(t)}},t.prototype.removeGraphic=function(t){for(var e=0;e<this._graphics.length;e++){var r=this._graphics[e];if(r===t)return r._previous&&(r._previous._next=r._next),r._next&&(r._next._previous=r._previous),this._graphics.splice(e,1),this.data.graphics.splice(e,1),this._runtime&&this._runtime.removeGraphic(r),!0}return!1},t.prototype.removeGraphics=function(){var t=this;this._runtime&&this._graphics.forEach((function(e){return t._runtime.removeGraphic(e)})),this._graphics=[],this.rendering.reset()},t.prototype.expandTime=function(t){return{startTime:Rg(this.data.startTime,t.startTime),endTime:Lg(this.data.endTime,t.endTime)}},t.prototype.findIndex=function(t){if(t instanceof Bg)return this._phrases.indexOf(t);if(t instanceof jg){for(var e=0,r=!1,n=0,i=this._phrases;n<i.length;n++){if(!((u=(s=i[n]).findIndex(t))<0)){e+=u,r=!0;break}e+=s.wordCount}return r?e:-1}if(t instanceof Ug){e=0,r=!1;for(var o=0,a=this._phrases;o<a.length;o++){var s,u;if(!((u=(s=a[o]).findIndex(t))<0)){e+=u,r=!0;break}e+=s.charCount}return r?e:-1}return t instanceof kg?this._graphics.indexOf(t):-1},t.prototype.getPhrase=function(t){return t<0||t>=this._phrases.length?null:this._phrases[t]},t.prototype.getWord=function(t){if(t<0)return null;for(var e=0,r=this.firstPhrase;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},t.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},t.prototype.getGraphic=function(t){return t<0||t>=this._graphics.length?null:this._graphics[t]},t.prototype.findPhrase=function(t,e){return Gg(this._phrases,t,e)},t.prototype.findWord=function(t,e){var r=this.findPhrase(t,e);return r?Gg(r._children,t,e):null},t.prototype.findChar=function(t,e){var r=this.findWord(t,e);return r?Gg(r._children,t,e):null},t.prototype.findGraphic=function(t,e){return Gg(this._graphics,t,e)},t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t}(),Xg=function(){function t(t,e,r,n,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.setValues(t,e,r,n,i,o)}return t.prototype.setValues=function(t,e,r,n,i,o){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.append=function(t,e,r,n,i,o){var a=this.a,s=this.b,u=this.c,l=this.d;return 1==t&&0==e&&0==r&&1==n||(this.a=a*t+u*e,this.b=s*t+l*e,this.c=a*r+u*n,this.d=s*r+l*n),this.tx=a*i+u*o+this.tx,this.ty=s*i+l*o+this.ty,this},t.prototype.prepend=function(t,e,r,n,i,o){var a=this.a,s=this.c,u=this.tx;return this.a=t*a+r*this.b,this.b=e*a+n*this.b,this.c=t*s+r*this.d,this.d=e*s+n*this.d,this.tx=t*u+r*this.ty+i,this.ty=e*u+n*this.ty+o,this},t.prototype.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.appendTransform=function(e,r,n,i,o,a,s,u,l){var c,h,p;return o%360?(c=o*t.DEG_TO_RAD,h=Math.cos(c),p=Math.sin(c)):(h=1,p=0),a||s?(a*=t.DEG_TO_RAD,s*=t.DEG_TO_RAD,this.append(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,r),this.append(h*n,p*n,-p*i,h*i,0,0)):this.append(h*n,p*n,-p*i,h*i,e,r),(u||l)&&(this.tx-=u*this.a+l*this.c,this.ty-=u*this.b+l*this.d),this},t.prototype.prependTransform=function(e,r,n,i,o,a,s,u,l){var c,h,p;return o%360?(c=o*t.DEG_TO_RAD,h=Math.cos(c),p=Math.sin(c)):(h=1,p=0),(u||l)&&(this.tx-=u,this.ty-=l),a||s?(a*=t.DEG_TO_RAD,s*=t.DEG_TO_RAD,this.prepend(h*n,p*n,-p*i,h*i,0,0),this.prepend(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,r)):this.prepend(h*n,p*n,-p*i,h*i,e,r),this},t.prototype.rotate=function(e){e*=t.DEG_TO_RAD;var r=Math.cos(e),n=Math.sin(e),i=this.a,o=this.b;return this.a=i*r+this.c*n,this.b=o*r+this.d*n,this.c=-i*n+this.c*r,this.d=-o*n+this.d*r,this},t.prototype.skew=function(e,r){return e*=t.DEG_TO_RAD,r*=t.DEG_TO_RAD,this.append(Math.cos(r),Math.sin(r),-Math.sin(e),Math.cos(e),0,0),this},t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.prototype.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.prototype.transformPoint=function(t,e,r){return r.x=t*this.a+e*this.c+this.tx,r.y=t*this.b+e*this.d+this.ty,r},t.prototype.decompose=function(e){void 0===e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var r=Math.atan2(-this.c,this.d),n=Math.atan2(this.b,this.a);return Math.abs(1-r/n)<1e-5?(e.rotation=n/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=r/t.DEG_TO_RAD,e.skewY=n/t.DEG_TO_RAD),e},t.prototype.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.prototype.toString=function(){return"["+this.constructor.name+" (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.DEG_TO_RAD=Math.PI/180,t.identity=new t,t}(),Wg=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.setValues(t,e)}return t.prototype.setValues=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"["+this.constructor.name+" (x="+this.x+" y="+this.y+")]"},t}(),Yg=function(){function t(){this.tx=new Xg,this.alpha=0,this.composite="",this.visible=!0}return t.prototype.reset=function(){},t}(),qg=function(){function t(){this.wrapperTable={}}return t.prototype.isGraphics=function(){return!1},t.prototype.setCanvas=function(){return Promise.resolve()},t.prototype.createRuntime=function(t){return e=this,n=function(){var e,r,n;return function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(i){for(e=t.firstPhrase;e;){for(e._runtime={graphics:{},rendering:new Yg,update:function(){}},r=e.firstWord;r;){for(r._runtime={graphics:{},rendering:new Yg,update:function(){}},n=r.firstChar;n&&(n._runtime={graphics:{clear:function(){}},rendering:new Yg,update:function(){},advance:0,ascent:0,descent:0,onFontUpdate:function(){},onColorUpdate:function(){}},n!==r.lastChar);)n=n.next;if(r===e.lastWord)break;r=r.next}e=e.next}return t._runtime={rendering:new Yg,addGraphic:function(){},removeGraphic:function(){}},[2,t._runtime]}))},new((r=void 0)||(r=Promise))((function(t,i){function o(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(o,a)}s((n=n.apply(e,[])).next())}));var e,r,n},t.prototype.reset=function(){},t.prototype.update=function(){},t.prototype.updateStageTx=function(){},t}(),$g=(function(t){var e,r,n,i;t.version="0.4.1",t.parse=function(t,i){return r=String(t),n=r.length,a(i),Wt(),function(t){v=y=s,e.locations&&(x=new Xt),b=w=null,_=[],Zt();var r=t||le(),n=!0;for(t||(r.body=[]);p!==O;){var i=_e();r.body.push(i),n&&pe(i)&&ae(!0),n=!1}return he(r,"Program")}(e.program)};var o=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function a(t){for(var r in e=t||{},o)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=o[r]);i=e.sourceFile||null}var s,u,l,c,h,p,d,f,m,g,v,y,x,b,_,w,T=t.getLineInfo=function(t,e){for(var r=1,n=0;;){Gt.lastIndex=n;var i=Gt.exec(t);if(!(i&&i.index<e))break;++r,n=i.index+i[0].length}return{line:r,column:e-n}};function E(t,e){var n=T(r,t);e+=" ("+n.line+":"+n.column+")";var i=new SyntaxError(e);throw i.pos=t,i.loc=n,i.raisedAt=s,i}t.tokenize=function(t,i){r=String(t),n=r.length,a(i),Wt();var o={};function v(t){return Zt(t),o.start=u,o.end=l,o.startLoc=c,o.endLoc=h,o.type=p,o.value=d,o}return v.jumpTo=function(t,n){var i;if(s=t,e.locations)for(m=1,g=Gt.lastIndex=0;(i=Gt.exec(r))&&i.index<t;)++m,g=i.index+i[0].length;f=n,Qt()},v};var S=[],A={type:"num"},P={type:"regexp"},M={type:"string"},I={type:"name"},O={type:"eof"},C={keyword:"break"},R={keyword:"case",beforeExpr:!0},L={keyword:"catch"},N={keyword:"continue"},F={keyword:"debugger"},D={keyword:"default"},U={keyword:"do",isLoop:!0},k={keyword:"else",beforeExpr:!0},j={keyword:"finally"},B={keyword:"for",isLoop:!0},z={keyword:"function"},G={keyword:"if"},V={keyword:"return",beforeExpr:!0},H={keyword:"switch"},X={keyword:"throw",beforeExpr:!0},W={keyword:"try"},Y={keyword:"var"},q={keyword:"while",isLoop:!0},$={keyword:"with"},Q={keyword:"new",beforeExpr:!0},Z={keyword:"this"},J={keyword:"null",atomValue:null},K={keyword:"true",atomValue:!0},tt={keyword:"false",atomValue:!1},et={keyword:"in",binop:7,beforeExpr:!0},rt={break:C,case:R,catch:L,continue:N,debugger:F,default:D,do:U,else:k,finally:j,for:B,function:z,if:G,return:V,switch:H,throw:X,try:W,var:Y,while:q,with:$,null:J,true:K,false:tt,new:Q,in:et,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Z,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},nt={type:"[",beforeExpr:!0},it={type:"]"},ot={type:"{",beforeExpr:!0},at={type:"}"},st={type:"(",beforeExpr:!0},ut={type:")"},lt={type:",",beforeExpr:!0},ct={type:";",beforeExpr:!0},ht={type:":",beforeExpr:!0},pt={type:"."},dt={type:"?",beforeExpr:!0},ft={binop:10,beforeExpr:!0},mt={isAssign:!0,beforeExpr:!0},gt={isAssign:!0,beforeExpr:!0},vt={postfix:!0,prefix:!0,isUpdate:!0},yt={prefix:!0,beforeExpr:!0},xt={binop:1,beforeExpr:!0},bt={binop:2,beforeExpr:!0},_t={binop:3,beforeExpr:!0},wt={binop:4,beforeExpr:!0},Tt={binop:5,beforeExpr:!0},Et={binop:6,beforeExpr:!0},St={binop:7,beforeExpr:!0},At={binop:8,beforeExpr:!0},Pt={binop:9,prefix:!0,beforeExpr:!0},Mt={binop:10,beforeExpr:!0};for(var It in t.tokTypes={bracketL:nt,bracketR:it,braceL:ot,braceR:at,parenL:st,parenR:ut,comma:lt,semi:ct,colon:ht,dot:pt,question:dt,slash:ft,eq:mt,name:I,eof:O,num:A,regexp:P,string:M},rt)t.tokTypes["_"+It]=rt[It];function Ot(t){t=t.split(" ");var e="",r=[];t:for(var n=0;n<t.length;++n){for(var i=0;i<r.length;++i)if(r[i][0].length==t[n].length){r[i].push(t[n]);continue t}r.push([t[n]])}function o(t){if(1==t.length)return e+="return str === "+JSON.stringify(t[0])+";";e+="switch(str){";for(var r=0;r<t.length;++r)e+="case "+JSON.stringify(t[r])+":";e+="return true}return false;"}if(r.length>3){for(r.sort((function(t,e){return e.length-t.length})),e+="switch(str.length){",n=0;n<r.length;++n){var a=r[n];e+="case "+a[0].length+":",o(a)}e+="}"}else o(t);return new Function("str",e)}var Ct,Rt=Ot("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Lt=Ot("class enum extends super const export import"),Nt=Ot("implements interface let package private protected public static yield"),Ft=Ot("eval arguments"),Dt=Ot("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Ut=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,kt="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",jt=new RegExp("["+kt+"]"),Bt=new RegExp("["+kt+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),zt=/[\n\r\u2028\u2029]/,Gt=/\r\n|[\n\r\u2028\u2029]/g,Vt=t.isIdentifierStart=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&jt.test(String.fromCharCode(t)))},Ht=t.isIdentifierChar=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&Bt.test(String.fromCharCode(t))))};function Xt(){this.line=m,this.column=s-g}function Wt(){m=1,s=g=0,f=!0,Qt()}function Yt(t,r){l=s,e.locations&&(h=new Xt),p=t,Qt(),d=r,f=t.beforeExpr}function qt(){var t,n=e.onComment&&e.locations&&new Xt,i=s,o=r.indexOf("*/",s+=2);if(-1===o&&E(s-2,"Unterminated comment"),s=o+2,e.locations)for(Gt.lastIndex=i;(t=Gt.exec(r))&&t.index<s;)++m,g=t.index+t[0].length;e.onComment&&e.onComment(!0,r.slice(i+2,o),i,s,n,e.locations&&new Xt)}function $t(){for(var t=s,i=e.onComment&&e.locations&&new Xt,o=r.charCodeAt(s+=2);s<n&&10!==o&&13!==o&&8232!==o&&8233!==o;)++s,o=r.charCodeAt(s);e.onComment&&e.onComment(!1,r.slice(t+2,s),t,s,i,e.locations&&new Xt)}function Qt(){for(;s<n;){var t=r.charCodeAt(s);if(32===t)++s;else if(13===t)++s,10===(i=r.charCodeAt(s))&&++s,e.locations&&(++m,g=s);else if(10===t||8232===t||8233===t)++s,e.locations&&(++m,g=s);else if(t>8&&t<14)++s;else if(47===t){var i;if(42===(i=r.charCodeAt(s+1)))qt();else{if(47!==i)break;$t()}}else if(160===t)++s;else{if(!(t>=5760&&Ut.test(String.fromCharCode(t))))break;++s}}}function Zt(t){if(t?s=u+1:u=s,e.locations&&(c=new Xt),t)return Kt();if(s>=n)return Yt(O);var i=r.charCodeAt(s);if(Vt(i)||92===i)return ie();var o=function(t){switch(t){case 46:return(o=r.charCodeAt(s+1))>=48&&o<=57?ee(!0):(++s,Yt(pt));case 40:return++s,Yt(st);case 41:return++s,Yt(ut);case 59:return++s,Yt(ct);case 44:return++s,Yt(lt);case 91:return++s,Yt(nt);case 93:return++s,Yt(it);case 123:return++s,Yt(ot);case 125:return++s,Yt(at);case 58:return++s,Yt(ht);case 63:return++s,Yt(dt);case 48:var i=r.charCodeAt(s+1);if(120===i||88===i)return function(){s+=2;var t=te(16);return null==t&&E(u+2,"Expected hexadecimal number"),Vt(r.charCodeAt(s))&&E(s,"Identifier directly after number"),Yt(A,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return ee(!1);case 34:case 39:return function(t){s++;for(var i="";;){s>=n&&E(u,"Unterminated string constant");var o=r.charCodeAt(s);if(o===t)return++s,Yt(M,i);if(92===o){o=r.charCodeAt(++s);var a=/^[0-7]+/.exec(r.slice(s,s+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,-1);if("0"===a&&(a=null),++s,a)w&&E(s-2,"Octal literal in strict mode"),i+=String.fromCharCode(parseInt(a,8)),s+=a.length-1;else switch(o){case 110:i+="\n";break;case 114:i+="\r";break;case 120:i+=String.fromCharCode(re(2));break;case 117:i+=String.fromCharCode(re(4));break;case 85:i+=String.fromCharCode(re(8));break;case 116:i+="\t";break;case 98:i+="\b";break;case 118:i+="\v";break;case 102:i+="\f";break;case 48:i+="\0";break;case 13:10===r.charCodeAt(s)&&++s;case 10:e.locations&&(g=s,++m);break;default:i+=String.fromCharCode(o)}}else 13!==o&&10!==o&&8232!==o&&8233!==o||E(u,"Unterminated string constant"),i+=String.fromCharCode(o),++s}}(t);case 47:return function(){var t=r.charCodeAt(s+1);return f?(++s,Kt()):61===t?Jt(gt,2):Jt(ft,1)}();case 37:case 42:return 61===r.charCodeAt(s+1)?Jt(gt,2):Jt(Mt,1);case 124:case 38:return function(t){var e=r.charCodeAt(s+1);return e===t?Jt(124===t?xt:bt,2):61===e?Jt(gt,2):Jt(124===t?_t:Tt,1)}(t);case 94:return 61===r.charCodeAt(s+1)?Jt(gt,2):Jt(wt,1);case 43:case 45:return function(t){var e=r.charCodeAt(s+1);return e===t?45==e&&62==r.charCodeAt(s+2)&&zt.test(r.slice(y,s))?(s+=3,$t(),Qt(),Zt()):Jt(vt,2):61===e?Jt(gt,2):Jt(Pt,1)}(t);case 60:case 62:return function(t){var e=r.charCodeAt(s+1),n=1;return e===t?(n=62===t&&62===r.charCodeAt(s+2)?3:2,61===r.charCodeAt(s+n)?Jt(gt,n+1):Jt(At,n)):33==e&&60==t&&45==r.charCodeAt(s+2)&&45==r.charCodeAt(s+3)?(s+=4,$t(),Qt(),Zt()):(61===e&&(n=61===r.charCodeAt(s+2)?3:2),Jt(St,n))}(t);case 61:case 33:return function(t){return 61===r.charCodeAt(s+1)?Jt(Et,61===r.charCodeAt(s+2)?3:2):Jt(61===t?mt:yt,1)}(t);case 126:return Jt(yt,1)}var o;return!1}(i);if(!1===o){var a=String.fromCharCode(i);if("\\"===a||jt.test(a))return ie();E(s,"Unexpected character '"+a+"'")}return o}function Jt(t,e){var n=r.slice(s,s+e);s+=e,Yt(t,n)}function Kt(){for(var t,e,i=s;;){s>=n&&E(i,"Unterminated regular expression");var o=r.charAt(s);if(zt.test(o)&&E(i,"Unterminated regular expression"),t)t=!1;else{if("["===o)e=!0;else if("]"===o&&e)e=!1;else if("/"===o&&!e)break;t="\\"===o}++s}var a=r.slice(i,s);++s;var u=ne();return u&&!/^[gmsiy]*$/.test(u)&&E(i,"Invalid regexp flag"),Yt(P,new RegExp(a,u))}function te(t,e){for(var n=s,i=0,o=0,a=null==e?1/0:e;o<a;++o){var u,l=r.charCodeAt(s);if((u=l>=97?l-97+10:l>=65?l-65+10:l>=48&&l<=57?l-48:1/0)>=t)break;++s,i=i*t+u}return s===n||null!=e&&s-n!==e?null:i}function ee(t){var e=s,n=!1,i=48===r.charCodeAt(s);t||null!==te(10)||E(e,"Invalid number"),46===r.charCodeAt(s)&&(++s,te(10),n=!0);var o=r.charCodeAt(s);69!==o&&101!==o||(43!==(o=r.charCodeAt(++s))&&45!==o||++s,null===te(10)&&E(e,"Invalid number"),n=!0),Vt(r.charCodeAt(s))&&E(s,"Identifier directly after number");var a,u=r.slice(e,s);return n?a=parseFloat(u):i&&1!==u.length?/[89]/.test(u)||w?E(e,"Invalid number"):a=parseInt(u,8):a=parseInt(u,10),Yt(A,a)}function re(t){var e=te(16,t);return null===e&&E(u,"Bad character escape sequence"),e}function ne(){Ct=!1;for(var t,e=!0,n=s;;){var i=r.charCodeAt(s);if(Ht(i))Ct&&(t+=r.charAt(s)),++s;else{if(92!==i)break;Ct||(t=r.slice(n,s)),Ct=!0,117!=r.charCodeAt(++s)&&E(s,"Expecting Unicode escape sequence \\uXXXX"),++s;var o=re(4),a=String.fromCharCode(o);a||E(s-1,"Invalid Unicode escape"),(e?Vt(o):Ht(o))||E(s-4,"Invalid Unicode escape"),t+=a}e=!1}return Ct?t:r.slice(n,s)}function ie(){var t=ne(),r=I;return Ct||(Dt(t)?r=rt[t]:(e.forbidReserved&&(3===e.ecmaVersion?Rt:Lt)(t)||w&&Nt(t))&&E(u,"The keyword '"+t+"' is reserved")),Yt(r,t)}function oe(){v=u,y=l,x=h,Zt()}function ae(t){if(w=t,s=y,e.locations)for(;s<g;)g=r.lastIndexOf("\n",g-2)+1,--m;Qt(),Zt()}function se(){this.type=null,this.start=u,this.end=null}function ue(){this.start=c,this.end=null,null!==i&&(this.source=i)}function le(){var t=new se;return e.locations&&(t.loc=new ue),e.directSourceFile&&(t.sourceFile=e.directSourceFile),e.ranges&&(t.range=[u,0]),t}function ce(t){var r=new se;return r.start=t.start,e.locations&&(r.loc=new ue,r.loc.start=t.loc.start),e.ranges&&(r.range=[t.range[0],0]),r}function he(t,r){return t.type=r,t.end=y,e.locations&&(t.loc.end=x),e.ranges&&(t.range[1]=y),t}function pe(t){return e.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function de(t){if(p===t)return oe(),!0}function fe(){return!e.strictSemicolons&&(p===O||p===at||zt.test(r.slice(y,u)))}function me(){de(ct)||fe()||ve()}function ge(t){p===t?oe():ve()}function ve(){E(u,"Unexpected token")}function ye(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&E(t.start,"Assigning to rvalue"),w&&"Identifier"===t.type&&Ft(t.name)&&E(t.start,"Assigning to "+t.name+" in strict mode")}var xe={kind:"loop"},be={kind:"switch"};function _e(){(p===ft||p===gt&&"/="==d)&&Zt(!0);var t=p,e=le();switch(t){case C:case N:oe();var n=t===C;de(ct)||fe()?e.label=null:p!==I?ve():(e.label=Fe(),me());for(var i=0;i<_.length;++i){var o=_[i];if(null==e.label||o.name===e.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(e.label&&n)break}}return i===_.length&&E(e.start,"Unsyntactic "+t.keyword),he(e,n?"BreakStatement":"ContinueStatement");case F:return oe(),me(),he(e,"DebuggerStatement");case U:return oe(),_.push(xe),e.body=_e(),_.pop(),ge(q),e.test=we(),me(),he(e,"DoWhileStatement");case B:if(oe(),_.push(xe),ge(st),p===ct)return Ee(e,null);if(p===Y){var a=le();return oe(),Ae(a,!0),he(a,"VariableDeclaration"),1===a.declarations.length&&de(et)?Se(e,a):Ee(e,a)}return a=Pe(!1,!0),de(et)?(ye(a),Se(e,a)):Ee(e,a);case z:return oe(),Le(e,!0);case G:return oe(),e.test=we(),e.consequent=_e(),e.alternate=de(k)?_e():null,he(e,"IfStatement");case V:return b||E(u,"'return' outside of function"),oe(),de(ct)||fe()?e.argument=null:(e.argument=Pe(),me()),he(e,"ReturnStatement");case H:oe(),e.discriminant=we(),e.cases=[],ge(ot),_.push(be);for(var s,l;p!=at;)if(p===R||p===D){var c=p===R;s&&he(s,"SwitchCase"),e.cases.push(s=le()),s.consequent=[],oe(),c?s.test=Pe():(l&&E(v,"Multiple default clauses"),l=!0,s.test=null),ge(ht)}else s||ve(),s.consequent.push(_e());return s&&he(s,"SwitchCase"),oe(),_.pop(),he(e,"SwitchStatement");case X:return oe(),zt.test(r.slice(y,u))&&E(y,"Illegal newline after throw"),e.argument=Pe(),me(),he(e,"ThrowStatement");case W:if(oe(),e.block=Te(),e.handler=null,p===L){var h=le();oe(),ge(st),h.param=Fe(),w&&Ft(h.param.name)&&E(h.param.start,"Binding "+h.param.name+" in strict mode"),ge(ut),h.guard=null,h.body=Te(),e.handler=he(h,"CatchClause")}return e.guardedHandlers=S,e.finalizer=de(j)?Te():null,e.handler||e.finalizer||E(e.start,"Missing catch or finally clause"),he(e,"TryStatement");case Y:return oe(),Ae(e),me(),he(e,"VariableDeclaration");case q:return oe(),e.test=we(),_.push(xe),e.body=_e(),_.pop(),he(e,"WhileStatement");case $:return w&&E(u,"'with' in strict mode"),oe(),e.object=we(),e.body=_e(),he(e,"WithStatement");case ot:return Te();case ct:return oe(),he(e,"EmptyStatement");default:var f=d,m=Pe();if(t===I&&"Identifier"===m.type&&de(ht)){for(i=0;i<_.length;++i)_[i].name===f&&E(m.start,"Label '"+f+"' is already declared");var g=p.isLoop?"loop":p===H?"switch":null;return _.push({name:f,kind:g}),e.body=_e(),_.pop(),e.label=m,he(e,"LabeledStatement")}return e.expression=m,me(),he(e,"ExpressionStatement")}}function we(){ge(st);var t=Pe();return ge(ut),t}function Te(t){var e,r=le(),n=!0,i=!1;for(r.body=[],ge(ot);!de(at);){var o=_e();r.body.push(o),n&&t&&pe(o)&&(e=i,ae(i=!0)),n=!1}return i&&!e&&ae(!1),he(r,"BlockStatement")}function Ee(t,e){return t.init=e,ge(ct),t.test=p===ct?null:Pe(),ge(ct),t.update=p===ut?null:Pe(),ge(ut),t.body=_e(),_.pop(),he(t,"ForStatement")}function Se(t,e){return t.left=e,t.right=Pe(),ge(ut),t.body=_e(),_.pop(),he(t,"ForInStatement")}function Ae(t,e){for(t.declarations=[],t.kind="var";;){var r=le();if(r.id=Fe(),w&&Ft(r.id.name)&&E(r.id.start,"Binding "+r.id.name+" in strict mode"),r.init=de(mt)?Pe(!0,e):null,t.declarations.push(he(r,"VariableDeclarator")),!de(lt))break}return t}function Pe(t,e){var r=Me(e);if(!t&&p===lt){var n=ce(r);for(n.expressions=[r];de(lt);)n.expressions.push(Me(e));return he(n,"SequenceExpression")}return r}function Me(t){var e=function(t){var e,r=(e=t,function t(e,r,n){var i=p.binop;if(null!=i&&(!n||p!==et)&&i>r){var o=ce(e);o.left=e,o.operator=d;var a=p;return oe(),o.right=t(Ie(),i,n),t(he(o,a===xt||a===bt?"LogicalExpression":"BinaryExpression"),r,n)}return e}(Ie(),-1,e));if(de(dt)){var n=ce(r);return n.test=r,n.consequent=Pe(!0),ge(ht),n.alternate=Pe(!0,t),he(n,"ConditionalExpression")}return r}(t);if(p.isAssign){var r=ce(e);return r.operator=d,r.left=e,oe(),r.right=Me(t),ye(e),he(r,"AssignmentExpression")}return e}function Ie(){if(p.prefix){var t=le(),e=p.isUpdate;return t.operator=d,t.prefix=!0,f=!0,oe(),t.argument=Ie(),e?ye(t.argument):w&&"delete"===t.operator&&"Identifier"===t.argument.type&&E(t.start,"Deleting local variable in strict mode"),he(t,e?"UpdateExpression":"UnaryExpression")}for(var r=Oe(Ce());p.postfix&&!fe();)(t=ce(r)).operator=d,t.prefix=!1,t.argument=r,ye(r),oe(),r=he(t,"UpdateExpression");return r}function Oe(t,e){var r;return de(pt)?((r=ce(t)).object=t,r.property=Fe(!0),r.computed=!1,Oe(he(r,"MemberExpression"),e)):de(nt)?((r=ce(t)).object=t,r.property=Pe(),r.computed=!0,ge(it),Oe(he(r,"MemberExpression"),e)):!e&&de(st)?((r=ce(t)).callee=t,r.arguments=Ne(ut,!1),Oe(he(r,"CallExpression"),e)):t}function Ce(){switch(p){case Z:var t=le();return oe(),he(t,"ThisExpression");case I:return Fe();case A:case M:case P:return(t=le()).value=d,t.raw=r.slice(u,l),oe(),he(t,"Literal");case J:case K:case tt:return(t=le()).value=p.atomValue,t.raw=p.keyword,oe(),he(t,"Literal");case st:var n=c,i=u;oe();var o=Pe();return o.start=i,o.end=l,e.locations&&(o.loc.start=n,o.loc.end=h),e.ranges&&(o.range=[i,l]),ge(ut),o;case nt:return t=le(),oe(),t.elements=Ne(it,!0,!0),he(t,"ArrayExpression");case ot:return function(){var t=le(),r=!0,n=!1;for(t.properties=[],oe();!de(at);){if(r)r=!1;else if(ge(lt),e.allowTrailingCommas&&de(at))break;var i,o={key:Re()},a=!1;if(de(ht)?(o.value=Pe(!0),i=o.kind="init"):e.ecmaVersion>=5&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(a=n=!0,i=o.kind=o.key.name,o.key=Re(),p!==st&&ve(),o.value=Le(le(),!1)):ve(),"Identifier"===o.key.type&&(w||n))for(var s=0;s<t.properties.length;++s){var u=t.properties[s];if(u.key.name===o.key.name){var l=i==u.kind||a&&"init"===u.kind||"init"===i&&("get"===u.kind||"set"===u.kind);l&&!w&&"init"===i&&"init"===u.kind&&(l=!1),l&&E(o.key.start,"Redefinition of property")}}t.properties.push(o)}return he(t,"ObjectExpression")}();case z:return t=le(),oe(),Le(t,!1);case Q:return a=le(),oe(),a.callee=Oe(Ce(),!0),de(st)?a.arguments=Ne(ut,!1):a.arguments=S,he(a,"NewExpression");default:ve()}var a}function Re(){return p===A||p===M?Ce():Fe(!0)}function Le(t,e){p===I?t.id=Fe():e?ve():t.id=null,t.params=[];var r=!0;for(ge(st);!de(ut);)r?r=!1:ge(lt),t.params.push(Fe());var n=b,i=_;if(b=!0,_=[],t.body=Te(!0),b=n,_=i,w||t.body.body.length&&pe(t.body.body[0]))for(var o=t.id?-1:0;o<t.params.length;++o){var a=o<0?t.id:t.params[o];if((Nt(a.name)||Ft(a.name))&&E(a.start,"Defining '"+a.name+"' in strict mode"),o>=0)for(var s=0;s<o;++s)a.name===t.params[s].name&&E(a.start,"Argument name clash in strict mode")}return he(t,e?"FunctionDeclaration":"FunctionExpression")}function Ne(t,r,n){for(var i=[],o=!0;!de(t);){if(o)o=!1;else if(ge(lt),r&&e.allowTrailingCommas&&de(t))break;n&&p===lt?i.push(null):i.push(Pe(!0))}return i}function Fe(t){var r=le();return r.name=p===I?d:t&&!e.forbidReserved&&p.keyword||ve(),f=!1,oe(),he(r,"Identifier")}}((Vg={path:void 0,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&Vg.path)}}).exports),Vg.exports);function Qg(t){var e=parseFloat(t);return isNaN(e)?0:e}function Zg(t){var e;if(!(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.search))return null;for(var r=0,n=window.location.search.substring(1).split("&");r<n.length;r++){var i=n[r].split("=");if(decodeURIComponent(i[0])===t)return decodeURIComponent(i[1])}return null}Object.freeze({__proto__:null,cancelIdleCallback:function(t){return window.cancelIdleCallback?window.cancelIdleCallback(t):clearTimeout(t)},requestIdleCallback:function(t,e){if(window.requestIdleCallback)return window.requestIdleCallback(t,e);var r=Date.now(),n=e?e.timeout:50;return setTimeout((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,n-(Date.now()-r))}})}),1)},getNumber:Qg,getQueryVariable:Zg});var Jg=function(t,e){return(Jg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function Kg(t,e){function r(){this.constructor=t}Jg(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var tv=function(){return(tv=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ev(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))}function rv(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function nv(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}var iv,ov=[0,0,0,0],av=function(){function t(){this._position=0,this._wait=50,this.update=this.update.bind(this)}return Object.defineProperty(t.prototype,"wait",{get:function(){return this._wait},set:function(t){this._wait=t,this._isPlaying&&this.start()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){if(!this.isPlaying)return this._position;var t=this.basePosition.position+(Date.now()-this.basePosition.time);return Math.min(t,this.player.video.duration)},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e=t.player,r=t.updater,n=t.emitter;return ev(this,void 0,void 0,(function(){return rv(this,(function(t){return this.player=e,this.updateMediaPosition=r,this.emitter=n,[2]}))}))},t.prototype.play=function(){this.start(),this.emitter.onPlay()},t.prototype.stop=function(){this.clearInterval(),this._isPlaying=!1,this.seek(0),this.pause(),this.emitter.onStop()},t.prototype.pause=function(){this.clearInterval(),this._isPlaying=!1,this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._position=t,this.updateMediaPosition(t).then((function(){e.emitter.onSeek(t)})),this.isPlaying&&this.start()},t.prototype.dispose=function(){this.clearInterval()},t.prototype.clearInterval=function(){window.clearInterval(this.intervalId)},t.prototype.start=function(){this.clearInterval(),this._isPlaying=!0,this.basePosition={time:Date.now(),position:this._position},this.intervalId=window.setInterval(this.update,this.wait)},t.prototype.update=function(){this.player.video||this.stop();var t=this.basePosition.position+(Date.now()-this.basePosition.time);this._position=Math.min(t,this.player.video.duration),this.updateMediaPosition(this.position),this._position>=this.player.video.duration&&this.stop()},t}();function sv(){return ev(this,void 0,void 0,(function(){return rv(this,(function(t){return iv&&iv.Player?[2,iv]:"undefined"==typeof window?[2,import("./main.d25f0dd5.js").then((function(t){return t.m}))]:window.Songle&&window.Songle.Player?[2,window.Songle]:[2,new Promise((function(t){var e=!1;window.onSongleAPIReady=function(r){e=!0,t(iv=r)},setTimeout((function(){if(!e){var t=[];document.querySelectorAll("script").forEach((function(e){var r=e.getAttribute("src");r&&r.indexOf("songle.jp/v2/api.js")>=0&&t.push(e)})),t.forEach((function(t){return t.parentElement.removeChild(t)}));var r=document.createElement("script");r.src="https://api.songle.jp/v2/api.js",document.head.appendChild(r)}}),1e3)}))]}))}))}var uv=function(){function t(t){void 0===t&&(t={}),this.options=t,this.wait=50,this.lastPosition=0,this.lastTime=0,this.elapsedTimes=[],this.volumeListener={onVolumeUpdate:this.onVolumeUpdate.bind(this)}}return Object.defineProperty(t.prototype,"songlePlayer",{get:function(){return this._songlePlayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._songlePlayer&&this._songlePlayer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){if(!this._songlePlayer)return 0;if(!this.handler)return this.lastPosition;var t=this.lastTime,e=this.lastPosition,r=Date.now()-t;return e>0?e+r:this._songlePlayer.positionTime},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e=t.player,r=t.updater,n=t.emitter,i=t.altSourceUrl;return ev(this,void 0,void 0,(function(){var t,o,a;return rv(this,(function(s){switch(s.label){case 0:return this.player&&this.player.removeListener(this.volumeListener),this.player=e,this.player.addListener(this.volumeListener),this.updateMediaPosition=r,this.emitter=n,this._songlePlayer?[3,2]:[4,this.initializeSonglePlayer()];case 1:s.sent(),s.label=2;case 2:return t=this.player.data.song.permalink,o=this.options.headless,a=i||(this.options.altSourceUrls||{})[t],Km.isUploaderUrl(a)&&(a=Km.getAltSongUrlFromUploaderGuid(Km.getUploaderGuid(Km.getSongPathFromUrl(a)))),[4,this._songlePlayer.useMedia(t,{headless:o,altSourceUrl:a})];case 3:return s.sent(),this._songlePlayer.volume=0*(1-this.player.volume/100)+100*this.player.volume/100,this._songlePlayer.play(),this._songlePlayer.stop(),[2]}}))}))},t.prototype.initializeSonglePlayer=function(){var t;return ev(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,u=this;return rv(this,(function(l){switch(l.label){case 0:return e=this.options,r=e.accessToken,n=e.secretToken,(o=this.options.songle)?[3,2]:[4,sv()];case 1:o=l.sent(),l.label=2;case 2:return(i=o).System&&(i.System.showLicense=!1),a=r||n,s=null===(t=this.options)||void 0===t?void 0:t.autoUseMedia,this._songlePlayer=a?new i.SyncPlayer({mediaElement:this.player.mediaSourceElement,accessToken:r,secretToken:n,autoUseMedia:s}):new i.Player({mediaElement:this.player.mediaSourceElement}),this._songlePlayer.on("play",(function(){u.handler||(u.startPolling(),u.emitter.onPlay())})),this._songlePlayer.on("pause",(function(){u.stopPolling(),u.emitter.onPause(),u.stopping&&(u.stopping=!1,u.emitter.onStop())})),this._songlePlayer.on("finish",(function(){u.handler&&(u.stopPolling(),u.emitter.onStop())})),this._songlePlayer.on("seek",(function(){u.updateMediaPosition(u._songlePlayer.positionTime)})),a&&(this._songlePlayer.on("mediaPlay",(function(){u.handler||(u.startPolling(),u.emitter.onPlay())})),this._songlePlayer.on("mediaFinish",(function(){u.handler&&(u.stopPolling(),u.emitter.onStop())}))),[2]}}))}))},t.prototype.play=function(){if(this._songlePlayer)return this._songlePlayer.play();this.emitter.onPlay()},t.prototype.stop=function(){if(this._songlePlayer)return this.stopping=this._songlePlayer.isPlaying,this._songlePlayer.stop();this.emitter.onStop()},t.prototype.pause=function(){if(this._songlePlayer)return this.stopping=!1,this._songlePlayer.pause();this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._songlePlayer?(this._songlePlayer.seekTo(t),this.emitter.onSeek(t)):this.updateMediaPosition(t).then((function(){e.emitter.onSeek(t)}))},t.prototype.startPolling=function(){var t,e=this;if(this.lastTime>0){var r=Date.now()-this.lastTime;t=Math.max(0,this.wait-r)}else t=this.wait;this.handler=setTimeout((function(){return ev(e,void 0,void 0,(function(){var e,r,n,i,o,a;return rv(this,(function(s){switch(s.label){case 0:return r=(e=this).lastTime,n=e.lastPosition,i=r>0?Date.now()-r:t,o=n>0?n+i:this._songlePlayer.positionTime,Math.abs(this._songlePlayer.positionTime-o)>2*this.wait?this.lastPosition=this._songlePlayer.positionTime:this.lastPosition<=this._songlePlayer.positionTime&&(this.lastPosition=.8*o+.2*this._songlePlayer.positionTime),this.lastTime=Date.now(),this.elapsedTimes.unshift(i),this.elapsedTimes=this.elapsedTimes.slice(0,10),this.elapsedTimes.length>=10&&((a=this.elapsedTimes.reduce((function(t,e){return t+e}))/10)>5*this.wait&&(this.player.stageScale=Math.max(.25,.9*this.player.stageScale),this.elapsedTimes=[]),a<1.2*this.wait&&this.player.stageScale<1&&(this.player.stageScale=Math.min(1,this.player.stageScale/.9),this.elapsedTimes=[])),[4,this.updateMediaPosition(o)];case 1:return s.sent(),this.handler&&this.startPolling(),[2]}}))}))}),t)},t.prototype.stopPolling=function(){this.handler&&(clearTimeout(this.handler),this.lastTime=0,this._songlePlayer&&(this.lastPosition=this._songlePlayer.positionTime)),this.handler=null},t.prototype.dispose=function(){this.player&&this.player.removeListener(this.volumeListener),this._songlePlayer&&(this._songlePlayer.stop(),this._songlePlayer=null)},t.prototype.onVolumeUpdate=function(t){this._songlePlayer&&(this._songlePlayer.volume=t)},t}(),lv=function(){function t(t){this.listeners=[],this.throttleInterval=t&&t.throttleInterval?Number(t.throttleInterval):100}return t.prototype.onVideoLoad=function(t,e){this.listeners.forEach((function(r){return r.onVideoLoad&&r.onVideoLoad(t,e)}))},t.prototype.onSongLoad=function(t,e){this.listeners.forEach((function(r){return r.onSongLoad&&r.onSongLoad(t,e)}))},t.prototype.onSongMapLoad=function(t,e){this.listeners.forEach((function(r){return r.onSongMapLoad&&r.onSongMapLoad(t,e)}))},t.prototype.onSongInfoLoad=function(t,e){var r=!1;this.listeners.forEach((function(n){n.onSongInfoLoad&&(n.onSongInfoLoad(t,e),r=!0)})),r&&console.warn('[TextAlive API] "onSongInfoLoad" event is deprecated; use "onSongMapLoad" event instead')},t.prototype.onVocalAmplitudeLoad=function(t,e){this.listeners.forEach((function(r){return r.onVocalAmplitudeLoad&&r.onVocalAmplitudeLoad(t,e)}))},t.prototype.onValenceArousalLoad=function(t,e){this.listeners.forEach((function(r){return r.onValenceArousalLoad&&r.onValenceArousalLoad(t,e)}))},t.prototype.onLyricsLoad=function(t,e){this.listeners.forEach((function(r){return r.onLyricsLoad&&r.onLyricsLoad(t,e)}))},t.prototype.onTextLoad=function(t,e){this.listeners.forEach((function(r){return r.onTextLoad&&r.onTextLoad(t,e)}))},t.prototype.onAppReady=function(t){this.listeners.forEach((function(e){return e.onAppReady&&e.onAppReady(t)}))},t.prototype.onAppParameterUpdate=function(t,e){this.listeners.forEach((function(r){return r.onAppParameterUpdate&&r.onAppParameterUpdate(t,e)}))},t.prototype.onAppMediaChange=function(t,e){this.listeners.forEach((function(r){return r.onAppMediaChange&&r.onAppMediaChange(t,e)}))},t.prototype.onTemplateUpdate=function(t){this.listeners.forEach((function(e){return e.onTemplateUpdate&&e.onTemplateUpdate(t)}))},t.prototype.onTemplateCommit=function(t){this.listeners.forEach((function(e){return e.onTemplateCommit&&e.onTemplateCommit(t)}))},t.prototype.onTemplatesLoad=function(t,e){this.listeners.forEach((function(r){return r.onTemplatesLoad&&r.onTemplatesLoad(t,e)}))},t.prototype.onFontsLoad=function(t,e){this.listeners.forEach((function(r){return r.onFontsLoad&&r.onFontsLoad(t,e)}))},t.prototype.onVideoReady=function(t){this.listeners.forEach((function(e){return e.onVideoReady&&e.onVideoReady(t)}))},t.prototype.onTimerReady=function(t){this.listeners.forEach((function(e){return e.onTimerReady&&e.onTimerReady(t)}))},t.prototype.onStageElementSet=function(t){this.listeners.forEach((function(e){return e.onStageElementSet&&e.onStageElementSet(t)}))},t.prototype.onMediaElementSet=function(t){this.listeners.forEach((function(e){return e.onMediaElementSet&&e.onMediaElementSet(t)}))},t.prototype.onTimeUpdate=function(t){var e=this;this.listeners.forEach((function(e){return e.onTimeUpdate&&e.onTimeUpdate(t)})),this.position=t,this.throttledTimeUpdate||(this.throttledTimeUpdate=new Promise((function(t,r){setTimeout((function(){e.onThrottledTimeUpdate(e.position),e.throttledTimeUpdate=null,t()}),e.throttleInterval)})))},t.prototype.onThrottledTimeUpdate=function(t){this.listeners.forEach((function(e){return e.onThrottledTimeUpdate&&e.onThrottledTimeUpdate(t)}))},t.prototype.onBackgroundGraphicsUpdate=function(t){this.listeners.forEach((function(e){return e.onBackgroundGraphicsUpdate&&e.onBackgroundGraphicsUpdate(t)}))},t.prototype.onMediaSeek=function(t){this.listeners.forEach((function(e){return e.onMediaSeek&&e.onMediaSeek(t)}))},t.prototype.onVideoSeekStart=function(){this.listeners.forEach((function(t){return t.onVideoSeekStart&&t.onVideoSeekStart()}))},t.prototype.onVideoSeekEnd=function(){this.listeners.forEach((function(t){return t.onVideoSeekEnd&&t.onVideoSeekEnd()}))},t.prototype.onVideoSeek=function(t){this.listeners.forEach((function(e){return e.onVideoSeek&&e.onVideoSeek(t)}))},t.prototype.onPlay=function(){this.listeners.forEach((function(t){return t.onPlay&&t.onPlay()}))},t.prototype.onPause=function(){this.listeners.forEach((function(t){return t.onPause&&t.onPause()}))},t.prototype.onSeek=function(t){this.listeners.forEach((function(e){return e.onSeek&&e.onSeek(t)}))},t.prototype.onStop=function(){this.listeners.forEach((function(t){return t.onStop&&t.onStop()}))},t.prototype.onDispose=function(){this.listeners.forEach((function(t){return t.onDispose&&t.onDispose()}))},t.prototype.onResize=function(t){this.listeners.forEach((function(e){return e.onResize&&e.onResize(t)}))},t.prototype.onVolumeUpdate=function(t){this.listeners.forEach((function(e){return e.onVolumeUpdate&&e.onVolumeUpdate(t)}))},t.prototype.addListener=function(t){!t||this.listeners.indexOf(t)>=0||this.listeners.push(t)},t.prototype.removeListener=function(t){var e=!1;return this.listeners=this.listeners.filter((function(r){var n=r===t;return e=e||n,!n})),e},t}(),cv=function(){function t(t,e,r){var n=this;this.player=t,this.manager=e,this.emitter=r,this._defaultBackgroundCss=null,this._background=null,t.addListener({onStageElementSet:function(t){return n.doUpdateBackground(n.background)}})}return Object.defineProperty(t.prototype,"background",{get:function(){return this._background},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultBackgroundCss",{get:function(){return this._defaultBackgroundCss?this._defaultBackgroundCss:""},set:function(t){this._defaultBackgroundCss=t,this.updateBackground(this._background)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._background},enumerable:!1,configurable:!0}),t.prototype.settingBackground=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){switch(e.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,e.sent()&&this.doUpdateBackground(t)]}}))}))},t.prototype.setBackground=function(t){return ev(this,void 0,void 0,(function(){var e;return rv(this,(function(r){switch(r.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,(e=r.sent())&&this.updateBackground(e)]}}))}))},t.prototype.doSetBackground=function(t){return ev(this,void 0,void 0,(function(){var e,r,n;return rv(this,(function(i){switch(i.label){case 0:return e=t&&t.originalUrl?t.originalUrl:"",this.manager.isBackgroundColorAsset(t)?[2,{css:e,originalUrl:e}]:this.manager.isBackgroundPiaproImageAsset(t)?[4,this.manager.read(e)]:[3,2];case 1:return(r=i.sent())&&r.url&&this.manager.checkBackgroundImageLicense(r.license)?(r.originalUrl=e,t&&(r.x=t.x,r.y=t.y),[2,r]):[2,{css:"",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,license:r?r.license:void 0}];case 2:return this.manager.isBackgroundSpecialImageAsset(t)?[2,{css:'url("https://api.textalive.jp/images/backgrounds/snowmiku2016/'+(n=/^snowmiku2016-([0-9]{2})$/.exec(e))[1]+'.jpg")',contentUrl:"https://api.textalive.jp/images/backgrounds/snowmiku2016/"+n[1]+".jpg",url:"https://snowmiku.com/2016/info_chara.html",name:"SNOW MIKU 2016",authorName:"豆の素",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,defaultY:0}]:[2,{originalUrl:null,css:"",x:t?t.x:void 0,y:t?t.y:void 0}]}}))}))},t.prototype.updateBackground=function(t){return!!this.doUpdateBackground(t)&&(this.emitter&&this.emitter.onBackgroundGraphicsUpdate&&this.emitter.onBackgroundGraphicsUpdate(t),!0)},t.prototype.doUpdateBackground=function(t){if(!this.player.stageElement||!t)return!1;var e=this.player.stageElement.style;return t.css.length<=0?e.background=this.defaultBackgroundCss:e.background=t.css,"number"==typeof t.x||this._background&&"number"==typeof this._background.x?("number"!=typeof t.x&&(t.x=this._background.x),e.backgroundPositionX=e.backgroundPositionX+"%"):e.backgroundPositionX="number"==typeof t.defaultX?t.defaultX+"%":"center","number"==typeof t.y||this._background&&"number"==typeof this._background.y?("number"!=typeof t.y&&(t.y=this._background.y),e.backgroundPositionY=e.backgroundPositionY+"%"):e.backgroundPositionY="number"==typeof t.defaultY?t.defaultY+"%":"center",e.backgroundSize="cover",this._background=t,!0},t.prototype.export=function(){if(!this.background)return null;var t={originalUrl:this.background.originalUrl};return void 0!==this.background.x&&(t.x=this.background.x),void 0!==this.background.y&&(t.y=this.background.y),t},t.prototype.exportPartialVideoEntry=function(t){return{background:this.export()}},t}();function hv(t,e,r,n){return ev(this,void 0,void 0,(function(){var i,o,a,s,u,l,c,h,p,d,f,m,g,v;return rv(this,(function(y){switch(y.label){case 0:if(i={loaded:[],failed:[]},"undefined"==typeof window||!window.document||!window.document.head)return i.failed=e.slice(),[2,i];for(o=n.split("").filter((function(t,e,r){return r.indexOf(t)===e})).sort(),a=!0,s=0,o.forEach((function(t){var e=r.indexOf(t,s);a=a&&e>=0,s=e})),u=window.document.head,l=[],c=0;c<u.children.length;c++)"link"===(h=u.children.item(c)).tagName.toLowerCase()&&"stylesheet"===h.getAttribute("rel")&&l.push(h.getAttribute("href"));p=[],d=[],f=[],e.forEach((function(e){if(e.google)f.push(e.key);else{var r=e.url||t+"/"+(a?e.key:e.key+"-all")+".css";l.includes(r)||(d.push(e.en),p.push(r))}})),m={classes:!1,active:null,inactive:null,fontactive:function(t){i.loaded.push(e.find((function(e){return e.en===t}))),i.failed=i.failed.filter((function(e){return e.en!==t}))},fontinactive:function(t){i.failed.push(e.find((function(e){return e.en===t})))},timeout:5e3},f.length>0&&(m.google={families:f}),d.length>0&&(m.custom={families:d,urls:p}),y.label=1;case 1:return y.trys.push([1,5,,6]),(v="undefined"!=typeof window&&(null===window||void 0===window?void 0:window.WebFont))?[3,3]:[4,import("./webfontloader.9d95d262.js").then((function(t){return t.w}))];case 2:v=y.sent(),y.label=3;case 3:return g=v,[4,new Promise((function(t){m.active=m.inactive=t,g.load(m)}))];case 4:case 5:return y.sent(),[3,6];case 6:return[2,i]}}))}))}function pv(t,e){return ev(this,void 0,void 0,(function(){var r,n,i,o,a,s,u,l;return rv(this,(function(c){switch(c.label){case 0:if(r={loaded:[],failed:[]},!("undefined"!=typeof window&&window.document&&window.document.head&&window.Ts&&window.Ts.loadFontAsync))return r.failed=t.slice(),[2,r];for(n=window.document.head,i={},o=function(t){var e=n.children.item(t);if("style"!==e.tagName.toLowerCase()||"text/css"!==e.getAttribute("type")||"stylesheet"!==e.getAttribute("rel")||!e.hasAttribute("data-cssName"))return"continue";var r=e.getAttribute("data-cssName");if(void 0===i[r])return i[r]=new Set(e.getAttribute("data-text")),{value:void 0};e.getAttribute("data-text").split("").forEach((function(t){return i[r].add(t)}))},a=0;a<n.children.length;a++)if("object"==typeof(s=o(a)))return[2,s.value];return u=window.Ts,l=[],t.forEach((function(t){var n=new Set(e+t.en+t.ja);i[t.en]&&i[t.en].forEach((function(t){return n.delete(t)})),n.size<=0?r.loaded.push(t):l.push(new Promise((function(e){return i=u,o=t,a=r,s=Array.from(n.values()).join(""),l=e,c=o.en,void i.loadFontAsync({cssName:c,text:s,outputType:"json",callback:function(t){try{e=c,r=s,n=t.data,i=JSON.parse(n),u=JSON.parse(i.res),(h=document.createElement("style")).setAttribute("data-cssName",e),h.setAttribute("data-text",r),h.setAttribute("type","text/css"),h.setAttribute("rel","stylesheet"),h.innerHTML="@font-face {font-family: '"+u.fontFamily+"';font-weight: "+u["font-weight"]+";src: url(data:font/woff;base64,"+u.src+");}",document.head.appendChild(h),a.loaded.push(o)}catch(e){a.failed.push(o)}var e,r,n,i,u,h;l()}});var i,o,a,s,l,c})))})),[4,Promise.all(l)];case 1:return c.sent(),[2,r]}}))}))}var dv=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.fonts=r,Object.setPrototypeOf(i,n.prototype),i}return Kg(e,t),e}(Error),fv=function(){function t(t,e,r){this.fontInfoManager=t,this.textFetcher=e,this.listener=r,this._failed=[],this._loaded=[]}return Object.defineProperty(t.prototype,"failed",{get:function(){return this._failed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),t.prototype.loadAll=function(){return ev(this,void 0,void 0,(function(){var t;return rv(this,(function(e){switch(e.label){case 0:return[4,this.listAvailableFonts()];case 1:return t=e.sent(),[2,this.loadFonts(t)]}}))}))},t.prototype.loadForVideo=function(t){return ev(this,void 0,void 0,(function(){var e,r;return rv(this,(function(n){switch(n.label){case 0:return(e=this.listFontFamiliesInVideo(t))?[4,this.listAvailableFonts()]:(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(this.loaded),[2,Promise.resolve(this.loaded)]);case 1:return r=n.sent(),[2,this.loadFonts(r.filter((function(t){return e.indexOf(t.en)>=0})))]}}))}))},t.prototype.listFontFamiliesInVideo=function(t){if(!t||!t.phrases)return null;var e=[];return t.phrases.forEach((function(t){return t.words.forEach((function(t){return t.characters.forEach((function(t){return e.push(t.fontFamily)}))}))})),e.filter((function(t,e,r){return r.indexOf(t)===e}))},t.prototype.listAvailableFonts=function(){return ev(this,void 0,void 0,(function(){return rv(this,(function(t){return[2,this.fontInfoManager.listAvailableFonts()]}))}))},t.prototype.isLoading=function(){return!!this.queue},t.prototype.load=function(t){return ev(this,void 0,void 0,(function(){var e,r;return rv(this,(function(n){switch(n.label){case 0:return e=[],r=[],t.forEach((function(t){"string"==typeof t?e.push(t):r.push(t)})),[4,this.fontInfoManager.listAvailableFonts()];case 1:return n.sent().forEach((function(t){e.indexOf(t.key)>=0&&r.push(t)})),[2,this.loadFonts(r)]}}))}))},t.prototype.loadFonts=function(t){return ev(this,void 0,void 0,(function(){var e=this;return rv(this,(function(r){return this.queue?(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(null,new dv("Failed to load some fonts because there is an ongoing font loding process",this.failed.slice())),[2,this.loaded]):(this.queue=this.doLoad(t).then((function(t){return e.queue=null,t})),[2,this.queue])}))}))},t.prototype.doLoad=function(t){return ev(this,void 0,void 0,(function(){var e,r,n,i,o=this;return rv(this,(function(a){switch(a.label){case 0:return e=[],r=[],[4,this.fontInfoManager.getFrequentChars()];case 1:return n=a.sent(),t.forEach((function(t){t.typesquare||t.typekit||e.push(t),t.typesquare&&r.push(t)})),i=(this.textFetcher&&this.textFetcher()||"").split("").filter((function(t,e,r){return r.indexOf(t)===e})).sort().join(""),[2,Promise.all([hv(this.fontInfoManager.endpoint,e,n,i),pv(r,i)]).then((function(t){var e=t[0],r=t[1],n=e.loaded.concat(r.loaded);if(o.addLoadedFonts(n),e.failed.length>0||r.failed.length>0){var i=e.failed.concat(r.failed);o.addFailedFonts(i),o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new dv("Failed to load some fonts",o.failed.slice()))}else o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(n);return o.loaded})).catch((function(t){return o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new dv(t,o.failed.slice())),o.loaded}))]}}))}))},t.prototype.addLoadedFonts=function(t){var e=this;this._loaded=this.loaded.concat(t.filter((function(t){return e.failed.findIndex((function(e){return e.key===t.key}))<0})))},t.prototype.addFailedFonts=function(t){var e=this;this._failed=this.failed.concat(t.filter((function(t){return e.failed.findIndex((function(e){return e.key===t.key}))<0})))},t}(),mv=function(){function t(){}return Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?this.startTime===this.endTime?0:(t-this.startTime)/(this.endTime-this.startTime):-1},t}(),gv=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return Kg(e,t),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.next?this.next.startTime:this.startTime},enumerable:!1,configurable:!0}),e}(mv),vv=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return Kg(e,t),e}(mv),yv=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return Kg(e,t),e}(mv),xv=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return Kg(e,t),e}(mv),bv=function(){function t(t){var e=t.analysis,r=t.info;this.beats=[],this.chords=[],this.segments=[],this.voice=[],this._revisions={beatId:r.beatRevisionId,chordId:r.chordRevisionId,repetitiveSegmentId:r.chorusRevisionId},this.parseBeats(e.beats),this.parseSegments(e.repetitive_segment),this.parseChords(e.chords),e.voice&&this.parseVoice(e.voice)}return Object.defineProperty(t.prototype,"revisions",{get:function(){return this._revisions},enumerable:!1,configurable:!0}),t.prototype.parseBeats=function(t){var e=this;if(Array.isArray(t)&&Array.isArray(t[0])){var r=null,n=0;t[0].forEach((function(t){var i=new gv;i.startTime=1e3*t[0],i.length=t[2],i.position=t[3],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.beats.push(i),r=i})),null!==r&&(r.next=null)}},t.prototype.parseChords=function(t){var e=this;if(Array.isArray(t)){var r=null,n=0;t.forEach((function(t){var i=new vv;i.startTime=1e3*t[0],i.endTime=1e3*t[1],i.name=t[2],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.chords.push(i),r=i})),null!==r&&(r.next=null)}},t.prototype.parseSegments=function(t){var e=this;Array.isArray(t)&&t.forEach((function(t){var r={chorus:!!t.chorus,duration:10*t.segment_length,segments:null},n=null,i=0;r.segments=t.start_frames.map((function(t){var e=new yv;return e.startTime=10*t,e.endTime=e.startTime+r.duration,e.previous=n,null!==n&&(n.next=e),e.index=i++,n=e,e})),null!==n&&(n.next=null),e.segments.push(r)}))},t.prototype.parseVoice=function(t){var e=this;Array.isArray(t)&&t.forEach((function(t){var r=[],n=null,i=0,o=0;t.forEach((function(t){var e=new xv;e.startTime=o,e.endTime=e.startTime+10*t[1],e.f0=t[0][0],e.initialF0=t[0][1],e.previous=n,null!==n&&(n.next=e),e.index=i++,r.push(e),n=e,o=e.endTime})),null!==n&&(n.next=null),e.voice.push(r)}))},t}(),_v=function(){function t(t){var e=t.song,r=t.analysis,n=t.vocalAmplitude,i=t.maxVocalAmplitude,o=t.valenceArousal;this._song=e,this._analysis=r,this._vocalAmplitude=n,this._maxVocalAmplitude=i,this._valenceArousal=o}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.getChoruses=function(){var t;if(!this._analysis)return[];var e=this._analysis.segments.filter((function(t){return t.chorus}));return e.length<=0?[]:(null===(t=e[0].segments)||void 0===t?void 0:t.slice())||[]},t.prototype.findChorus=function(t,e){var r=[];if(this._analysis){var n=this._analysis.segments.filter((function(t){return t.chorus}));if(n.length<=0)return null;r=n[0].segments}return Gg(r,t,e)},t.prototype.findChorusBetween=function(t,e){return this.findChorus(t,{endTime:e})},t.prototype.getBeats=function(){var t;return this._analysis&&(null===(t=this._analysis.beats)||void 0===t?void 0:t.slice())||[]},t.prototype.findBeat=function(t,e){return this._analysis?Gg(this._analysis.beats,t,e):null},t.prototype.getChords=function(){var t;return this._analysis&&(null===(t=this._analysis.chords)||void 0===t?void 0:t.slice())||[]},t.prototype.findChord=function(t,e){return this._analysis?Gg(this._analysis.chords,t,e):null},t.prototype.getVocalFrequency=function(t){var e;if(!Array.isArray(null===(e=this._analysis)||void 0===e?void 0:e.voice))return-1;var r=this._analysis.voice[0];if(r.length<=0)return-1;var n=zg(r,t,(function(t){return t.endTime}));return r[n].contains(t)?r[n].f0:-1},t.prototype.getVocalAmplitude=function(t){var e=this._vocalAmplitude,r=Math.round(t/10);return!Array.isArray(this._vocalAmplitude)||r<0||r>=e.length?-1:this._vocalAmplitude[r]},t.prototype.getMaxVocalAmplitude=function(){return"number"==typeof this._maxVocalAmplitude?this._maxVocalAmplitude:-1},t.prototype.getValenceArousal=function(t){var e=this._valenceArousal;if(!e)return null;var r=zg(e.seq,t,(function(t){return 1e3*t.t[1]}));if(r<0)return{a:e.seq[0].a,v:e.seq[0].v};if(r>=e.seq.length||t<1e3*e.seq[r+1].t[0])return{a:e.seq[Math.min(r,e.seq.length-1)].a,v:e.seq[Math.min(r,e.seq.length-1)].v};var n=e.seq[r],i=e.seq[r+1],o=t/1e3,a=i.t[0],s=n.t[1],u=s-a;return{a:(n.a*(s-o)+i.a*(o-a))/u,v:(n.v*(s-o)+i.v*(o-a))/u}},t.prototype.getMedianValenceArousal=function(){var t=this._valenceArousal;return t?t.stats.median:null},t}(),wv=function(){function t(t,e,r){this.songManager=t,this.options=r,this.listener=e}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.loadSong=function(t,e){var r,n,i;return ev(this,void 0,void 0,(function(){var o,a;return rv(this,(function(s){switch(s.label){case 0:return"number"==typeof t&&t<0||!t?(this.onSongLoad(null,new Error("Neither Songle ID or code provided")),[2,null]):[4,this.songManager.load("number"==typeof t?{id:t}:{code:t})];case 1:return o=s.sent(),this.onSongLoad(o,o?void 0:new Error("Song data not found")),o?(a={chord:null==e?void 0:e.chordId,beat:null==e?void 0:e.beatId,chorus:null==e?void 0:e.repetitiveSegmentId},[4,Promise.all([(null===(r=this.options)||void 0===r?void 0:r.vocalFrequencyEnabled)?this.loadSongDetailInfo(o.song.code,{revisions:a}):this.loadSongInfo(o.song.code,{revisions:a}),(null===(n=this.options)||void 0===n?void 0:n.vocalAmplitudeEnabled)?this.loadVocalAmplitude(o.song.code):Promise.resolve(null),(null===(i=this.options)||void 0===i?void 0:i.valenceArousalEnabled)?this.loadValenceArousal(o.song.code):Promise.resolve(null)])]):[2,null];case 2:return s.sent(),[2,new _v(this)]}}))}))},t.prototype.onSongLoad=function(t,e){this._song=t,this.listener&&this.listener.onSongLoad&&this.listener.onSongLoad(t,e)},t.prototype.loadSongInfo=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,this.songManager.loadInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:new Error("Song analysis data not found")),[2,r]}}))}))},t.prototype.loadSongDetailInfo=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,this.songManager.loadDetailInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:new Error("Song analysis data not found")),[2,r]}}))}))},t.prototype.mockSongInfo=function(t){var e=function(t){for(var e=t.beat,r=t.chorusSegment,n=t.duration,i=[],o=0;60*o/e.bpm<n/1e3;)i.push([60*o/e.bpm,1,e.length,o%e.length+1,1]),o++;return{beats:[i],chords:null,repetitive_segment:[{chorus:!0,index:0,segment_length:r.duration/10,start_frames:r.startTimes.map((function(t){return t/10}))}],voice:null}}(t);return this._song=null,this.onSongMapLoad({analysis:e,info:null}),new _v(this)},t.prototype.onSongMapLoad=function(t,e){var r,n;this._analysis=new bv(t),(null===(r=this.listener)||void 0===r?void 0:r.onSongMapLoad)&&this.listener.onSongMapLoad(this._analysis,e),(null===(n=this.listener)||void 0===n?void 0:n.onSongInfoLoad)&&this.listener.onSongInfoLoad(t,e)},t.prototype.loadVocalAmplitude=function(t){var e;return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadVocalAmplitude(String(t))];case 1:return r._vocalAmplitude=n.sent(),this._maxVocalAmplitude=Math.max.apply(Math,this._vocalAmplitude),(null===(e=this.listener)||void 0===e?void 0:e.onVocalAmplitudeLoad)&&this.listener.onVocalAmplitudeLoad(this._vocalAmplitude,this._vocalAmplitude?void 0:new Error("Vocal amplitude data not found")),[2,this._vocalAmplitude]}}))}))},t.prototype.loadValenceArousal=function(t){var e;return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadValenceArousal(String(t))];case 1:return r._valenceArousal=n.sent(),(null===(e=this.listener)||void 0===e?void 0:e.onValenceArousalLoad)&&this.listener.onValenceArousalLoad(this._valenceArousal,this._valenceArousal?void 0:new Error("Valence arousal data not found")),[2,this._valenceArousal]}}))}))},t}(),Tv=function(){function t(t,e,r){this.managers=t,this.listener=e,this.options=r}return t.prototype.loadRawText=function(t){var e;return e=!t.phrases||t.phrases.length<0?"":t.phrases.map((function(t){return t.words.map((function(t){return t.characters.map((function(t){return t.char})).join("")})).join("")})).join(""),this.onTextLoad({text:e}),{lyricsId:-1,lyrics:null,lyricsBody:{text:e,artist:null,name:null,url:null}}},t.prototype.loadLyrics=function(t){var e=t.songCode,r=t.lyricId,n=void 0===r?-1:r,i=t.lyricDiffId,o=void 0===i?-1:i,a=t.altLyricsUrl,s=t.directAccess;return ev(this,void 0,void 0,(function(){var t,r,i,u;return rv(this,(function(l){switch(l.label){case 0:return n<=0?(0===n?this.onLyricsLoad(null,new Error("Lyrics not loaded")):this.onLyricsLoad(null,new Error("Lyrics not found")),[2,null]):[4,this.managers.lyrics.loadDiff(e,n,o)];case 1:return(null==(t=l.sent())?void 0:t.data)?(r=tv(tv({},t),{processing:!1,failed:!1,id:n,diff:{id:o}}),this.onLyricsLoad(r),a||s?[3,3]:[4,this.managers.lyrics.fetchLocalLyricBody(n)]):(this.onLyricsLoad(null,new Error("Lyrics timing information not found")),[2,null]);case 2:i=l.sent(),l.label=3;case 3:if(i)return[3,7];l.label=4;case 4:return l.trys.push([4,6,,7]),[4,this.loadLyricsText(t,{altLyricsUrl:a,directAccess:s})];case 5:return i=l.sent(),[3,7];case 6:return u=l.sent(),this.onTextLoad(null,u),[3,7];case 7:return i&&this.onTextLoad(i),[2,{lyricsId:r.id,lyrics:r,lyricsBody:i}]}}))}))},t.prototype.loadLyricsText=function(t,e){var r=void 0===e?{}:e,n=r.altLyricsUrl,i=r.directAccess;return ev(this,void 0,void 0,(function(){var e,r,o=this;return rv(this,(function(a){switch(a.label){case 0:return e=this.options&&"number"==typeof this.options.lyricsFetchTimeout&&this.options.lyricsFetchTimeout>=0,r=this.managers.lyrics.fetchLyricBody(n||t.url,{parserPath:t.parser_path,directAccess:i}),[4,e?Promise.race([r,new Promise((function(t,e){return setTimeout((function(){return e(new Error("Fetching lyrics text timeout"))}),o.options.lyricsFetchTimeout)}))]):r];case 1:return[2,a.sent()]}}))}))},t.prototype.onLyricsLoad=function(t,e){this.listener&&this.listener.onLyricsLoad&&this.listener.onLyricsLoad(t,e)},t.prototype.onTextLoad=function(t,e){this.listener&&this.listener.onTextLoad&&this.listener.onTextLoad(t,e)},t}(),Ev=function(){function t(t){var e=t.video;this._video=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._video.json},enumerable:!1,configurable:!0}),t}(),Sv=function(){function t(t,e){this.managers=t,this.listener=e,this.listener=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),t.prototype.onVideoLoad=function(t,e){var r=t?Object.assign(t,e):null;return r&&("string"==typeof r.json?r.json=JSON.parse(r.json):"object"==typeof r.json&&null!==r.json||(r.json={}),"string"==typeof r.config?r.config=JSON.parse(r.config):"object"==typeof r.config&&null!==r.config||(r.config={})),this._video=r,this.listener&&this.listener.onVideoLoad&&this.listener.onVideoLoad(r),new Ev({video:r})},t.prototype.createFromVideoId=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,this.managers.video.load(t)];case 1:return r=n.sent(),[2,this.onVideoLoad(r,e)]}}))}))},t.prototype.createFromVideo=function(t,e){return this.onVideoLoad(t,e)},t.prototype.createFromSongUrl=function(t,e){return ev(this,void 0,void 0,(function(){return rv(this,(function(r){return[2,this.createFromSongPath(this.managers.song.getSongPathFromUrl(t),e)]}))}))},t.prototype.createFromSongPath=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({songPath:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSongId=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({id:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSongCode=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({code:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSong=function(t,e){var r;return ev(this,void 0,void 0,(function(){var n,i,o,a,s,u;return rv(this,(function(l){switch(l.label){case 0:return n=null==e?void 0:e.lyricId,i=null==e?void 0:e.lyricDiffId,"number"!=typeof n||n<0?[4,this.managers.lyrics.load(t.code)]:[3,4];case 1:return o=l.sent(),(s=o&&!o.status.failed&&!o.status.processing&&Array.isArray(o.lyrics)&&o.lyrics.length>0)?[4,this.managers.lyrics.loadDetail(t.code,o.lyrics[0].id)]:[3,3];case 2:s=l.sent(),l.label=3;case 3:(a=s)&&(n=a.id,i=null===(r=a.diff)||void 0===r?void 0:r.id),l.label=4;case 4:return"number"!=typeof n&&(n=-1),"number"!=typeof i&&(i=-1),u={id:-1,sourceId:-1,sourceOriginId:-1,songleId:t.id,songleCode:t.code,lyricId:n,lyricDiffId:i,title:null,log:null,background:null,config:null,json:null,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},[2,this.onVideoLoad(u,e)]}}))}))},t.prototype.createFromText=function(t,e){return ev(this,void 0,void 0,(function(){var r,n,i,o,a,s;return rv(this,(function(u){switch(u.label){case 0:return[4,this.managers.text.parse(t)];case 1:return r=u.sent(),n=r&&"success"===r.status?this.createVideoDataFromParsedText(r,t):this.createVideoDataFromText(t),i=n[n.length-1],o=i&&i.words[i.words.length-1],a=o&&o.characters[o.characters.length-1],s=a?a.endTime:0,[2,this.createFromJSON({phrases:n,startTime:0,endTime:s,duration:s},e)]}}))}))},t.prototype.createFromJSON=function(t,e){var r={id:-1,sourceId:-1,sourceOriginId:-1,songleId:-1,lyricId:-1,lyricDiffId:-1,title:null,log:null,background:null,config:null,json:t,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null};return this.onVideoLoad(r,e)},t.prototype.createVideoDataFromParsedText=function(t,e){var r=0,n=e.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);return t.result.map((function(t,e){return{words:t.map((function(t){return{characters:n[e].substr(t.startPosition,t.wordLength).split("").map((function(t){return{char:t,startTime:300*r,endTime:300*++r}})),pos:t.PoS,rawPoS:t.rawPoS,language:t.language}})),templates:[{type:"DefaultAlignment"}]}}))},t.prototype.createVideoDataFromText=function(t){for(var e,r={characters:[]},n={words:[r],templates:[{type:"DefaultAlignment"}]},i=0,o=[n],a=0;a<t.length;a++){var s=t.charAt(a);"\n"!==s?" "!==s?(e={char:s,startTime:300*i,endTime:300*++i},r.characters.push(e)):(r={characters:[]},n.words.push(r)):(n={words:[r={characters:[]}],templates:[{type:"DefaultAlignment"}]},o.push(n))}return r.characters.length<=0&&n.words.pop(),n.words.length<=0&&o.pop(),o},t}(),Av=function(){function t(t,e,r){var n=this;void 0===e&&(e=null),this.managers=t,this.listener=e,this.options=r,this.fontLoader=new fv(t.font,(function(){return n.text}),e)}return Object.defineProperty(t.prototype,"permalink",{get:function(){var t;return"https://textalive.jp"+((null===(t=this.song)||void 0===t?void 0:t.permalink)?"/songs/"+encodeURIComponent(Km.getSongPathFromUrl(this.song.permalink)):"")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){var t;return null===(t=this.videoProvider)||void 0===t?void 0:t.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"song",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songStatus",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songMap",{get:function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsId",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyrics)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyrics",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyrics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsBody",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody)||void 0===e?void 0:e.text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fonts",{get:function(){return this.fontLoader},enumerable:!1,configurable:!0}),t.prototype.createFromVideoId=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,new Sv(this.managers,this.listener).createFromVideoId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromVideo=function(t,e){return this.videoProvider=new Sv(this.managers,this.listener).createFromVideo(t,e),this.videoProvider},t.prototype.createFromSongUrl=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,new Sv(this.managers,this.listener).createFromSongUrl(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongPath=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,new Sv(this.managers,this.listener).createFromSongPath(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongId=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,new Sv(this.managers,this.listener).createFromSongId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongCode=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,new Sv(this.managers,this.listener).createFromSongCode(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromText=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return r=this,[4,new Sv(this.managers,this.listener).createFromText(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromJSON=function(t,e){return this.videoProvider=new Sv(this.managers,this.listener).createFromJSON(t,e),this.videoProvider},t.prototype.finalize=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){switch(e.label){case 0:return this.video?[4,this.loadSong()]:[2,null];case 1:return e.sent(),[4,this.loadText(t)];case 2:return e.sent(),[4,this.loadFonts()];case 3:return e.sent(),[2]}}))}))},t.prototype.mockSongInfo=function(t){this.songProvider=new wv(this.managers.song,this.listener,this.options).mockSongInfo(t)},t.prototype.loadSong=function(){return ev(this,void 0,void 0,(function(){var t;return rv(this,(function(e){switch(e.label){case 0:return t=this,[4,new wv(this.managers.song,this.listener,this.options).loadSong(this.video.songleCode||this.video.songleId,this.video)];case 1:return t.songProvider=e.sent(),[2]}}))}))},t.prototype.loadText=function(t){var e,r;return ev(this,void 0,void 0,(function(){var n,i,o,a,s,u,l,c;return rv(this,(function(h){switch(h.label){case 0:return n=this.video,i=n.lyricId,o=n.lyricDiffId,a=this.song?this.song.code:null,s=new Tv(this.managers,this.listener,this.options),!a&&i<0?(u=s.loadRawText(null===(e=this.videoProvider)||void 0===e?void 0:e.data),[3,3]):[3,1];case 1:return l=(null==t?void 0:t.altLyricsUrl)||void 0,c=(null==t?void 0:t.lyricsDirectAccess)||void 0,[4,s.loadLyrics({songCode:a,lyricId:i,lyricDiffId:o,altLyricsUrl:l,directAccess:c})];case 2:u=h.sent(),h.label=3;case 3:return this.textProvider=u,(null==u?void 0:u.lyrics)&&(null===(r=null==u?void 0:u.lyricsBody)||void 0===r?void 0:r.text)&&this.importLyrics(),[2]}}))}))},t.prototype.loadFonts=function(){var t,e,r;return ev(this,void 0,void 0,(function(){return rv(this,(function(n){return"number"==typeof this.video.id&&this.video.id>=0?(this.fontLoader.loadForVideo(null===(t=this.videoProvider)||void 0===t?void 0:t.data),[2]):Array.isArray(null===(e=this.options)||void 0===e?void 0:e.fontFamilies)?(this.fontLoader.load(this.options.fontFamilies),[2]):null===(null===(r=this.options)||void 0===r?void 0:r.fontFamilies)?(this.fontLoader.loadAll(),[2]):[2]}))}))},t.prototype.importLyrics=function(){var t=this.text.replace(/[\s\r\n]/g,""),e=0,r={phrases:this.lyrics.data.map((function(r){return{words:r.map((function(r){return{characters:r.map((function(r){return{char:t.charAt(e++),startTime:1e3*r.start_time,endTime:1e3*r.end_time}}))}}))}}))};this.video.json&&Array.isArray(this.video.json.phrases)?this.video.json.phrases.forEach((function(t,e){t.words.forEach((function(t,n){t.characters.forEach((function(t,i){var o=r.phrases[e].words[n].characters[i];t.char=o.char,t.startTime=o.startTime,t.endTime=o.endTime}))}))})):this.video.json=r},t.prototype.getChoruses=function(){return this.songProvider.getChoruses()},t.prototype.findChorus=function(t,e){return this.songProvider.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){return this.songProvider.findChorusBetween(t,e)},t.prototype.getBeats=function(){return this.songProvider.getBeats()},t.prototype.findBeat=function(t,e){return this.songProvider.findBeat(t,e)},t.prototype.getChords=function(){return this.songProvider.getChords()},t.prototype.findChord=function(t,e){return this.songProvider.findChord(t,e)},t.prototype.getVocalFrequency=function(t){return this.songProvider.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){return this.songProvider.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){return this.songProvider.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){return this.songProvider.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){return this.songProvider.getMedianValenceArousal()},t}(),Pv=function(){function t(t,e){var r;this.player=t,this.listener=e,"undefined"!=typeof window&&(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.app)&&this.initialize()}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?"boolean"==typeof this._options?{}:tv({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"managed",{get:function(){return!!this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songUrl",{get:function(){return this._songUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songOptions",{get:function(){return this._songOptions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConnecting",{get:function(){return!!this.connecting},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t,e;return ev(this,void 0,void 0,(function(){return rv(this,(function(r){switch(r.label){case 0:return this._options=null===(e=null===(t=this.player)||void 0===t?void 0:t.options)||void 0===e?void 0:e.app,this._options&&"object"==typeof this._options&&(this._options=tv({},this._options)),this._parameters={},this.parseQueryString(),[4,this.connect()];case 1:return r.sent(),this.initializePlayerListener(),this.initializeMessageListener(),this._songUrl&&this.createFromSongUrl(),[2]}}))}))},t.prototype.initializePlayerListener=function(){var t=this;this.playerListener={onVideoReady:function(e){t._host&&window.parent.postMessage({kind:"ta_video",options:{lyrics:!!t.player.data.lyrics,duration:t.player.video.duration}},"*")},onThrottledTimeUpdate:function(e){t._host&&window.parent.postMessage({kind:"ta_position",options:{position:e}},"*")},onPlay:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"play"}},"*")},onPause:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"pause"}},"*")},onStop:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"stop"}},"*")},onDispose:function(){t.dispose()}},this.player.addListener(this.playerListener)},t.prototype.initializeMessageListener=function(){var t=this;this.messageListener=function(e){if(e.data.kind&&/^ta_/.test(e.data.kind)){var r=t.player;switch(e.data.kind.substring("ta_".length)){case"status":switch(e.data.options.status){case"play":r.requestPlay();break;case"pause":r.requestPause();break;case"stop":r.requestStop()}break;case"seek":r.requestMediaSeek(e.data.options.position);break;case"parameter":var n=e.data.options,i=n.name,o=n.value;t.parameters[i]=o,t.listener.onAppParameterUpdate(i,o);break;case"media":t._songUrl=e.data.options.url,t._songOptions=e.data.options.options||{},r.requestStop();var a=t.createFromSongUrl();t.listener.onAppMediaChange(t._songUrl,a)}}},window.addEventListener("message",this.messageListener)},t.prototype.createFromSongUrl=function(){var t,e=this._songOptions;return e&&(t={video:{}},e.altLyricsUrl&&(t.altLyricsUrl=e.altLyricsUrl),e.lyricsDirectAccess&&(t.lyricsDirectAccess=e.lyricsDirectAccess),e.lyricId&&(t.video.lyricId=e.lyricId),e.lyricDiffId&&(t.video.lyricDiffId=e.lyricDiffId),e.chordId&&(t.video.chordId=e.chordId),e.beatId&&(t.video.beatId=e.beatId),e.repetitiveSegmentId&&(t.video.repetitiveSegmentId=e.repetitiveSegmentId)),this.player.createFromSongUrl(this._songUrl,t)},t.prototype.parseQueryString=function(){this._songUrl=Zg("ta_song_url"),this._songOptions={};var t=Zg("ta_lyric_id");t&&(this._songOptions.lyricId=parseInt(t),isNaN(this._songOptions.lyricId)&&delete this._songOptions.lyricId);var e=Zg("ta_lyric_diff_id");e&&(this._songOptions.lyricDiffId=parseInt(e),isNaN(this._songOptions.lyricDiffId)&&delete this._songOptions.lyricDiffId);var r=Zg("ta_alt_lyrics_url");r&&(this._songOptions.altLyricsUrl=r);var n=Zg("ta_lyrics_direct_access");n&&(this._songOptions.lyricsDirectAccess="true"===n,this._songOptions.lyricsDirectAccess||delete this._songOptions.lyricsDirectAccess);var i=Zg("ta_chord_id");i&&(this._songOptions.chordId=parseInt(i),isNaN(this._songOptions.chordId)&&delete this._songOptions.chordId);var o=Zg("ta_beat_id");o&&(this._songOptions.beatId=parseInt(o),isNaN(this._songOptions.beatId)&&delete this._songOptions.beatId);var a=Zg("ta_repetitive_segment_id");a&&(this._songOptions.repetitiveSegmentId=parseInt(a),isNaN(this._songOptions.repetitiveSegmentId)&&delete this._songOptions.repetitiveSegmentId)},t.prototype.connect=function(){return ev(this,void 0,void 0,(function(){var t,e=this;return rv(this,(function(r){switch(r.label){case 0:return this.connecting?[2,this.connecting]:"undefined"!=typeof window&&this.options&&window.parent&&window!==window.parent?[3,2]:[4,new Promise((function(t){return setTimeout(t,1)}))];case 1:return r.sent(),this.listener.onAppReady(this),[2,!1];case 2:return this.connecting=Promise.race([new Promise((function(r){t=function(n){n.data.kind&&/^ta_/.test(n.data.kind)&&"ack"===n.data.kind.substring("ta_".length)&&(window.removeEventListener("message",t),e._host=n.data.options,r(!0))},window.addEventListener("message",t)})),ev(e,void 0,void 0,(function(){var e;return rv(this,(function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<5?(window.parent.postMessage({kind:"ta_connect",options:this.options},"*"),[4,new Promise((function(t){return setTimeout(t,200)}))]):[3,4];case 2:if(r.sent(),this._host)return[3,4];r.label=3;case 3:return e++,[3,1];case 4:return!this._host&&t&&window.removeEventListener("message",t),[2,!!this._host]}}))}))]),this.connecting.finally((function(){e.connecting=null,e.listener.onAppReady(e)})),[2,this.connecting]}}))}))},t.prototype.dispose=function(){"undefined"!=typeof window&&this.options&&(this.player.removeListener(this.playerListener),window.removeEventListener("message",this.messageListener)),this._host=null,this.player=null},t}();function Mv(t){return function(e){return Math.pow(e,t)}}function Iv(t){return function(e){return 1-Math.pow(1-e,t)}}function Ov(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}var Cv=Mv(2),Rv=Iv(2),Lv=Ov(2),Nv=Mv(3),Fv=Iv(3),Dv=Ov(3),Uv=Mv(4),kv=Iv(4),jv=Ov(4),Bv=Mv(5),zv=Iv(5),Gv=Ov(5);function Vv(t){return function(e){return e*e*((t+1)*e-t)}}var Hv=Vv(1.7);function Xv(t){return function(e){return--e*e*((t+1)*e+t)+1}}var Wv=Xv(1.7);function Yv(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}var qv=Yv(1.7);function $v(t){return 1-Qv(1-t)}function Qv(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Zv(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)}}var Jv=Zv(1,.3);function Kv(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-i)*r/e)+1}}var ty=Kv(1,.3);function ey(t,e){var r=2*Math.PI;return function(n){var i=e/r*Math.asin(1/t);return(n*=2)<1?t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)*-.5:t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*r/e)*.5+1}}var ry=ey(1,.3*1.5),ny=Object.freeze({__proto__:null,linear:function(t){return t},get:function(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0==t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},getPowIn:Mv,getPowOut:Iv,getPowInOut:Ov,quadIn:Cv,quadOut:Rv,quadInOut:Lv,cubicIn:Nv,cubicOut:Fv,cubicInOut:Dv,quartIn:Uv,quartOut:kv,quartInOut:jv,quintIn:Bv,quintOut:zv,quintInOut:Gv,sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},getBackIn:Vv,backIn:Hv,getBackOut:Xv,backOut:Wv,getBackInOut:Yv,backInOut:qv,circIn:function(t){return-(Math.sqrt(1-t*t)-1)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},bounceIn:$v,bounceOut:Qv,bounceInOut:function(t){return t<.5?.5*$v(2*t):.5*Qv(2*t-1)+.5},getElasticIn:Zv,elasticIn:Jv,getElasticOut:Kv,elasticOut:ty,getElasticInOut:ey,elasticInOut:ry}),iy=function(){function t(){this.cursor=-1,this.widgets=[],this.instances=[],this.model={id:-1,type:Ym.NONE,sourceId:-1,author:null,originalAuthor:null,className:null,createdDate:null}}return Object.defineProperty(t.prototype,"id",{get:function(){return this.model?this.model.id:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"script",{get:function(){return this.model?this.model.script:null},enumerable:!1,configurable:!0}),t}(),oy=function(){},ay=function(){function t(t,e){this.onTemplateLoad=e,this._emitter=null,this._loaded=null,this._loading=null,this.verbose=!1,this._emitter=t,this.clear()}return Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._loaded={},this._loading={}},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),ev(this,void 0,void 0,(function(){var e;return rv(this,(function(r){switch(r.label){case 0:return[4,Ag.list({maxResults:t,withoutAuthors:!0,withoutOriginalAuthors:!0,script:!0})];case 1:return(e=r.sent())&&e.list?(this.verbose&&console.log("--- loading template classes ---"),[2,this.registerMany(e.list)]):[2]}}))}))},t.prototype.loadForVideo=function(t){return ev(this,void 0,void 0,(function(){var e,r=this;return rv(this,(function(n){switch(n.label){case 0:return[4,Ag.loadForVideo(t)];case 1:return(e=n.sent())&&e.list?(this.verbose&&console.log("--- loading template classes for vid:"+t+" ---"),[4,this.registerMany(e.list)]):[2,null];case 2:return[2,n.sent().map((function(t){return t?r.getByName(t):null}))]}}))}))},t.prototype.loadByNames=function(t){return ev(this,void 0,void 0,(function(){var e,r=this;return rv(this,(function(n){switch(n.label){case 0:return!Array.isArray(t)||t.length<=0?[2,[]]:(this.verbose&&console.log("--- loading template classes ---"),[4,Promise.all(t.map((function(t){return r.doLoadByName(t)})))]);case 1:return(e=n.sent())&&this._emitter.onTemplatesLoad(e.filter((function(t){return!!t})).map((function(t){return t.className}))),[2,e]}}))}))},t.prototype.loadByName=function(t){return ev(this,void 0,void 0,(function(){var e,r;return rv(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.doLoadByName(t)];case 1:return e=n.sent(),this._emitter.onTemplatesLoad([e.className]),[2,e];case 2:return r=n.sent(),this._emitter.onTemplatesLoad(null,r),[2,null];case 3:return[2]}}))}))},t.prototype.doLoadByName=function(t){return ev(this,void 0,void 0,(function(){var e,r,n=this;return rv(this,(function(i){return null!==(e=this.getByName(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise((function(e){return Ag.loadByName(t).then((function(t){return n.onTemplateLoad(t)})).then(e)})),this._loading[t]=r,r.finally((function(){return delete n._loading[t]})),[2,r])}))}))},t.prototype.loadById=function(t){return ev(this,void 0,void 0,(function(){var e,r,n;return rv(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.doLoadById(t)];case 1:return e=i.sent(),r=null,[3,3];case 2:return n=i.sent(),r=n,[3,3];case 3:return this._emitter.onTemplatesLoad(e?[e.className]:null,r),[2,e]}}))}))},t.prototype.doLoadById=function(t){return ev(this,void 0,void 0,(function(){var e,r,n=this;return rv(this,(function(i){return(e=this.getById(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise((function(e){return Ag.load(t).then((function(t){return n.onTemplateLoad(t)})).then(e)})),this._loading[t]=r,r.finally((function(){return delete n._loading[t]})),[2,r])}))}))},t.prototype.registerMany=function(t){return ev(this,void 0,void 0,(function(){var e,r,n=this;return rv(this,(function(i){switch(i.label){case 0:return e=t.map((function(t){var e=n.onTemplateLoad(t);return n._loading[t.className]=e,n._loading[t.className+"@"+t.id]=e,e})),[4,Promise.all(e.map((function(t){return t.then((function(t){return t.className})).catch((function(t){return null}))})))];case 1:return r=i.sent().filter((function(t){return!!t})),this._emitter.onTemplatesLoad(r),[2,r]}}))}))},t.prototype.commit=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,Ag.create({sourceId:t.model.sourceId,script:t.model.script,log:e})];case 1:return(r=n.sent()).success&&(t.model.id=r.id,this._emitter.onTemplateCommit(t.className)),[2,r]}}))}))},t.prototype.getByName=function(t,e){var r;if(void 0===e&&(e=!1),t&&(r=t.match(/(.+)@([0-9]+)/))){t=r[1];var n=parseInt(r[2]);if(!this._loaded[t])return null;var i=this._loaded[t].model;if(i.id!==n){if(!e)return null;this.verbose&&console.log("[warning] template "+t+" version "+n+" is requested but "+i.id+" is used")}}return this._loaded[t]?this._loaded[t]:null},t.prototype.getById=function(t){var e=null;for(var r in this._loaded)if(this._loaded[r].model.id===t){e=this._loaded[r];break}return e},t}(),sy=function(){function t(e,r){"string"==typeof e&&(e=t.acorn.parse(e,t.PARSE_OPTIONS)),this.ast=e,this.initFunc_=r,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);for(var n,i=/^step([A-Z]\w*)$/,o=Object.getOwnPropertyNames(t.prototype),a=0;a<o.length;a++){var s=o[a];"function"==typeof t.prototype[s]&&(n=s.match(i))&&(this.stepFunctions_[n[1]]=t.prototype[s].bind(this))}var u;this.global=this.createScope(this.ast,null),this.ast=t.acorn.parse(this.polyfills_.join("\n"),t.PARSE_OPTIONS),this.polyfills_=void 0,this.stripLocations_(this.ast,void 0,void 0),(u=new ly(this.ast,this.global)).done=!1,this.stateStack=[u],this.run(),this.value=void 0,this.ast=e,(u=new ly(this.ast,this.global)).done=!1,this.stateStack.length=0,this.stateStack[0]=u,this.nodeConstructor=u.node.constructor,this.stateStack=this.stateStack,this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.UNDEFINED=void 0,this.NULL=null,this.NAN=NaN,this.TRUE=!0,this.FALSE=!1,this.STRING_EMPTY="",this.NUMBER_ZERO=0,this.NUMBER_ONE=1}return t.prototype.wrap=function(t){return t},t.prototype.unwrap=function(t,e){return t},t.prototype.appendCode=function(e){var r=this.stateStack[0];if(!r||"Program"!==r.node.type)throw Error("Expecting original AST to start with a Program node.");if("string"==typeof e&&(e=t.acorn.parse(e,t.PARSE_OPTIONS)),!e||"Program"!==e.type)throw Error("Expecting new AST to start with a Program node.");this.populateScope_(e,r.scope);for(var n,i=0;n=e.body[i];i++)r.node.body.push(n);r.done=!1},t.prototype.step=function(){var e=this.stateStack,r=e[e.length-1];if(!r)return!1;var n=r.node,i=n.type;if("Program"===i&&r.done)return!1;if(this.paused_)return!0;try{var o=this.stepFunctions_[i](e,r,n)}catch(e){if(e!==t.STEP_ERROR)throw e}return o&&e.push(o),!!n.end||this.step()},t.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},t.prototype.initGlobalScope=function(e){this.setProperty(e,"NaN",NaN,t.READONLY_DESCRIPTOR),this.setProperty(e,"Infinity",1/0,t.READONLY_DESCRIPTOR),this.setProperty(e,"undefined",void 0,t.READONLY_DESCRIPTOR),this.setProperty(e,"window",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"this",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"self",e),this.OBJECT_PROTO=new uy(null),this.FUNCTION_PROTO=new uy(this.OBJECT_PROTO),this.initFunction(e),this.initObject(e),e.proto=this.OBJECT_PROTO,this.setProperty(e,"constructor",this.OBJECT),this.initArray(e),this.initString(e),this.initBoolean(e),this.initNumber(e),this.initDate(e),this.initRegExp(e),this.initError(e),this.initMath(e),this.initJSON(e);var r=this,n=this.createNativeFunction((function(t){throw EvalError("Can't happen")}),!1);n.eval=!0,this.setProperty(e,"eval",n),this.setProperty(e,"parseInt",this.createNativeFunction(parseInt,!1)),this.setProperty(e,"parseFloat",this.createNativeFunction(parseFloat,!1)),this.setProperty(e,"isNaN",this.createNativeFunction(isNaN,!1)),this.setProperty(e,"isFinite",this.createNativeFunction(isFinite,!1));for(var i=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],o=0;o<i.length;o++){var a=function(t){return function(e){try{return t(e)}catch(t){r.throwException(r.URI_ERROR,t.message)}}}(i[o][0]);this.setProperty(e,i[o][1],this.createNativeFunction(a,!1),t.NONENUMERABLE_DESCRIPTOR)}this.initFunc_&&this.initFunc_(this,e)},t.prototype.initFunction=function(e){var r,n=this,i=/^[A-Za-z_$][\w$]*$/;(r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.FUNCTION_PROTO);if(arguments.length)var o=String(arguments[arguments.length-1]);else o="";for(var a=[],s=0;s<arguments.length-1;s++){var u=String(arguments[s]);u.match(i)||n.throwException(n.SYNTAX_ERROR,"Invalid function argument: "+u),a.push(u)}a=a.join(", "),r.parentScope=n.global;try{var l=t.acorn.parse("$ = function("+a+") {"+o+"};",t.PARSE_OPTIONS)}catch(t){n.throwException(n.SYNTAX_ERROR,"Invalid code: "+t.message)}return 1!==l.body.length&&n.throwException(n.SYNTAX_ERROR,"Invalid code in function body."),r.node=l.body[0].expression.right,n.setProperty(r,"length",r.node.length,t.READONLY_DESCRIPTOR),r}).id=this.functionCounter_++,this.FUNCTION=this.createObjectProto(this.FUNCTION_PROTO),this.setProperty(e,"Function",this.FUNCTION),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO),this.FUNCTION.nativeFunc=r,this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,t.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.setProperty(this.FUNCTION_PROTO,"length",0,t.READONLY_DESCRIPTOR);var o=function(t){if(!(t&&t.isObject||n.getScope().strict))if(null==t)t=n.global;else{var e=n.createObjectProto(n.getPrototype(t));e.data=t,t=e}return t};r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[],null!=e&&(e.isObject?r.arguments_=n.pseudoToNative(e):n.throwException(n.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",r),r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[];for(var i=1;i<arguments.length;i++)r.arguments_.push(arguments[i]);r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",r),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),r=function(){return this.toString()},this.setNativeFunctionPrototype(this.FUNCTION,"toString",r),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",r),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initObject=function(e){var r,n=this;r=function(t){if(null==t)return n.calledWithNew()?this:n.createObjectProto(n.OBJECT_PROTO);if(!t.isObject){var e=n.createObjectProto(n.getPrototype(t));return e.data=t,e}return t},this.OBJECT=this.createNativeFunction(r,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT),this.setProperty(e,"Object",this.OBJECT);var i=function(t){null==t&&n.throwException(n.TYPE_ERROR,"Cannot convert '"+t+"' to object")};r=function(t){i(t);var e=t.isObject?t.properties:t;return n.nativeToPseudo(Object.getOwnPropertyNames(e))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),t.isObject?n.nativeToPseudo(Object.keys(t.properties)):n.nativeToPseudo(Object.keys(t))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return null===t?n.createObjectProto(null):(void 0!==t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object prototype may only be an Object or null"),n.createObjectProto(t))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),r=function(t,e,r){return e=String(e),t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.defineProperty called on non-object"),r&&r.isObject||n.throwException(n.TYPE_ERROR,"Property description must be an object"),!t.properties[e]&&t.preventExtensions&&n.throwException(n.TYPE_ERROR,"Can't define property '"+e+"', object is not extensible"),n.setProperty(t,e,ReferenceError,r.properties),t},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),r=function(t,e){if(t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),(e=String(e))in t.properties){var r=Object.getOwnPropertyDescriptor(t.properties,e),i=t.getter[e],o=t.setter[e];(i||o)&&(r.get=i,r.set=o,delete r.value,delete r.writable);var a=n.nativeToPseudo(r);return"value"in r&&n.setProperty(a,"value",r.value),a}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),n.getPrototype(t)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return Boolean(t)&&!t.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return t&&t.isObject&&(t.preventExtensions=!0),t},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",uy.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",uy.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",uy.prototype.valueOf),r=function(t){return i(this),this.isObject?String(t)in this.properties:this.hasOwnProperty(t)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",r),r=function(t){return i(this),Object.prototype.propertyIsEnumerable.call(this.properties,t)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",r),r=function(t){for(;;){if(!(t=n.getPrototype(t)))return!1;if(t===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",r)},t.prototype.initArray=function(e){var r,n=this;r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.ARRAY_PROTO);var i=arguments[0];if(1===arguments.length&&"number"==typeof i)isNaN(t.legalArrayLength(i))&&n.throwException(n.RANGE_ERROR,"Invalid array length"),r.properties.length=i;else{for(var o=0;o<arguments.length;o++)r.properties[o]=arguments[o];r.properties.length=o}return r},this.ARRAY=this.createNativeFunction(r,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(e,"Array",this.ARRAY),r=function(t){return t&&"Array"===t.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return Array.prototype.pop.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"pop",r),r=function(t){return Array.prototype.push.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"push",r),r=function(){return Array.prototype.shift.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"shift",r),r=function(t){return Array.prototype.unshift.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"unshift",r),r=function(){return Array.prototype.reverse.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"reverse",r),r=function(t,e){var r=Array.prototype.splice.apply(this.properties,arguments);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"splice",r),r=function(t,e){var r=Array.prototype.slice.call(this.properties,t,e);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"slice",r),r=function(t){return Array.prototype.join.call(this.properties,t)},this.setNativeFunctionPrototype(this.ARRAY,"join",r),r=function(t){for(var e=[],r=0,i=n.getProperty(this,"length"),o=0;o<i;o++){if(n.hasProperty(this,o)){var a=n.getProperty(this,o);e[r]=a}r++}for(o=0;o<arguments.length;o++){var s=arguments[o];if(n.isa(s,n.ARRAY))for(var u=n.getProperty(s,"length"),l=0;l<u;l++)n.hasProperty(s,l)&&(e[r]=n.getProperty(s,l)),r++;else e[r]=s}return n.unwrap&&(e=e.map(n.unwrap)),n.nativeToPseudo(e)},this.setNativeFunctionPrototype(this.ARRAY,"concat",r),r=function(t,e){return Array.prototype.indexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"indexOf",r),r=function(t,e){return Array.prototype.lastIndexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"lastIndexOf",r),r=function(){return Array.prototype.sort.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"sort",r),this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O && !callbackfn.call(T, O[k], k, O)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t) {","var val = t[i];","if (fun.call(thisArg, val, i, t)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O) callback.call(T, O[k], k, O);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') new TypeError;","var T, A, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","A = new Array(len);","k = 0;","while (k < len) {","if (k in O) A[k] = callback.call(T, O[k], k, O);","k++;","}","return A;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var t = Object(this), len = t.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in t)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k++];","}","for (; k < len; k++) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var t = Object(this), len = t.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in t)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k--];","}","for (; k >= 0; k--) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t && fun.call(thisArg, t[i], i, t)) {","return true;","}","}","return false;","}","});","(function() {","var sort_ = Array.prototype.sort;","Array.prototype.sort = function(opt_comp) {","if (typeof opt_comp !== 'function') {","return sort_.call(this);","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp(this[j], this[j + 1]) > 0) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","};","})();","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function() {","var out = [];","for (var i = 0; i < this.length; i++) {","out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();","}","return out.join(',');","}","});","")},t.prototype.initString=function(e){var r,n=this;r=function(t){return t=String(t),n.calledWithNew()?(this.data=t,this):t},this.STRING=this.createNativeFunction(r,!0),this.setProperty(e,"String",this.STRING),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["trim","toLowerCase","toUpperCase","toLocaleLowerCase","toLocaleUpperCase","charAt","charCodeAt","substring","slice","substr","indexOf","lastIndexOf","concat"],o=0;o<i.length;o++)this.setNativeFunctionPrototype(this.STRING,i[o],String.prototype[i[o]]);r=function(t,e,r){return e=e?n.pseudoToNative(e):void 0,r=r?n.pseudoToNative(r):void 0,String(this).localeCompare(t,e,r)},this.setNativeFunctionPrototype(this.STRING,"localeCompare",r),r=function(t,e){n.isa(t,n.REGEXP)&&(t=t.data);var r=String(this).split(t,e);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.STRING,"split",r),r=function(t){t=t?t.data:void 0;var e=String(this).match(t);return e?n.nativeToPseudo(e):null},this.setNativeFunctionPrototype(this.STRING,"match",r),r=function(t){return n.isa(t,n.REGEXP)&&(t=t.data),String(this).search(t)},this.setNativeFunctionPrototype(this.STRING,"search",r),r=function(t,e){return String(this).replace(t.data||t,e)},this.setNativeFunctionPrototype(this.STRING,"replace",r),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},t.prototype.initBoolean=function(t){var e,r=this;e=function(t){return t=Boolean(t),r.calledWithNew()?(this.data=t,this):t},this.BOOLEAN=this.createNativeFunction(e,!0),this.setProperty(t,"Boolean",this.BOOLEAN)},t.prototype.initNumber=function(e){var r,n=this;r=function(t){return t=Number(t),n.calledWithNew()?(this.data=t,this):t},this.NUMBER=this.createNativeFunction(r,!0),this.setProperty(e,"Number",this.NUMBER);for(var i=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<i.length;o++)this.setProperty(this.NUMBER,i[o],Number[i[o]],t.READONLY_NONENUMERABLE_DESCRIPTOR);r=function(t){try{return Number(this).toExponential(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",r),r=function(t){try{return Number(this).toFixed(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",r),r=function(t){try{return Number(this).toPrecision(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",r),r=function(t){try{return Number(this).toString(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",r),r=function(t,e){return t=t?n.pseudoToNative(t):void 0,e=e?n.pseudoToNative(e):void 0,Number(this).toLocaleString(t,e)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",r)},t.prototype.initDate=function(e){var r,n=this;r=function(t,e){if(!n.calledWithNew())return Date();var r=[null].concat([].slice.call(arguments));return this.data=new(Function.prototype.bind.apply(Date,r)),this},this.DATE=this.createNativeFunction(r,!0),this.setProperty(e,"Date",this.DATE),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<i.length;o++)r=function(t){return function(e){for(var r=[],i=0;i<arguments.length;i++)r[i]=n.pseudoToNative(arguments[i]);return this.data[t].apply(this.data,r)}}(i[o]),this.setNativeFunctionPrototype(this.DATE,i[o],r)},t.prototype.initRegExp=function(e){var r,n=this;r=function(t,e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.REGEXP_PROTO);return t=t?t.toString():"",e=e?e.toString():"",n.populateRegExp(r,new RegExp(t,e)),r},this.REGEXP=this.createNativeFunction(r,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(e,"RegExp",this.REGEXP),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",t.READONLY_NONENUMERABLE_DESCRIPTOR),r=function(t){return this.data.test(t)},this.setNativeFunctionPrototype(this.REGEXP,"test",r),r=function(t){t=t.toString(),this.data.lastIndex=Number(n.getProperty(this,"lastIndex"));var e=this.data.exec(t);if(n.setProperty(this,"lastIndex",this.data.lastIndex),e){for(var r=n.createObjectProto(n.ARRAY_PROTO),i=0;i<e.length;i++)n.setProperty(r,i,e[i]);return n.setProperty(r,"index",e.index),n.setProperty(r,"input",e.input),r}return null},this.setNativeFunctionPrototype(this.REGEXP,"exec",r)},t.prototype.initError=function(e){var r=this;this.ERROR=this.createNativeFunction((function(e){if(r.calledWithNew())var n=this;else n=r.createObject(r.ERROR);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n}),!0),this.setProperty(e,"Error",this.ERROR),this.setProperty(this.ERROR.properties.prototype,"message","",t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",t.NONENUMERABLE_DESCRIPTOR);var n=function(n){var i=r.createNativeFunction((function(e){if(r.calledWithNew())var n=this;else n=r.createObject(i);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n}),!0);return r.setProperty(i,"prototype",r.createObject(r.ERROR)),r.setProperty(i.properties.prototype,"name",n,t.NONENUMERABLE_DESCRIPTOR),r.setProperty(e,n,i),i};this.EVAL_ERROR=n("EvalError"),this.RANGE_ERROR=n("RangeError"),this.REFERENCE_ERROR=n("ReferenceError"),this.SYNTAX_ERROR=n("SyntaxError"),this.TYPE_ERROR=n("TypeError"),this.URI_ERROR=n("URIError")},t.prototype.initMath=function(e){var r=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"Math",r);for(var n=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],i=0;i<n.length;i++)this.setProperty(r,n[i],Math[n[i]],t.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(i=0;i<o.length;i++)this.setProperty(r,o[i],this.createNativeFunction(Math[o[i]],!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initJSON=function(t){var e=this,r=e.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"JSON",r);var n=function(t){try{var r=JSON.parse(t.toString())}catch(t){e.throwException(e.SYNTAX_ERROR,t.message)}return e.nativeToPseudo(r)};this.setProperty(r,"parse",this.createNativeFunction(n,!1)),n=function(t){var r=e.pseudoToNative(t);try{var n=JSON.stringify(r)}catch(t){e.throwException(e.TYPE_ERROR,t.message)}return n},this.setProperty(r,"stringify",this.createNativeFunction(n,!1))},t.prototype.isa=function(t,e){if(null==t||!e)return!1;var r=e.properties.prototype;if(t===r)return!0;for(var n=this.getPrototype(t);n;){if(n===r)return!0;n=n.proto}return!1},t.legalArrayLength=function(t){var e=t>>>0;return e===Number(t)?e:NaN},t.legalArrayIndex=function(t){var e=t>>>0;return String(e)===String(t)&&4294967295!==e?e:NaN},t.prototype.createObject=function(t){return this.createObjectProto(t&&t.properties.prototype)},t.prototype.createObjectProto=function(t){var e=new uy(t);return this.isa(e,this.FUNCTION)&&(this.setProperty(e,"prototype",this.createObjectProto(this.OBJECT_PROTO||null)),e.class="Function"),this.isa(e,this.ARRAY)&&(this.setProperty(e,"length",0,{configurable:!1,enumerable:!1,writable:!0}),e.class="Array"),this.isa(e,this.ERROR)&&(e.class="Error"),e},t.prototype.populateRegExp=function(e,r){e.data=r,this.setProperty(e,"lastIndex",r.lastIndex,t.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"source",r.source,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"global",r.global,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"ignoreCase",r.ignoreCase,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"multiline",r.multiline,t.READONLY_NONENUMERABLE_DESCRIPTOR)},t.prototype.createFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.parentScope=r,n.node=e,this.setProperty(n,"length",n.node.params.length,t.READONLY_DESCRIPTOR),n},t.prototype.createNativeFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.nativeFunc=e,e.id=this.functionCounter_++,this.setProperty(n,"length",e.length,t.READONLY_DESCRIPTOR),r?this.setProperty(n.properties.prototype,"constructor",n,t.NONENUMERABLE_DESCRIPTOR):!1===r&&(n.illegalConstructor=!0,this.setProperty(n,"prototype",void 0)),n},t.prototype.createAsyncFunction=function(e){var r=this.createObjectProto(this.FUNCTION_PROTO);return r.asyncFunc=e,e.id=this.functionCounter_++,this.setProperty(r,"length",e.length,t.READONLY_DESCRIPTOR),r},t.prototype.nativeToPseudo=function(t){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(t instanceof RegExp){var e=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(e,t),e}if(t instanceof Function){var r=this;return this.createNativeFunction((function(){return r.nativeToPseudo(t.apply(r,Array.prototype.slice.call(arguments).map((function(t){return r.pseudoToNative(t)}))))}),void 0)}var n;if(Array.isArray(t)){n=this.createObjectProto(this.ARRAY_PROTO);for(var i=0;i<t.length;i++)i in t&&this.setProperty(n,i,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]))}else for(var o in n=this.createObjectProto(this.OBJECT_PROTO),t)this.setProperty(n,o,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]));return n},t.prototype.pseudoToNative=function(t,e){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(this.isa(t,this.REGEXP))return t.data;var r,n=e||{pseudo:[],native:[]};if(-1!==(o=n.pseudo.indexOf(t)))return n.native[o];if(n.pseudo.push(t),this.isa(t,this.ARRAY)){r=[],n.native.push(r);for(var i=this.getProperty(t,"length"),o=0;o<i;o++)this.hasProperty(t,o)&&(r[o]=this.unwrap?this.unwrap(this.getProperty(t,o),n):this.pseudoToNative(this.getProperty(t,o),n))}else{if(t._native)return t._native;var a;for(var s in r={},n.native.push(r),t.properties)a=t.properties[s],r[s]=this.unwrap?this.unwrap(a,n):this.pseudoToNative(a,n)}return n.pseudo.pop(),n.native.pop(),r},t.prototype.getPrototype=function(t){switch(typeof t){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return t?t.proto:null},t.prototype.getProperty=function(e,r){if(r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+r+"' of "+e),"length"===r){if(this.isa(e,this.STRING))return String(e).length}else if(r.charCodeAt(0)<64&&this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return String(e)[n]}do{var i=e;if(i.properties&&r in i.properties){var o=i.getter[r];return o?(o.isGetter=!0,o):i.properties[r]}if(void 0!==i._native&&"_"!==r.charAt(0)&&"function"!=typeof i._native[r])return this.wrap?this.wrap(i._native[r]):i._native[r]}while(e=this.getPrototype(e))},t.prototype.hasProperty=function(e,r){if(!e.isObject)throw TypeError("Primitive data type has no properties");if("length"===(r=String(r))&&this.isa(e,this.STRING))return!0;if(this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return!0}do{var i=e;if(i.properties&&r in i.properties)return!0;if(void 0!==i._native&&"_"!=r.charAt(0)){var o=typeof i._native[r];return"function"!==o&&("undefined"!==o||cy(i._native.constructor,r))}}while(e=this.getPrototype(e));return!1},t.prototype.setProperty=function(e,r,n,i){r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of "+e),i&&("get"in i||"set"in i)&&("value"in i||"writable"in i)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(e.isObject){if(this.isa(e,this.STRING)){var a=t.legalArrayIndex(r);if("length"===r||!isNaN(a)&&a<String(e).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of String '"+e.data+"'"))}if("Array"===e.class){var s,u=e.properties.length;if("length"===r){if(n=t.legalArrayLength(n),isNaN(n)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),n<u)for(s in e.properties)s=t.legalArrayIndex(s),!isNaN(s)&&n<=s&&delete e.properties[s]}else isNaN(s=t.legalArrayIndex(r))||(e.properties.length=Math.max(u,s+1))}if(!e.preventExtensions||r in e.properties)if(i){"get"in i&&(i.get?e.getter[r]=i.get:delete e.getter[r]),"set"in i&&(i.set?e.setter[r]=i.set:delete e.setter[r]);var l={};"configurable"in i&&(l.configurable=i.configurable),"enumerable"in i&&(l.enumerable=i.enumerable),"writable"in i&&(l.writable=i.writable,delete e.getter[r],delete e.setter[r]),"value"in i?(l.value=i.value,delete e.getter[r],delete e.setter[r]):n!==ReferenceError&&(l.value=n,delete e.getter[r],delete e.setter[r]);try{Object.defineProperty(e.properties,r,l)}catch(t){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+r)}}else{if(n===ReferenceError)throw ReferenceError("Value not specified.");if(void 0!==e._native&&"_"!=r.charAt(0)){var c=typeof e._native[r];if("function"!==c&&("undefined"!==c||cy(e._native.constructor,r))){var h=this.unwrap?this.unwrap(n):n;return void(e._native[r]=h)}}for(var p=e;!(r in p.properties);)if(!(p=this.getPrototype(p))){p=e;break}if(p.setter&&p.setter[r])return p.setter[r];if(p.getter&&p.getter[r])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of object '"+e+"' which only has a getter");else try{e.properties[r]=n}catch(t){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of object '"+e+"'")}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+r+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+r+"' on '"+e+"'")},t.prototype.setNativeFunctionPrototype=function(e,r,n){this.setProperty(e.properties.prototype,r,this.createNativeFunction(n,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.getScope=function(){var t=this.stateStack[this.stateStack.length-1].scope;if(!t)throw Error("No scope found.");return t},t.prototype.createScope=function(t,e){var r=this.createObjectProto(null);if(r.parentScope=e,e||this.initGlobalScope(r),this.populateScope_(t,r),r.strict=!1,e&&e.strict)r.strict=!0;else{var n=t.body&&t.body[0];n&&n.expression&&"Literal"===n.expression.type&&"use strict"===n.expression.value&&(r.strict=!0)}return r},t.prototype.createSpecialScope=function(t,e){if(!t)throw Error("parentScope required");var r=e||this.createObjectProto(null);return r.parentScope=t,r.strict=t.strict,r},t.prototype.getValueFromScope=function(t){for(var e=this.getScope();e&&e!==this.global;){if(t in e.properties)return e.properties[t];e=e.parentScope}if(e===this.global&&this.hasProperty(e,t))return this.getProperty(e,t);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r.type&&"typeof"===r.operator||this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.setValueToScope=function(t,e){for(var r=this.getScope(),n=r.strict;r&&r!==this.global;){if(t in r.properties)return void(r.properties[t]=e);r=r.parentScope}if(r===this.global&&(!n||this.hasProperty(r,t)))return this.setProperty(r,t,e);this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.populateScope_=function(e,r){if("VariableDeclaration"===e.type)for(var n=0;n<e.declarations.length;n++)this.setProperty(r,e.declarations[n].id.name,void 0,t.VARIABLE_DESCRIPTOR);else{if("FunctionDeclaration"===e.type)return void this.setProperty(r,e.id.name,this.createFunction(e,r),t.VARIABLE_DESCRIPTOR);if("FunctionExpression"===e.type)return;if("ExpressionStatement"===e.type)return}var i=e.constructor;for(var o in e){var a=e[o];if(a&&"object"==typeof a)if(Array.isArray(a))for(n=0;n<a.length;n++)a[n]&&a[n].constructor===i&&this.populateScope_(a[n],r);else a.constructor===i&&this.populateScope_(a,r)}},t.prototype.stripLocations_=function(t,e,r){for(var n in e?t.start=e:delete t.start,r?t.end=r:delete t.end,t)if(t.hasOwnProperty(n)){var i=t[n];i&&"object"==typeof i&&this.stripLocations_(i,e,r)}},t.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},t.prototype.getValue=function(e){return e[0]===t.SCOPE_REFERENCE?this.getValueFromScope(e[1]):this.getProperty(e[0],e[1])},t.prototype.setValue=function(e,r){return e[0]===t.SCOPE_REFERENCE?this.setValueToScope(e[1],r):this.setProperty(e[0],e[1],r)},t.prototype.throwException=function(e,r){if(void 0===r)var n=e;else n=this.createObject(e),this.setProperty(n,"message",r,t.NONENUMERABLE_DESCRIPTOR);throw this.executeException(n),t.STEP_ERROR},t.prototype.executeException=function(t){var e,r=this.stateStack.slice();do{this.stateStack.pop();var n=this.stateStack[this.stateStack.length-1];if("TryStatement"===n.node.type)return void(n.throwValue=t)}while(n&&"Program"!==n.node.type);if(this.isa(t,this.ERROR)){var i={EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError},o=this.getProperty(t,"name").toString(),a=this.getProperty(t,"message").valueOf();e=(i[o]||Error)(a)}else e=t.toString();throw this.stateStack=r,e},t.prototype.createGetter_=function(t,e){var r=Array.isArray(e)?e[0]:e,n=new this.nodeConstructor;n.type="CallExpression";var i=new ly(n,this.stateStack[this.stateStack.length-1].scope);return i.doneCallee_=!0,i.funcThis_=r,i.func_=t,i.doneArgs_=!0,i.arguments_=[],i},t.prototype.createSetter_=function(t,e,r){var n=Array.isArray(e)?e[0]:this.global,i=new this.nodeConstructor;i.type="CallExpression";var o=new ly(i,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=!0,o.funcThis_=n,o.func_=t,o.doneArgs_=!0,o.arguments_=[r],o},t.prototype.stepArrayExpression=function(t,e,r){var n=r.elements,i=e.n_||0;for(e.array_?(this.setProperty(e.array_,i,e.value),i++):(e.array_=this.createObjectProto(this.ARRAY_PROTO),e.array_.properties.length=n.length);i<n.length;){if(n[i])return e.n_=i,new ly(n[i],e.scope);i++}t.pop(),t[t.length-1].value=e.array_},t.prototype.stepAssignmentExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new ly(r.left,e.scope);return n.components=!0,n}if(!e.doneRight_){if(e.leftReference_||(e.leftReference_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_&&"="!==r.operator){var i=this.getValue(e.leftReference_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftReference_)}}return e.doneRight_=!0,new ly(r.right,e.scope)}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var a=e.leftValue_,s=e.value;switch(r.operator){case"=":a=s;break;case"+=":a+=s;break;case"-=":a-=s;break;case"*=":a*=s;break;case"/=":a/=s;break;case"%=":a%=s;break;case"<<=":a<<=s;break;case">>=":a>>=s;break;case">>>=":a>>>=s;break;case"&=":a&=s;break;case"^=":a^=s;break;case"|=":a|=s;break;default:throw SyntaxError("Unknown assignment expression: "+r.operator)}var u=this.setValue(e.leftReference_,a);if(u)return e.doneSetter_=a,this.createSetter_(u,e.leftReference_,a);t.pop(),t[t.length-1].value=a},t.prototype.stepBinaryExpression=function(t,e,r){if(!e.doneLeft_)return e.doneLeft_=!0,new ly(r.left,e.scope);if(!e.doneRight_)return e.doneRight_=!0,e.leftValue_=e.value,new ly(r.right,e.scope);t.pop();var n,i=e.leftValue_,o=e.value;switch(r.operator){case"==":n=i==o;break;case"!=":n=i!=o;break;case"===":n=i===o;break;case"!==":n=i!==o;break;case">":n=i>o;break;case">=":n=i>=o;break;case"<":n=i<o;break;case"<=":n=i<=o;break;case"+":n=i+o;break;case"-":n=i-o;break;case"*":n=i*o;break;case"/":n=i/o;break;case"%":n=i%o;break;case"&":n=i&o;break;case"|":n=i|o;break;case"^":n=i^o;break;case"<<":n=i<<o;break;case">>":n=i>>o;break;case">>>":n=i>>>o;break;case"in":o&&o.isObject||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+o+"'"),n=this.hasProperty(o,i);break;case"instanceof":this.isa(o,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),n=!!i.isObject&&this.isa(i,o);break;default:throw SyntaxError("Unknown binary operator: "+r.operator)}t[t.length-1].value=n},t.prototype.stepBlockStatement=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new ly(i,e.scope);t.pop()},t.prototype.stepBreakStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name);e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(n){if(e.labels&&-1!==e.labels.indexOf(n))return}else if(e.isLoop||e.isSwitch)return;e=t.pop()}throw SyntaxError("Illegal break statement")},t.prototype.stepCallExpression=function(e,r,n){if(!r.doneCallee_){r.doneCallee_=1;var i=new ly(n.callee,r.scope);return i.components=!0,i}if(1===r.doneCallee_){r.doneCallee_=2;var o=r.value;if(Array.isArray(o)){if(r.func_=this.getValue(o),o[0]!==t.SCOPE_REFERENCE&&(r.funcThis_=o[0]),(o=r.func_)&&"object"==typeof o&&o.isGetter)return o.isGetter=!1,r.doneCallee_=1,this.createGetter_(o,r.value)}else r.func_=o;r.arguments_=[],r.n_=0}if(o=r.func_,!r.doneArgs_){if(0!==r.n_&&r.arguments_.push(r.value),n.arguments[r.n_])return new ly(n.arguments[r.n_++],r.scope);"NewExpression"===n.type?(o.illegalConstructor&&this.throwException(this.TYPE_ERROR,o+" is not a constructor"),r.funcThis_=this.createObject(o),r.isConstructor=!0):void 0===r.funcThis_&&(r.funcThis_=r.scope.strict?void 0:this.global),r.doneArgs_=!0}if(r.doneExec_)e.pop(),r.isConstructor&&"object"!=typeof r.value?e[e.length-1].value=r.funcThis_:e[e.length-1].value=r.value;else{r.doneExec_=!0,o&&o.isObject||(console.log("non-function called",o,r),this.throwException(this.TYPE_ERROR,o+" is not a function"));var a=o.node;if(a){for(var s=this.createScope(a.body,o.parentScope),u=0;u<a.params.length;u++){var l=a.params[u].name,c=r.arguments_.length>u?r.arguments_[u]:void 0;this.setProperty(s,l,c)}var h=this.createObjectProto(this.ARRAY_PROTO);for(u=0;u<r.arguments_.length;u++)this.setProperty(h,u,r.arguments_[u]);this.setProperty(s,"arguments",h);var p=a.id&&a.id.name;return p&&this.setProperty(s,p,o),this.setProperty(s,"this",r.funcThis_,t.READONLY_DESCRIPTOR),r.value=void 0,new ly(a.body,s)}if(o.eval){var d=r.arguments_[0];if("string"==typeof d){try{var f=t.acorn.parse(d.toString(),t.PARSE_OPTIONS)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}var m=new this.nodeConstructor;return m.type="EvalProgram_",m.body=f.body,this.stripLocations_(m,n.start,n.end),(s=r.scope).strict?s=this.createScope(f,s):this.populateScope_(f,s),this.value=void 0,new ly(m,s)}r.value=d}else if(o.nativeFunc)void 0!==r.funcThis_&&void 0!==r.funcThis_._native?r.value=o.nativeFunc.call(r.funcThis_,r.arguments_):r.value=o.nativeFunc.apply(r.funcThis_,r.arguments_);else{if(o.asyncFunc){var g=this,v=r.arguments_.concat((function(t){r.value=t,g.paused_=!1}));return this.paused_=!0,void o.asyncFunc.apply(r.funcThis_,v)}this.throwException(this.TYPE_ERROR,o.class+" is not a function")}}},t.prototype.stepCatchClause=function(t,e,r){if(!e.done_){e.done_=!0;var n=this.createSpecialScope(e.scope);return this.setProperty(n,r.param.name,e.throwValue),new ly(r.body,n)}t.pop()},t.prototype.stepConditionalExpression=function(t,e,r){var n=e.mode_||0;if(0===n)return e.mode_=1,new ly(r.test,e.scope);if(1===n){e.mode_=2;var i=Boolean(e.value);if(i&&r.consequent)return new ly(r.consequent,e.scope);if(!i&&r.alternate)return new ly(r.alternate,e.scope);this.value=void 0}t.pop(),"ConditionalExpression"===r.type&&(t[t.length-1].value=e.value)},t.prototype.stepContinueStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name),e=t[t.length-1];e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(e.isLoop&&(!n||e.labels&&-1!==e.labels.indexOf(n)))return;t.pop(),e=t[t.length-1]}throw SyntaxError("Illegal continue statement")},t.prototype.stepDebuggerStatement=function(t,e,r){t.pop()},t.prototype.stepDoWhileStatement=function(t,e,r){if("DoWhileStatement"===r.type&&void 0===e.test_&&(e.value=!0,e.test_=!0),!e.test_)return e.test_=!0,new ly(r.test,e.scope);if(e.value){if(r.body)return e.test_=!1,e.isLoop=!0,new ly(r.body,e.scope)}else t.pop()},t.prototype.stepEmptyStatement=function(t,e,r){t.pop()},t.prototype.stepEvalProgram_=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new ly(i,e.scope);t.pop(),t[t.length-1].value=this.value},t.prototype.stepExpressionStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new ly(r.expression,e.scope);t.pop(),this.value=e.value},t.prototype.stepForInStatement=function(e,r,n){if(!r.doneInit_&&(r.doneInit_=!0,n.left.declarations&&n.left.declarations[0].init))return r.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new ly(n.left,r.scope);if(!r.doneObject_)return r.doneObject_=!0,r.variable_||(r.variable_=r.value),new ly(n.right,r.scope);if(r.isLoop||(r.isLoop=!0,r.object_=r.value,r.visited_=Object.create(null)),void 0===r.name_){t:do{if(r.object_&&r.object_.isObject){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_.properties));do{var i=r.props_.shift()}while(i&&(r.visited_[i]||!Object.prototype.hasOwnProperty.call(r.object_.properties,i)));if(i&&(r.visited_[i]=!0,Object.prototype.propertyIsEnumerable.call(r.object_.properties,i))){r.name_=i;break t}}else if(null!==r.object_){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_));do{i=r.props_.shift()}while(i&&r.visited_[i]);if(i){r.visited_[i]=!0,r.name_=i;break t}}r.object_=this.getPrototype(r.object_),r.props_=null}while(null!==r.object_);if(null===r.object_)return void e.pop()}if(!r.doneVariable_){r.doneVariable_=!0;var o=n.left;if("VariableDeclaration"!==o.type){r.variable_=null;var a=new ly(o,r.scope);return a.components=!0,a}r.variable_=[t.SCOPE_REFERENCE,o.declarations[0].id.name]}if(r.variable_||(r.variable_=r.value),!r.doneSetter_){r.doneSetter_=!0;var s=r.name_,u=this.setValue(r.variable_,s);if(u)return this.createSetter_(u,r.variable_,s)}return r.name_=void 0,r.doneVariable_=!1,r.doneSetter_=!1,n.body?new ly(n.body,r.scope):void 0},t.prototype.stepForStatement=function(t,e,r){var n=e.mode_||0;if(0===n){if(e.mode_=1,r.init)return new ly(r.init,e.scope)}else if(1===n){if(e.mode_=2,r.test)return new ly(r.test,e.scope)}else if(2===n){if(e.mode_=3,!r.test||e.value)return e.isLoop=!0,new ly(r.body,e.scope);t.pop()}else if(3===n&&(e.mode_=1,r.update))return new ly(r.update,e.scope)},t.prototype.stepFunctionDeclaration=function(t,e,r){t.pop()},t.prototype.stepFunctionExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.createFunction(r,e.scope)},t.prototype.stepIdentifier=function(e,r,n){if(e.pop(),r.components)e[e.length-1].value=[t.SCOPE_REFERENCE,n.name];else{var i=this.getValueFromScope(n.name);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;for(var o=r.scope;!this.hasProperty(o,n.name);)o=o.parentScope;var a=i;return this.createGetter_(a,this.global)}e[e.length-1].value=i}},t.prototype.stepIfStatement=function(t,e,r){return this.stepConditionalExpression(t,e,r)},t.prototype.stepLabeledStatement=function(t,e,r){t.pop();var n=e.labels||[];n.push(r.label.name);var i=new ly(r.body,e.scope);return i.labels=n,i},t.prototype.stepLiteral=function(t,e,r){t.pop();var n=r.value;if(n instanceof RegExp){var i=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(i,n),n=i}t[t.length-1].value=n},t.prototype.stepLogicalExpression=function(t,e,r){if("&&"!==r.operator&&"||"!==r.operator)throw SyntaxError("Unknown logical operator: "+r.operator);if(!e.doneLeft_)return e.doneLeft_=!0,new ly(r.left,e.scope);if(e.doneRight_)t.pop(),t[t.length-1].value=e.value;else{if(!("&&"===r.operator&&!e.value||"||"===r.operator&&e.value))return e.doneRight_=!0,new ly(r.right,e.scope);t.pop(),t[t.length-1].value=e.value}},t.prototype.stepMemberExpression=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new ly(r.object,e.scope);var n;if(r.computed){if(!e.doneProperty_)return e.object_=e.value,e.doneProperty_=!0,new ly(r.property,e.scope);n=e.value}else e.object_=e.value,n=r.property.name;if(t.pop(),e.components)t[t.length-1].value=[e.object_,n];else{var i=this.getProperty(e.object_,n);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;var o=i;return this.createGetter_(o,e.object_)}t[t.length-1].value=i}},t.prototype.stepNewExpression=function(t,e,r){return this.stepCallExpression(t,e,r)},t.prototype.stepObjectExpression=function(t,e,r){var n=e.n_||0,i=r.properties[n];if(e.object_){var o=i.key;if("Identifier"===o.type)var a=o.name;else{if("Literal"!==o.type)throw SyntaxError("Unknown object structure: "+o.type);a=o.value}e.properties_[a]||(e.properties_[a]={}),e.properties_[a][i.kind]=e.value,e.n_=++n,i=r.properties[n]}else e.object_=this.createObjectProto(this.OBJECT_PROTO),e.properties_=Object.create(null);if(i)return new ly(i.value,e.scope);for(var s in e.properties_){var u=e.properties_[s];if("get"in u||"set"in u){var l={configurable:!0,enumerable:!0,get:u.get,set:u.set};this.setProperty(e.object_,s,null,l)}else this.setProperty(e.object_,s,u.init)}t.pop(),t[t.length-1].value=e.object_},t.prototype.stepProgram=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.done=!1,e.n_=n+1,new ly(i,e.scope);e.done=!0},t.prototype.stepReturnStatement=function(t,e,r){if(r.argument&&!e.done_)return e.done_=!0,new ly(r.argument,e.scope);var n=e.value,i=t.length-1;for(e=t[i];"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if("TryStatement"!==e.node.type&&t.splice(i,1),--i<0)throw SyntaxError("Illegal return statement");e=t[i]}e.value=n},t.prototype.stepSequenceExpression=function(t,e,r){var n=e.n_||0,i=r.expressions[n];if(i)return e.n_=n+1,new ly(i,e.scope);t.pop(),t[t.length-1].value=e.value},t.prototype.stepSwitchStatement=function(t,e,r){if(!e.test_)return e.test_=1,new ly(r.discriminant,e.scope);for(1===e.test_&&(e.test_=2,e.switchValue_=e.value);;){var n=e.index_||0,i=r.cases[n];if(e.matched_||!i||i.test)if(i||e.matched_||!e.defaultCase_){if(!i)return void t.pop();if(!e.matched_&&!e.tested_&&i.test)return e.tested_=!0,new ly(i.test,e.scope);if(e.matched_||e.value===e.switchValue_){e.matched_=!0;var o=e.n_||0;if(i.consequent[o])return e.isSwitch=!0,e.n_=o+1,new ly(i.consequent[o],e.scope)}e.tested_=!1,e.n_=0,e.index_=n+1}else e.matched_=!0,e.index_=e.defaultCase_;else e.defaultCase_=n,e.index_=n+1}},t.prototype.stepThisExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.getValueFromScope("this")},t.prototype.stepThrowStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new ly(r.argument,e.scope);this.throwException(e.value)},t.prototype.stepTryStatement=function(t,e,r){if(!e.doneBlock_)return e.doneBlock_=!0,new ly(r.block,e.scope);if(e.throwValue&&!e.doneHandler_&&r.handler){e.doneHandler_=!0;var n=new ly(r.handler,e.scope);return n.throwValue=e.throwValue,e.throwValue=null,n}if(!e.doneFinalizer_&&r.finalizer)return e.doneFinalizer_=!0,new ly(r.finalizer,e.scope);e.throwValue?this.executeException(e.throwValue):t.pop()},t.prototype.stepUnaryExpression=function(e,r,n){if(!r.done_){r.done_=!0;var i=new ly(n.argument,r.scope);return i.components="delete"===n.operator,i}e.pop();var o=r.value;if("-"===n.operator)o=-o;else if("+"===n.operator)o=+o;else if("!"===n.operator)o=!o;else if("~"===n.operator)o=~o;else if("delete"===n.operator){var a=!0;if(Array.isArray(o)){var s=o[0];s===t.SCOPE_REFERENCE&&(s=r.scope);var u=String(o[1]);try{delete s.properties[u]}catch(t){r.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+u+"' of '"+s+"'"):a=!1}}o=a}else if("typeof"===n.operator)o=o&&"Function"===o.class?"function":typeof o;else{if("void"!==n.operator)throw SyntaxError("Unknown unary operator: "+n.operator);o=void 0}e[e.length-1].value=o},t.prototype.stepUpdateExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new ly(r.argument,e.scope);return n.components=!0,n}if(e.leftSide_||(e.leftSide_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_){var i=this.getValue(e.leftSide_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftSide_)}}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var a;if(i=Number(e.leftValue_),"++"===r.operator)a=i+1;else{if("--"!==r.operator)throw SyntaxError("Unknown update expression: "+r.operator);a=i-1}var s=r.prefix?a:i,u=this.setValue(e.leftSide_,a);if(u)return e.doneSetter_=s,this.createSetter_(u,e.leftSide_,a);t.pop(),t[t.length-1].value=s},t.prototype.stepVariableDeclaration=function(t,e,r){var n=r.declarations,i=e.n_||0,o=n[i];for(e.init_&&o&&(this.setValueToScope(o.id.name,e.value),e.init_=!1,o=n[++i]);o;){if(o.init)return e.n_=i,e.init_=!0,new ly(o.init,e.scope);o=n[++i]}t.pop()},t.prototype.stepWithStatement=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new ly(r.object,e.scope);if(!e.doneBody_){e.doneBody_=!0;var n=this.createSpecialScope(e.scope,e.value);return new ly(r.body,n)}t.pop()},t.prototype.stepWhileStatement=function(t,e,r){return this.stepDoWhileStatement(t,e,r)},t.PARSE_OPTIONS={ecmaVersion:5},t.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},t.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},t.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},t.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},t.STEP_ERROR={},t.SCOPE_REFERENCE={},t.toStringCycles_=[],t}(),uy=function(){function t(t){this.proto=null,this.isObject=!0,this.class="Object",this.data=null,this._native=void 0,this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=t}return t.prototype.toString=function(){if("Array"===this.class){(n=sy.toStringCycles_).push(this);try{for(var t=[],e=0;e<this.properties.length;e++){var r=this.properties[e];t[e]=r&&r.isObject&&-1!==n.indexOf(r)?"...":r}}finally{n.pop()}return t.join(",")}if("Error"===this.class){var n,i,o;if(-1!==(n=sy.toStringCycles_).indexOf(this))return"[object Error]";var a=this;do{if("name"in a.properties){i=a.properties.name;break}}while(a=a.proto);a=this;do{if("message"in a.properties){o=a.properties.message;break}}while(a=a.proto);n.push(this);try{i=i&&i.toString(),o=o&&o.toString()}finally{n.pop()}return o?i+": "+o:String(i)}return null!==this.data?String(this.data):"[object "+this.class+"]"},t.prototype.valueOf=function(){return void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},t}(),ly=function(t,e){this.node=t,this.scope=e},cy=function(t,e){for(var r=t;r&&r.prototype;){if(Object.getOwnPropertyNames(r.prototype).indexOf(e)>=0)return!0;r=Object.getPrototypeOf(r)}return!1};sy.Object=uy,sy.State=ly;try{sy.acorn=(self||global).acorn}catch(t){}function hy(t,e){var r={},n=$g.parse(t,{locations:!0,onComment:function(t,e,n,i,o,a){r[a.line]=e}});if("Program"!==n.type||1!==n.body.length||"FunctionDeclaration"!==n.body[0].type)throw new Error("this function does not follow the definition rule.");var i=n.body[0].body.body,o=[],a=[];return i.forEach((function(t){if("ExpressionStatement"===t.type){var n=t.expression;if("AssignmentExpression"===n.type&&"="===n.operator&&"MemberExpression"===n.left.type&&"ThisExpression"===n.left.object.type&&"Identifier"===n.left.property.type){for(var i=[],s=n.loc.start.line-1;s>=0&&void 0!==r[s];s--)i.push(r[s]);if(!(i.length<=0)){var u=n.left.property.name;if(!(Array.isArray(e)&&e.indexOf(u)>=0)&&"FunctionExpression"!==n.right.type){var l=function(t,e,r){var n={name:t,title:{},className:null,proposed:!1,initialValue:null};if(e.forEach((function(t){var e=t.indexOf("@ui ");if(e>=0)n.description=t.substring(e+"@ui ".length).trim();else{var r=t.indexOf("@title ");if(r>=0){var i=t.substring(r+"@title ".length).trim();0===i.indexOf("@ja ")?n.title.ja=i.substring("@ja ".length).trim():n.title.default=i}else if(t.indexOf("@proposed")>=0)n.proposed=!0;else{var o=t.indexOf("@comment ");if(o>=0){var a=t.substring(o+"@comment ".length).trim();return n.comment||(n.comment={}),void(0===a.indexOf("@ja ")?n.comment.ja=a.substring("@ja ".length).trim():n.comment.default=a)}}}})),!n.description&&!n.comment)return null;if(n.proposed||n.comment)return n;var i=n.description.indexOf("("),o=n.description.indexOf(")",i);if(!(i<0||o<0)){n.className=n.description.substr(0,i);try{var a=new sy("["+n.description.substr(i+1,o-i-1)+"]"),s=Date.now();for(a.unwrap=null,a.wrap=null;a.step()&&!(Date.now()-s>100););n.params=a.pseudoToNative(a.value)}catch(t){}return n.params||(n.params=[]),n}}(u,i);a.push(n),l&&o.push(l)}}}}})),{widgets:o,fields:a,ast:n}}function py(t,e){if(void 0===e&&(e=-1),!t)return{dependencyAtCursor:null,dependencies:[]};for(var r=[],n=null,i=("string"==typeof t?$g.parse(t):t).body[0].body.body.slice(0);i.length>0;){var o=i.shift();if(null!=o)if("CallExpression"!==o.type)o.expression&&i.push(o.expression),o.object&&i.push(o.object),o.property&&i.push(o.property),o.name&&"string"!=typeof name&&i.push(o.name),o.left&&i.push(o.left),o.right&&i.push(o.right),o.id&&i.push(o.id),o.init&&i.push(o.init),o.callee&&i.push(o.callee),o.body&&Array.isArray(o.body)&&i.push.apply(i,o.body),o.declarations&&Array.isArray(o.declarations)&&i.push.apply(i,o.declarations),o.arguments&&Array.isArray(o.arguments)&&i.push.apply(i,o.arguments),o.params&&Array.isArray(o.params)&&i.push.apply(i,o.params);else if(o.callee.name&&"require"===o.callee.name){var a=o.arguments;if(a&&Array.isArray(a)&&1===a.length){var s=a[0];if("Literal"===s.type){var u=s.value;r.push(u),o.start&&o.end&&o.start<=e&&o.end>=e&&(n=u)}}}}return{dependencyAtCursor:n,dependencies:r}}function dy(t,e){if("object"!=typeof t||null===t)return t;if(t.type&&e[t.type]){var r;if("Color"===t.type){var n=new Fg;n.r=Number(t.value.r),n.g=Number(t.value.g),n.b=Number(t.value.b),n.a=Number(t.value.a),r=n}else{for(var i=new e[t.type],o=0,a=Object.keys(t.value);o<a.length;o++){var s=a[o];i[s]=t.value[s]}r=i}return r}}function fy(t){if(void 0!==t&&"function"!=typeof t){if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof Fg)return{type:"Color",value:{r:t.r,g:t.g,b:t.b,a:t.a}};throw new Error}}function my(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t}sy.acorn=$g,sy.acorn=$g;var gy={type:"ExpressionStatement",start:null,end:null,expression:{type:"CallExpression",start:null,end:null,expression:null,arguments:null},arguments:null},vy=function(){function t(t,e,r){this.verbose=!1,this.wrapperTable=t,this.ignoredPropNames=e,this.isGraphics=r,this.initialize()}return t.prototype.initialize=function(){var t=this,e=new sy("",(function(e,r){t.globalScope=r}));this.interpreter=e,this.interpreter.wrap=function(e){return t.wrap(e)},this.interpreter.unwrap=function(e,r){return t.unwrap(e,r)},this.wrappers={},Object.keys(this.wrapperTable).forEach((function(e){return t.wrapClass(t.wrapperTable[e],e)}))},t.prototype.createGlobalFunction=function(t,e){var r,n=this,i=e.func,o=e.raw,a=e.isConstructor,s=e.async,u=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=i(o?t:t.map((function(e,r){return r<t.length-1||!s?n.unwrap(e):e})));return o?r:n.wrap(r)};r=s?this.interpreter.createAsyncFunction(u):this.interpreter.createNativeFunction(u,a),this.interpreter.setProperty(this.globalScope,t,r)},t.prototype.attachGetAssignedUnitMethod=function(t){var e=this,r=this.interpreter.createNativeFunction((function(){return e.wrap(t.assignedUnit)}));this.interpreter.setProperty(t.templateInstance,"getAssignedUnit",r)},t.prototype.setSizeProperties=function(t,e,r){this.interpreter.setProperty(this.globalScope,"width",t),this.interpreter.setProperty(this.globalScope,"height",e),this.interpreter.setProperty(this.globalScope,"margin",this.interpreter.wrap(r))},t.prototype.setDurationProperty=function(t){this.interpreter.setProperty(this.globalScope,"duration",t)},t.prototype.setProperty=function(t,e,r){this.interpreter.setProperty(t,e,this.wrap(r))},t.prototype.getProperty=function(t,e){return this.unwrap(this.interpreter.getProperty(t,e))},t.prototype.getRawProperty=function(t,e){return this.interpreter.getProperty(t,e)},t.prototype.prepareRun=function(t){var e;e="string"==typeof t?$g.parse(t):t;var r=this.interpreter.createScope(e,this.globalScope);return this.interpreter.stateStack=[{node:e,scope:r,done:!1}],r},t.prototype.newStatementFor=function(t){return $g.parse("new "+t+"();")},t.prototype.prepareNewInstance=function(t,e){var r=this.interpreter.createScope($g.parse(""),e);return this.interpreter.stateStack=[{node:t,scope:r,thisExpression:r}],r},t.prototype.exec=function(t,e,r,n){var i=this,o=this.interpreter;gy.expression.arguments=[];var a=[];return r.forEach((function(t){gy.expression.arguments.push(null),a.push(i.wrap(t))})),o.stateStack=[{node:{type:"Program",body:[gy]},scope:this.globalScope,done:!0,n_:1},{node:gy,scope:this.globalScope,done_:!0},{node:gy.expression,doneCallee_:2,doneArgs_:!0,arguments_:a,funcThis_:t,func_:o.getProperty(t,e),scope:t,n_:a.length,value:[t,e]}],this.run(700,"call a method ("+t.className+"."+e+(n?" assigned to "+n.toString():"")+")")},t.prototype.run=function(t,e){var r=this.interpreter,n=Date.now(),i=!1;try{for(;r.step();)if(Date.now()-n>t){i=!0;break}}catch(t){throw this.verbose&&console.log(r.stateStack),"string"==typeof t&&(t=new Error(t)),r.stateStack.length>0&&(t.node=r.stateStack[r.stateStack.length-1].node),t}if(i){var o=new Error("timeout: spent too long time (> "+t+"ms) to "+e);throw r.stateStack.length>0&&(o.node=r.stateStack[0].node),o}return this.interpreter.value},t.prototype.getPrimitiveProperty=function(t,e){return"object"==typeof t&&"object"==typeof t.properties&&my(t.properties[e])?t.properties[e]:null},t.prototype.cleanupProperties=function(t){for(var e in this.ignoredPropNames.forEach((function(e){void 0!==t.properties[e]&&delete t.properties[e]})),t.properties)this.cleanupProperty(t.properties[e])||delete t.properties[e];return t.properties},t.prototype.cleanupProperty=function(t){if(my(t))return!0;var e=t;if(e._native)return!0;var r=this.globalScope.properties;if(e.parent===r.Array){for(var n=e.length,i=0;i<e.length;i++)this.cleanupProperty(e.properties[i])||(delete e.properties[i],n--);return e.length=n,n>0}if(e.parent===r.Object){var o=!0;for(var a in e.properties)this.cleanupProperty(e.properties[a])?o=!1:delete e.properties[a];return!o}return!1},t.prototype.restoreProperties=function(t,e){t.properties=tv(tv({},t.properties),e)},t.prototype.wrap=function(t){if("object"==typeof t&&null!==t&&void 0!==t.constructor&&"string"==typeof t.constructor.className){var e=t.constructor.className,r=this.wrappers[e];if(void 0===r)return;var n=this.interpreter.createObject(r);return n._native=t,n}return this.verbose&&(my(t)||Array.isArray(t)||console.log("wrap complex obj:",String(t))),this.interpreter.nativeToPseudo(t)},t.prototype.unwrap=function(t,e){return"object"==typeof t&&null!==t&&t._native?t._native:this.interpreter.pseudoToNative(t,e)},t.prototype.wrapClass=function(t,e){this.verbose&&console.log("--- wrapping "+e+" ---"),t.className=e;var r=this,n=this.interpreter.createNativeFunction((function(e){var i,o;if(i=r.interpreter.calledWithNew()?this:r.interpreter.createObjectProto(n.properties.prototype),void 0!==e)if(Array.isArray(e))for(var a=0;a<e.length;a++)o[a]=r.unwrap(e[a]);else o=r.unwrap(e);if(t){var s=Object.create(t.prototype),u=t.apply(s,[null].concat(o).splice(1));i._native=null!==u&&"object"==typeof u?u:s}return i}));return this.interpreter.setProperty(this.globalScope,e,n),this.wrapStaticMembers(n,t),this.wrapInstanceMembers(n,t),this.wrappers[e]=n,n},t.prototype.wrapStaticMembers=function(t,e){var r=this,n=function(n){var o=n;if(i.interpreter.setProperty(t,n,ReferenceError,{get:function(){return r.wrap(e[o])},set:function(t){return e[o]=r.unwrap(t)}}),i.verbose){var a=void 0;try{a=typeof e[o]}catch(t){a="not accessible"}console.log("static "+o+" ("+a+")")}},i=this;for(var o in e)n(o)},t.prototype.wrapInstanceMembers=function(t,e){for(var r,n=new e,i=this.isGraphics(t),o=0,a=nv(Object.keys(n),function(t){for(var e=t,r=[];e&&e.prototype;)r=nv(r,Object.getOwnPropertyNames(e.prototype)),e=Object.getPrototypeOf(e);return r}(e)).filter((function(t,e,r){return r.indexOf(t)===e}));o<a.length;o++){var s=a[o];if("constructor"!==s&&!this.interpreter.hasProperty(t,s)&&!this.interpreter.hasProperty(t.properties.prototype,s)&&"_"!==s.charAt(0)){if(this.verbose){var u=void 0;try{u=typeof n[s]}catch(t){u="not accessible"}r=s+" ("+u+")"}try{var l;if("function"==typeof n[s])l=i?function(t,e){return function(r){var n;return e.wrap((n=this._native)[t].apply(n,r.map((function(t){var r=e.unwrap(t);return r instanceof Fg?r.toString():r}))))}}(s,this):function(t,e){return function(r){var n;return e.wrap((n=this._native)[t].apply(n,r.map((function(t){return e.unwrap(t)}))))}}(s,this),this.interpreter.setProperty(t.properties.prototype,s,this.interpreter.createNativeFunction(l)),this.verbose&&(r+=" native method")}catch(t){}this.verbose&&console.log(r)}}},t}(),yy={Matrix2D:Xg,Point:Wg,Color:Fg,Font:Dg,RenderingUnit:Cg,TextUnit:Ng,Graphic:kg,Phrase:Bg,Word:jg,Char:Ug,Beat:gv,RepetitiveSegment:yv},xy=["headTime","tailTime","insomnia"],by=["animate","getAssignedUnit","name","type"],_y=function(){function t(t,e,r){this._emitter=null,this._player=null,this.interpreter=null,this.unsafeAcceleration=!1,this._verbose=!1,this.rawConsole=!1,this._player=t,this._emitter=e,this.unsafeAcceleration=r,this.loader=new ay(e,this.register.bind(this)),t.addListener({onVideoReady:this.onVideoReady.bind(this)})}return Object.defineProperty(t.prototype,"verbose",{get:function(){return this._verbose},set:function(t){this._verbose=this.loader.verbose=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.interpreter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this.loader.loaded},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t=this;if(!this.ready){var e=function(t){var e=t.player,r=t.ignoredPropNames,n=t.rawConsole,i=t.templateGetter,o=e.graphics.wrapperTable,a=new vy(tv(tv({},yy),o),r,(function(t){return e.graphics.isGraphics(t)})),s={require:{func:function(t){if(!(t.length<1||"string"!=typeof t[0])){var e=t[0],r=i(e);return null===r?void 0:r.functionDefinition}},raw:!0,isConstructor:!0},print:{func:function(t){e.isEditing&&console.log.apply(console,t)},raw:n},findChorus:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.findChorus(t[0])}},findBeat:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.findBeat(t[0])}},getVocalFrequency:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.getVocalFrequency(t[0])}},getVocalAmplitude:{func:function(t){return t.length<1||"number"!=typeof t[0]?-1:e.getVocalAmplitude(t[0])}},getMaxVocalAmplitude:{func:function(t){return e.getMaxVocalAmplitude()}},getValenceArousal:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.getValenceArousal(t[0])}},getMedianValenceArousal:{func:function(t){return e.getMedianValenceArousal()}}};Object.keys(Ym).forEach((function(t){a.setProperty(a.globalScope,t,Ym[t]),s[t]={value:Ym[t]}})),Object.keys(ny).forEach((function(t){var e=ny[t];0!==t.indexOf("get")&&(s[t]={func:e})}));var u=Object.keys(a.wrapperTable);return u&&u.forEach((function(t){return s[t]={cls:a.wrapperTable[t]}})),Object.keys(s).forEach((function(t){var e=s[t];e.func?a.createGlobalFunction(t,e):e.value&&a.setProperty(a.globalScope,t,e.value)})),{interpreter:a,unsafeGlobalScope:s}}({player:this._player,ignoredPropNames:by,rawConsole:this.rawConsole,templateGetter:function(e){return t.getByName(e,!0)}}),r=e.interpreter,n=e.unsafeGlobalScope;this.unsafeGlobalScope=n,this.interpreter=r,this.onVideoReady(this._player.video)}},t.prototype.getByName=function(t,e){return void 0===e&&(e=!1),this.loader.getByName(t,e)},t.prototype.getById=function(t){return this.loader.getById(t)},t.prototype.clear=function(){this.loader.clear()},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),ev(this,void 0,void 0,(function(){return rv(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadLatest(t)]}))}))},t.prototype.loadForVideo=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadForVideo(t)]}))}))},t.prototype.loadByNames=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadByNames(t)]}))}))},t.prototype.loadByName=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadByName(t)]}))}))},t.prototype.loadById=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadById(t)]}))}))},t.prototype.commit=function(t,e){return ev(this,void 0,void 0,(function(){return rv(this,(function(r){return[2,this.loader.commit(t,e)]}))}))},t.prototype.register=function(t){return ev(this,void 0,void 0,(function(){var e,r,n,i,o=this;return rv(this,(function(a){switch(a.label){case 0:if(!t)return[2,null];if(!(e=this.createClass(t.script)))return[2,null];r=py(e.ast).dependencies,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.all(r.map((function(t){var e=o.getByName(t);return e?Promise.resolve(e):o.loadByName(t)})))];case 2:return a.sent(),this.verbose&&console.log("load dependencies for",e.className,r),[3,4];case 3:return n=a.sent(),this.verbose&&console.error("failed loading dependencies for",e.className,n),[3,4];case 4:try{if(!this.newRawInstance(e))throw new Error("failed to create a template instance");return e.model=t,[2,this.registerClass(e)]}catch(e){throw delete(i=tv({},t)).script,{error:e.message,stack:e.stack,cause:i}}return[2]}}))}))},t.prototype.updateClassScript=function(t,e){var r=this.createClass(e);return this.updateClass(t,r)},t.prototype.registerClass=function(t){if(!t)return null;if(this.loader.loaded[t.className]){this.verbose&&console.log("updating",t.className,t.model.id);var e=this.updateClass(this.loader.loaded[t.className],t);return this.verbose&&console.log("updated",e.className,e.id),e}return this.loader.loaded[t.className]=t,this.verbose&&console.log("loaded",t.className,t.model.id),t},t.prototype.updateClass=function(t,e){var r=t,n=e;if(!n)return null;if(r.model.script===n.model.script)return this.verbose&&console.log("no diff for",r.className),r;var i=this.newRawInstance(n);if(null===i)return null;if(n.id<0){var o=i.templateInstance,a=n.model.script;n.model={id:-1,sourceId:-1,className:n.className,prettyName:o?this.interpreter.getPrimitiveProperty(o,"name"):i.unsafeTemplateInstance.name,type:o?this.interpreter.getPrimitiveProperty(o,"type"):i.unsafeTemplateInstance.type,script:a,author:null,originalAuthor:null,createdDate:null}}if(r.className!==n.className){var s=this.getByName(n.className);if(!s)return n.cursor=r.cursor,this.loader.loaded[n.className]=n,this.verbose&&console.log("create",n.className),n;r=s}return r.newStatement=n.newStatement,r.widgets=n.widgets,r.scope=n.scope,r.functionDefinition=n.functionDefinition,r.newStatement=n.newStatement,r.unsafeConstructorGenerator=n.unsafeConstructorGenerator,r.ast=n.ast,r.cursor<0&&(r.cursor=n.cursor),n.id>=0?(this.verbose&&console.log("replace",n.className,r.id,n.id),r.model=n.model):(this.verbose&&console.log("update",n.className,r.id,n.id),r.model.type=n.model.type,r.model.className=n.model.className,r.model.prettyName=n.model.prettyName,r.model.script=n.model.script,r.model.createdDate=null,r.id>=0&&(r.model.sourceId=r.model.id,r.model.id=-1)),n=r,this.updateInstances(r.instances.slice(),n),this._emitter.onTemplateUpdate(n.className),n},t.prototype.updateInstances=function(t,e){var r=this;t.forEach((function(t){try{r.updateInstance(t,e)}catch(r){console.log("failed updating template for",t.assignedUnit,":",e)}})),this._player.isPlaying||this._player.requestStageUpdate()},t.prototype.createClass=function(t){var e=this;this.ready||this.initialize();var r=new iy;r.model={id:-1,sourceId:-1,className:null,prettyName:null,type:0,script:t,author:null,originalAuthor:null,createdDate:null};var n=hy(t,by),i=n.ast,o=n.widgets;if(r.ast=i,r.widgets=o,r.className=r.ast.body[0].id.name,r.scope=this.interpreter.prepareRun(r.ast),this.interpreter.run(1e3,"to define "+r.className),r.functionDefinition=this.interpreter.getRawProperty(r.scope,r.className),r.newStatement=this.interpreter.newStatementFor(r.className),this.unsafeAcceleration){var a=Object.keys(this.unsafeGlobalScope),s="return function(props){var "+Object.keys(this.getGlobalProperties()).map((function(t){return t+"=props."+t})).join(",")+";"+t+"return "+r.className+";}",u=new(Function.bind.apply(Function,nv([void 0],a,[s]))),l=function(t){var r=e.getByName(t);return r?r.unsafeConstructorGenerator(e.getGlobalProperties()):null},c=a.map((function(t){if("require"===t)return l;var r=e.unsafeGlobalScope[t];return r.func?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.func(t)}:r.cls||r.value}));r.unsafeConstructorGenerator=u.apply({},c)}return r},t.prototype.getGlobalProperties=function(){var t;return{width:this._player.videoWidth,height:this._player.videoHeight,margin:this._player.margin,duration:(null===(t=this._player.video)||void 0===t?void 0:t.duration)||0}},t.prototype.newRawInstance=function(t){var e=t,r=new oy;if(this.unsafeAcceleration){var n=new(e.unsafeConstructorGenerator(this.getGlobalProperties()));r.unsafeTemplateInstance=n}else{this.interpreter.prepareNewInstance(e.newStatement,e.scope);var i=this.interpreter.run(700,"to instantiate "+e.className);r.templateInstance=i,r.templateInstance._nativeInstance=r}return r.templateClass=e,r.ignore=!1,r},t.prototype.setProperty=function(t,e,r){this.unsafeAcceleration?t.unsafeTemplateInstance[e]=r:this.interpreter.setProperty(t.templateInstance,e,r)},t.prototype.getProperty=function(t,e){return this.unsafeAcceleration?t.unsafeTemplateInstance[e]:this.interpreter.getProperty(t.templateInstance,e)},t.prototype.exportInstance=function(t){for(var e={},r=0,n=t.templateClass.widgets.map((function(t){return t.name})).concat(xy);r<n.length;r++){var i=n[r],o=this.getProperty(t,i);try{var a=fy(o);void 0!==a&&(e[i]=a)}catch(e){console.error("cannot export "+t.templateClass.className+"."+i,o,"assigned to",t.assignedUnit)}}return{type:t.templateClass.className,value:e}},t.prototype.importInstances=function(t,e){try{for(var r=e.phrases,n=t.firstPhrase,i=0;null!==n;){var o=r[i++];this.importTemplates(n,o.templates);for(var a=n.firstWord,s=0;s<n.wordCount;s++){var u=o.words[s];this.importTemplates(a,u.templates);for(var l=a.firstChar,c=0;c<a.charCount;c++){var h=u.characters[c];this.importTemplates(l,h.templates),l=l.next}a=a.next}n=n.next}for(var p=e.graphics,d=t.firstGraphic,f=0;null!==d;){var m=p[f++];this.importTemplates(d,m.templates),d=d.next}}catch(t){return console.error("restoring templates failed",t),!1}return!0},t.prototype.importTemplates=function(t,e){if(Array.isArray(e))for(var r=0,n=e;r<n.length;r++){var i=n[r],o=this.importInstance(i);o&&t.addTemplate(o)}},t.prototype.importInstance=function(t){var e=this.getByName(t.type),r=this.newInstance(e);if(!r||!t.value)return null;for(var n=0,i=Object.keys(t.value);n<i.length;n++){var o=i[n],a=dy(t.value[o],this.interpreter.wrapperTable);void 0!==a&&this.setProperty(r,o,a)}return r},t.prototype.updateInstance=function(t,e){var r=t,n=e,i=this.newRawInstance(n),o=r.templateInstance,a=this.interpreter.cleanupProperties(o);r.templateClass!==n&&(this.disposeInstance(r),n.instances.push(r)),r.templateClass=n,r.scope=i.scope,r.templateInstance=i.templateInstance,r.ignore=i.ignore,this.interpreter.restoreProperties(r.templateInstance,a),this.attachGetAssignedUnitMethod(r)},t.prototype.newInstance=function(t){var e;try{if(null===(e=this.newRawInstance(t)))return null}catch(t){return null}return this.attachGetAssignedUnitMethod(e),t.instances.push(e),e},t.prototype.attachGetAssignedUnitMethod=function(t){this.unsafeAcceleration?t.unsafeTemplateInstance.getAssignedUnit=function(){return t.assignedUnit}:this.interpreter.attachGetAssignedUnitMethod(t)},t.prototype.disposeInstance=function(t){var e=t.templateClass;e.instances=e.instances.filter((function(e){return e!==t}))},t.prototype.disposeInstances=function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){return e.disposeInstance(t)}));else{var r=t;[r.firstPhrase,r.firstWord,r.firstChar,r.firstGraphic].forEach((function(t){for(;t;)e.disposeInstances(t.removeTemplates()),t=t.next}))}},t.prototype.setTemplate=function(t,e){this.removeTemplates(t),t.addTemplate(e)},t.prototype.clearTemplate=function(t){this.removeTemplates(t)},t.prototype.removeTemplateAt=function(t,e){var r=t.removeTemplateAt(e);r&&this.disposeInstance(r)},t.prototype.removeTemplates=function(t){var e=t.removeTemplates();this.disposeInstances(e)},t.prototype.getRequiredTemplates=function(t){return py(t).dependencies},t.prototype.getRequiredTemplateAt=function(t,e){return py(t,e).dependencyAtCursor},t.prototype.exec=function(t,e,r){if(t.unsafeTemplateInstance){var n=t.unsafeTemplateInstance;return n[e].apply(n,r)}var i=this.interpreter.exec(t.templateInstance,e,r,t.assignedUnit);return this.interpreter.unwrap(i)},t.prototype.declareVariable=function(t,e,r,n){return this.updateClassScript(t,function(t,e,r,n){try{var i=hy(t),o=i.ast,a=i.fields,s=a[a.length-1],u=t.match(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/),l=u?u.pop():"\n",c=t.split(l),h=s?Array(s.loc.start.column+1).join(" "):"  ",p=s?s.loc.end.line:0;if(p<=0){var d=o.body[0].body,f=c[d.loc.start.line-1],m=f.substring(0,d.loc.start.column+1),g=f.substring(d.loc.start.column+1);c[d.loc.start.line-1]=m,c.splice(d.loc.start.line,0,g),p=d.loc.start.line}for(var v=void 0;(v="var"+Math.random().toString().substring(2)).length>8&&(v=v.substring(0,8)),!(t.indexOf(v)<0););c.length>p&&c[p].length>0&&c.splice(p,0,""),c.splice(p,0,"",h+"// @proposed",h+"// @title "+e,h+"// "+function(t,e){if("Slider"===t)return"@ui Slider("+e.min+", "+e.max+")";if("Check"===t)return"@ui Check()";if("Color"===t)return"@ui Color()";var r=e.etc;return"@comment "+(r=r.replace(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/g,"")).replace(/\/[*/]/g,"")}(r,n),h+"this."+v+" = "+(x=n,("Slider"===(y=r)?((x.min+x.max)/2).toString():"Check"===y?"false":"Color"===y?'new Color("#000000")':"null")+";")),t=c.join(l)}catch(t){}var y,x;return t}(t.model.script,e,r,n))},t.prototype.onVideoReady=function(t){this.ready&&(this.interpreter.setSizeProperties(this._player.resolutionWidth,this._player.resolutionHeight,this._player.margin),this.interpreter.setDurationProperty((null==t?void 0:t.duration)||0))},t}(),wy=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.video=r,Object.setPrototypeOf(i,n.prototype),i}return Kg(e,t),e}(Error),Ty=function(){this.halted=[],this.errors=[]},Ey=function(){function t(t,e){var r=this;this.listener=e,this.player=null,this._scale=1,this.playerListener={onResize:function(t){r.elementWidth=t.width,r.updateSize()},onVideoReady:function(){r.elementWidth=r.calcWidth(),r.updateSize()},onStageElementSet:function(t){r.elementWidth=r.calcWidth(),r.updateSize(),r.player.graphics.setCanvas(t)},onDispose:function(){r.dispose()}},this.requestedTime=0,this.request=null,this.player=t,t.addListener(this.playerListener)}return Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateSize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.player.graphics.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.player.graphics.height},enumerable:!1,configurable:!0}),t.prototype.requestUpdate=function(t){return ev(this,void 0,void 0,(function(){var e=this;return rv(this,(function(r){return this.requestedTime=void 0===t?this.player.videoPosition:t,this.request||(this.request=new Promise((function(t){setTimeout((function(){try{e.update(e.requestedTime)}catch(t){}e.request=null,t(e.requestedTime)}),0)}))),[2,this.request]}))}))},t.prototype.update=function(t){t||(t=this.player.mediaPosition),"number"==typeof t&&(this.player.graphics.reset(),this.animate(t),this.player.graphics.update(),this.listener.onStageUpdate(t))},t.prototype.animate=function(t){for(var e=new Ty,r=e.errors,n=e.halted,i=0,o=[this.player.video.firstPhrase,this.player.video.firstWord,this.player.video.firstChar,this.player.video.firstGraphic];i<o.length;i++)for(var a=o[i];a;)this.animateRenderingUnit(t,a,e),a=a.next;if(n.length>0){console.error("---");for(var s=0;s<n.length;s++)console.error("halted",n[s],r[s])}},t.prototype.animateRenderingUnit=function(t,e,r){if(e.animate)e.animate(t,e);else if(e.templateCount<=0)Sy(e)&&e.getType()===Ym.CHAR&&(e.rendering.visible=!1);else for(var n=0;n<e.templateCount;n++)this.animateTemplate(t,e,e.getTemplate(n),r)},t.prototype.animateTemplate=function(t,e,r,n){var i,o,a,s,u,l,c=this;if(r.ignore)e.rendering.visible=!1;else{if(e.getType()!==Ym.GRAPHIC)for(var h=e.parent;h;){if(h.templateCount>0&&(!h.rendering.visible||0===h.rendering.alpha))return void(e.rendering.visible=!1);h=h.parent}var p=this.player.templates.getProperty(r,"insomnia"),d=Sy(e);if(!p&&d&&(i=function(t,e){return c.player.templates.getProperty(t,e)},o=t,a=e,u=(s=r)&&i(s,"headTime")||500,l=s&&i(s,"tailTime")||500,!(a.startTime-u<=o&&a.endTime+l>=o||(a.getType()!==Ym.GRAPHIC&&(a.rendering.visible=!1),0))))return;this.doAnimateTemplate(t,r,n)}},t.prototype.doAnimateTemplate=function(t,e,r){var n=r.errors,i=r.halted;try{this.player.templates.exec(e,"animate",[t])}catch(t){n.push(t),i.push(e)}},t.prototype.calcWidth=function(){var t=this.player.stageElement;if(!t)return 0;var e=window.getComputedStyle(t);return t.offsetWidth-Qg(e.borderLeftWidth)-Qg(e.borderRightWidth)-Qg(e.paddingLeft)-Qg(e.paddingRight)},t.prototype.updateSize=function(){var t=this.player.stageElement;if(t){var e=this.elementWidth*this.player.videoProportion;if(t.style.height=e+"px",t.width=this.elementWidth*this._scale,t.height=e*this._scale,this.player.video){var r=t.width/this.player.videoWidth;this.player.graphics.updateStageTx(r,this.player.margin),this.player.isPlaying||this.requestUpdate()}}},t.prototype.dispose=function(){this.player.removeListener(this.playerListener),this.player=null},t}();function Sy(t){if(t.getType()===Ym.GRAPHIC)return!0;for(var e=!0,r=t.parent;r;){if(r.templateCount>0){e=!1;break}r=r.parent}return e}var Ay="https://textalive.jp",Py=function(){function t(t){var e,r=this;if(this.player=t,this._position="embed",this._rounded=!1,this._bordered=!1,this._shadowed=!1,this._background="#fff",this._color="#1f4391",void 0!==(null===(e=t.options)||void 0===e?void 0:e.mediaBannerPosition)&&(this._position=t.options.mediaBannerPosition),this.domEnabled){this.logoAnchor=document.createElement("a"),this.logoAnchor.className="textalive-logo",this.logoAnchor.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><style>.bg{fill:#1f4391;}.fg{fill:#fff;}</style></defs><g class="logo-sq"><rect class="bg" x="-20" y="-20" width="240" height="240"/><g class="textalive-logo-art"><path class="fg" d="M97.33,130.81V142a3,3,0,0,0,4.78,2.41l56.81-42.09a3,3,0,0,0,0-4.81l-8.33-6.14Z"/><path class="fg" d="M137.14,81.43l-35-25.84A3,3,0,0,0,97.33,58v52.92Z"/><path class="fg" d="M51,55H80.33a2,2,0,0,1,2,2V71.67a0,0,0,0,1,0,0H51a2,2,0,0,1-2-2V57A2,2,0,0,1,51,55Z"/><path class="fg" d="M44.83,107.5h56.33a2,2,0,0,1,2,2v12.67a2,2,0,0,1-2,2H44.83a0,0,0,0,1,0,0V107.5A0,0,0,0,1,44.83,107.5Z" transform="translate(189.83 41.84) rotate(90)"/></g></g></svg>',this.logoAnchor.style.padding=this.bordered?"1px 2px":"1px 3px",this.logoAnchor.href=Ay,this.logoAnchor.target="_blank",this.logoAnchor.title="Powered by TextAlive App API",this.logoSvg=this.logoAnchor.querySelector("svg"),this.logoSvg.style.width="24px",this.songNameDiv=document.createElement("div"),this.songNameDiv.className="name",this.songNameDiv.style.fontWeight="bold",this.songNameDiv.style.overflow="hidden",this.songNameDiv.style.textOverflow="ellipsis",this.songNameDiv.style.marginBottom="2px",this.songNameDiv.textContent="-",this.songArtistDiv=document.createElement("div"),this.songArtistDiv.className="artist",this.songArtistDiv.textContent="-",this.songArtistDiv.style.overflow="hidden",this.songArtistDiv.style.textOverflow="ellipsis";var n=document.createElement("span");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="song"><path d="M120.95,45.77l-59.12,13a2.57,2.57,0,0,0-2,2.51v47.8c0,13.61-12.4,23.74-24.2,23.74-8.92,0-14.82-4.23-14.82-13,0-13,12.86-21.93,23.9-21.93a16.33,16.33,0,0,1,10,3V35a2.57,2.57,0,0,1,2-2.51l69.41-15.29a2.57,2.57,0,0,1,3.13,2.51V92.84c0,13.61-12.1,23.9-24.2,23.9-8.92,0-14.82-4.24-14.82-13,0-13.16,12.86-21.93,23.9-21.93a16.31,16.31,0,0,1,10,2.87V48.29A2.57,2.57,0,0,0,120.95,45.77Z"/><path d="M35.61,134.36c-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43a18.4,18.4,0,0,1,8.48,1.88V35a4,4,0,0,1,3.2-4l69.41-15.29a4.07,4.07,0,0,1,5,4V92.83c0,15-13.54,25.4-25.7,25.4-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43A19,19,0,0,1,122.57,82V48.29a1.07,1.07,0,0,0-1.3-1h0l-59.12,13a1.08,1.08,0,0,0-.84,1v47.8C61.3,124,47.76,134.36,35.61,134.36Zm9.07-34.94c-10.57,0-22.4,8.74-22.4,20.43,0,10,8.35,11.51,13.32,11.51,13.38,0,22.7-11.72,22.7-22.24V61.31a4.1,4.1,0,0,1,3.2-4l59.12-13h0a4.07,4.07,0,0,1,5,4V87.56l-2.37-1.67a14.88,14.88,0,0,0-9.12-2.6c-10.59,0-22.4,8.39-22.4,20.43,0,10,8.35,11.51,13.32,11.51,10.74,0,22.7-9.2,22.7-22.4V19.72a1.07,1.07,0,0,0-1.3-1L57,34a1.07,1.07,0,0,0-.84,1v68.83l-2.37-1.67A14.87,14.87,0,0,0,44.68,99.42Z"/></g></svg>',n.style.padding="0 3px 0 0",this.songSvg=n.querySelector("svg"),this.songSvg.style.width="14px",this.songWrapper=document.createElement("div"),this.songWrapper.style.width="203px",this.songWrapper.style.maxWidth="203px",this.songWrapper.appendChild(this.songNameDiv),this.songWrapper.appendChild(this.songArtistDiv),this.songAnchor=document.createElement("a"),this.songAnchor.className="song",this.songAnchor.target="_blank",this.songAnchor.style.display="flex",this.songAnchor.style.lineHeight="1.2em",this.songAnchor.style.padding="4px 3px 3px 3px",this.songAnchor.style.textDecoration="none",this.songAnchor.appendChild(n),this.songAnchor.appendChild(this.songWrapper),this.lyricsNameDiv=document.createElement("div"),this.lyricsNameDiv.className="name",this.lyricsNameDiv.style.fontWeight="bold",this.lyricsNameDiv.textContent="-",this.lyricsNameDiv.style.overflow="hidden",this.lyricsNameDiv.style.textOverflow="ellipsis",this.lyricsNameDiv.style.marginBottom="2px",this.lyricsArtistDiv=document.createElement("div"),this.lyricsArtistDiv.className="artist",this.lyricsArtistDiv.textContent="-",this.lyricsArtistDiv.style.overflow="hidden",this.lyricsArtistDiv.style.textOverflow="ellipsis";var i=document.createElement("span");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="lyrics"><path d="M78,126.3H67.52l-6.26-23.82H24.4L18.14,126.3H7.7L35.7,22H50ZM27,92.39H58.65l-15.82-61Z"/><path d="M78,128.3H67.52a2,2,0,0,1-1.93-1.49l-5.87-22.33H25.94l-5.87,22.33a2,2,0,0,1-1.93,1.49H7.7a2,2,0,0,1-1.93-2.52l28-104.34A2,2,0,0,1,35.7,20H50a2,2,0,0,1,1.93,1.48l28,104.34A2,2,0,0,1,78,128.3Zm-8.89-4h6.29L48.43,24H37.23L10.31,124.3h6.28L22.46,102a2,2,0,0,1,1.93-1.49H61.26A2,2,0,0,1,63.2,102ZM58.65,94.39H27a2,2,0,0,1-1.94-2.5l15.82-61a2,2,0,0,1,3.87,0l15.82,61a2,2,0,0,1-1.94,2.5Zm-29.06-4H56.07L42.83,39.32Z"/><path d="M106.82,128c-17.74,0-26.43-13-26.43-36.52S89.09,55,106.82,55a21.78,21.78,0,0,1,15.83,6.43L134,56.22V112c0,5.22,1.56,8,4.7,8a7.31,7.31,0,0,0,3.65-1v6.61A17.77,17.77,0,0,1,133.6,128a9.61,9.61,0,0,1-9.74-7.65A22.4,22.4,0,0,1,106.82,128Zm0-10.09a18.15,18.15,0,0,0,16.69-10.61V75.7a18.15,18.15,0,0,0-16.69-10.61c-11.3,0-16,9.56-16,26.43S95.52,118,106.82,118Z"/><path d="M133.6,130A11.61,11.61,0,0,1,123.08,124,24.48,24.48,0,0,1,106.82,130c-13,0-28.43-6.68-28.43-38.52S93.85,53,106.82,53A23.88,23.88,0,0,1,123,59.05l10.08-4.65A2,2,0,0,1,136,56.22V112c0,4,.91,6,2.7,6a5.3,5.3,0,0,0,2.66-.78,2,2,0,0,1,3,1.74v6.61a2,2,0,0,1-1,1.74A19.64,19.64,0,0,1,133.6,130Zm-9.74-11.65a2,2,0,0,1,1.95,1.55,7.63,7.63,0,0,0,7.79,6.1,15.19,15.19,0,0,0,6.69-1.64v-2.52a8.51,8.51,0,0,1-1.65.16c-2.5,0-6.7-1.3-6.7-10V59.34l-8.46,3.91a2,2,0,0,1-2.25-.4A19.67,19.67,0,0,0,106.82,57C90.61,57,82.39,68.62,82.39,91.52S90.61,126,106.82,126a20.33,20.33,0,0,0,15.55-7A2,2,0,0,1,123.86,118.39Zm-17,1.57c-11.94,0-18-9.57-18-28.43s6.06-28.43,18-28.43a20.07,20.07,0,0,1,18.5,11.75,2,2,0,0,1,.19.86v31.65a2,2,0,0,1-.19.86A20.06,20.06,0,0,1,106.82,120Zm0-52.86c-12.55,0-14,13.94-14,24.43,0,21.9,8,24.43,14,24.43a16.13,16.13,0,0,0,14.69-9.07V76.16A16.13,16.13,0,0,0,106.82,67.09Z"/></g></svg>',i.style.padding="0 3px 0 0",this.lyricsSvg=i.querySelector("svg"),this.lyricsSvg.style.width="14px",this.lyricsWrapper=document.createElement("div"),this.lyricsWrapper.style.width="90px",this.lyricsWrapper.style.maxWidth="90px",this.lyricsWrapper.appendChild(this.lyricsNameDiv),this.lyricsWrapper.appendChild(this.lyricsArtistDiv),this.lyricsAnchor=document.createElement("a"),this.lyricsAnchor.className="lyrics",this.lyricsAnchor.target="_blank",this.lyricsAnchor.style.display="flex",this.lyricsAnchor.style.lineHeight="1.2em",this.lyricsAnchor.style.padding="4px 3px 3px 3px",this.lyricsAnchor.style.textDecoration="none",this.lyricsAnchor.appendChild(i),this.lyricsAnchor.appendChild(this.lyricsWrapper),this.bannerDiv=document.createElement("div"),this.bannerDiv.className="textalive-banner",this.bannerDiv.style.cursor="pointer",this.bannerDiv.style.zIndex="10000",this.bannerDiv.style.background="#1f4391",this.bannerDiv.style.lineHeight="0",this.bannerDiv.style.display="flex",this.bannerDiv.style.maxWidth="256px",this.bannerDiv.style.fontFamily="'Hiragino Kaku Gothic Pro','游ゴシック体','Yu Gothic',YuGothic,Meiryo,HelveticaNeue,'Helvetica Neue',Helvetica,Arial,sans-serif",this.bannerDiv.style.fontSize="9px",this.bannerDiv.style.alignItems="center",this.bannerDiv.style.whiteSpace="nowrap",this.bannerDiv.appendChild(this.logoAnchor),this.bannerDiv.appendChild(this.songAnchor),this.bannerDiv.appendChild(this.lyricsAnchor),this.songAnchor.style.display="none",this.lyricsAnchor.style.display="none",this.updatePosition(),this.updateRounded(),this.updateBordered(),this.updateShadowed(),this.updateBackground(),this.updateColor()}this.listener={onAppReady:function(){r.updatePosition()},onMediaElementSet:function(t){r.domEnabled&&(r.bannerDiv&&r.bannerDiv.parentElement&&r.bannerDiv.parentElement.removeChild(r.bannerDiv),r.player.mediaBannerElement&&r.player.mediaBannerElement.appendChild(r.bannerDiv))},onVideoLoad:function(){r.domEnabled&&(r.logoAnchor.href=Ay,r.songAnchor.style.display="none",r.lyricsAnchor.style.display="none",r.songAnchor.style.borderRadius="0")},onSongLoad:function(t){var e,n,i,o;if(t){var a=null===(n=null===(e=null==t?void 0:t.song)||void 0===e?void 0:e.artist)||void 0===n?void 0:n.name,s=null===(i=null==t?void 0:t.song)||void 0===i?void 0:i.name,u=null===(o=null==t?void 0:t.song)||void 0===o?void 0:o.permalink,l=Ay+(u?"/songs/"+encodeURIComponent(Km.getSongPathFromUrl(u)):"");r.domEnabled&&(r.logoAnchor.href=l,r.songArtistDiv.textContent=My(a),r.songNameDiv.textContent=My(s),r.songAnchor.title=My(s)+" by "+My(a),r.songAnchor.href=u,r.songAnchor.style.display="flex",r.songAnchor.style.borderRadius=r.rounded?"0 4px 4px 0":"0",r.songWrapper.style.width="auto"),console.warn("[TextAlive API] 楽曲 アーティスト:",My(a),"/ 楽曲名:",My(s),"/ 配信元サイト:",u)}},onLyricsLoad:function(t){t&&(r.songWrapper.style.maxWidth="90px",r.lyricsAnchor.style.display="flex",r.songAnchor.style.borderRadius="0")},onTextLoad:function(t){var e;if(t){var n=null===(e=null==t?void 0:t.artist)||void 0===e?void 0:e.name,i=null==t?void 0:t.name,o=null==t?void 0:t.url;r.domEnabled&&(r.lyricsArtistDiv.textContent=My(n),r.lyricsNameDiv.textContent=My(i),r.lyricsAnchor.title=My(i)+" by "+My(n),r.lyricsAnchor.href=o,r.lyricsWrapper.style.width="auto"),console.warn("[TextAlive API] 歌詞 アーティスト:",My(n),"/ 歌詞名:",My(i),"/ 配信元サイト:",o)}},onDispose:function(){this.dispose()}},t.addListener(this.listener),t.mediaBannerElement&&this.player.mediaBannerElement.appendChild(this.bannerDiv)}return Object.defineProperty(t.prototype,"domEnabled",{get:function(){return"undefined"!=typeof window},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.updatePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rounded",{get:function(){return this._rounded},set:function(t){this._rounded=t,this.updateRounded()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bordered",{get:function(){return this._bordered},set:function(t){this._bordered=t,this.updateBordered()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowed",{get:function(){return this._shadowed},set:function(t){this._shadowed=t,this.updateShadowed()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(t){this._background=t,this.updateBackground()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.updateColor()},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.player.removeListener(this.listener)},t.prototype.updatePosition=function(){var t,e;if(this.domEnabled){var r=this.position,n=this.player;if(null===r||!(null===(t=n.options)||void 0===t?void 0:t.app)||(null===(e=n.app)||void 0===e?void 0:e.managed))this.bannerDiv.style.display="none";else if(this.bannerDiv.style.display="flex","embed"===r)this.bannerDiv.style.position="initial",this.bannerDiv.style.marginTop="4px",this.songAnchor.style.flexGrow="1",this.lyricsAnchor.style.flexGrow="1";else{this.bannerDiv.style.position="fixed",this.bannerDiv.style.marginTop="0";var i=r.indexOf("top")>=0,o=r.indexOf("right")>=0,a=r.indexOf("bottom")>=0,s=r.indexOf("left")>=0;this.bannerDiv.style.top=i?"4px":"initial",this.bannerDiv.style.right=o?"4px":"initial",this.bannerDiv.style.bottom=a?"4px":"initial",this.bannerDiv.style.left=s?"4px":"initial",this.songAnchor.style.flexGrow="0",this.lyricsAnchor.style.flexGrow="0"}}},t.prototype.updateRounded=function(){if(this.domEnabled){var t=this.rounded;this.logoSvg.style.borderRadius=t?"4px 0 0 4px":"0",this.lyricsAnchor.style.borderRadius=t?"0 4px 4px 0":"0",this.bannerDiv.style.borderRadius=t?"4px":"0"}},t.prototype.updateBordered=function(){if(this.domEnabled){var t=this.bordered;this.logoAnchor.style.padding=t?"1px 2px":"1px 3px",this.bannerDiv.style.border=t?"1px solid rgba(31, 67, 145, 0.3)":"none"}},t.prototype.updateShadowed=function(){if(this.domEnabled){var t=this.shadowed;this.bannerDiv.style.boxShadow=t?"1px 1px 3px 0 rgba(9, 19, 42, 0.9)":"none"}},t.prototype.updateBackground=function(){this.domEnabled&&(this.songAnchor.style.background=this.background,this.lyricsAnchor.style.background=this.background)},t.prototype.updateColor=function(){this.domEnabled&&(this.songSvg.style.fill=this.color,this.songAnchor.style.color=this.color,this.lyricsSvg.style.fill=this.color,this.lyricsAnchor.style.color=this.color)},t}();function My(t){return t&&""!==t?t:"-"}function Iy(t,e){var r=e.parser;return ev(this,void 0,void 0,(function(){var e,n,i;return rv(this,(function(o){switch(o.label){case 0:return t&&t.length>0&&t[0].words&&t[0].words.length>0&&t[0].words[0]&&!t[0].words[0].pos?(e=t.map((function(t){return t.words.map((function(t){return t.characters.map((function(t){return t.char})).join("")})).join(" ")})),n=e.join("\n"),[4,r(n)]):[2];case 1:return(i=o.sent())&&"success"===i.status?(t.forEach((function(t,r){var n=i.result[r],o=0;t.words.forEach((function(t){var i=t.characters.map((function(t){return t.char})).join(""),a=e[r].indexOf(i,o);if(!(a<0)){o=a;var s=n.find((function(t){return t.startPosition<=a&&t.endPosition>=a}));s&&(t.pos=s.PoS,t.rawPoS=s.rawPoS,t.language=s.language)}}))})),[2]):[2]}}))}))}function Oy(t){for(;t.firstElementChild;)t.removeChild(t.firstElementChild)}function Cy(t,e){var r=e.id,n=e.data,i=e.loader,o=e.deserializer;return ev(this,void 0,void 0,(function(){return rv(this,(function(e){switch(e.label){case 0:return r&&r>=0?[4,i(r)]:[3,2];case 1:e.sent(),e.label=2;case 2:return o(t,n),[2]}}))}))}function Ry(t){return"string"!=typeof t?t:"undefined"==typeof window?null:document.querySelector(t)}var Ly=function(){function t(t){this._mediaPosition=0,this._videoPosition=0,this.isEditing=!1,this._isVideoSeeking=!1,this._volume=100,this._options=t,this.emitter=new lv(t),this._templates=new _y(this,this.emitter,t&&t.unsafeAcceleration);var e=Object.assign({},Mg);t&&t.managers&&(e=Object.assign(e,t.managers)),this.managers=e,this._timer=t&&t.timer||this.createDefaultTimer(),this._data=new Av(e,this.emitter,t),this._backgroundGraphics=new cv(this,e.asset,this.emitter),this._graphics=t&&t.graphics||this.createDefaultGraphicsDriver(),this.stage=new Ey(this,{onStageUpdate:this.onStageUpdate.bind(this)}),this._banner=new Py(this),this.stageElement=Ry(null==t?void 0:t.stageElement)||null,this.mediaElement=Ry(null==t?void 0:t.mediaElement)||null,this._app=new Pv(this,this.emitter)}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?tv({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"app",{get:function(){return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundGraphics",{get:function(){return this._backgroundGraphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageElement",{get:function(){return this._stageElement},set:function(t){this._stageElement=t,this.emitter.onStageElementSet(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageScale",{get:function(){return this.stage.scale},set:function(t){this.stage.scale=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaElement",{get:function(){return this._mediaElement},set:function(t){this.updateMediaElement(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaSourceElement",{get:function(){return this._mediaSourceElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaBannerElement",{get:function(){return this._mediaBannerElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaPosition",{get:function(){return this._mediaPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoPosition",{get:function(){return this._videoPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wait",{get:function(){return this._timer?this._timer.wait:0},set:function(t){this._timer&&(this._timer.wait=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return 1e3/this.wait},set:function(t){this.wait=1e3/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionWidth",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.width?this._data.video.config.width:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.width)?this._options.defaultVideoSize.width:1280},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionHeight",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.height?this._data.video.config.height:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.height)?this._options.defaultVideoSize.height:720},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionProportion",{get:function(){return this.resolutionHeight/this.resolutionWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&this._data.video.config.margin?this._data.video.config.margin:(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.margin)||ov},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoWidth",{get:function(){var t=this.resolutionWidth,e=this.margin;return t+e[1]+e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){var t=this.resolutionHeight,e=this.margin;return t+e[0]+e[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoProportion",{get:function(){return this.videoHeight/this.videoWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.stage.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.stage.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return!!this._videoPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._timer&&this._timer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVideoSeeking",{get:function(){return this._isVideoSeeking},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this._banner},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timer",{get:function(){return this._timer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){isNaN(t)||(this._volume=Math.min(100,Math.max(0,t)),this.emitter.onVolumeUpdate(this._volume))},enumerable:!1,configurable:!0}),t.prototype.createDefaultTimer=function(){try{if("undefined"!=typeof window&&"basic"!==Zg("ta_timer"))return new uv}catch(t){}return new av},t.prototype.createDefaultGraphicsDriver=function(){return new qg},t.prototype.addListener=function(t){return this.emitter.addListener(t)},t.prototype.removeListener=function(t){return this.emitter.removeListener(t)},t.prototype.createFromVideoId=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromVideoId(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromVideoId=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromVideoId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromVideo=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromVideo(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromVideo=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){return(r=new Av(this.managers,this.emitter,this._options)).createFromVideo(t,null==e?void 0:e.video),[2,this.finalize(r,e)]}))}))},t.prototype.createFromSongUrl=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongUrl(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongUrl=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromSongUrl(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongPath=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongPath(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongPath=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromSongPath(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongId=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongId(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongId=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromSongId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongCode=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongCode(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongCode=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromSongCode(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromText=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromText(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromText=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromText(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromJSON=function(t,e){return ev(this,void 0,void 0,(function(){var r=this;return rv(this,(function(n){return[2,this.create((function(){return r.doCreateFromJSON(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromJSON=function(t,e){return ev(this,void 0,void 0,(function(){var r;return rv(this,(function(n){switch(n.label){case 0:return[4,(r=new Av(this.managers,this.emitter,this._options)).createFromJSON(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.create=function(t,e){return ev(this,void 0,void 0,(function(){var r,n=this;return rv(this,(function(i){if(this._videoPromise&&!e)throw new wy("Player.createFrom* method calls cannot run in parallel",this._videoPromise);return r=t(),e||(this._videoPromise=r,r.finally((function(){return n._videoPromise=null}))),[2,r]}))}))},t.prototype.finalize=function(t,e){return ev(this,void 0,void 0,(function(){var r,n,i,o=this;return rv(this,(function(a){switch(a.label){case 0:return t.video?[4,Promise.all([t.finalize(e),this.backgroundGraphics.setBackground(t.video.background)])]:[2,null];case 1:return a.sent(),(null==e?void 0:e.dryRun)?[2,null]:(r=t.video.json,s=n=new Hg(r),u={config:t.video.config,song:t.song},c=u.song,(l=u.config)&&"object"==typeof l&&"number"==typeof l.duration?s.duration=l.duration:c?s.duration=1e3*c.length:s.duration||(s.duration=s.endTime),[4,Promise.all([this.graphics.createRuntime(n),Cy(n,{id:t.video.id,data:r,loader:function(t){return ev(o,void 0,void 0,(function(){return rv(this,(function(e){switch(e.label){case 0:return[4,this.templates.loadForVideo(t)];case 1:return e.sent(),[2]}}))}))},deserializer:function(t,e){return o.templates.importInstances(t,e)}}),Iy(null==r?void 0:r.phrases,{parser:fg.parse.bind(fg)})])]);case 2:return a.sent(),this._data,this._video&&this.templates.disposeInstances(this._video),this._data=t,this._video=n,this.emitter.onVideoReady(n),i=(null==e?void 0:e.altSourceUrl)||void 0,[4,this._timer.initialize({player:this,updater:this.updateMediaPosition.bind(this),emitter:this.emitter,altSourceUrl:i})];case 3:return a.sent(),this.emitter.onTimerReady(this._timer),[2,n]}var s,u,l,c}))}))},t.prototype.updateMediaPosition=function(t){return ev(this,void 0,void 0,(function(){var e=this;return rv(this,(function(r){return this._isVideoSeeking?(this._mediaPosition=t,this.emitter.onMediaSeek(t),[2,t]):[2,this.stage.requestUpdate(t).then((function(t){return e._mediaPosition=t,e._videoPosition=t,e.emitter.onMediaSeek(t),t}))]}))}))},t.prototype.exportVideo=function(t){return void 0===t&&(t={legacyStringMode:!0}),ev(this,void 0,void 0,(function(){var e,r,n,i;return rv(this,(function(o){return e={sourceId:this._data.video.id,sourceOriginId:this._data.video.sourceOriginId,songleId:this._data.song.id,lyricId:this._data.lyricsId,lyricDiffId:this._data.lyrics?this._data.lyrics.id:-1,config:((null==t?void 0:t.legacyStringMode)?this._data.video.config&&JSON.stringify(this._data.video.config):this._data.video.config)||null},r=this.backgroundGraphics.exportPartialVideoEntry(t),n=this._video.exportData(this._templates),i=(null==t?void 0:t.legacyStringMode)?JSON.stringify(n):n,[2,tv(tv(tv({},e),r),{json:i})]}))}))},t.prototype.getChoruses=function(){return this._data.getChoruses()},t.prototype.findChorus=function(t,e){return this._data.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){return this._data.findChorusBetween(t,e)},t.prototype.getBeats=function(){return this._data.getBeats()},t.prototype.findBeat=function(t,e){return this._data.findBeat(t,e)},t.prototype.getChords=function(){return this._data.getChords()},t.prototype.findChord=function(t,e){return this._data.findChord(t,e)},t.prototype.getVocalFrequency=function(t){return this._data.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){return this._data.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){return this._data.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){return this._data.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){return this._data.getMedianValenceArousal()},t.prototype.resize=function(t){return this.emitter.onResize(t)},t.prototype.onResize=function(t){return this.resize(t)},t.prototype.setStageElement=function(t){return this._stageElement=t,this.emitter.onStageElementSet(t)},t.prototype.setMediaElement=function(t){this.mediaElement=t},t.prototype.updateMediaElement=function(t){"undefined"!=typeof document&&(this._mediaElement&&Oy(this._mediaElement),t?(Oy(t),this._mediaSourceElement||(this._mediaSourceElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-media-wrapper")),t.appendChild(this._mediaSourceElement),this._mediaBannerElement||(this._mediaBannerElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-banner-wrapper")),t.appendChild(this._mediaBannerElement)):(this._mediaSourceElement=null,this._mediaBannerElement=null)),this._mediaElement=t,this.emitter.onMediaElementSet(t)},t.prototype.setVideoPosition=function(t){return ev(this,void 0,void 0,(function(){var e=this;return rv(this,(function(r){return[2,this.stage.requestUpdate(t).then((function(t){return e._videoPosition=t,e.emitter.onVideoSeek(t),t}))]}))}))},t.prototype.setMediaPosition=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return this.requestMediaSeek(t),[2]}))}))},t.prototype.requestPlay=function(){return this._timer.play(),!0},t.prototype.requestStop=function(){return this._timer.stop(),!0},t.prototype.requestPause=function(){return this._timer.pause(),!0},t.prototype.requestMediaSeek=function(t){return this._timer.seek(t),!0},t.prototype.startVideoSeek=function(){return this._isVideoSeeking=!0,this.emitter.onVideoSeekStart()},t.prototype.endVideoSeek=function(){return this._isVideoSeeking=!1,this.emitter.onVideoSeekEnd()},t.prototype.requestSettingBackground=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return[2,this.backgroundGraphics.settingBackground(t)]}))}))},t.prototype.requestSetBackground=function(t){return ev(this,void 0,void 0,(function(){return rv(this,(function(e){return[2,this.backgroundGraphics.setBackground(t)]}))}))},t.prototype.requestStageUpdate=function(){return ev(this,void 0,void 0,(function(){return rv(this,(function(t){return[2,this.stage.requestUpdate()]}))}))},t.prototype.onStageUpdate=function(t){this._isVideoSeeking||this.emitter.onTimeUpdate(t)},t.prototype.dispose=function(){this._timer&&(this._timer.dispose(),this._timer=null),this.mediaElement&&(Oy(this._mediaElement),this._mediaElement=null),this.stageElement&&(this._stageElement=null),this.emitter.onDispose()},t}();console.log("# ライセンス表記に関するガイドライン\n\n国立研究開発法人産業技術総合研究所\n人間情報インタラクション研究部門\nメディアインタラクション研究グループ\n\nTextAlive App APIは非商用利用に限り、どなたでも無料・無保証で利用することができます。\nただし、原則としてTextAlive App APIを利用している旨を TextAlive https://textalive.jp/ サイト内楽曲ページまたは https://developer.textalive.jp/ にハイパーリンクした上で、利用しているシステムもしくは外部サイト等に表示する必要があります。\n\n# お問い合わせ\n\ntextalive-ml@aist.go.jp");const Ny=new class{constructor(){Sf.manager.subscribe((t=>{this.manager=t})).bind(this)}play(){this.manager.playVideo()}pause(){this.manager.pauseVideo()}stop(){this.manager.stopVideo()}cue(){this.manager.cueVideo()}};class Fy{constructor(t,e,r,{beatHandler:n,chorusHandler:i,vocalAmplitudeHandler:o},a){this.maxVocalAmplitude=65535;const s=new Ly({app:{appAuthor:"nolze",appName:"mmmapper"},mediaElement:t,vocalAmplitudeEnabled:!0});this.player=s,(n||i||o)&&s.addListener({onTimeUpdate:t=>{if(n){const e=s.findBeat(t);if(!e)return;n(t,e)}if(o){const e=s.getVocalAmplitude(t)/(this.maxVocalAmplitude+1e-9);if(!e)return;o(t,e)}},onThrottledTimeUpdate:t=>{if(i){const e=s.findChorus(t);i(t,!!e)}}}),s.addListener({onAppReady:t=>{t.managed||this.showControls(),t.songUrl||(a=a||"https://www.youtube.com/watch?v=ygY2qObZv24",s.createFromSongUrl(a))},onVideoReady:t=>{let n=s.video.firstWord;const i=()=>{n.animate=e,n=n.next,n&&setTimeout(i,0)};i();let o=s.video.firstChar;const a=()=>{o.animate=r,o=o.next,o&&setTimeout(a,0)};a(),this.maxVocalAmplitude=this.player.getMaxVocalAmplitude()},onSongLoad:t=>{console.log({song:t})},onSongMapLoad:t=>{console.log({songMap:t})},onValenceArousalLoad:t=>{console.log({valenceArousal:t})},onVocalAmplitudeLoad:t=>{},onLyricsLoad:t=>{},onTextLoad:t=>{},onFontsLoad:t=>{},onVideoLoad:t=>{}})}showControls(){}dispose(){try{this.player.dispose()}catch(t){}this.player=null}playVideo(){this.player.timer&&this.player.requestPlay()}pauseVideo(){this.player.timer&&this.player.requestPause()}stopVideo(){this.player.timer&&this.player.requestStop()}cueVideo(){this.player.timer&&this.player.video&&this.player.requestMediaSeek(this.player.video.firstChar.startTime)}}function Dy(e){let r,n,i,o,a;return{c(){r=g("button"),n=v("svg"),i=v("path"),w(i,"fill","#ffffff"),w(i,"d","M13,16V8H15V16H13M9,16V8H11V16H9M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"),E(n,"width","24px"),E(n,"height","24px"),w(n,"viewBox","0 0 24 24")},m(t,s){d(t,r,s),p(r,n),p(n,i),o||(a=_(r,"click",e[14]),o=!0)},p:t,d(t){t&&f(r),o=!1,a()}}}function Uy(t){let e,r,n,i;return{c(){e=g("button"),r=v("svg"),n=v("path"),w(n,"fill","#ffffff"),w(n,"d",i=t[3].icons[t[3].index]),E(r,"width","24px"),E(r,"height","24px"),w(r,"viewBox","0 0 24 24")},m(t,i){d(t,e,i),p(e,r),p(r,n)},p(t,e){8&e&&i!==(i=t[3].icons[t[3].index])&&w(n,"d",i)},d(t){t&&f(e)}}}function ky(e){let r,n,i,o,a;return{c(){r=g("button"),n=v("svg"),i=v("path"),w(i,"fill","#ffffff"),w(i,"d","M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,16.5L16,12L10,7.5V16.5Z"),E(n,"width","24px"),E(n,"height","24px"),w(n,"viewBox","0 0 24 24")},m(t,s){d(t,r,s),p(r,n),p(n,i),o||(a=_(r,"click",e[13]),o=!0)},p:t,d(t){t&&f(r),o=!1,a()}}}function jy(e){let r,n;function i(t,e){return t[1]||t[0]?!t[1]&&t[0]?Uy:Dy:ky}let o=i(e),a=o(e);return{c(){a.c(),r=x(),n=g("div"),E(n,"position","fixed"),E(n,"bottom","20px"),E(n,"right","20px"),w(n,"id","media")},m(t,i){a.m(t,i),d(t,r,i),d(t,n,i),e[15](n)},p(t,[e]){o===(o=i(t))&&a?a.p(t,e):(a.d(1),a=o(t),a&&(a.c(),a.m(r.parentNode,r)))},i:t,o:t,d(t){a.d(t),t&&f(r),t&&f(n),e[15](null)}}}function By(t,e,r){let n,{songSelected:i=!1}=e,{animateWord:o}=e,{animateChar:a}=e,{handlers:s={}}=e,{songUrl:u}=e,l=u,c=!1,h=!1,p=!1,d=null;const f={icons:["M12 2C17.5 2 22 6.5 22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4M12 5C13.93 5 15.68 5.78 16.95 7.05L12 12V5Z","M12 2C17.5 2 22 6.5 22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4M12 5C15.87 5 19 8.13 19 12C19 13.93 18.22 15.68 16.95 16.95L12 12V5Z","M12 2C17.5 2 22 6.5 22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4M12 5C15.87 5 19 8.13 19 12C19 15.87 15.87 19 12 19C10.07 19 8.32 18.22 7.05 16.95L12 12V5Z","M12 2C17.5 2 22 6.5 22 12C22 17.5 17.5 22 12 22C6.5 22 2 17.5 2 12C2 6.5 6.5 2 12 2M12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4M12 5C15.87 5 19 8.13 19 12C19 15.87 15.87 19 12 19C8.13 19 5 15.87 5 12C5 10.07 5.78 8.32 7.05 7.05L12 12V5Z"],index:0,timer:null};function m(){h||(r(0,c=!0),r(3,f.timer=setInterval((()=>{r(3,f.index=(f.index+1)%f.icons.length,f)}),1e3),f)),d?g():(r(12,d=new Fy(n,o,a,s,u)),Sf.manager.set(d),d.player.addListener({onTimerReady:t=>{r(0,c=!1),clearInterval(f.timer),r(3,f.index=0,f),r(11,h=!0)},onStop:()=>{Ny.stop(),r(1,p=!1)}}))}function g(){Ny.play(),r(1,p=!0),r(5,i=!0)}Sf.manager.subscribe((t=>{r(12,d=t)}));return t.$$set=t=>{"songSelected"in t&&r(5,i=t.songSelected),"animateWord"in t&&r(6,o=t.animateWord),"animateChar"in t&&r(7,a=t.animateChar),"handlers"in t&&r(8,s=t.handlers),"songUrl"in t&&r(9,u=t.songUrl)},t.$$.update=()=>{7680&t.$$.dirty&&h&&l!==u&&(Ny.stop(),r(0,c=r(11,h=r(1,p=!1))),d.dispose(),r(12,d=null),r(10,l=u),m()),2048&t.$$.dirty&&h&&g()},[c,p,n,f,m,i,o,a,s,u,l,h,d,()=>{m()},()=>{Ny.pause(),r(1,p=!1)},function(t){R[t?"unshift":"push"]((()=>{n=t,r(2,n)}))}]}class zy extends et{constructor(t){super(),tt(this,t,By,jy,o,{songSelected:5,animateWord:6,animateChar:7,handlers:8,songUrl:9})}}function Gy(t){let e,r,i,o,a,s,u,l,c,h,m,y,b,T,S;return r=new zy({props:{animateWord:t[0],animateChar:t[1],handlers:t[2],songUrl:t[3]}}),{c(){e=g("div"),Q(r.$$.fragment),i=x(),o=g("div"),a=g("button"),s=v("svg"),u=v("path"),l=x(),c=g("div"),h=g("button"),m=v("svg"),y=v("path"),w(e,"class","flex items-center"),w(u,"fill","#ffffff"),w(u,"d","M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M8,8V16L13,12M14,8V16H16V8"),E(s,"width","24px"),E(s,"height","24px"),w(s,"viewBox","0 0 24 24"),w(o,"class","flex items-center ml-1"),w(y,"fill","#ffffff"),w(y,"d","M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4M9,9V15H15V9"),E(m,"width","24px"),E(m,"height","24px"),w(m,"viewBox","0 0 24 24"),w(c,"class","flex items-center ml-1")},m(n,f){d(n,e,f),Z(r,e,null),d(n,i,f),d(n,o,f),p(o,a),p(a,s),p(s,u),d(n,l,f),d(n,c,f),p(c,h),p(h,m),p(m,y),b=!0,T||(S=[_(a,"click",t[4]),_(h,"click",t[5])],T=!0)},p(t,[e]){const n={};1&e&&(n.animateWord=t[0]),2&e&&(n.animateChar=t[1]),4&e&&(n.handlers=t[2]),8&e&&(n.songUrl=t[3]),r.$set(n)},i(t){b||(Y(r.$$.fragment,t),b=!0)},o(t){q(r.$$.fragment,t),b=!1},d(t){t&&f(e),J(r),t&&f(i),t&&f(o),t&&f(l),t&&f(c),T=!1,n(S)}}}function Vy(t,e,r){let{animateWord:n}=e,{animateChar:i}=e,{handlers:o}=e,{songUrl:a}=e;return t.$$set=t=>{"animateWord"in t&&r(0,n=t.animateWord),"animateChar"in t&&r(1,i=t.animateChar),"handlers"in t&&r(2,o=t.handlers),"songUrl"in t&&r(3,a=t.songUrl)},[n,i,o,a,()=>{Ny.cue()},()=>{Ny.stop()}]}class Hy extends et{constructor(t){super(),tt(this,t,Vy,Gy,o,{animateWord:0,animateChar:1,handlers:2,songUrl:3})}}var Xy={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},Wy={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},Yy=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],qy={CSS:{},springs:{}};function $y(t,e,r){return Math.min(Math.max(t,e),r)}function Qy(t,e){return t.indexOf(e)>-1}function Zy(t,e){return t.apply(null,e)}var Jy={arr:function(t){return Array.isArray(t)},obj:function(t){return Qy(Object.prototype.toString.call(t),"Object")},pth:function(t){return Jy.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return t.nodeType||Jy.svg(t)},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return void 0===t},nil:function(t){return Jy.und(t)||null===t},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Jy.hex(t)||Jy.rgb(t)||Jy.hsl(t)},key:function(t){return!Xy.hasOwnProperty(t)&&!Wy.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function Ky(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map((function(t){return parseFloat(t)})):[]}function tx(t,e){var r=Ky(t),n=$y(Jy.und(r[0])?1:r[0],.1,100),i=$y(Jy.und(r[1])?100:r[1],.1,100),o=$y(Jy.und(r[2])?10:r[2],.1,100),a=$y(Jy.und(r[3])?0:r[3],.1,100),s=Math.sqrt(i/n),u=o/(2*Math.sqrt(i*n)),l=u<1?s*Math.sqrt(1-u*u):0,c=u<1?(u*s-a)/l:-a+s;function h(t){var r=e?e*t/1e3:t;return r=u<1?Math.exp(-r*u*s)*(1*Math.cos(l*r)+c*Math.sin(l*r)):(1+c*r)*Math.exp(-r*s),0===t||1===t?t:1-r}return e?h:function(){var e=qy.springs[t];if(e)return e;for(var r=1/6,n=0,i=0;;)if(1===h(n+=r)){if(++i>=16)break}else i=0;var o=n*r*1e3;return qy.springs[t]=o,o}}function ex(t){return void 0===t&&(t=10),function(e){return Math.ceil($y(e,1e-6,1)*t)*(1/t)}}var rx,nx,ix=function(){var t=.1;function e(t,e){return 1-3*e+3*t}function r(t,e){return 3*e-6*t}function n(t){return 3*t}function i(t,i,o){return((e(i,o)*t+r(i,o))*t+n(i))*t}function o(t,i,o){return 3*e(i,o)*t*t+2*r(i,o)*t+n(i)}return function(e,r,n,a){if(0<=e&&e<=1&&0<=n&&n<=1){var s=new Float32Array(11);if(e!==r||n!==a)for(var u=0;u<11;++u)s[u]=i(u*t,e,n);return function(t){return e===r&&n===a||0===t||1===t?t:i(l(t),r,a)}}function l(r){for(var a=0,u=1;10!==u&&s[u]<=r;++u)a+=t;--u;var l=a+(r-s[u])/(s[u+1]-s[u])*t,c=o(l,e,n);return c>=.001?function(t,e,r,n){for(var a=0;a<4;++a){var s=o(e,r,n);if(0===s)return e;e-=(i(e,r,n)-t)/s}return e}(r,l,e,n):0===c?l:function(t,e,r,n,o){var a,s,u=0;do{(a=i(s=e+(r-e)/2,n,o)-t)>0?r=s:e=s}while(Math.abs(a)>1e-7&&++u<10);return s}(r,a,a+t,e,n)}}}(),ox=(rx={linear:function(){return function(t){return t}}},nx={Sine:function(){return function(t){return 1-Math.cos(t*Math.PI/2)}},Circ:function(){return function(t){return 1-Math.sqrt(1-t*t)}},Back:function(){return function(t){return t*t*(3*t-2)}},Bounce:function(){return function(t){for(var e,r=4;t<((e=Math.pow(2,--r))-1)/11;);return 1/Math.pow(4,3-r)-7.5625*Math.pow((3*e-2)/22-t,2)}},Elastic:function(t,e){void 0===t&&(t=1),void 0===e&&(e=.5);var r=$y(t,1,10),n=$y(e,.1,2);return function(t){return 0===t||1===t?t:-r*Math.pow(2,10*(t-1))*Math.sin((t-1-n/(2*Math.PI)*Math.asin(1/r))*(2*Math.PI)/n)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach((function(t,e){nx[t]=function(){return function(t){return Math.pow(t,e+2)}}})),Object.keys(nx).forEach((function(t){var e=nx[t];rx["easeIn"+t]=e,rx["easeOut"+t]=function(t,r){return function(n){return 1-e(t,r)(1-n)}},rx["easeInOut"+t]=function(t,r){return function(n){return n<.5?e(t,r)(2*n)/2:1-e(t,r)(-2*n+2)/2}},rx["easeOutIn"+t]=function(t,r){return function(n){return n<.5?(1-e(t,r)(1-2*n))/2:(e(t,r)(2*n-1)+1)/2}}})),rx);function ax(t,e){if(Jy.fnc(t))return t;var r=t.split("(")[0],n=ox[r],i=Ky(t);switch(r){case"spring":return tx(t,e);case"cubicBezier":return Zy(ix,i);case"steps":return Zy(ex,i);default:return Zy(n,i)}}function sx(t){try{return document.querySelectorAll(t)}catch(t){return}}function ux(t,e){for(var r=t.length,n=arguments.length>=2?arguments[1]:void 0,i=[],o=0;o<r;o++)if(o in t){var a=t[o];e.call(n,a,o,t)&&i.push(a)}return i}function lx(t){return t.reduce((function(t,e){return t.concat(Jy.arr(e)?lx(e):e)}),[])}function cx(t){return Jy.arr(t)?t:(Jy.str(t)&&(t=sx(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function hx(t,e){return t.some((function(t){return t===e}))}function px(t){var e={};for(var r in t)e[r]=t[r];return e}function dx(t,e){var r=px(t);for(var n in t)r[n]=e.hasOwnProperty(n)?e[n]:t[n];return r}function fx(t,e){var r=px(t);for(var n in e)r[n]=Jy.und(t[n])?e[n]:t[n];return r}function mx(t){return Jy.rgb(t)?(r=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e=t))?"rgba("+r[1]+",1)":e:Jy.hex(t)?function(t){var e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,r,n){return e+e+r+r+n+n})),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+",1)"}(t):Jy.hsl(t)?function(t){var e,r,n,i=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),o=parseInt(i[1],10)/360,a=parseInt(i[2],10)/100,s=parseInt(i[3],10)/100,u=i[4]||1;function l(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}if(0==a)e=r=n=s;else{var c=s<.5?s*(1+a):s+a-s*a,h=2*s-c;e=l(h,c,o+1/3),r=l(h,c,o),n=l(h,c,o-1/3)}return"rgba("+255*e+","+255*r+","+255*n+","+u+")"}(t):void 0;var e,r}function gx(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function vx(t,e){return Jy.fnc(t)?t(e.target,e.id,e.total):t}function yx(t,e){return t.getAttribute(e)}function xx(t,e,r){if(hx([r,"deg","rad","turn"],gx(e)))return e;var n=qy.CSS[e+r];if(!Jy.und(n))return n;var i=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(i),i.style.position="absolute",i.style.width=100+r;var a=100/i.offsetWidth;o.removeChild(i);var s=a*parseFloat(e);return qy.CSS[e+r]=s,s}function bx(t,e,r){if(e in t.style){var n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=t.style[e]||getComputedStyle(t).getPropertyValue(n)||"0";return r?xx(t,i,r):i}}function _x(t,e){return Jy.dom(t)&&!Jy.inp(t)&&(!Jy.nil(yx(t,e))||Jy.svg(t)&&t[e])?"attribute":Jy.dom(t)&&hx(Yy,e)?"transform":Jy.dom(t)&&"transform"!==e&&bx(t,e)?"css":null!=t[e]?"object":void 0}function wx(t){if(Jy.dom(t)){for(var e,r=t.style.transform||"",n=/(\w+)\(([^)]*)\)/g,i=new Map;e=n.exec(r);)i.set(e[1],e[2]);return i}}function Tx(t,e,r,n){var i=Qy(e,"scale")?1:0+function(t){return Qy(t,"translate")||"perspective"===t?"px":Qy(t,"rotate")||Qy(t,"skew")?"deg":void 0}(e),o=wx(t).get(e)||i;return r&&(r.transforms.list.set(e,o),r.transforms.last=e),n?xx(t,o,n):o}function Ex(t,e,r,n){switch(_x(t,e)){case"transform":return Tx(t,e,n,r);case"css":return bx(t,e,r);case"attribute":return yx(t,e);default:return t[e]||0}}function Sx(t,e){var r=/^(\*=|\+=|-=)/.exec(t);if(!r)return t;var n=gx(t)||0,i=parseFloat(e),o=parseFloat(t.replace(r[0],""));switch(r[0][0]){case"+":return i+o+n;case"-":return i-o+n;case"*":return i*o+n}}function Ax(t,e){if(Jy.col(t))return mx(t);if(/\s/g.test(t))return t;var r=gx(t),n=r?t.substr(0,t.length-r.length):t;return e?n+e:n}function Px(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Mx(t){for(var e,r=t.points,n=0,i=0;i<r.numberOfItems;i++){var o=r.getItem(i);i>0&&(n+=Px(e,o)),e=o}return n}function Ix(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return function(t){return 2*Math.PI*yx(t,"r")}(t);case"rect":return function(t){return 2*yx(t,"width")+2*yx(t,"height")}(t);case"line":return function(t){return Px({x:yx(t,"x1"),y:yx(t,"y1")},{x:yx(t,"x2"),y:yx(t,"y2")})}(t);case"polyline":return Mx(t);case"polygon":return function(t){var e=t.points;return Mx(t)+Px(e.getItem(e.numberOfItems-1),e.getItem(0))}(t)}}function Ox(t,e){var r=e||{},n=r.el||function(t){for(var e=t.parentNode;Jy.svg(e)&&Jy.svg(e.parentNode);)e=e.parentNode;return e}(t),i=n.getBoundingClientRect(),o=yx(n,"viewBox"),a=i.width,s=i.height,u=r.viewBox||(o?o.split(" "):[0,0,a,s]);return{el:n,viewBox:u,x:u[0]/1,y:u[1]/1,w:a,h:s,vW:u[2],vH:u[3]}}function Cx(t,e,r){function n(r){void 0===r&&(r=0);var n=e+r>=1?e+r:0;return t.el.getPointAtLength(n)}var i=Ox(t.el,t.svg),o=n(),a=n(-1),s=n(1),u=r?1:i.w/i.vW,l=r?1:i.h/i.vH;switch(t.property){case"x":return(o.x-i.x)*u;case"y":return(o.y-i.y)*l;case"angle":return 180*Math.atan2(s.y-a.y,s.x-a.x)/Math.PI}}function Rx(t,e){var r=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=Ax(Jy.pth(t)?t.totalLength:t,e)+"";return{original:n,numbers:n.match(r)?n.match(r).map(Number):[0],strings:Jy.str(t)||e?n.split(r):[]}}function Lx(t){return ux(t?lx(Jy.arr(t)?t.map(cx):cx(t)):[],(function(t,e,r){return r.indexOf(t)===e}))}function Nx(t){var e=Lx(t);return e.map((function(t,r){return{target:t,id:r,total:e.length,transforms:{list:wx(t)}}}))}function Fx(t,e){var r=px(e);if(/^spring/.test(r.easing)&&(r.duration=tx(r.easing)),Jy.arr(t)){var n=t.length;2===n&&!Jy.obj(t[0])?t={value:t}:Jy.fnc(e.duration)||(r.duration=e.duration/n)}var i=Jy.arr(t)?t:[t];return i.map((function(t,r){var n=Jy.obj(t)&&!Jy.pth(t)?t:{value:t};return Jy.und(n.delay)&&(n.delay=r?0:e.delay),Jy.und(n.endDelay)&&(n.endDelay=r===i.length-1?e.endDelay:0),n})).map((function(t){return fx(t,r)}))}function Dx(t,e){var r=[],n=e.keyframes;for(var i in n&&(e=fx(function(t){for(var e=ux(lx(t.map((function(t){return Object.keys(t)}))),(function(t){return Jy.key(t)})).reduce((function(t,e){return t.indexOf(e)<0&&t.push(e),t}),[]),r={},n=function(n){var i=e[n];r[i]=t.map((function(t){var e={};for(var r in t)Jy.key(r)?r==i&&(e.value=t[r]):e[r]=t[r];return e}))},i=0;i<e.length;i++)n(i);return r}(n),e)),e)Jy.key(i)&&r.push({name:i,tweens:Fx(e[i],t)});return r}function Ux(t,e){var r;return t.tweens.map((function(n){var i=function(t,e){var r={};for(var n in t){var i=vx(t[n],e);Jy.arr(i)&&1===(i=i.map((function(t){return vx(t,e)}))).length&&(i=i[0]),r[n]=i}return r.duration=parseFloat(r.duration),r.delay=parseFloat(r.delay),r}(n,e),o=i.value,a=Jy.arr(o)?o[1]:o,s=gx(a),u=Ex(e.target,t.name,s,e),l=r?r.to.original:u,c=Jy.arr(o)?o[0]:l,h=gx(c)||gx(u),p=s||h;return Jy.und(a)&&(a=l),i.from=Rx(c,p),i.to=Rx(Sx(a,c),p),i.start=r?r.end:0,i.end=i.start+i.delay+i.duration+i.endDelay,i.easing=ax(i.easing,i.duration),i.isPath=Jy.pth(o),i.isPathTargetInsideSVG=i.isPath&&Jy.svg(e.target),i.isColor=Jy.col(i.from.original),i.isColor&&(i.round=1),r=i,i}))}var kx={css:function(t,e,r){return t.style[e]=r},attribute:function(t,e,r){return t.setAttribute(e,r)},object:function(t,e,r){return t[e]=r},transform:function(t,e,r,n,i){if(n.list.set(e,r),e===n.last||i){var o="";n.list.forEach((function(t,e){o+=e+"("+t+") "})),t.style.transform=o}}};function jx(t,e){Nx(t).forEach((function(t){for(var r in e){var n=vx(e[r],t),i=t.target,o=gx(n),a=Ex(i,r,o,t),s=Sx(Ax(n,o||gx(a)),a),u=_x(i,r);kx[u](i,r,s,t.transforms,!0)}}))}function Bx(t,e){return ux(lx(t.map((function(t){return e.map((function(e){return function(t,e){var r=_x(t.target,e.name);if(r){var n=Ux(e,t),i=n[n.length-1];return{type:r,property:e.name,animatable:t,tweens:n,duration:i.end,delay:n[0].delay,endDelay:i.endDelay}}}(t,e)}))}))),(function(t){return!Jy.und(t)}))}function zx(t,e){var r=t.length,n=function(t){return t.timelineOffset?t.timelineOffset:0},i={};return i.duration=r?Math.max.apply(Math,t.map((function(t){return n(t)+t.duration}))):e.duration,i.delay=r?Math.min.apply(Math,t.map((function(t){return n(t)+t.delay}))):e.delay,i.endDelay=r?i.duration-Math.max.apply(Math,t.map((function(t){return n(t)+t.duration-t.endDelay}))):e.endDelay,i}var Gx=0;var Vx=[],Hx=function(){var t;function e(r){for(var n=Vx.length,i=0;i<n;){var o=Vx[i];o.paused?(Vx.splice(i,1),n--):(o.tick(r),i++)}t=i>0?requestAnimationFrame(e):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",(function(){Wx.suspendWhenDocumentHidden&&(Xx()?t=cancelAnimationFrame(t):(Vx.forEach((function(t){return t._onDocumentVisibility()})),Hx()))})),function(){t||Xx()&&Wx.suspendWhenDocumentHidden||!(Vx.length>0)||(t=requestAnimationFrame(e))}}();function Xx(){return!!document&&document.hidden}function Wx(t){void 0===t&&(t={});var e,r=0,n=0,i=0,o=0,a=null;function s(t){var e=window.Promise&&new Promise((function(t){return a=t}));return t.finished=e,e}var u=function(t){var e=dx(Xy,t),r=dx(Wy,t),n=Dx(r,t),i=Nx(t.targets),o=Bx(i,n),a=zx(o,r),s=Gx;return Gx++,fx(e,{id:s,children:[],animatables:i,animations:o,duration:a.duration,delay:a.delay,endDelay:a.endDelay})}(t);s(u);function l(){var t=u.direction;"alternate"!==t&&(u.direction="normal"!==t?"normal":"reverse"),u.reversed=!u.reversed,e.forEach((function(t){return t.reversed=u.reversed}))}function c(t){return u.reversed?u.duration-t:t}function h(){r=0,n=c(u.currentTime)*(1/Wx.speed)}function p(t,e){e&&e.seek(t-e.timelineOffset)}function d(t){for(var e=0,r=u.animations,n=r.length;e<n;){var i=r[e],o=i.animatable,a=i.tweens,s=a.length-1,l=a[s];s&&(l=ux(a,(function(e){return t<e.end}))[0]||l);for(var c=$y(t-l.start-l.delay,0,l.duration)/l.duration,h=isNaN(c)?1:l.easing(c),p=l.to.strings,d=l.round,f=[],m=l.to.numbers.length,g=void 0,v=0;v<m;v++){var y=void 0,x=l.to.numbers[v],b=l.from.numbers[v]||0;y=l.isPath?Cx(l.value,h*x,l.isPathTargetInsideSVG):b+h*(x-b),d&&(l.isColor&&v>2||(y=Math.round(y*d)/d)),f.push(y)}var _=p.length;if(_){g=p[0];for(var w=0;w<_;w++){p[w];var T=p[w+1],E=f[w];isNaN(E)||(g+=T?E+T:E+" ")}}else g=f[0];kx[i.type](o.target,i.property,g,o.transforms),i.currentValue=g,e++}}function f(t){u[t]&&!u.passThrough&&u[t](u)}function m(t){var h=u.duration,m=u.delay,g=h-u.endDelay,v=c(t);u.progress=$y(v/h*100,0,100),u.reversePlayback=v<u.currentTime,e&&function(t){if(u.reversePlayback)for(var r=o;r--;)p(t,e[r]);else for(var n=0;n<o;n++)p(t,e[n])}(v),!u.began&&u.currentTime>0&&(u.began=!0,f("begin")),!u.loopBegan&&u.currentTime>0&&(u.loopBegan=!0,f("loopBegin")),v<=m&&0!==u.currentTime&&d(0),(v>=g&&u.currentTime!==h||!h)&&d(h),v>m&&v<g?(u.changeBegan||(u.changeBegan=!0,u.changeCompleted=!1,f("changeBegin")),f("change"),d(v)):u.changeBegan&&(u.changeCompleted=!0,u.changeBegan=!1,f("changeComplete")),u.currentTime=$y(v,0,h),u.began&&f("update"),t>=h&&(n=0,u.remaining&&!0!==u.remaining&&u.remaining--,u.remaining?(r=i,f("loopComplete"),u.loopBegan=!1,"alternate"===u.direction&&l()):(u.paused=!0,u.completed||(u.completed=!0,f("loopComplete"),f("complete"),!u.passThrough&&"Promise"in window&&(a(),s(u)))))}return u.reset=function(){var t=u.direction;u.passThrough=!1,u.currentTime=0,u.progress=0,u.paused=!0,u.began=!1,u.loopBegan=!1,u.changeBegan=!1,u.completed=!1,u.changeCompleted=!1,u.reversePlayback=!1,u.reversed="reverse"===t,u.remaining=u.loop,e=u.children;for(var r=o=e.length;r--;)u.children[r].reset();(u.reversed&&!0!==u.loop||"alternate"===t&&1===u.loop)&&u.remaining++,d(u.reversed?u.duration:0)},u._onDocumentVisibility=h,u.set=function(t,e){return jx(t,e),u},u.tick=function(t){i=t,r||(r=i),m((i+(n-r))*Wx.speed)},u.seek=function(t){m(c(t))},u.pause=function(){u.paused=!0,h()},u.play=function(){u.paused&&(u.completed&&u.reset(),u.paused=!1,Vx.push(u),h(),Hx())},u.reverse=function(){l(),u.completed=!u.reversed,h()},u.restart=function(){u.reset(),u.play()},u.remove=function(t){qx(Lx(t),u)},u.reset(),u.autoplay&&u.play(),u}function Yx(t,e){for(var r=e.length;r--;)hx(t,e[r].animatable.target)&&e.splice(r,1)}function qx(t,e){var r=e.animations,n=e.children;Yx(t,r);for(var i=n.length;i--;){var o=n[i],a=o.animations;Yx(t,a),a.length||o.children.length||n.splice(i,1)}r.length||n.length||e.pause()}function $x(t,e,r){const n=t.slice();return n[10]=e[r],n[12]=r,n}function Qx(t){let e,r;return e=new qr({props:{text:t[10],style:t[3][t[12]],x:t[4][t[12]][0],y:t[4][t[12]][1],width:100,height:100,fontSize:60,fill:16777215,textStyle:{lineJoin:"bevel",strokeThickness:2,fill:16777215}}}),{c(){Q(e.$$.fragment)},m(t,n){Z(e,t,n),r=!0},p(t,r){const n={};4&r&&(n.text=t[10]),8&r&&(n.style=t[3][t[12]]),16&r&&(n.x=t[4][t[12]][0]),16&r&&(n.y=t[4][t[12]][1]),e.$set(n)},i(t){r||(Y(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Zx(t){let e,r,n,i,o,a,s,u,l,c;e=new Wr({props:{x:0,y:0,width:600,height:400,fill:6340791,brightness:1}}),n=new tn({props:{x:60,y:0,width:480,height:450,n:50,shape:"triangle",hue:t[0]?"pink":null,fill:null,randomFill:!0,delta:.4,direction:t[0]?"right":"zoom"}}),o=new rn({props:{x:450,y:150,offset:[[-10,-10],[10,10],[-10,20],[-30,0]],width:100,height:100,scale:.5+.5*t[5](t[1]),color:16777215}}),s=new rn({props:{x:180,y:0,offset:[[0,0],[10,10],[10,20],[-10,10]],width:100,height:100,scale:.5+.5*t[5](t[1]),color:16777215}});let h=t[2],p=[];for(let e=0;e<h.length;e+=1)p[e]=Qx($x(t,h,e));const g=t=>q(p[t],1,1,(()=>{p[t]=null}));return{c(){Q(e.$$.fragment),r=x(),Q(n.$$.fragment),i=x(),Q(o.$$.fragment),a=x(),Q(s.$$.fragment),u=x();for(let t=0;t<p.length;t+=1)p[t].c();l=b()},m(t,h){Z(e,t,h),d(t,r,h),Z(n,t,h),d(t,i,h),Z(o,t,h),d(t,a,h),Z(s,t,h),d(t,u,h);for(let e=0;e<p.length;e+=1)p[e].m(t,h);d(t,l,h),c=!0},p(t,[e]){const r={};1&e&&(r.hue=t[0]?"pink":null),1&e&&(r.direction=t[0]?"right":"zoom"),n.$set(r);const i={};2&e&&(i.scale=.5+.5*t[5](t[1])),o.$set(i);const a={};if(2&e&&(a.scale=.5+.5*t[5](t[1])),s.$set(a),28&e){let r;for(h=t[2],r=0;r<h.length;r+=1){const n=$x(t,h,r);p[r]?(p[r].p(n,e),Y(p[r],1)):(p[r]=Qx(n),p[r].c(),Y(p[r],1),p[r].m(l.parentNode,l))}for(X(),r=h.length;r<p.length;r+=1)g(r);W()}},i(t){if(!c){Y(e.$$.fragment,t),Y(n.$$.fragment,t),Y(o.$$.fragment,t),Y(s.$$.fragment,t);for(let t=0;t<h.length;t+=1)Y(p[t]);c=!0}},o(t){q(e.$$.fragment,t),q(n.$$.fragment,t),q(o.$$.fragment,t),q(s.$$.fragment,t),p=p.filter(Boolean);for(let t=0;t<p.length;t+=1)q(p[t]);c=!1},d(t){J(e,t),t&&f(r),J(n,t),t&&f(i),J(o,t),t&&f(a),J(s,t),t&&f(u),m(p,t),t&&f(l)}}}Wx.version="3.2.1",Wx.speed=1,Wx.suspendWhenDocumentHidden=!0,Wx.running=Vx,Wx.remove=function(t){for(var e=Lx(t),r=Vx.length;r--;){qx(e,Vx[r])}},Wx.get=Ex,Wx.set=jx,Wx.convertPx=xx,Wx.path=function(t,e){var r=Jy.str(t)?sx(t)[0]:t,n=e||100;return function(t){return{property:t,el:r,svg:Ox(r),totalLength:Ix(r)*(n/100)}}},Wx.setDashoffset=function(t){var e=Ix(t);return t.setAttribute("stroke-dasharray",e),e},Wx.stagger=function(t,e){void 0===e&&(e={});var r=e.direction||"normal",n=e.easing?ax(e.easing):null,i=e.grid,o=e.axis,a=e.from||0,s="first"===a,u="center"===a,l="last"===a,c=Jy.arr(t),h=c?parseFloat(t[0]):parseFloat(t),p=c?parseFloat(t[1]):0,d=gx(c?t[1]:t)||0,f=e.start||0+(c?h:0),m=[],g=0;return function(t,e,v){if(s&&(a=0),u&&(a=(v-1)/2),l&&(a=v-1),!m.length){for(var y=0;y<v;y++){if(i){var x=u?(i[0]-1)/2:a%i[0],b=u?(i[1]-1)/2:Math.floor(a/i[0]),_=x-y%i[0],w=b-Math.floor(y/i[0]),T=Math.sqrt(_*_+w*w);"x"===o&&(T=-_),"y"===o&&(T=-w),m.push(T)}else m.push(Math.abs(a-y));g=Math.max.apply(Math,m)}n&&(m=m.map((function(t){return n(t/g)*g}))),"reverse"===r&&(m=m.map((function(t){return o?t<0?-1*t:-t:Math.abs(g-t)})))}return f+(c?(p-h)/g:h)*(Math.round(100*m[e])/100)+d}},Wx.timeline=function(t){void 0===t&&(t={});var e=Wx(t);return e.duration=0,e.add=function(r,n){var i=Vx.indexOf(e),o=e.children;function a(t){t.passThrough=!0}i>-1&&Vx.splice(i,1);for(var s=0;s<o.length;s++)a(o[s]);var u=fx(r,dx(Wy,t));u.targets=u.targets||t.targets;var l=e.duration;u.autoplay=!1,u.direction=e.direction,u.timelineOffset=Jy.und(n)?l:Sx(n,l),a(e),e.seek(u.timelineOffset);var c=Wx(u);a(c),o.push(c);var h=zx(o,t);return e.delay=h.delay,e.endDelay=h.endDelay,e.duration=h.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e},Wx.easing=ax,Wx.penner=ox,Wx.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};const Jx={stageSet:class{constructor(t){let e=new ou;const r=bf(3939);for(let n=0;n<8;n++){let i=new Yo(100,100,100),o=new jo(i,t),a=new el(new xc(i,45),new Wu({color:13421772}));o.add(a),o.position.x=100*Math.floor(n/2)-150,o.position.z=n%2*100,o.position.y=0,o.rotation.x=.4*r()-.2,o.rotation.y=.4*r()-.2,o.rotation.z=.4*r()-.2,e.add(o)}e.position.y=120,this.geometry=null,this.material=t,this.mesh=e}},camera:{position:[150,-630,200]},projector:{position:[0,-512,0]}};function Kx(t,e,r){let n=1,i=!1;Af.beat.progress.subscribe((t=>{r(1,n=t)})),Af.chorus.now.subscribe((t=>{r(0,i=t)})),Af.vocalAmplitude.ratio.subscribe((t=>{}));let o=["","","","","","","",""],a=0,s=[{},{},{},{},{},{},{},{}],u=[[-30,-20],[80,-50],[220,-30],[330,-20],[-40,100],[80,100],[220,100],[340,100]];u.forEach(((t,e)=>{r(4,u[e][0]+=100,u),r(4,u[e][1]+=50,u)}));let l=!1;return Af.char.subscribe((t=>{t&&(l&&(r(2,o=["","","","","","","",""]),a=0,l=!1),r(2,o[a]=t.text,o),r(3,s[a]={opacity:1,scale:1.5},s),Wx.timeline().add({targets:s[a],opacity:[1,0],scale:[1,2],duration:950,delay:950,easing:"easeOutExpo",update:()=>{}}),a=(a+1)%o.length,t.parent.parent.lastChar===t&&(l=!0))})),t.$$.update=()=>{t.$$.dirty},[i,n,o,s,u,t=>t>3/4?3/4:t>.5?.5:t>1/4?1/4:t>=0?0:void 0]}class tb extends et{constructor(t){super(),tt(this,t,Kx,Zx,o,{})}}function eb(t,e,r){const n=t.slice();return n[9]=e[r],n[11]=r,n}function rb(t){let e,r;return e=new qr({props:{text:t[9],style:t[2][t[11]],x:150+50*t[11],y:180,width:50,height:50,fontSize:20,fill:t[0]?ob:16777215,textStyle:{lineJoin:"bevel",strokeThickness:2,fill:16777215}}}),{c(){Q(e.$$.fragment)},m(t,n){Z(e,t,n),r=!0},p(t,r){const n={};2&r&&(n.text=t[9]),4&r&&(n.style=t[2][t[11]]),1&r&&(n.fill=t[0]?ob:16777215),e.$set(n)},i(t){r||(Y(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function nb(t){let e,r,n,i,o,a;e=new on({props:{x:0,y:0,width:600,height:400,offset:[[50,0],[-50,0]],fills:[16777215,16738740],brightness:1}}),n=new tn({props:{x:60,y:0,width:480,height:450,n:100,shape:"line",fill:null,randomFill:!0,delta:.4,direction:t[0]?"zoom":"up"}});let s=t[1],u=[];for(let e=0;e<s.length;e+=1)u[e]=rb(eb(t,s,e));const l=t=>q(u[t],1,1,(()=>{u[t]=null}));return{c(){Q(e.$$.fragment),r=x(),Q(n.$$.fragment),i=x();for(let t=0;t<u.length;t+=1)u[t].c();o=b()},m(t,s){Z(e,t,s),d(t,r,s),Z(n,t,s),d(t,i,s);for(let e=0;e<u.length;e+=1)u[e].m(t,s);d(t,o,s),a=!0},p(t,[e]){const r={};if(1&e&&(r.direction=t[0]?"zoom":"up"),n.$set(r),7&e){let r;for(s=t[1],r=0;r<s.length;r+=1){const n=eb(t,s,r);u[r]?(u[r].p(n,e),Y(u[r],1)):(u[r]=rb(n),u[r].c(),Y(u[r],1),u[r].m(o.parentNode,o))}for(X(),r=s.length;r<u.length;r+=1)l(r);W()}},i(t){if(!a){Y(e.$$.fragment,t),Y(n.$$.fragment,t);for(let t=0;t<s.length;t+=1)Y(u[t]);a=!0}},o(t){q(e.$$.fragment,t),q(n.$$.fragment,t),u=u.filter(Boolean);for(let t=0;t<u.length;t+=1)q(u[t]);a=!1},d(t){J(e,t),t&&f(r),J(n,t),t&&f(i),m(u,t),t&&f(o)}}}const ib={stageSet:class{constructor(t){const e=new Wo;let r=new bc(180,180,100,32),n=new jo(r);n.rotation.x=Math.PI/2,e.mergeMesh(n),r=new wc(180,80,32),n=new jo(r),n.rotation.x=Math.PI/2,n.position.z=90,e.mergeMesh(n),n=new jo(e,t),n.position.y=180,this.geometry=r,this.material=t,this.mesh=n}},camera:{position:[150,-1200,400]},projector:{position:[0,-512,50]}},ob=6340791;function ab(t,e,r){let n=!1;Af.beat.progress.subscribe((t=>{})),Af.chorus.now.subscribe((t=>{r(0,n=t)})),Af.vocalAmplitude.ratio.subscribe((t=>{}));let i=["","","","","",""],o=0,a=[{},{},{},{},{},{}],s=!1;return Af.char.subscribe((t=>{t&&(s&&(r(1,i=["","","","","",""]),o=0,s=!1),r(1,i[o]=t.text,i),r(2,a[o]={opacity:1,scale:1.5},a),Wx.timeline().add({targets:a[o],opacity:[1,0],scale:[1,2],duration:950,delay:950,easing:"easeOutExpo",update:()=>{}}),o=(o+1)%i.length,t.parent.parent.lastChar===t&&(s=!0))})),t.$$.update=()=>{t.$$.dirty},[n,i,a]}class sb extends et{constructor(t){super(),tt(this,t,ab,nb,o,{})}}function ub(t,e,r){const n=t.slice();return n[9]=e[r],n[11]=r,n}function lb(t){let e,r;return e=new qr({props:{text:t[9],style:t[3][t[11]],x:150+50*t[11],y:200,width:50,height:50,fontSize:20,fill:t[0]?pb:16777215,textStyle:{lineJoin:"bevel",strokeThickness:2,fill:16777215}}}),{c(){Q(e.$$.fragment)},m(t,n){Z(e,t,n),r=!0},p(t,r){const n={};4&r&&(n.text=t[9]),8&r&&(n.style=t[3][t[11]]),1&r&&(n.fill=t[0]?pb:16777215),e.$set(n)},i(t){r||(Y(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function cb(t){let e,r,n,i,o,a,s,u;e=new Wr({props:{x:0,y:0,width:600,height:400,fill:t[0]?15658734:1444395,brightness:1}}),n=new tn({props:{x:60,y:0,width:480,height:450,n:100,shape:"circle",fill:null,randomFill:!0,hue:t[0]?"green":"blue",delta:.4,direction:t[0]?"right":"up"}}),o=new rn({props:{x:60,y:120,width:480,height:250,scale:.5+.5*t[4](t[1]),color:16777215,filters:[]}});let l=t[2],c=[];for(let e=0;e<l.length;e+=1)c[e]=lb(ub(t,l,e));const h=t=>q(c[t],1,1,(()=>{c[t]=null}));return{c(){Q(e.$$.fragment),r=x(),Q(n.$$.fragment),i=x(),Q(o.$$.fragment),a=x();for(let t=0;t<c.length;t+=1)c[t].c();s=b()},m(t,l){Z(e,t,l),d(t,r,l),Z(n,t,l),d(t,i,l),Z(o,t,l),d(t,a,l);for(let e=0;e<c.length;e+=1)c[e].m(t,l);d(t,s,l),u=!0},p(t,[r]){const i={};1&r&&(i.fill=t[0]?15658734:1444395),e.$set(i);const a={};1&r&&(a.hue=t[0]?"green":"blue"),1&r&&(a.direction=t[0]?"right":"up"),n.$set(a);const u={};if(2&r&&(u.scale=.5+.5*t[4](t[1])),o.$set(u),13&r){let e;for(l=t[2],e=0;e<l.length;e+=1){const n=ub(t,l,e);c[e]?(c[e].p(n,r),Y(c[e],1)):(c[e]=lb(n),c[e].c(),Y(c[e],1),c[e].m(s.parentNode,s))}for(X(),e=l.length;e<c.length;e+=1)h(e);W()}},i(t){if(!u){Y(e.$$.fragment,t),Y(n.$$.fragment,t),Y(o.$$.fragment,t);for(let t=0;t<l.length;t+=1)Y(c[t]);u=!0}},o(t){q(e.$$.fragment,t),q(n.$$.fragment,t),q(o.$$.fragment,t),c=c.filter(Boolean);for(let t=0;t<c.length;t+=1)q(c[t]);u=!1},d(t){J(e,t),t&&f(r),J(n,t),t&&f(i),J(o,t),t&&f(a),m(c,t),t&&f(s)}}}const hb={stageSet:class{constructor(t){let e=function(t,e){let r=new pa(1,1,t.length-1,1);for(let n=0,i=t.length;n<i;n++){let o=t[n];r.vertices[n].x=r.vertices[n+i].x=o.x,r.vertices[n].y=r.vertices[n+i].y=o.y,r.vertices[n].z=o.z+e,r.vertices[n+i].z=o.z}return r.computeFaceNormals(),r.computeVertexNormals(),r}(new Eh(new _n(-375,0,0),new _n(-187.5,187.5,0),new _n(187.5,187.5,0),new _n(375,0,0)).getPoints(100),300),r=new jo(e,t);r.position.z=0;let n=new el(new xc(e,45),new Wu({color:13421772}));r.add(n),r.position.y=180,this.geometry=e,this.material=t,this.mesh=r}},camera:{position:[0,-480,0]},projector:{position:[0,-512,-50],lookAt:[0,0,100]}},pb=6340791;function db(t,e,r){let n=1,i=!1;Af.beat.progress.subscribe((t=>{r(1,n=t)})),Af.chorus.now.subscribe((t=>{r(0,i=t)})),Af.vocalAmplitude.ratio.subscribe((t=>{}));let o=["","","","","",""],a=0,s=[{},{},{},{},{},{}],u=!1;return Af.char.subscribe((t=>{t&&(u&&(r(2,o=["","","","","",""]),a=0,u=!1),r(2,o[a]=t.text,o),r(3,s[a]={opacity:1,scale:1.5},s),Wx.timeline().add({targets:s[a],opacity:[1,0],scale:[1,2],duration:950,delay:950,easing:"easeOutExpo",update:()=>{}}),a=(a+1)%o.length,t.parent.parent.lastChar===t&&(u=!0))})),t.$$.update=()=>{t.$$.dirty},[i,n,o,s,t=>t>3/4?3/4:t>.5?.5:t>1/4?1/4:t>=0?0:void 0]}class fb extends et{constructor(t){super(),tt(this,t,db,cb,o,{})}}function mb(t,e,r){const n=t.slice();return n[43]=e[r],n[45]=r,n}function gb(t){let e,r,i,o,a,s,u,l,c,h,m,b,A,P,M,I,O,C,L,N,F,D,U,j,B,z,G,V,H,K,tt,et,rt,nt,it,ot,at,st,ut,lt,ct,ht,pt,dt,ft,mt,gt,vt,yt,xt,bt,_t,wt,Tt,Et,St,At,Pt,Mt,It,Ot,Ct,Rt,Lt,Nt,Ft,Dt,Ut,kt,jt,Bt,zt,Gt,Vt,Ht,Xt,Wt,Yt,qt,$t,Qt,Zt,Jt,Kt,te,ee,re,ne,ie,oe,ae,se,ue,le,ce,he=t[11]("move_horizontally")+"",pe=t[11]("menu.edit_items.edit_code")+"",de=t[11]("menu.edit")+"",fe=t[11]("menu.projector_mode")+"",me=t[11]("menu.settings")+"",ge=t[11]("menu.resolution")+"",ve=t[11]("menu.resolution_items.best")+"",ye=t[11]("menu.language")+"",xe=t[11]("menu.help")+"";m=new Hy({props:{animateWord:t[16],animateChar:t[17],handlers:{beatHandler:t[18],chorusHandler:t[19],vocalAmplitudeHandler:t[20]},songUrl:t[8].url}});let be=t[3]&&vb(t),_e=t[1]&&xb(t);function we(e){t[26].call(null,e)}let Te={width:"600",height:"400",style:"background:rgba(0,0,0,0.8);object-fit:contain;width:100%;height:100%;",$$slots:{default:[Sb]},$$scope:{ctx:t}};void 0!==t[1]&&(Te.canvas=t[1]),z=new Tr({props:Te}),R.push((()=>$(z,"canvas",we)));let Ee=t[7]&&Ab(t),Se=t[5].help&&Pb(t);return{c(){e=g("main"),r=g("div"),i=g("div"),o=g("div"),a=g("div"),s=g("div"),u=g("button"),l=v("svg"),c=v("path"),h=x(),Q(m.$$.fragment),b=x(),A=g("h1"),A.textContent="mmmapper",P=x(),be&&be.c(),M=x(),I=g("div"),O=g("div"),C=g("div"),L=y(he),N=x(),_e&&_e.c(),F=x(),D=g("div"),U=g("div"),j=g("div"),B=g("div"),Q(z.$$.fragment),V=x(),H=g("div"),Ee&&Ee.c(),K=x(),tt=g("div"),et=g("span"),rt=y(pe),it=x(),ot=g("div"),at=g("div"),st=g("button"),ut=g("div"),lt=v("svg"),ct=v("path"),ht=x(),pt=g("div"),dt=y(de),ft=x(),mt=g("div"),gt=g("button"),vt=g("div"),yt=v("svg"),xt=v("path"),bt=x(),_t=g("div"),wt=y(fe),Tt=x(),Et=g("div"),St=g("button"),At=g("div"),Pt=v("svg"),Mt=v("path"),It=x(),Ot=g("div"),Ct=y(me),Rt=x(),Lt=g("div"),Nt=g("div"),Ft=g("div"),Dt=y(ge),Ut=x(),kt=g("button"),jt=y(ve),Bt=x(),zt=g("button"),zt.textContent="1200x800",Gt=x(),Vt=g("button"),Vt.textContent="600x400",Ht=x(),Xt=g("div"),Wt=g("div"),Yt=y(ye),qt=x(),$t=g("button"),$t.textContent="English",Qt=x(),Zt=g("button"),Zt.textContent="日本語",Jt=x(),Kt=g("div"),te=g("button"),ee=g("div"),re=v("svg"),ne=v("path"),ie=x(),oe=g("div"),ae=y(xe),se=x(),Se&&Se.c(),w(c,"fill","#ffffff"),w(c,"d","M19,9H2V11H19V9M19,5H2V7H19V5M2,15H15V13H2V15M17,13V19L22,16L17,13Z"),E(l,"width","24px"),E(l,"height","24px"),w(l,"viewBox","0 0 24 24"),w(s,"class","flex items-center mr-2"),w(a,"class","flex items-center ml-3 mr-1"),w(A,"class","italic ml-1 mr-4 -mt-1 text-2xl text-white inline-block"),w(o,"class","h-12 flex items-center"),E(i,"max-width","360px"),w(i,"class","w-full md:mr-0 md:w-auto mt-3 border border-gray-700 bg-black bg-opacity-25 rounded text-white flex flex-col"),w(r,"class","absolute z-50 top-0 left-0 w-auto max-w-full px-3"),w(C,"class","text-sm text-white"),w(O,"class","mr-3 mt-3 flex items-center"),w(I,"id","control-help"),w(I,"class","absolute z-50 top-0 right-0 hidden md:inline-block svelte-174b49y"),w(B,"class","border"),E(B,"position","absolute"),E(B,"top","0"),E(B,"right","0"),E(B,"bottom","0"),E(B,"left","0"),w(et,"class","my-2"),E(et,"writing-mode","vertical-rl"),E(et,"text-orientation","sideways"),w(tt,"class","border w-6 bg-gray-300 rounded-r cursor-pointer"),w(H,"class","flex"),w(H,"style",nt=`position:absolute;left:100%;top:0;bottom:0;padding-right:2rem;${t[7]&&"width:calc(100vw - 100% - 2rem);"}`),w(j,"class","screen-container mb-2 absolute w-full max-w-full flex svelte-174b49y"),E(j,"bottom","100%"),S(j,"hidden",!t[2]),w(ct,"fill","#ffffff"),w(ct,"d","M4,2A1,1 0 0,0 3,3V4A1,1 0 0,0 4,5H5V14H11V16.59L6.79,20.79L8.21,22.21L11,19.41V22H13V19.41L15.79,22.21L17.21,20.79L13,16.59V14H19V5H20A1,1 0 0,0 21,4V3A1,1 0 0,0 20,2H4Z"),E(lt,"width","24px"),E(lt,"height","24px"),w(lt,"viewBox","0 0 24 24"),w(pt,"class","ml-1 text-white"),w(ut,"class","inline-block flex items-center mx-2 my-1"),w(st,"class","button svelte-174b49y"),w(at,"class","hidden md:inline-block"),w(xt,"fill",t[13]?"#2d3748":"#ffffff"),w(xt,"d","M16,6C14.87,6 13.77,6.35 12.84,7H4C2.89,7 2,7.89 2,9V15C2,16.11 2.89,17 4,17H5V18A1,1 0 0,0 6,19H8A1,1 0 0,0 9,18V17H15V18A1,1 0 0,0 16,19H18A1,1 0 0,0 19,18V17H20C21.11,17 22,16.11 22,15V9C22,7.89 21.11,7 20,7H19.15C18.23,6.35 17.13,6 16,6M16,7.5A3.5,3.5 0 0,1 19.5,11A3.5,3.5 0 0,1 16,14.5A3.5,3.5 0 0,1 12.5,11A3.5,3.5 0 0,1 16,7.5M4,9H8V10H4V9M16,9A2,2 0 0,0 14,11A2,2 0 0,0 16,13A2,2 0 0,0 18,11A2,2 0 0,0 16,9M4,11H8V12H4V11M4,13H8V14H4V13Z"),E(yt,"width","24px"),E(yt,"height","24px"),w(yt,"viewBox","0 0 24 24"),w(_t,"class","ml-1 text-white"),S(_t,"text-gray-800",t[13]),w(vt,"class","inline-block flex items-center mx-2 my-1"),w(gt,"class","button svelte-174b49y"),gt.disabled=t[13],S(gt,"disabled",t[13]),w(mt,"class","ml-2 hidden md:inline-block"),w(Mt,"fill","#ffffff"),w(Mt,"d","M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"),E(Pt,"width","24px"),E(Pt,"height","24px"),w(Pt,"viewBox","0 0 24 24"),w(Ot,"class","ml-1 text-white"),w(At,"class","inline-block flex items-center mx-2 my-1"),w(St,"class","button svelte-174b49y"),w(Ft,"class","px-2 py-1 text-gray-600 flex-none"),w(kt,"class","px-2 py-1 hover:bg-teal-300 flex-none"),S(kt,"bg-teal-300","full"===t[0]),w(zt,"class","px-2 py-1 hover:bg-teal-300 flex-none"),S(zt,"bg-teal-300","2"===t[0]),w(Vt,"class","px-2 py-1 hover:bg-teal-300 flex-none"),S(Vt,"bg-teal-300",null===t[0]),w(Nt,"class","flex flex-wrap"),w(Wt,"class","px-2 py-1 text-gray-600 flex-none"),w($t,"class","px-2 py-1 hover:bg-teal-300 flex-none"),S($t,"bg-teal-300",t[12].startsWith("en")),w(Zt,"class","px-2 py-1 hover:bg-teal-300 flex-none"),S(Zt,"bg-teal-300",t[12].startsWith("ja")),w(Xt,"class","flex flex-wrap"),E(Lt,"bottom","95%"),E(Lt,"right","0"),w(Lt,"class","absolute ml-2 bg-white rounded border flex flex-col"),S(Lt,"hidden",!t[5].resolution),w(Et,"class","md:ml-2"),w(ne,"fill","#ffffff"),w(ne,"d","M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"),E(re,"width","24px"),E(re,"height","24px"),w(re,"viewBox","0 0 24 24"),w(oe,"class","ml-1 text-white"),w(ee,"class","inline-block flex items-center mx-2 my-1"),w(te,"class","button svelte-174b49y"),w(Kt,"class","ml-2"),w(ot,"class","menu inline-block flex items-center svelte-174b49y"),w(U,"class","mb-3 ml-3"),w(D,"class","absolute z-50 bottom-0 left-0")},m(n,f){d(n,e,f),p(e,r),p(r,i),p(i,o),p(o,a),p(a,s),p(s,u),p(u,l),p(l,c),p(a,h),Z(m,a,null),p(o,b),p(o,A),p(i,P),be&&be.m(i,null),p(e,M),p(e,I),p(I,O),p(O,C),p(C,L),p(e,N),_e&&_e.m(e,null),p(e,F),p(e,D),p(D,U),p(U,j),p(j,B),Z(z,B,null),p(j,V),p(j,H),Ee&&Ee.m(H,null),p(H,K),p(H,tt),p(tt,et),p(et,rt),p(U,it),p(U,ot),p(ot,at),p(at,st),p(st,ut),p(ut,lt),p(lt,ct),p(ut,ht),p(ut,pt),p(pt,dt),p(ot,ft),p(ot,mt),p(mt,gt),p(gt,vt),p(vt,yt),p(yt,xt),p(vt,bt),p(vt,_t),p(_t,wt),p(ot,Tt),p(ot,Et),p(Et,St),p(St,At),p(At,Pt),p(Pt,Mt),p(At,It),p(At,Ot),p(Ot,Ct),p(Et,Rt),p(Et,Lt),p(Lt,Nt),p(Nt,Ft),p(Ft,Dt),p(Nt,Ut),p(Nt,kt),p(kt,jt),p(Nt,Bt),p(Nt,zt),p(Nt,Gt),p(Nt,Vt),p(Lt,Ht),p(Lt,Xt),p(Xt,Wt),p(Wt,Yt),p(Xt,qt),p(Xt,$t),p(Xt,Qt),p(Xt,Zt),p(ot,Jt),p(ot,Kt),p(Kt,te),p(te,ee),p(ee,re),p(re,ne),p(ee,ie),p(ee,oe),p(oe,ae),p(Kt,se),Se&&Se.m(Kt,null),ue=!0,le||(ce=[_(u,"click",t[23]),_(tt,"click",t[28]),_(st,"click",t[29]),_(gt,"click",t[30]),_(St,"click",t[31]),_(kt,"click",t[32]),_(zt,"click",t[33]),_(Vt,"click",t[34]),_($t,"click",t[35]),_(Zt,"click",t[36]),_(te,"click",t[37])],le=!0)},p(t,r){const n={};256&r[0]&&(n.songUrl=t[8].url),m.$set(n),t[3]?be?be.p(t,r):(be=vb(t),be.c(),be.m(i,null)):be&&(be.d(1),be=null),(!ue||2048&r[0])&&he!==(he=t[11]("move_horizontally")+"")&&T(L,he),t[1]?_e?(_e.p(t,r),2&r[0]&&Y(_e,1)):(_e=xb(t),_e.c(),Y(_e,1),_e.m(e,F)):_e&&(X(),q(_e,1,1,(()=>{_e=null})),W());const o={};838&r[0]|32768&r[1]&&(o.$$scope={dirty:r,ctx:t}),!G&&2&r[0]&&(G=!0,o.canvas=t[1],k((()=>G=!1))),z.$set(o),t[7]?Ee?(Ee.p(t,r),128&r[0]&&Y(Ee,1)):(Ee=Ab(t),Ee.c(),Y(Ee,1),Ee.m(H,K)):Ee&&(X(),q(Ee,1,1,(()=>{Ee=null})),W()),(!ue||2048&r[0])&&pe!==(pe=t[11]("menu.edit_items.edit_code")+"")&&T(rt,pe),(!ue||128&r[0]&&nt!==(nt=`position:absolute;left:100%;top:0;bottom:0;padding-right:2rem;${t[7]&&"width:calc(100vw - 100% - 2rem);"}`))&&w(H,"style",nt),4&r[0]&&S(j,"hidden",!t[2]),(!ue||2048&r[0])&&de!==(de=t[11]("menu.edit")+"")&&T(dt,de),(!ue||2048&r[0])&&fe!==(fe=t[11]("menu.projector_mode")+"")&&T(wt,fe),8192&r[0]&&S(_t,"text-gray-800",t[13]),8192&r[0]&&S(gt,"disabled",t[13]),(!ue||2048&r[0])&&me!==(me=t[11]("menu.settings")+"")&&T(Ct,me),(!ue||2048&r[0])&&ge!==(ge=t[11]("menu.resolution")+"")&&T(Dt,ge),(!ue||2048&r[0])&&ve!==(ve=t[11]("menu.resolution_items.best")+"")&&T(jt,ve),1&r[0]&&S(kt,"bg-teal-300","full"===t[0]),1&r[0]&&S(zt,"bg-teal-300","2"===t[0]),1&r[0]&&S(Vt,"bg-teal-300",null===t[0]),(!ue||2048&r[0])&&ye!==(ye=t[11]("menu.language")+"")&&T(Yt,ye),4096&r[0]&&S($t,"bg-teal-300",t[12].startsWith("en")),4096&r[0]&&S(Zt,"bg-teal-300",t[12].startsWith("ja")),32&r[0]&&S(Lt,"hidden",!t[5].resolution),(!ue||2048&r[0])&&xe!==(xe=t[11]("menu.help")+"")&&T(ae,xe),t[5].help?Se?(Se.p(t,r),32&r[0]&&Y(Se,1)):(Se=Pb(t),Se.c(),Y(Se,1),Se.m(Kt,null)):Se&&(X(),q(Se,1,1,(()=>{Se=null})),W())},i(t){ue||(Y(m.$$.fragment,t),Y(_e),Y(z.$$.fragment,t),Y(Ee),Y(Se),ue=!0)},o(t){q(m.$$.fragment,t),q(_e),q(z.$$.fragment,t),q(Ee),q(Se),ue=!1},d(t){t&&f(e),J(m),be&&be.d(),_e&&_e.d(),J(z),Ee&&Ee.d(),Se&&Se.d(),le=!1,n(ce)}}}function vb(t){let e,r=t[15],n=[];for(let e=0;e<r.length;e+=1)n[e]=yb(mb(t,r,e));return{c(){e=g("div");for(let t=0;t<n.length;t+=1)n[t].c();w(e,"class","playlist flex flex-col px-2 pt-3 pb-2 svelte-174b49y")},m(t,r){d(t,e,r);for(let t=0;t<n.length;t+=1)n[t].m(e,null)},p(t,i){if(33024&i[0]){let o;for(r=t[15],o=0;o<r.length;o+=1){const a=mb(t,r,o);n[o]?n[o].p(a,i):(n[o]=yb(a),n[o].c(),n[o].m(e,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=r.length}},d(t){t&&f(e),m(n,t)}}}function yb(t){let e,r,n,i,o,a=t[43].title+"";function s(){return t[24](t[43])}return{c(){e=g("div"),r=y(a),n=x(),w(e,"class","item svelte-174b49y"),S(e,"active",t[43]===t[8]),S(e,"mt-1",t[45]>0)},m(t,a){d(t,e,a),p(e,r),p(e,n),i||(o=_(e,"click",s),i=!0)},p(r,n){t=r,33024&n[0]&&S(e,"active",t[43]===t[8])},d(t){t&&f(e),i=!1,o()}}}function xb(t){let e,r,n,i,o,a,s,u,l,c=t[11]("click_to_return")+"";return r=new Ef({props:{canvas:t[1],stageSetup:t[8].stageSetup}}),{c(){e=g("div"),Q(r.$$.fragment),n=x(),i=g("div"),o=g("div"),a=y(c),S(e,"hidden",t[4]),w(o,"class","text-3xl text-white"),w(i,"class","fixed top-0 bottom-0 left-0 right-0 flex justify-center items-center"),S(i,"hidden",!t[4])},m(c,h){d(c,e,h),Z(r,e,null),d(c,n,h),d(c,i,h),p(i,o),p(o,a),s=!0,u||(l=_(i,"click",t[25]),u=!0)},p(t,n){const o={};2&n[0]&&(o.canvas=t[1]),256&n[0]&&(o.stageSetup=t[8].stageSetup),r.$set(o),16&n[0]&&S(e,"hidden",t[4]),(!s||2048&n[0])&&c!==(c=t[11]("click_to_return")+"")&&T(a,c),16&n[0]&&S(i,"hidden",!t[4])},i(t){s||(Y(r.$$.fragment,t),s=!0)},o(t){q(r.$$.fragment,t),s=!1},d(t){t&&f(e),J(r),t&&f(n),t&&f(i),u=!1,l()}}}function bb(e){let r,n,i=e[8].sketch,a=Eb(e);return{c(){a.c(),r=b()},m(t,e){a.m(t,e),d(t,r,e),n=!0},p(e,n){256&n[0]&&o(i,i=e[8].sketch)?(X(),q(a,1,1,t),W(),a=Eb(e),a.c(),Y(a),a.m(r.parentNode,r)):a.p(e,n)},i(t){n||(Y(a),n=!0)},o(t){q(a),n=!1},d(t){t&&f(r),a.d(t)}}}function _b(t){let e,r;return e=new em({props:{canvas:t[1],source:t[9],editMode:t[2]}}),{c(){Q(e.$$.fragment)},m(t,n){Z(e,t,n),r=!0},p(t,r){const n={};2&r[0]&&(n.canvas=t[1]),512&r[0]&&(n.source=t[9]),4&r[0]&&(n.editMode=t[2]),e.$set(n)},i(t){r||(Y(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function wb(t){let e,r,n;var i=t[8].sketch;return i&&(e=new i({})),{c(){e&&Q(e.$$.fragment),r=b()},m(t,i){e&&Z(e,t,i),d(t,r,i),n=!0},p(t,n){if(i!==(i=t[8].sketch)){if(e){X();const t=e;q(t.$$.fragment,1,0,(()=>{J(t,1)})),W()}i?(e=new i({}),Q(e.$$.fragment),Y(e.$$.fragment,1),Z(e,r.parentNode,r)):e=null}},i(t){n||(e&&Y(e.$$.fragment,t),n=!0)},o(t){e&&q(e.$$.fragment,t),n=!1},d(t){t&&f(r),e&&J(e,t)}}}function Tb(t){let e,r;return e=new Hr({props:{$$slots:{default:[wb]},$$scope:{ctx:t}}}),{c(){Q(e.$$.fragment)},m(t,n){Z(e,t,n),r=!0},p(t,r){const n={};256&r[0]|32768&r[1]&&(n.$$scope={dirty:r,ctx:t}),e.$set(n)},i(t){r||(Y(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Eb(t){let e,r;return e=new Br({props:{canvas:t[1],editMode:t[2],width:"600",height:"400",$$slots:{default:[Tb]},$$scope:{ctx:t}}}),{c(){Q(e.$$.fragment)},m(t,n){Z(e,t,n),r=!0},p(t,r){const n={};2&r[0]&&(n.canvas=t[1]),4&r[0]&&(n.editMode=t[2]),256&r[0]|32768&r[1]&&(n.$$scope={dirty:r,ctx:t}),e.$set(n)},i(t){r||(Y(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){J(e,t)}}}function Sb(t){let e,r,n,i;const o=[_b,bb],a=[];function s(t,e){return t[6]?0:t[1]&&t[8].sketch?1:-1}return~(e=s(t))&&(r=a[e]=o[e](t)),{c(){r&&r.c(),n=b()},m(t,r){~e&&a[e].m(t,r),d(t,n,r),i=!0},p(t,i){let u=e;e=s(t),e===u?~e&&a[e].p(t,i):(r&&(X(),q(a[u],1,1,(()=>{a[u]=null})),W()),~e?(r=a[e],r?r.p(t,i):(r=a[e]=o[e](t),r.c()),Y(r,1),r.m(n.parentNode,n)):r=null)},i(t){i||(Y(r),i=!0)},o(t){q(r),i=!1},d(t){~e&&a[e].d(t),t&&f(n)}}}function Ab(t){let e,r,n,i;function o(e){t[27].call(null,e)}let a={};return void 0!==t[9]&&(a.code=t[9]),r=new sm({props:a}),R.push((()=>$(r,"code",o))),{c(){e=g("div"),Q(r.$$.fragment),w(e,"class","bg-white")},m(t,n){d(t,e,n),Z(r,e,null),i=!0},p(t,e){const i={};!n&&512&e[0]&&(n=!0,i.code=t[9],k((()=>n=!1))),r.$set(i)},i(t){i||(Y(r.$$.fragment,t),i=!0)},o(t){q(r.$$.fragment,t),i=!1},d(t){t&&f(e),J(r)}}}function Pb(t){let e,r,n;function i(e){t[38].call(null,e)}let o={};return void 0!==t[5].help&&(o.open=t[5].help),e=new pr({props:o}),R.push((()=>$(e,"open",i))),{c(){Q(e.$$.fragment)},m(t,r){Z(e,t,r),n=!0},p(t,n){const i={};!r&&32&n[0]&&(r=!0,i.open=t[5].help,k((()=>r=!1))),e.$set(i)},i(t){n||(Y(e.$$.fragment,t),n=!0)},o(t){q(e.$$.fragment,t),n=!1},d(t){J(e,t)}}}function Mb(t){let e,r,n=!t[10]&&gb(t);return{c(){n&&n.c(),e=b()},m(t,i){n&&n.m(t,i),d(t,e,i),r=!0},p(t,r){t[10]?n&&(X(),q(n,1,1,(()=>{n=null})),W()):n?(n.p(t,r),1024&r[0]&&Y(n,1)):(n=gb(t),n.c(),Y(n,1),n.m(e.parentNode,e))},i(t){r||(Y(n),r=!0)},o(t){q(n),r=!1},d(t){n&&n.d(t),t&&f(e)}}}function Ib(t,e,r){let n,i,o;s(t,Me,(t=>r(10,n=t))),s(t,Ze,(t=>r(11,i=t))),s(t,Oe,(t=>r(12,o=t)));let a=null,u=!1,l=!0,c=!1,p=!1,d=null,f={resolution:!1,help:!1},m=!1,g=!1;const v=/Android|iPhone|iPad/i.test(navigator.userAgent),y=new URLSearchParams(window.location.search);"custom"===y.get("screenedit")&&(m=!0,g=!0,u=!0),d=y.get("hd"),Sf.manager.subscribe((t=>{l&&!p&&t&&(p=!0,r(3,l=!1))}));const x=[{title:"愛されなくても君がいる / ピノキオピー feat. 初音ミク",url:"https://www.youtube.com/watch?v=ygY2qObZv24",stageSetup:Jx,sketch:tb},{title:"ブレス・ユア・ブレス / 和田たけあき feat. 初音ミク",url:"https://www.youtube.com/watch?v=a-Nf3QUFkOU",stageSetup:ib,sketch:sb},{title:"グリーンライツ・セレナーデ / Omoi feat. 初音ミク",url:"https://www.youtube.com/watch?v=XSLhsjepelI",stageSetup:hb,sketch:fb}];let b=x[0],_="<script>\n    import { Screen, SketchWrapper } from '@mmmapper/components';\n    import { RectElement, TextElement } from '@mmmapper/components';\n\n    export let canvas, editMode, store;\n\n    let chars = ['', '', '', '', '', ''];\n    let charsIndex = 0;\n    let styles = [{}, {}, {}, {}, {}, {}];\n\n    let phraseEnd = false;\n\n    store.char.subscribe((newChar) => {\n      if (!newChar) return;\n      if (phraseEnd) {\n        chars = ['', '', '', '', '', ''];\n        charsIndex = 0;\n        phraseEnd = false;\n      }\n      chars[charsIndex] = newChar.text;\n      styles[charsIndex] = {\n        opacity: 1,\n        scale: 1,\n      };\n      charsIndex = (charsIndex + 1) % chars.length;\n      if (newChar.parent.parent.lastChar === newChar) {\n        phraseEnd = true;\n      }\n    });\n  <\/script>\n\n  <Screen {canvas} editMode={$editMode} width=\"600\" height=\"400\">\n    <SketchWrapper>\n      <RectElement\n        x={250}\n        y={150}\n        width={100}\n        height={100}\n        fill={0x60c0b7}\n        brightness={1} />\n      {#each chars as char, i}\n        <TextElement\n          text={char}\n          style={styles[i]}\n          x={150 + i * 50}\n          y={180}\n          width={50}\n          height={50}\n          fontSize={20}\n          fill={0xffffff}\n          textStyle={{ lineJoin: 'bevel', strokeThickness: 2, fill: 0xffffff }} />\n      {/each}\n    </SketchWrapper>\n  </Screen>\n  ";let w;function T(){const t=window.open("",null,"width=600,height=400,status"),e=document.head.cloneNode(!0);new xr({target:t.document.body,props:{self:t,head:e,canvas:a}})}function E(t){t?y.set("screenedit",t):y.delete("screenedit"),window.location.search=y.toString()}return t.$$.update=()=>{var e;1&t.$$.dirty[0]&&(e=d,y.get("hd")!==e&&(e?y.set("hd",e):y.delete("hd"),window.location.search=y.toString()))},[d,a,u,l,c,f,m,g,b,_,n,i,o,v,y,x,(t,e)=>{},(t,e)=>{e.contains(t+100)&&w!==e&&(Af.char.set(e),w=e)},(t,e)=>{Af.beat.progress.set(e.progress(t)),Af.beat.position.set({position:e.position,length:e.length})},(t,e)=>{Af.chorus.now.set(e)},(t,e)=>{Af.vocalAmplitude.ratio.set(e)},T,E,()=>{r(3,l=!l)},t=>{r(8,b=t)},()=>{r(4,c=!1)},function(t){a=t,r(1,a)},function(t){_=t,r(9,_)},()=>{"custom"!==y.get("screenedit")?E("custom"):r(7,g=!g)},()=>r(2,u=!u),()=>{T(),r(4,c=!0)},()=>{r(5,f.resolution=!f.resolution,f)},()=>{r(0,d="full")},()=>{r(0,d="2")},()=>{r(0,d=null)},()=>{h(Oe,o="en",o)},()=>{h(Oe,o="ja",o)},()=>{r(5,f.help=!f.help,f)},function(t){f.help=t,r(5,f)}]}var Ob={close:"Close",move_horizontally:"Move horizontally: Shift + Drag",click_to_return:"Click to return",menu:{edit:"Edit",edit_items:{edit_code:"Edit Code (β)"},projector_mode:"Projector Mode",settings:"Settings",resolution:"Resolution",resolution_items:{best:"Best"},language:"Language",help:"Help"},projector_window:{maximize:"Maximize",fullscreen:"Full screen (multi-display only)"}};var Cb={close:"閉じる",move_horizontally:"平行移動: Shift + ドラッグ",click_to_return:"クリックで復帰",menu:{edit:"編集",edit_items:{edit_code:"コード編集 (β)"},projector_mode:"プロジェクターモード",settings:"設定",resolution:"画質",resolution_items:{best:"最大"},language:"言語",help:"ヘルプ"},projector_window:{maximize:"最大化",fullscreen:"フルスクリーン (マルチディスプレイのみ)"}};xe("en",Ob),xe("en-US",Ob),xe("ja",Cb),xe("ja-JP",Cb),function(t){const{formats:e}=t,r=Se(t,["formats"]),n=t.initialLocale||t.fallbackLocale;Object.assign(Ae,r,{initialLocale:n}),e&&("number"in e&&Object.assign(Ae.formats.number,e.number),"date"in e&&Object.assign(Ae.formats.date,e.date),"time"in e&&Object.assign(Ae.formats.time,e.time)),Oe.set(n)}({fallbackLocale:"en",initialLocale:"undefined"==typeof window?null:window.navigator.language||window.navigator.languages[0]});new class extends et{constructor(t){super(),tt(this,t,Ib,Mb,o,{},[-1,-1])}}({target:document.body});export{$r as a,Qr as c};
